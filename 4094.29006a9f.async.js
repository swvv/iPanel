(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4094],{64335:function(Ar,ne,Q){"use strict";var Pe=Q(67294),ye=(0,Pe.createContext)({});ne.Z=ye},21349:function(Ar,ne,Q){"use strict";var Pe=Q(84305),ye=Q(75901),m=Q(53645),Oe=Q.n(m),W=Q(67294),pe=Q(94184),ce=Q.n(pe),Be=Q(64335),_e=function(pt){var Et=(0,W.useContext)(Be.Z),Jt=pt.children,ur=pt.contentWidth,kt=pt.className,er=pt.style,jt=(0,W.useContext)(ye.ZP.ConfigContext),ct=jt.getPrefixCls,dt=pt.prefixCls||ct("pro"),ir=ur||Et.contentWidth,Y="".concat(dt,"-grid-content");return W.createElement("div",{className:ce()(Y,kt,{wide:ir==="Fixed"}),style:er},W.createElement("div",{className:"".concat(dt,"-grid-content-children")},Jt))};ne.Z=_e},41480:function(Ar,ne,Q){"use strict";Q.d(ne,{zP:function(){return zM},JE:function(){return K5},ns:function(){return NM}});var Pe={};Q.r(Pe),Q.d(Pe,{add:function(){return Pr},adjoint:function(){return Od},clone:function(){return va},copy:function(){return dc},create:function(){return El},determinant:function(){return Rd},equals:function(){return hn},exactEquals:function(){return Qt},frob:function(){return or},fromQuat:function(){return sr},fromQuat2:function(){return fe},fromRotation:function(){return Xl},fromRotationTranslation:function(){return z},fromRotationTranslationScale:function(){return Pt},fromRotationTranslationScaleOrigin:function(){return Yt},fromScaling:function(){return dh},fromTranslation:function(){return Aa},fromValues:function(){return So},fromXRotation:function(){return Of},fromYRotation:function(){return vh},fromZRotation:function(){return kd},frustum:function(){return dr},getRotation:function(){return rr},getScaling:function(){return Ot},getTranslation:function(){return De},identity:function(){return hh},invert:function(){return zp},lookAt:function(){return Ut},mul:function(){return Wr},multiply:function(){return Bu},multiplyScalar:function(){return Nn},multiplyScalarAndAdd:function(){return qt},ortho:function(){return Cr},orthoNO:function(){return vr},orthoZO:function(){return nt},perspective:function(){return Sr},perspectiveFromFieldOfView:function(){return Zr},perspectiveNO:function(){return mr},perspectiveZO:function(){return Tr},rotate:function(){return cp},rotateX:function(){return fp},rotateY:function(){return Up},rotateZ:function(){return Xc},scale:function(){return lp},set:function(){return Ks},str:function(){return Fr},sub:function(){return br},subtract:function(){return Yr},targetTo:function(){return gr},translate:function(){return up},transpose:function(){return $h}});var ye=Q(67294),m=(0,ye.createContext)({});function Oe(){return(0,ye.useContext)(m)}var W={},pe={},ce=function(i){return pe[i]},Be=function(i,r){pe[i]=r},_e=function(i){return W[i]},tt=function(i,r){W[i]=r},pt={},Et={},Jt=34,ur=10,kt=13;function er(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function jt(e,i){var r=er(e);return function(n,a){return i(r(n),a,e)}}function ct(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function dt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function ir(e){return e<0?"-"+dt(-e,6):e>9999?"+"+dt(e,6):dt(e,4)}function Y(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ir(e.getUTCFullYear(),4)+"-"+dt(e.getUTCMonth()+1,2)+"-"+dt(e.getUTCDate(),2)+(a?"T"+dt(i,2)+":"+dt(r,2)+":"+dt(n,2)+"."+dt(a,3)+"Z":n?"T"+dt(i,2)+":"+dt(r,2)+":"+dt(n,2)+"Z":r||i?"T"+dt(i,2)+":"+dt(r,2)+"Z":"")}function Wt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,k){var F,V,K=a(T,function(ee,be){if(F)return F(ee,be-1);V=ee,F=k?jt(ee,k):er(ee)});return K.columns=V||[],K}function a(T,k){var F=[],V=T.length,K=0,ee=0,be,je=V<=0,Ke=!1;T.charCodeAt(V-1)===ur&&--V,T.charCodeAt(V-1)===kt&&--V;function et(){if(je)return Et;if(Ke)return Ke=!1,pt;var It,Kt=K,hr;if(T.charCodeAt(Kt)===Jt){for(;K++<V&&T.charCodeAt(K)!==Jt||T.charCodeAt(++K)===Jt;);return(It=K)>=V?je=!0:(hr=T.charCodeAt(K++))===ur?Ke=!0:hr===kt&&(Ke=!0,T.charCodeAt(K)===ur&&++K),T.slice(Kt+1,It-1).replace(/""/g,'"')}for(;K<V;){if((hr=T.charCodeAt(It=K++))===ur)Ke=!0;else if(hr===kt)Ke=!0,T.charCodeAt(K)===ur&&++K;else if(hr!==r)continue;return T.slice(Kt,It)}return je=!0,T.slice(Kt,V)}for(;(be=et())!==Et;){for(var At=[];be!==pt&&be!==Et;)At.push(be),be=et();k&&(At=k(At,ee++))==null||F.push(At)}return F}function s(T,k){return T.map(function(F){return k.map(function(V){return C(F[V])}).join(e)})}function p(T,k){return k==null&&(k=ct(T)),[k.map(C).join(e)].concat(s(T,k)).join(`
`)}function v(T,k){return k==null&&(k=ct(T)),s(T,k).join(`
`)}function y(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?Y(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:p,formatBody:v,formatRows:y,formatRow:x,formatValue:C}}var ut=Wt(","),qe=ut.parse,St=ut.parseRows,Qe=ut.format,Xt=ut.formatBody,wr=ut.formatRows,Gr=ut.formatRow,Qr=ut.formatValue,A=Q(96156),Ce=Q(85061),ke=Q(38163),xt=Q.n(ke);function ht(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ft(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ht(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,v=[];return e.forEach(function(y,x){var C=[];if(r&&n&&(C=[parseFloat(y[r]),parseFloat(y[n])]),r&&n&&a&&s){var T=[parseFloat(y[r]),parseFloat(y[n])],k=[parseFloat(y[a]),parseFloat(y[s])];C=[T,k]}if(p){var F="Polygon";Array.isArray(p[0])||(F="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(F="LineString");var V={type:F,coordinates:(0,Ce.Z)(y[p])};xt()(V,!0),C=V.coordinates}var K=Ft(Ft({},y),{},{_id:x,coordinates:C});v.push(K)}),{dataArray:v}}var Er=[{lng1:100,lat1:30,lng2:130,lat2:30}],Qn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function gn(e,i){var r=qe(e);return Gt(r,i)}var di=63710088e-1,Hn={centimeters:di*100,centimetres:di*100,degrees:di/111325,feet:di*3.28084,inches:di*39.37,kilometers:di/1e3,kilometres:di/1e3,meters:di,metres:di,miles:di/1609.344,millimeters:di*1e3,millimetres:di*1e3,nauticalmiles:di/1852,radians:1,yards:di*1.0936},ai={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/di,yards:1.0936133},vi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Xn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function mi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return fa(i).geometry;case"LineString":return pa(i).geometry;case"Polygon":return Li(i).geometry;case"MultiPoint":return Ni(i).geometry;case"MultiLineString":return _a(i).geometry;case"MultiPolygon":return aa(i).geometry;default:throw new Error(e+" is invalid")}}function fa(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(e[0])||!wn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Xn(n,i,r)}function Wi(e,i,r){return r===void 0&&(r={}),Ia(e.map(function(n){return fa(n,i)}),r)}function Li(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Xn(v,i,r)}function Qi(e,i,r){return r===void 0&&(r={}),Ia(e.map(function(n){return Li(n,i)}),r)}function pa(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Xn(n,i,r)}function Lo(e,i,r){return r===void 0&&(r={}),Ia(e.map(function(n){return pa(n,i)}),r)}function Ia(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function _a(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Xn(n,i,r)}function Ni(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Xn(n,i,r)}function aa(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Xn(n,i,r)}function Ji(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Xn(n,i,r)}function Ss(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function he(e,i){i===void 0&&(i="kilometers");var r=Hn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function oi(e,i){i===void 0&&(i="kilometers");var r=Hn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function xo(e,i){return Nt(oi(e,i))}function Js(e){var i=e%360;return i<0&&(i+=360),i}function Nt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function $t(e){var i=e%360;return i*Math.PI/180}function Ir(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return he(oi(e,i),r)}function nn(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=vi[i];if(!n)throw new Error("invalid original units");var a=vi[r];if(!a)throw new Error("invalid final units");return e/n*a}function wn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function zn(e){return!!e&&e.constructor===Object}function xi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!wn(i))throw new Error("bbox must only contain numbers")})}function fi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function En(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ii(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Pi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Pi(e[0]);throw new Error("coordinates must only contain numbers")}function to(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function fs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Go(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Da(e){return e.type==="Feature"?e.geometry:e}function xa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function G(e,i,r){if(e!==null)for(var n,a,s,p,v,y,x,C=0,T=0,k,F=e.type,V=F==="FeatureCollection",K=F==="Feature",ee=V?e.features.length:1,be=0;be<ee;be++){x=V?e.features[be].geometry:K?e.geometry:e,k=x?x.type==="GeometryCollection":!1,v=k?x.geometries.length:1;for(var je=0;je<v;je++){var Ke=0,et=0;if(p=k?x.geometries[je]:x,p!==null){y=p.coordinates;var At=p.type;switch(C=r&&(At==="Polygon"||At==="MultiPolygon")?1:0,At){case null:break;case"Point":if(i(y,T,be,Ke,et)===!1)return!1;T++,Ke++;break;case"LineString":case"MultiPoint":for(n=0;n<y.length;n++){if(i(y[n],T,be,Ke,et)===!1)return!1;T++,At==="MultiPoint"&&Ke++}At==="LineString"&&Ke++;break;case"Polygon":case"MultiLineString":for(n=0;n<y.length;n++){for(a=0;a<y[n].length-C;a++){if(i(y[n][a],T,be,Ke,et)===!1)return!1;T++}At==="MultiLineString"&&Ke++,At==="Polygon"&&et++}At==="Polygon"&&Ke++;break;case"MultiPolygon":for(n=0;n<y.length;n++){for(et=0,a=0;a<y[n].length;a++){for(s=0;s<y[n][a].length-C;s++){if(i(y[n][a][s],T,be,Ke,et)===!1)return!1;T++}et++}Ke++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(G(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function q(e,i,r,n){var a=r;return G(e,function(s,p,v,y,x){p===0&&r===void 0?a=s:a=i(a,s,p,v,y,x)},n),a}function te(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function de(e,i,r){var n=r;return te(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Me(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ve(e,i,r){var n=r;return Me(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function $e(e){var i=[];return G(e,function(r){i.push(r)}),i}function oe(e,i){var r,n,a,s,p,v,y,x,C,T,k=0,F=e.type==="FeatureCollection",V=e.type==="Feature",K=F?e.features.length:1;for(r=0;r<K;r++){for(v=F?e.features[r].geometry:V?e.geometry:e,x=F?e.features[r].properties:V?e.properties:{},C=F?e.features[r].bbox:V?e.bbox:void 0,T=F?e.features[r].id:V?e.id:void 0,y=v?v.type==="GeometryCollection":!1,p=y?v.geometries.length:1,a=0;a<p;a++){if(s=y?v.geometries[a]:v,s===null){if(i(null,k,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,k,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],k,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function Re(e,i,r){var n=r;return oe(e,function(a,s,p,v,y){s===0&&r===void 0?n=a:n=i(n,a,s,p,v,y)}),n}function lt(e,i){oe(e,function(r,n,a,s,p){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Xn(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var y;switch(v){case"MultiPoint":y="Point";break;case"MultiLineString":y="LineString";break;case"MultiPolygon":y="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:y,coordinates:C};if(i(Xn(T,a),n,x)===!1)return!1}})}function cr(e,i,r){var n=r;return lt(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function Rt(e,i){lt(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var v,y=0,x=0,C=0;if(G(r,function(T,k,F,V,K){if(v===void 0||n>y||V>x||K>C){v=T,y=n,x=V,C=K,s=0;return}var ee=lineString([v,T],r.properties);if(i(ee,n,a,K,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function Lt(e,i,r){var n=r,a=!1;return Rt(e,function(s,p,v,y,x){a===!1&&r===void 0?n=s:n=i(n,s,p,v,y,x),a=!0}),n}function pr(e,i){if(!e)throw new Error("geojson is required");lt(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<p.length;v++)if(i(lineString(p[v],r.properties),n,a,v)===!1)return!1;break}}})}function _n(e,i,r){var n=r;return pr(e,function(a,s,p,v){s===0&&r===void 0?n=a:n=i(n,a,s,p,v)}),n}function un(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var y=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=y.length+s-1),lineString([y[s],y[s+1]],p,i);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s-1),lineString([y[a][s],y[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=y.length+n),s<0&&(s=y[n].length+s-1),lineString([y[n][s],y[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=y.length+n),a<0&&(a=y[n].length+a),s<0&&(s=y[n][a].length-s-1),lineString([y[n][a][s],y[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function Ct(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var y=v.coordinates;switch(v.type){case"Point":return point(y,p,i);case"MultiPoint":return n<0&&(n=y.length+n),point(y[n],p,i);case"LineString":return s<0&&(s=y.length+s),point(y[s],p,i);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s),point(y[a][s],p,i);case"MultiLineString":return n<0&&(n=y.length+n),s<0&&(s=y[n].length+s),point(y[n][s],p,i);case"MultiPolygon":return n<0&&(n=y.length+n),a<0&&(a=y[n].length+a),s<0&&(s=y[n][a].length-s),point(y[n][a][s],p,i)}throw new Error("geojson is invalid")}function Kr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kr(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hr(e,i){var r=[],n={};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),xt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return lt(e,function(s,p){var v=Ii(s),y=p,x=Dr(Dr({},s.properties),{},{coordinates:v,_id:y});r.push(x)}),{dataArray:r,featureKeys:n}}function pi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function $r(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var yn=Q(28481),Zi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function li(e){this.message=e}li.prototype=new Error,li.prototype.name="InvalidCharacterError";function Ci(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new li("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Zi.indexOf(s);return r}function gi(e){e=String(e);for(var i,r,n,a,s="",p=0,v=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Zi.charAt(i>>18&63)+Zi.charAt(i>>12&63)+Zi.charAt(i>>6&63)+Zi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ft=Q(6610),Mt=Q(5991),wa=function(){function e(i,r){(0,ft.Z)(this,e),this.buffers=i,this.type=r}return(0,Mt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Ai=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Di=Ai?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Rr=Q(10379),cn=Q(46070),_t=Q(77608),ea=(0,Mt.Z)(function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),le=Q(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ki(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Ki(e,i){if(!!e){if(typeof e=="string")return fu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fu(e,i)}}function fu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Fa=new WeakMap,Ta=function(){function e(){(0,ft.Z)(this,e),Fa.set(this,{})}return(0,Mt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Fa.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),Fa.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Fa.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var v=p.length;v--;v>0)if(p[v]===n){p.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Fa.get(this)[r.type];if(n){var a=Ko(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Ha(e){var i=ta();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function ta(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wo=function(e){(0,Rr.Z)(r,e);var i=Ha(r);function r(){var n;return(0,ft.Z)(this,r),n=i.call(this),(0,A.Z)((0,le.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Mt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ta);function Ho(e){var i=Eu();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Eu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ho=function(e){(0,Rr.Z)(r,e);var i=Ho(r);function r(){var n;return(0,ft.Z)(this,r),n=i.call(this),(0,A.Z)((0,le.Z)(n),"className",void 0),(0,A.Z)((0,le.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Mt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(wo),Do=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ra,Wa,Fo,Xa;if(Do){var Cs=my.getSystemInfoSync();ra=Cs.screenWidth,Wa=Cs.screenHeight,Fo=Cs.windowWidth,Xa=Cs.windowHeight}else{var Tl=Ei.innerWidth,ps=Ei.innerHeight;ra=Tl,Wa=ps,Fo=Tl,Xa=ps}var J={width:ra,height:Wa,availWidth:Fo,availHeight:Xa,availLeft:0,availTop:0},ge=J.availWidth,We=J.availHeight,Tt={style:[]};function Mr(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Tt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Tt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Mn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ge+"px",height:We+"px",margin:"0px",padding:"0px"})}function wi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ge,e.clientHeight=We),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ro(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ge,e.offsetHeight=We)}function Oa(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ge,e.scrollHeight=We)}function Ba(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Wo(e){var i=hs();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function hs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function uo(){}var To=function(e){(0,Rr.Z)(r,e);var i=Wo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ft.Z)(this,r),n=i.call(this),(0,A.Z)((0,le.Z)(n),"className",void 0),(0,A.Z)((0,le.Z)(n),"children",void 0),(0,A.Z)((0,le.Z)(n),"focus",void 0),(0,A.Z)((0,le.Z)(n),"blur",void 0),(0,A.Z)((0,le.Z)(n),"insertBefore",void 0),(0,A.Z)((0,le.Z)(n),"appendChild",void 0),(0,A.Z)((0,le.Z)(n),"removeChild",void 0),(0,A.Z)((0,le.Z)(n),"remove",void 0),(0,A.Z)((0,le.Z)(n),"innerHTML",void 0),(0,A.Z)((0,le.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=uo,n.blur=uo,n.insertBefore=uo,n.appendChild=uo,n.removeChild=uo,n.remove=uo,n.innerHTML="",n.tagName=a.toUpperCase(),Mr((0,le.Z)(n),s),Mn((0,le.Z)(n)),Ba((0,le.Z)(n)),wi((0,le.Z)(n)),ro((0,le.Z)(n)),Oa((0,le.Z)(n)),n}return(0,Mt.Z)(r)}(ho);function ds(e){var i=As();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function As(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rs=function(e){(0,Rr.Z)(r,e);var i=ds(r);function r(n){return(0,ft.Z)(this,r),i.call(this,n)}return(0,Mt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(To);function eu(e){var i=vs();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ha=function(e){(0,Rr.Z)(r,e);var i=eu(r);function r(){return(0,ft.Z)(this,r),i.call(this,"video")}return(0,Mt.Z)(r)}(Rs),ya={},rs={};function nf(e,i){ya=e,ya.id=i,"tagName"in ya||(ya.tagName="CANVAS"),ya.type="canvas",Mixin.parentNode(ya),Mixin.style(ya),Mixin.classList(ya),Mixin.clientRegion(ya),Mixin.offsetRegion(ya),ya.focus=function(){},ya.blur=function(){}}function Ml(e,i){var r=1024,n=1024;rs={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in rs||(rs.tagName="CANVAS"),Mixin.parentNode(rs),Mixin.style(rs),Mixin.classList(rs),Mixin.clientRegion(rs),Mixin.offsetRegion(rs),rs.getContext=function(a){if(a==="2d")return e},rs.focus=function(){},rs.blur=function(){}}function Zs(){return ya}function ec(){return rs}var Hu=(0,Mt.Z)(function e(){(0,ft.Z)(this,e);var i=Zs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Mr(r),Ba(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),js={href:"",protocol:"",host:""};function ul(e){var i=_();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,Rr.Z)(r,e);var i=ul(r);function r(){return(0,ft.Z)(this,r),i.call(this,"body",0)}return(0,Mt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(To),B=function(e){(0,Rr.Z)(r,e);var i=ul(r);function r(){return(0,ft.Z)(this,r),i.call(this,"html",0)}return(0,Mt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(To),R={},X={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:js,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Hu:i==="video"?new ha:new To(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){R[i]||(R[i]=[]),R[i].push(r)},removeEventListener:function(i,r){var n=R[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=R[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new ea(i)}};X.documentElement=new B,X.head=new To("head"),X.body=new M;var me=Object,Ge=Q(90484),ot=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Ge.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Mt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),st=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,tr,ar,Tn;if(st){var ti=my.getSystemInfoSync();tr=ti.system,ar=ti.platform,Tn=ti.language}else{var Rn={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};Rn.versions.android?ar="android":Rn.versions.trident?ar="IE":Rn.versions.presto?ar="Opera":Rn.versions.webKit?ar="webKit":Rn.versions.gecko?ar="Firefox":Rn.versions.mobile?ar="mobile":Rn.versions.ios?ar="ios":Rn.versions.iPhone?ar="iPhone":Rn.versions.iPad?ar="ipad":Rn.versions.webApp?ar="webApp":Rn.versions.weixin?ar="weixin":Rn.versions.qq&&(ar="qq"),tr=Ei.navigator.userAgent,Tn=Rn.language}var ji=tr.toLowerCase().indexOf("android")!==-1,ua=ji?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ea="Mozilla/5.0 (".concat(ua,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Tn),zi={platform:ar,language:Tn,appVersion:"5.0 (".concat(ua,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ea},ms={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},tu=0,Wu=0;function af(e){var i=Date.now(),r=Math.max(tu+23,i);return Wu=setTimeout(function(){e(tu=r)},r-i),Wu}function ll(e){var i=Zs();return i.requestAnimationFrame?i.requestAnimationFrame(e):af(e)}function Mc(e){var i=Zs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Su=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ft.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Mt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Cu(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function Cu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return gi(i)}var Au={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},lo={};function Zf(e){var i=jf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function jf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Pc=new Map,wu=new Map,ru={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function of(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Pl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,of.call(this,"readystatechange",i)}var Oi=function(e){(0,Rr.Z)(r,e);var i=Zf(r);function r(){var n;return(0,ft.Z)(this,r),n=i.call(this),(0,A.Z)((0,le.Z)(n),"onabort",void 0),(0,A.Z)((0,le.Z)(n),"onerror",void 0),(0,A.Z)((0,le.Z)(n),"onload",void 0),(0,A.Z)((0,le.Z)(n),"onloadstart",void 0),(0,A.Z)((0,le.Z)(n),"onprogress",void 0),(0,A.Z)((0,le.Z)(n),"ontimeout",void 0),(0,A.Z)((0,le.Z)(n),"onloadend",void 0),(0,A.Z)((0,le.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,le.Z)(n),"readyState",void 0),(0,A.Z)((0,le.Z)(n),"response",void 0),(0,A.Z)((0,le.Z)(n),"responseText",void 0),(0,A.Z)((0,le.Z)(n),"_responseType",void 0),(0,A.Z)((0,le.Z)(n),"responseXML",void 0),(0,A.Z)((0,le.Z)(n),"status",void 0),(0,A.Z)((0,le.Z)(n),"statusText",void 0),(0,A.Z)((0,le.Z)(n),"upload",void 0),(0,A.Z)((0,le.Z)(n),"withCredentials",void 0),(0,A.Z)((0,le.Z)(n),"timeout",void 0),(0,A.Z)((0,le.Z)(n),"_url",void 0),(0,A.Z)((0,le.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Mt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=wu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Pc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Pc.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=$o.get("requestHeader");p[a]=s,$o.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||p,s.call(p,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ta);(0,A.Z)(Oi,"UNSEND",void 0),(0,A.Z)(Oi,"OPENED",void 0),(0,A.Z)(Oi,"HEADERS_RECEIVED",void 0),(0,A.Z)(Oi,"LOADING",void 0),(0,A.Z)(Oi,"DONE",void 0),Oi.UNSEND=0,Oi.OPENED=1,Oi.HEADERS_RECEIVED=2,Oi.LOADING=3,Oi.DONE=4;function Il(e){var i=Mp();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Mp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cl=function(e){(0,Rr.Z)(r,e);var i=Il(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,le.Z)(a),"touches",void 0),(0,A.Z)((0,le.Z)(a),"targetTouches",void 0),(0,A.Z)((0,le.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Zs(),a.currentTarget=Zs(),a}return(0,Mt.Z)(r)}(ea);function Ic(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,v=p===void 0?0:p,y=i.clientY,x=y===void 0?0:y;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Vf(e){return function(i){var r=new cl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Ic(n)}),r.touches.forEach(function(n){return Ic(n)}),r.targetTouches.forEach(function(n){return Ic(n)}),X.dispatchEvent(r)}}function Pp(e){return function(i){i.type=e,X.dispatchEvent(i)}}var Gf=Vf("touchstart"),Oc=Vf("touchmove"),tc=Vf("touchend"),rc=Pp("mapCameaParams");function Ol(e){var i=fl();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rl=function(e){(0,Rr.Z)(r,e);var i=Ol(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,le.Z)(a),"buttons",void 0),(0,A.Z)((0,le.Z)(a),"which",void 0),(0,A.Z)((0,le.Z)(a),"pointerId",void 0),(0,A.Z)((0,le.Z)(a),"bubbles",void 0),(0,A.Z)((0,le.Z)(a),"button",void 0),(0,A.Z)((0,le.Z)(a),"width",void 0),(0,A.Z)((0,le.Z)(a),"height",void 0),(0,A.Z)((0,le.Z)(a),"pressure",void 0),(0,A.Z)((0,le.Z)(a),"isPrimary",void 0),(0,A.Z)((0,le.Z)(a),"pointerType",void 0),(0,A.Z)((0,le.Z)(a),"altKey",void 0),(0,A.Z)((0,le.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,le.Z)(a),"metaKey",void 0),(0,A.Z)((0,le.Z)(a),"shiftKey",void 0),a.target=Zs(),a.currentTarget=Zs(),a}return(0,Mt.Z)(r)}(ea),Xu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Vs=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],sf="touch";function uf(e,i,r){for(var n=new Rl(e),a=0;a<Xu.length;a++){var s=Xu[a];n[s]=i[s]||Vs[a]}return n.type=e,n.target=Zs(),n.currentTarget=Zs(),n.buttons=Hf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=nc(i),n.pointerType=sf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Hf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var nu=null;function nc(e){return nu===e.identifier}function Rc(e){nu===null&&(nu=e.identifier)}function lf(e){nu===e.identifier&&(nu=null)}function kl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Rc(a):(e==="pointerup"||e==="pointercancel")&&lf(a);var s=uf(e,a,i);X.dispatchEvent(s)}}}var oh=kl("pointerdown"),cf=kl("pointermove"),Ll=kl("pointerup");function ff(e){var i=pf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function pf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dl=function(e){(0,Rr.Z)(r,e);var i=ff(r);function r(n){return(0,ft.Z)(this,r),i.call(this,n)}return(0,Mt.Z)(r)}(ea);function kc(e){return function(i){i.type=e,X.dispatchEvent(i)}}var Ip=kc("mousedown"),Op=kc("mousemove"),ic=kc("mouseup"),Rp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Fl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Yi=Rp||Fl,ac={atob:Ci,btoa:gi,devicePixelRatio:Di,Blob:wa,document:X,Element:ho,Event:ea,EventTarget:Ta,HTMLCanvasElement:me,HTMLElement:To,HTMLMediaElement:Rs,HTMLVideoElement:ha,Image:Hu,ImageData:ot,navigator:zi,Node:wo,requestAnimationFrame:ll,cancelAnimationFrame:Mc,screen:J,XMLHttpRequest:Oi,performance:ms,URL:Su,WebGLRenderingContext:Au,WebGL2RenderingContext:lo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};X.addEventListener(i,r,n)},removeEventListener:function(i,r,n){X.removeEventListener(i,r)},dispatchEvent:function(i){X.dispatchEvent(i)},innerWidth:J.availWidth,innerHeight:J.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},oa=Yi?ac:Ei,Tu=Yi?Oi:Ei.XMLHttpRequest,Vi=Yi?js:Ei.location;function Ma(e){var i=e;return typeof e=="string"&&(i=oa.document.getElementById(e)),i}function gs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Lc(e){return gs(e).split(/\s+/)}function Yu(e){var i,r,n=oa==null||(i=oa.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Na(e,i,r){var n=oa.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function oc(e){var i=e.parentNode;i&&i.removeChild(e)}function Bl(e,i){if(e.classList!==void 0)for(var r=Lc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Dc(e,i)){var s=vo(e);Mu(e,(s?s+" ":"")+i)}}function qu(e,i){e.classList!==void 0?e.classList.remove(i):Mu(e,gs((" "+vo(e)+" ").replace(" "+i+" "," ")))}function Dc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=vo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Mu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function vo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Nl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var sc=Yu(["transform","WebkitTransform"]);function mo(e,i){e.style[sc]=i}function pn(){if(typeof Event=="function")oa.dispatchEvent(new Event("resize"));else{var e=oa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,oa,0),oa.dispatchEvent(e)}}function co(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Ku(){var e,i=oa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,yn.Z)(s,2),v=p[0],y=p[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var Ra=Ku()<1?1:oa.devicePixelRatio,Gs=Q(14665);function ws(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var hf=Q(51814);function Ur(e,i,r){return(0,hf.Z)()?Ur=Reflect.construct:Ur=function(a,s,p){var v=[null];v.push.apply(v,s);var y=Function.bind.apply(a,v),x=new y;return p&&(0,Gs.Z)(x,p.prototype),x},Ur.apply(null,arguments)}function uc(e){var i=typeof Map=="function"?new Map:void 0;return uc=function(n){if(n===null||!ws(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Ur(n,arguments,(0,_t.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Gs.Z)(a,n)},uc(e)}function df(e){var i=pl();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sa=function(e){(0,Rr.Z)(r,e);var i=df(r);function r(n,a,s){var p;return(0,ft.Z)(this,r),p=i.call(this,n),(0,A.Z)((0,le.Z)(p),"status",void 0),(0,A.Z)((0,le.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,Mt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(uc(Error));function ys(e){var i=new Tu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var vf=function(i,r){var n=ys(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Sa("".concat(n.statusText),n.status,i.url)):r(new Sa(n.statusText,n.status,i.url))},n.send(),n},Pu=function(i,r){var n=ys(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Sa(n.statusText,n.status,i.url))},n.send(),n};function ks(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Iu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Wf=function(i,r){return Pu(i,function(n,a){if(n)r(n);else if(a){var s=new oa.Image;s.crossOrigin="anonymous";var p=oa.URL||oa.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var v=new oa.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(v):Iu}})},hl=2*Math.PI*6378137/2;function Xf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;mf(i,n)}),i}function mf(e,i){return Array.isArray(i[0])?i.forEach(function(r){mf(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function iu(e,i){return Ts(e,i)}function Ts(e,i){return Array.isArray(e[0])?e.map(function(r){return Ts(r,i)}):i(e)}function Si(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=dl(e,i);var n=e[0],a=e[1],s=n*hl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*hl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function Ou(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/hl*180,s=n/hl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function au(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Xo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function dl(e,i){if(i===!1)return e;var r=au(e[0]),n=Xo(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function ns(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var v=.5/Math.PI,y=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+y),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function Hs(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),v=p[0],y=p[1];v=(v/s-r)/i,y=(y/s-a)/n,y=(Math.atan(Math.pow(Math.E,y))-Math.PI/4)*2,a=Math.PI/180;var x=y/a,C=v/a;return[C,x]}function _s(e,i,r){var n=$t(i[1]-e[1]),a=$t(i[0]-e[0]),s=$t(e[1]),p=$t(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return he(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function pu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[p,v]}function In(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Cn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Fc(e){return[[e[0],e[1]],[e[2],e[3]]]}function is(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function ou(e,i){return e[0]*i[0]+e[1]*i[1]}function Bo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ru(e,i){return Math.acos(ou(e,i)/(Bo(e)*Bo(i)))*180/Math.PI}function gf(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function yf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],v=e[s+1],y=is(p,v);n+=y;var x=[p[0]-v[0],p[1]-v[1]],C=gf(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:p,end:v,dis:y,rotation:C,duration:0})}return a.map(function(k){k.duration=i*(k.dis/n)}),a}}var la=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ft.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Mt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function da(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var kp=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ft.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Mt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),$u=Q(2650);function hu(e){return typeof e=="string"?!!$u.ZP(e):!1}function Gi(e){var i=$u.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function no(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Ws(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Xs(e){var i=oa.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var y=(e.positions[v]-s)/(p-s);n.addColorStop(y,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Yi)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var vl;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(vl||(vl={}));var ku={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zl(e,i,r){var n=e.classList;for(var a in ku)ku.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function ja(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var su={BACK:1029,FRONT:1028};function du(e){switch(e){case"GAODE1.x":return su.BACK;case"GAODE2.x":return su.BACK;case"MAPBOX":return su.FRONT;case"SIMPLE":return su.FRONT;case"GLOBEL":return su.BACK;case"L7MAP":return su.FRONT;default:return su.FRONT}}function Yf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function ml(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Qu(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function _f(e){if(e.length===0)throw new Error("mean requires at least one data point");return Qu(e)/e.length}function gl(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var Ms={min:ml,max:Yf,mean:_f,sum:Qu,mode:gl};function lc(e,i){return e.map(function(r){return r[i]})}function Bc(e,i){return Ms[e](i)}function xf(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){cc(e,function(v){p(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function cc(e,i){var r=e,n=[];if(typeof r=="string")Wf({url:r},function(p,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(p){Wf({url:p},function(v,y){s++,n.push(y),s===a&&i(n)})})}return xf}function l(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var f=Q(30236),c=Q.n(f),d=Q(47037),E=Q.n(d),w=Q(23560),P=Q.n(w),L=Q(50361),U=Q.n(L),H=Q(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ae(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function v(C){try{x(n.next(C))}catch(T){p(T)}}function y(C){try{x(n.throw(C))}catch(T){p(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,y)}x((n=n.apply(e,i||[])).next())})}function se(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(x){return function(C){return y([x,C])}}function y(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function ue(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){p={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function Ie(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(ue(arguments[i]));return e}function Ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Fe(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Ae=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Ee(Ae);var Ue=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Ee(Ue);var Ye=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof H=="object"&&typeof H.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(y){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return y.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=H.nextTick:p=a,i.default=s(p)});Ee(Ye);var vt=Ye.fallback,Vt=Ye.wrap,zt=Ye.hasSetImmediate,Ht=Ye.hasNextTick,fr=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ue),n=a(Ye);function a(y){return y&&y.__esModule?y:{default:y}}function s(y){return(0,xr.isAsync)(y)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),k=y.apply(this,x);return p(k,T)}:(0,r.default)(function(x,C){var T;try{T=y.apply(this,x)}catch(k){return C(k)}if(T&&typeof T.then=="function")return p(T,C);C(null,T)})}function p(y,x){return y.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(y,x,C){try{y(x,C)}catch(T){(0,n.default)(function(k){throw k},T)}}e.exports=i.default});Ee(fr);var xr=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(fr);function n(y){return y&&y.__esModule?y:{default:y}}function a(y){return y[Symbol.toStringTag]==="AsyncFunction"}function s(y){return y[Symbol.toStringTag]==="AsyncGenerator"}function p(y){return typeof y[Symbol.asyncIterator]=="function"}function v(y){if(typeof y!="function")throw new Error("expected a function");return a(y)?(0,r.default)(y):y}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});Ee(xr);var Or=xr.isAsyncIterable,an=xr.isAsyncGenerator,Un=xr.isAsync,On=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,v=[],y=arguments.length;y--;)v[y]=arguments[y];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var k=[],F=arguments.length-1;F-- >0;)k[F]=arguments[F+1];if(T)return C(T);x(k.length>1?k:k[0])},n.apply(p,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Ee(On);var Bn=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Ae),n=s(xr),a=s(On);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,v,y){var x=(0,r.default)(v)?[]:{};p(v,function(C,T,k){(0,n.default)(C)(function(F){for(var V,K=[],ee=arguments.length-1;ee-- >0;)K[ee]=arguments[ee+1];K.length<2&&(V=K,K=V[0]),x[T]=K,k(F)})},function(C){return y(C,x)})},3),e.exports=i.default});Ee(Bn);var Ti=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Ee(Ti);var tn=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Ee(tn);var ri=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=y;var r=a(Ae),n=a(tn);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var k=x.next();return k.done?null:(C++,{value:k.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,k=C.length;return function(){var V=C[++T];return T<k?{value:x[V],key:V}:null}}function y(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):v(x)}e.exports=i.default});Ee(ri);var ni=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});Ee(ni);var Yn=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Ee(Yn);var Vn=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Yn);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,v,y){var x=!1,C=!1,T=!1,k=0,F=0;function V(){k>=p||T||x||(T=!0,s.next().then(function(be){var je=be.value,Ke=be.done;if(!(C||x)){if(T=!1,Ke){x=!0,k<=0&&y(null);return}k++,v(je,F,K),F++,V()}}).catch(ee))}function K(be,je){if(k-=1,!C){if(be)return ee(be);if(be===!1){x=!0,C=!0;return}if(je===r.default||x&&k<=0)return x=!0,y(null);V()}}function ee(be){C||(T=!1,x=!0,y(be))}V()}e.exports=i.default});Ee(Vn);var ci=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(Ti),n=v(ri),a=v(ni),s=v(Vn),p=v(Yn);function v(y){return y&&y.__esModule?y:{default:y}}i.default=function(y){return function(x,C,T){if(T=(0,r.default)(T),y<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,xr.isAsyncGenerator)(x))return(0,s.default)(x,y,C,T);if((0,xr.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),y,C,T);var k=(0,n.default)(x),F=!1,V=!1,K=0,ee=!1;function be(Ke,et){if(!V)if(K-=1,Ke)F=!0,T(Ke);else if(Ke===!1)F=!0,V=!0;else{if(et===p.default||F&&K<=0)return F=!0,T(null);ee||je()}}function je(){for(ee=!0;K<y&&!F;){var Ke=k();if(Ke===null){F=!0,K<=0&&T(null);return}K+=1,C(Ke.value,Ke.key,(0,a.default)(be))}ee=!1}je()}},e.exports=i.default});Ee(ci);var Wn=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(ci),n=s(xr),a=s(On);function s(v){return v&&v.__esModule?v:{default:v}}function p(v,y,x,C){return(0,r.default)(y)(v,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});Ee(Wn);var Gn=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Wn),n=a(On);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v,y){return(0,r.default)(p,1,v,y)}i.default=(0,n.default)(s,3),e.exports=i.default});Ee(Gn);var bo=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Bn),n=a(Gn);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,r.default)(n.default,p,v)}e.exports=i.default}),Va=Ee(bo),ka=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Va(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Ie(n.args)),a(null,i)})},e}(),Mo=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(Ae),n=x(Yn),a=x(Wn),s=x(Ti),p=x(ni),v=x(xr),y=x(On);function x(F){return F&&F.__esModule?F:{default:F}}function C(F,V,K){K=(0,s.default)(K);var ee=0,be=0,je=F.length,Ke=!1;je===0&&K(null);function et(At,It){At===!1&&(Ke=!0),Ke!==!0&&(At?K(At):(++be===je||It===n.default)&&K(null))}for(;ee<je;ee++)V(F[ee],ee,(0,p.default)(et))}function T(F,V,K){return(0,a.default)(F,Infinity,V,K)}function k(F,V,K){var ee=(0,r.default)(F)?C:T;return ee(F,(0,v.default)(V),K)}i.default=(0,y.default)(k,3),e.exports=i.default});Ee(Mo);var Ya=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Mo),n=a(Bn);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,n.default)(r.default,p,v)}e.exports=i.default}),fo=Ee(Ya),Ps=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return fo(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return ae(n,void 0,void 0,function(){return se(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),as=Fe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(Ti),n=p(ni),a=p(xr),s=p(On);function p(y){return y&&y.__esModule?y:{default:y}}function v(y,x){if(x=(0,r.default)(x),!Array.isArray(y))return x(new Error("First argument to waterfall must be an array of functions"));if(!y.length)return x();var C=0;function T(F){var V=(0,a.default)(y[C++]);V.apply(void 0,F.concat([(0,n.default)(k)]))}function k(F){for(var V=[],K=arguments.length-1;K-- >0;)V[K]=arguments[K+1];if(F!==!1){if(F||C===y.length)return x.apply(void 0,[F].concat(V));T(V)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),Lu=Ee(as),os=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Lu(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Ls=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Va(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),go=Q(26729),fc=Q.n(go),Ul=Q(69848),vu=Q.n(Ul);function yl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ys(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,v=p===void 0?0:p,y=i.zoom,x=y===void 0?2:y;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=jl(C),e}var T=new(vu())({radius:n,minZoom:v,maxZoom:s}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:Zl({},F)}}),T.load(k.features),T}function jl(e){return e.map(function(i,r){return Zl({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function mu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Eo(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function gu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Ju(e){if(e.length===0)throw new Error("mean requires at least one data point");return gu(e)/e.length}var el={min:Eo,max:mu,mean:Ju,sum:gu};function na(e,i){return e.map(function(r){return r[i]*1})}function Is(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function No(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Is(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Is(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tl(e){var i=Nc();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zc(e,i){if(Array.isArray(i))return i}var bf=function(e){(0,Rr.Z)(r,e);var i=tl(r);function r(n,a){var s;return(0,ft.Z)(this,r),s=i.call(this),(0,A.Z)((0,le.Z)(s),"data",void 0),(0,A.Z)((0,le.Z)(s),"extent",void 0),(0,A.Z)((0,le.Z)(s),"hooks",{init:new ka}),(0,A.Z)((0,le.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,le.Z)(s),"transforms",[]),(0,A.Z)((0,le.Z)(s),"cluster",!1),(0,A.Z)((0,le.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,le.Z)(s),"mapService",void 0),(0,A.Z)((0,le.Z)(s),"invalidExtent",!1),(0,A.Z)((0,le.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,le.Z)(s),"originData",void 0),(0,A.Z)((0,le.Z)(s),"rawData",void 0),(0,A.Z)((0,le.Z)(s),"cfg",{}),(0,A.Z)((0,le.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Mt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,v=p.method,y=v===void 0?"sum":v,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||P()(y))&&(C=C.map(function(T){var k=T.id;if(k){var F=s.clusterIndex.getLeaves(k,Infinity),V=F.map(function(be){return be.properties}),K;if(E()(y)&&x){var ee=na(V,x);K=el[y](ee)}P()(y)&&(K=y(V)),T.properties.stat=K}else T.properties.point_count=1;return T})),this.data=ce("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",y=U()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});y.properties=x}return y}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?No(No({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(v){return v[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=In(Fc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=c()(this.cfg,a,zc);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=No(No({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=ce(s);this.data=p(this.originData,a),this.extent=Xf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var v=p.type,y=_e(v)(a.data,p);Object.assign(a.data,y)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=Ys(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(go.EventEmitter);function qs(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Vl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=uu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function uu(e,i){if(!!e){if(typeof e=="string")return rl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rl(e,i)}}function rl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Gl=6378e3;function yu(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Gl)*(256<<20)/2,p=zo(r,a),v=p.gridHash,y=p.gridOffset,x=Kf(v,y,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function zo(e,i){var r=Infinity,n=-Infinity,a,s=Vl(e),p;try{for(s.s();!(p=s.n()).done;){var v=p.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Ke){s.e(Ke)}finally{s.f()}var y=(r+n)/2,x=Uc(i,y);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=Vl(e),k;try{for(T.s();!(k=T.n()).done;){var F=k.value,V=F.coordinates[1],K=F.coordinates[0];if(Number.isFinite(V)&&Number.isFinite(K)){var ee=Math.floor((V+90)/x.yOffset),be=Math.floor((K+180)/x.xOffset),je="".concat(ee,"-").concat(be);C[je]=C[je]||{count:0,points:[]},C[je].count+=1,C[je].points.push(F)}}}catch(Ke){T.e(Ke)}finally{T.f()}return{gridHash:C,gridOffset:x}}function Uc(e,i){var r=qf(e),n=Lp(i,e);return{yOffset:r,xOffset:n}}function qf(e){return e/Gl*(180/Math.PI)}function Lp(e,i){return i/Gl*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Kf(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),v=parseInt(p[0],10),y=parseInt(p[1],10),x={};if(r.field&&r.method){var C=lc(e[a].points,r.field);x[r.method]=Ms[r.method](C)}return Object.assign(x,{_id:s,coordinates:ns([-180+i.xOffset*(y+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var pc=Math.PI/3,sh=[0,pc,2*pc,3*pc,4*pc,5*pc];function hc(e){return e[0]}function Ef(e){return e[1]}function Dp(){var e=0,i=0,r=1,n=1,a=hc,s=Ef,p,v,y;function x(T){var k={},F=[],V,K=T.length;for(V=0;V<K;++V)if(!(isNaN(be=+a.call(null,ee=T[V],V,T))||isNaN(je=+s.call(null,ee,V,T)))){var ee,be,je,Ke=Math.round(je=je/y),et=Math.round(be=be/v-(Ke&1)/2),At=je-Ke;if(Math.abs(At)*3>1){var It=be-et,Kt=et+(be<et?-1:1)/2,hr=Ke+(je<Ke?-1:1),zr=be-Kt,rn=je-hr;It*It+At*At>zr*zr+rn*rn&&(et=Kt+(Ke&1?1:-1)/2,Ke=hr)}var _r=et+"-"+Ke,Sn=k[_r];Sn?Sn.push(ee):(F.push(Sn=k[_r]=[ee]),Sn.x=(et+(Ke&1)/2)*v,Sn.y=Ke*y)}return F}function C(T){var k=0,F=0;return sh.map(function(V){var K=Math.sin(V)*T,ee=-Math.cos(V)*T,be=K-k,je=ee-F;return k=K,F=ee,[be,je]})}return x.hexagon=function(T){return"m"+C(T==null?p:+T).join("l")+"z"},x.centers=function(){for(var T=[],k=Math.round(i/y),F=Math.round(e/v),V=k*y;V<n+p;V+=y,++k)for(var K=F*v+(k&1)*v/2;K<r+v/2;K+=v)T.push([K,V]);return T},x.mesh=function(){var T=C(p).slice(0,4).join("l");return x.centers().map(function(k){return"M"+k+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(p=+T,v=p*2*Math.sin(pc),y=p*1.5,x):p},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function uh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _l(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?uh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Sf=6378e3;function jh(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,v=a/(2*Math.PI*Sf)*(256<<20)/2,y=r.map(function(k){var F=ns(k.coordinates),V=(0,yn.Z)(F,2),K=V[0],ee=V[1];return _l(_l({},k),{},{coordinates:[K,ee]})}),x=Dp().radius(v).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),C=x(y),T={dataArray:C.map(function(k,F){var V;if(i.field&&p){var K=lc(k,i.field);k[p]=Ms[p](K)}return V={},(0,A.Z)(V,i.method,k[p]),(0,A.Z)(V,"count",k.length),(0,A.Z)(V,"rawData",k),(0,A.Z)(V,"coordinates",[k.x,k.y]),(0,A.Z)(V,"_id",F),V}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function Vh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lh(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var v=p[n];return Zc(Zc({},p),s[v])}),e}function Td(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Be("geojson",Hr),Be("image",xf),Be("csv",gn),Be("json",Gt),Be("raster",l),tt("cluster",Ys),tt("filter",qs),tt("join",lh),tt("map",Td),tt("grid",yu),tt("hexagon",jh);var Md=Er,Gh=Qn,ch=bf,dv=Q(28660),Lr=Q(86700),Pd=Q(84879),bt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Fp=Q(31745),Hh=Q.n(Fp);function $f(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$f(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$f(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Cf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Bp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Bp(e,i){if(!!e){if(typeof e=="string")return Af(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Af(e,i)}}function Af(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Du=30;function wf(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,v=p===void 0?{}:p,y=e.xOffset,x=y===void 0?0:y,C=e.yOffset,T=C===void 0?0:C,k=0,F=x;Array.from(i).forEach(function(K,ee){if(!v[K]){var be=r(K,ee);F+Du>s&&(F=0,k++),v[K]={x:F,y:T+k*Du,width:Du,height:Du,advance:be},F+=Du}});var V=n+a*2;return{mapping:v,xOffset:F,yOffset:T+k*V,canvasHeight:Hl(T+(k+1)*V)}}function Jf(e,i,r){var n=0,a=0,s=0,p=[],v={},y=Cf(e),x;try{for(y.s();!(x=y.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(ep(v,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(F){y.e(F)}finally{y.f()}p.length>0&&ep(v,p,a);var k=Hl(s+a+i);return{mapping:v,canvasHeight:k}}function ep(e,i,r){var n=Cf(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,v=s.xOffset;e[p.id]=Qf(Qf({},p),{},{x:v,y:r,image:p.image,width:p.width,height:p.height})}}catch(y){n.e(y)}finally{n.f()}}function Hl(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var tp,Tf;function rp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Mf(e,i){if(!!e){if(typeof e=="string")return jc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jc(e,i)}}function jc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ds(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ds(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ds(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var np=qh(),ip="sans-serif",ap="normal",Np=24,xl=3,Gc=.25,Wh=8,op=1024,Xh=1,Yh=1,Id=3,Fu=null;function qh(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function sp(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Hc(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var nl=(tp=(0,Lr.b2)(),tp(Tf=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new la(Id))}return(0,Mt.Z)(e,[{key:"scale",get:function(){return Yh}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ip,fontWeight:ap,characterSet:np,fontSize:Np,buffer:xl,sdf:!0,cutoff:Gc,radius:Wh,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Vc(Vc({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,v=s.fontWeight,y=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,k=s.cutoff,F=s.iconfont,V=a&&a.data;V||(V=oa.document.createElement("canvas"),V.width=op);var K=V.getContext("2d");sp(K,p,y,v);var ee=wf(Vc({getFontWidth:function(Us){return K.measureText(Us).width},fontHeight:y*Yh,buffer:x,characterSet:n,maxCanvasWidth:op},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),be=ee.mapping,je=ee.canvasHeight,Ke=ee.xOffset,et=ee.yOffset,At=K.getImageData(0,0,V.width,V.height);if(V.height=je,K.putImageData(At,0,0),sp(K,p,y,v),C){var It=new(Hh())(y,x,T,k,p,v),Kt=K.getImageData(0,0,It.size,It.size),hr=rp(n),zr;try{for(hr.s();!(zr=hr.n()).done;){var rn=zr.value;if(F){var _r=String.fromCharCode(parseInt(rn.replace("&#x","").replace(";",""),16)),Sn=It.draw(_r);Hc(Sn,Kt)}else Hc(It.draw(rn),Kt);K.putImageData(Kt,be[rn].x,be[rn].y)}}catch(_o){hr.e(_o)}finally{hr.f()}}else{var kn=rp(n),ui;try{for(kn.s();!(ui=kn.n()).done;){var so=ui.value;K.fillText(so,be[so].x,be[so].y+y*Xh)}}catch(_o){kn.e(_o)}finally{kn.f()}}return{xOffset:Ke,yOffset:et,mapping:be,data:V,width:V.width,height:V.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,v,y,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,v=new Set(Object.keys(p)),y=new Set(n);return y.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||Tf),fh,Kh;function bl(e){var i=Pf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Pf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wc=3,Wl=1024,If=64,ph=(fh=(0,Lr.b2)(),fh(Kh=function(e){(0,Rr.Z)(r,e);var i=bl(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"canvasHeight",128),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"canvas",void 0),(0,A.Z)((0,le.Z)(n),"iconData",void 0),(0,A.Z)((0,le.Z)(n),"iconMap",void 0),(0,A.Z)((0,le.Z)(n),"ctx",void 0),(0,A.Z)((0,le.Z)(n),"loadingImageCount",0),n}return(0,Mt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=oa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:If}),this.updateIconMap(),this.loadImage(s).then(function(y){v=y;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var v=this,y=p.getSceneConfig().canvas,x=y.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:If}),this.updateIconMap(),this.loadImageMini(s,y).then(function(C){x=C;var T=v.iconData.find(function(k){return k.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){p(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=Wl,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],v=p.x,y=p.y,x=p.image,C=p.width,T=C===void 0?64:C,k=p.height,F=k===void 0?64:k,V=Math.max(T,F),K=V/If,ee=F/K,be=T/K;x&&a.ctx.drawImage(x,v+(If-be)/2,y+(If-ee)/2,be,ee)})}},{key:"updateIconMap",value:function(){var a=Jf(this.iconData,Wc,Wl),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,v){var y=s.createImage();y.crossOrigin="anonymous",y.onload=function(){p(y)},y.onerror=function(){v(new Error("Could not load image at "+a))},y.src=a})}}]),r}(go.EventEmitter))||Kh),Ca=Q(49685);function El(){var e=new Ca.WT(16);return Ca.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function va(e){var i=new Ca.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function dc(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function So(e,i,r,n,a,s,p,v,y,x,C,T,k,F,V,K){var ee=new Ca.WT(16);return ee[0]=e,ee[1]=i,ee[2]=r,ee[3]=n,ee[4]=a,ee[5]=s,ee[6]=p,ee[7]=v,ee[8]=y,ee[9]=x,ee[10]=C,ee[11]=T,ee[12]=k,ee[13]=F,ee[14]=V,ee[15]=K,ee}function Ks(e,i,r,n,a,s,p,v,y,x,C,T,k,F,V,K,ee){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=v,e[7]=y,e[8]=x,e[9]=C,e[10]=T,e[11]=k,e[12]=F,e[13]=V,e[14]=K,e[15]=ee,e}function hh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $h(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function zp(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],y=i[6],x=i[7],C=i[8],T=i[9],k=i[10],F=i[11],V=i[12],K=i[13],ee=i[14],be=i[15],je=r*v-n*p,Ke=r*y-a*p,et=r*x-s*p,At=n*y-a*v,It=n*x-s*v,Kt=a*x-s*y,hr=C*K-T*V,zr=C*ee-k*V,rn=C*be-F*V,_r=T*ee-k*K,Sn=T*be-F*K,kn=k*be-F*ee,ui=je*kn-Ke*Sn+et*_r+At*rn-It*zr+Kt*hr;return ui?(ui=1/ui,e[0]=(v*kn-y*Sn+x*_r)*ui,e[1]=(a*Sn-n*kn-s*_r)*ui,e[2]=(K*Kt-ee*It+be*At)*ui,e[3]=(k*It-T*Kt-F*At)*ui,e[4]=(y*rn-p*kn-x*zr)*ui,e[5]=(r*kn-a*rn+s*zr)*ui,e[6]=(ee*et-V*Kt-be*Ke)*ui,e[7]=(C*Kt-k*et+F*Ke)*ui,e[8]=(p*Sn-v*rn+x*hr)*ui,e[9]=(n*rn-r*Sn-s*hr)*ui,e[10]=(V*It-K*et+be*je)*ui,e[11]=(T*et-C*It-F*je)*ui,e[12]=(v*zr-p*_r-y*hr)*ui,e[13]=(r*_r-n*zr+a*hr)*ui,e[14]=(K*Ke-V*At-ee*je)*ui,e[15]=(C*At-T*Ke+k*je)*ui,e):null}function Od(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],y=i[6],x=i[7],C=i[8],T=i[9],k=i[10],F=i[11],V=i[12],K=i[13],ee=i[14],be=i[15];return e[0]=v*(k*be-F*ee)-T*(y*be-x*ee)+K*(y*F-x*k),e[1]=-(n*(k*be-F*ee)-T*(a*be-s*ee)+K*(a*F-s*k)),e[2]=n*(y*be-x*ee)-v*(a*be-s*ee)+K*(a*x-s*y),e[3]=-(n*(y*F-x*k)-v*(a*F-s*k)+T*(a*x-s*y)),e[4]=-(p*(k*be-F*ee)-C*(y*be-x*ee)+V*(y*F-x*k)),e[5]=r*(k*be-F*ee)-C*(a*be-s*ee)+V*(a*F-s*k),e[6]=-(r*(y*be-x*ee)-p*(a*be-s*ee)+V*(a*x-s*y)),e[7]=r*(y*F-x*k)-p*(a*F-s*k)+C*(a*x-s*y),e[8]=p*(T*be-F*K)-C*(v*be-x*K)+V*(v*F-x*T),e[9]=-(r*(T*be-F*K)-C*(n*be-s*K)+V*(n*F-s*T)),e[10]=r*(v*be-x*K)-p*(n*be-s*K)+V*(n*x-s*v),e[11]=-(r*(v*F-x*T)-p*(n*F-s*T)+C*(n*x-s*v)),e[12]=-(p*(T*ee-k*K)-C*(v*ee-y*K)+V*(v*k-y*T)),e[13]=r*(T*ee-k*K)-C*(n*ee-a*K)+V*(n*k-a*T),e[14]=-(r*(v*ee-y*K)-p*(n*ee-a*K)+V*(n*y-a*v)),e[15]=r*(v*k-y*T)-p*(n*k-a*T)+C*(n*y-a*v),e}function Rd(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],v=e[6],y=e[7],x=e[8],C=e[9],T=e[10],k=e[11],F=e[12],V=e[13],K=e[14],ee=e[15],be=i*p-r*s,je=i*v-n*s,Ke=i*y-a*s,et=r*v-n*p,At=r*y-a*p,It=n*y-a*v,Kt=x*V-C*F,hr=x*K-T*F,zr=x*ee-k*F,rn=C*K-T*V,_r=C*ee-k*V,Sn=T*ee-k*K;return be*Sn-je*_r+Ke*rn+et*zr-At*hr+It*Kt}function Bu(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=i[4],y=i[5],x=i[6],C=i[7],T=i[8],k=i[9],F=i[10],V=i[11],K=i[12],ee=i[13],be=i[14],je=i[15],Ke=r[0],et=r[1],At=r[2],It=r[3];return e[0]=Ke*n+et*v+At*T+It*K,e[1]=Ke*a+et*y+At*k+It*ee,e[2]=Ke*s+et*x+At*F+It*be,e[3]=Ke*p+et*C+At*V+It*je,Ke=r[4],et=r[5],At=r[6],It=r[7],e[4]=Ke*n+et*v+At*T+It*K,e[5]=Ke*a+et*y+At*k+It*ee,e[6]=Ke*s+et*x+At*F+It*be,e[7]=Ke*p+et*C+At*V+It*je,Ke=r[8],et=r[9],At=r[10],It=r[11],e[8]=Ke*n+et*v+At*T+It*K,e[9]=Ke*a+et*y+At*k+It*ee,e[10]=Ke*s+et*x+At*F+It*be,e[11]=Ke*p+et*C+At*V+It*je,Ke=r[12],et=r[13],At=r[14],It=r[15],e[12]=Ke*n+et*v+At*T+It*K,e[13]=Ke*a+et*y+At*k+It*ee,e[14]=Ke*s+et*x+At*F+It*be,e[15]=Ke*p+et*C+At*V+It*je,e}function up(e,i,r){var n=r[0],a=r[1],s=r[2],p,v,y,x,C,T,k,F,V,K,ee,be;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],v=i[1],y=i[2],x=i[3],C=i[4],T=i[5],k=i[6],F=i[7],V=i[8],K=i[9],ee=i[10],be=i[11],e[0]=p,e[1]=v,e[2]=y,e[3]=x,e[4]=C,e[5]=T,e[6]=k,e[7]=F,e[8]=V,e[9]=K,e[10]=ee,e[11]=be,e[12]=p*n+C*a+V*s+i[12],e[13]=v*n+T*a+K*s+i[13],e[14]=y*n+k*a+ee*s+i[14],e[15]=x*n+F*a+be*s+i[15]),e}function lp(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function cp(e,i,r,n){var a=n[0],s=n[1],p=n[2],v=Math.hypot(a,s,p),y,x,C,T,k,F,V,K,ee,be,je,Ke,et,At,It,Kt,hr,zr,rn,_r,Sn,kn,ui,so;return v<Ca.Ib?null:(v=1/v,a*=v,s*=v,p*=v,y=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],k=i[1],F=i[2],V=i[3],K=i[4],ee=i[5],be=i[6],je=i[7],Ke=i[8],et=i[9],At=i[10],It=i[11],Kt=a*a*C+x,hr=s*a*C+p*y,zr=p*a*C-s*y,rn=a*s*C-p*y,_r=s*s*C+x,Sn=p*s*C+a*y,kn=a*p*C+s*y,ui=s*p*C-a*y,so=p*p*C+x,e[0]=T*Kt+K*hr+Ke*zr,e[1]=k*Kt+ee*hr+et*zr,e[2]=F*Kt+be*hr+At*zr,e[3]=V*Kt+je*hr+It*zr,e[4]=T*rn+K*_r+Ke*Sn,e[5]=k*rn+ee*_r+et*Sn,e[6]=F*rn+be*_r+At*Sn,e[7]=V*rn+je*_r+It*Sn,e[8]=T*kn+K*ui+Ke*so,e[9]=k*kn+ee*ui+et*so,e[10]=F*kn+be*ui+At*so,e[11]=V*kn+je*ui+It*so,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function fp(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],v=i[6],y=i[7],x=i[8],C=i[9],T=i[10],k=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=v*a+T*n,e[7]=y*a+k*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=T*a-v*n,e[11]=k*a-y*n,e}function Up(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],y=i[3],x=i[8],C=i[9],T=i[10],k=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=v*a-T*n,e[3]=y*a-k*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=v*n+T*a,e[11]=y*n+k*a,e}function Xc(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],y=i[3],x=i[4],C=i[5],T=i[6],k=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=v*a+T*n,e[3]=y*a+k*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=T*a-v*n,e[7]=k*a-y*n,e}function Aa(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function dh(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xl(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),v,y,x;return p<Ca.Ib?null:(p=1/p,n*=p,a*=p,s*=p,v=Math.sin(i),y=Math.cos(i),x=1-y,e[0]=n*n*x+y,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+y,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Of(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vh(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function z(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=n+n,y=a+a,x=s+s,C=n*v,T=n*y,k=n*x,F=a*y,V=a*x,K=s*x,ee=p*v,be=p*y,je=p*x;return e[0]=1-(F+K),e[1]=T+je,e[2]=k-be,e[3]=0,e[4]=T-je,e[5]=1-(C+K),e[6]=V+ee,e[7]=0,e[8]=k+be,e[9]=V-ee,e[10]=1-(C+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fe(e,i){var r=new Ca.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],v=i[4],y=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+p*p;return T>0?(r[0]=(v*p+C*n+y*s-x*a)*2/T,r[1]=(y*p+C*a+x*n-v*s)*2/T,r[2]=(x*p+C*s+v*a-y*n)*2/T):(r[0]=(v*p+C*n+y*s-x*a)*2,r[1]=(y*p+C*a+x*n-v*s)*2,r[2]=(x*p+C*s+v*a-y*n)*2),z(e,i,r),e}function De(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Ot(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],v=i[6],y=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,v),e[2]=Math.hypot(y,x,C),e}function rr(e,i){var r=new Ca.WT(3);Ot(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,v=i[1]*a,y=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,k=i[8]*n,F=i[9]*a,V=i[10]*s,K=p+C+V,ee=0;return K>0?(ee=Math.sqrt(K+1)*2,e[3]=.25*ee,e[0]=(T-F)/ee,e[1]=(k-y)/ee,e[2]=(v-x)/ee):p>C&&p>V?(ee=Math.sqrt(1+p-C-V)*2,e[3]=(T-F)/ee,e[0]=.25*ee,e[1]=(v+x)/ee,e[2]=(k+y)/ee):C>V?(ee=Math.sqrt(1+C-p-V)*2,e[3]=(k-y)/ee,e[0]=(v+x)/ee,e[1]=.25*ee,e[2]=(T+F)/ee):(ee=Math.sqrt(1+V-p-C)*2,e[3]=(v-x)/ee,e[0]=(k+y)/ee,e[1]=(T+F)/ee,e[2]=.25*ee),e}function Pt(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3],y=a+a,x=s+s,C=p+p,T=a*y,k=a*x,F=a*C,V=s*x,K=s*C,ee=p*C,be=v*y,je=v*x,Ke=v*C,et=n[0],At=n[1],It=n[2];return e[0]=(1-(V+ee))*et,e[1]=(k+Ke)*et,e[2]=(F-je)*et,e[3]=0,e[4]=(k-Ke)*At,e[5]=(1-(T+ee))*At,e[6]=(K+be)*At,e[7]=0,e[8]=(F+je)*It,e[9]=(K-be)*It,e[10]=(1-(T+V))*It,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Yt(e,i,r,n,a){var s=i[0],p=i[1],v=i[2],y=i[3],x=s+s,C=p+p,T=v+v,k=s*x,F=s*C,V=s*T,K=p*C,ee=p*T,be=v*T,je=y*x,Ke=y*C,et=y*T,At=n[0],It=n[1],Kt=n[2],hr=a[0],zr=a[1],rn=a[2],_r=(1-(K+be))*At,Sn=(F+et)*At,kn=(V-Ke)*At,ui=(F-et)*It,so=(1-(k+be))*It,_o=(ee+je)*It,Us=(V+Ke)*Kt,bu=(ee-je)*Kt,Qs=(1-(k+K))*Kt;return e[0]=_r,e[1]=Sn,e[2]=kn,e[3]=0,e[4]=ui,e[5]=so,e[6]=_o,e[7]=0,e[8]=Us,e[9]=bu,e[10]=Qs,e[11]=0,e[12]=r[0]+hr-(_r*hr+ui*zr+Us*rn),e[13]=r[1]+zr-(Sn*hr+so*zr+bu*rn),e[14]=r[2]+rn-(kn*hr+_o*zr+Qs*rn),e[15]=1,e}function sr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,v=n+n,y=a+a,x=r*p,C=n*p,T=n*v,k=a*p,F=a*v,V=a*y,K=s*p,ee=s*v,be=s*y;return e[0]=1-T-V,e[1]=C+be,e[2]=k-ee,e[3]=0,e[4]=C-be,e[5]=1-x-V,e[6]=F+K,e[7]=0,e[8]=k+ee,e[9]=F-K,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dr(e,i,r,n,a,s,p){var v=1/(r-i),y=1/(a-n),x=1/(s-p);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*y,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*y,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function mr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var Sr=mr;function Tr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function Zr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),y=2/(p+v),x=2/(a+s);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-v)*y*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function vr(e,i,r,n,a,s,p){var v=1/(i-r),y=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*y,e[14]=(p+s)*x,e[15]=1,e}var Cr=vr;function nt(e,i,r,n,a,s,p){var v=1/(i-r),y=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*y,e[14]=s*x,e[15]=1,e}function Ut(e,i,r,n){var a,s,p,v,y,x,C,T,k,F,V=i[0],K=i[1],ee=i[2],be=n[0],je=n[1],Ke=n[2],et=r[0],At=r[1],It=r[2];return Math.abs(V-et)<Ca.Ib&&Math.abs(K-At)<Ca.Ib&&Math.abs(ee-It)<Ca.Ib?hh(e):(C=V-et,T=K-At,k=ee-It,F=1/Math.hypot(C,T,k),C*=F,T*=F,k*=F,a=je*k-Ke*T,s=Ke*C-be*k,p=be*T-je*C,F=Math.hypot(a,s,p),F?(F=1/F,a*=F,s*=F,p*=F):(a=0,s=0,p=0),v=T*p-k*s,y=k*a-C*p,x=C*s-T*a,F=Math.hypot(v,y,x),F?(F=1/F,v*=F,y*=F,x*=F):(v=0,y=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=y,e[6]=T,e[7]=0,e[8]=p,e[9]=x,e[10]=k,e[11]=0,e[12]=-(a*V+s*K+p*ee),e[13]=-(v*V+y*K+x*ee),e[14]=-(C*V+T*K+k*ee),e[15]=1,e)}function gr(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=n[0],y=n[1],x=n[2],C=a-r[0],T=s-r[1],k=p-r[2],F=C*C+T*T+k*k;F>0&&(F=1/Math.sqrt(F),C*=F,T*=F,k*=F);var V=y*k-x*T,K=x*C-v*k,ee=v*T-y*C;return F=V*V+K*K+ee*ee,F>0&&(F=1/Math.sqrt(F),V*=F,K*=F,ee*=F),e[0]=V,e[1]=K,e[2]=ee,e[3]=0,e[4]=T*ee-k*K,e[5]=k*V-C*ee,e[6]=C*K-T*V,e[7]=0,e[8]=C,e[9]=T,e[10]=k,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function Fr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function or(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Pr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Yr(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Nn(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function qt(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Qt(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function hn(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],v=e[5],y=e[6],x=e[7],C=e[8],T=e[9],k=e[10],F=e[11],V=e[12],K=e[13],ee=e[14],be=e[15],je=i[0],Ke=i[1],et=i[2],At=i[3],It=i[4],Kt=i[5],hr=i[6],zr=i[7],rn=i[8],_r=i[9],Sn=i[10],kn=i[11],ui=i[12],so=i[13],_o=i[14],Us=i[15];return Math.abs(r-je)<=Ca.Ib*Math.max(1,Math.abs(r),Math.abs(je))&&Math.abs(n-Ke)<=Ca.Ib*Math.max(1,Math.abs(n),Math.abs(Ke))&&Math.abs(a-et)<=Ca.Ib*Math.max(1,Math.abs(a),Math.abs(et))&&Math.abs(s-At)<=Ca.Ib*Math.max(1,Math.abs(s),Math.abs(At))&&Math.abs(p-It)<=Ca.Ib*Math.max(1,Math.abs(p),Math.abs(It))&&Math.abs(v-Kt)<=Ca.Ib*Math.max(1,Math.abs(v),Math.abs(Kt))&&Math.abs(y-hr)<=Ca.Ib*Math.max(1,Math.abs(y),Math.abs(hr))&&Math.abs(x-zr)<=Ca.Ib*Math.max(1,Math.abs(x),Math.abs(zr))&&Math.abs(C-rn)<=Ca.Ib*Math.max(1,Math.abs(C),Math.abs(rn))&&Math.abs(T-_r)<=Ca.Ib*Math.max(1,Math.abs(T),Math.abs(_r))&&Math.abs(k-Sn)<=Ca.Ib*Math.max(1,Math.abs(k),Math.abs(Sn))&&Math.abs(F-kn)<=Ca.Ib*Math.max(1,Math.abs(F),Math.abs(kn))&&Math.abs(V-ui)<=Ca.Ib*Math.max(1,Math.abs(V),Math.abs(ui))&&Math.abs(K-so)<=Ca.Ib*Math.max(1,Math.abs(K),Math.abs(so))&&Math.abs(ee-_o)<=Ca.Ib*Math.max(1,Math.abs(ee),Math.abs(_o))&&Math.abs(be-Us)<=Ca.Ib*Math.max(1,Math.abs(be),Math.abs(Us))}var Wr=Bu,br=Yr,Xr,qr,yi=(Xr=(0,Lr.b2)(),Xr(qr=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,Mt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=El(),zp(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,yn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Aa(El(),[r,n,0]);this.jitteredProjectionMatrix=Bu(El(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Bu(El(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||qr),Jn,jr;function Jr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Kn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Kn(e,i){if(!!e){if(typeof e=="string")return si(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return si(e,i)}}function si(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Fi=(Jn=(0,Lr.b2)(),Jn(jr=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,Mt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(bt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(bt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Jr(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Na("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=p.map(function(y){return n+y}).join(" ");r[p.join("")]=Na("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&oc(this.controlCorners[r]);this.controlContainer&&oc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||jr),qa,io,Ri=(qa=(0,Lr.b2)(),qa(io=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,Mt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(bt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||io),Yo,za,qo=(Yo=(0,Lr.b2)(),Yo(za=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,Mt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(bt.IMapService)}}]),e}())||za),Co=Q(82492),Uo=Q.n(Co),Zo={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ss=Zo,ao,hi;function Po(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xi(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Po(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Po(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Qo={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ei={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ki=(ao=(0,Lr.b2)(),ao(hi=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,Mt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return ss[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Xi(Xi({},Qo),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=Xi({},Uo()({},this.sceneConfigCache[r],ei,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||hi);function xn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Ln(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,v){return v(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function il(){var e=new Ca.WT(4);return Ca.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function we(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Dt(e,i,r,n){var a=new Ca.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function gt(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function dn(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Ui(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function xe(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function ie(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Ze(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function it(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function wt(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Xe(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Le(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Je(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function ve(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function ze(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function Se(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function at(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function yt(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function lr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function Br(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function Nr(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function en(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function kr(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function An(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],y=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],k=i[2],F=i[3];return e[0]=T*x-k*y+F*v,e[1]=-(C*x)+k*p-F*s,e[2]=C*y-T*p+F*a,e[3]=-(C*v)+T*s-k*a,e}function on(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=v+n*(r[3]-v),e}function bn(e,i){i=i||1;var r,n,a,s,p,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var y=Math.sqrt((1-p)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*y,e[3]=i*s*y,e}function fn(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function vn(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],v=r[1],y=r[2],x=r[3],C=x*n+v*s-y*a,T=x*a+y*n-p*s,k=x*s+p*a-v*n,F=-p*n-v*a-y*s;return e[0]=C*x+F*-p+T*-y-k*-v,e[1]=T*x+F*-v+k*-p-C*-y,e[2]=k*x+F*-y+C*-v-T*-p,e[3]=i[3],e}function $n(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ba(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function us(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Ua(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],v=i[1],y=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var ma=null,Yl=null,Fs=null,Sl=null,Nu=null,Qh=null,zu=null,Yc=function(){var e=il();return function(i,r,n,a,s,p){var v,y;for(r||(r=4),n||(n=0),a?y=Math.min(a*r+n,i.length):y=i.length,v=n;v<y;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,p),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),qc=Math.PI/180,vv=512,jo=4003e4;function Zp(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,v=p===void 0?!1:p,y=e.flipY,x=y===void 0?!1:y;s=s!==void 0?s:Math.pow(2,a);var C={},T=vv*s,k=Math.cos(r*qc),F=T/360,V=F/k,K=T/jo/k;if(C.pixelsPerMeter=[K,-K,K],C.metersPerPixel=[1/K,-1/K,1/K],C.pixelsPerDegree=[F,-V,K],C.degreesPerPixel=[1/F,-1/V,1/K],v){var ee=qc*Math.tan(r*qc)/k,be=F*ee/2,je=T/jo*ee,Ke=je/V*K;C.pixelsPerDegree2=[0,-be,je],C.pixelsPerMeter2=[Ke,0,Ke],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var lu;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(lu||(lu={}));var vc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},mh,Jh,pp,ql,Ld,mv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],b0=(mh=(0,Lr.b2)(),Jh=(0,Lr.f3)(bt.ICameraService),mh(pp=(ql=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),xn(this,"cameraService",Ld,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,Mt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Zp({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===lu.LNGLAT||this.coordinateSystem===lu.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===lu.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===lu.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=Zp({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=p.pixelsPerMeter,y=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),k=Bu([],T,C),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=fn([],[F[0],F[1],0,1],k),C=this.cameraService.getViewMatrixUncentered()||C,k=Bu([],T,C),k=Bu([],k,mv),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=v,this.pixelsPerDegree=y,this.pixelsPerDegree2=x}}]),e}(),Ld=Ln(ql.prototype,"cameraService",[Jh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ql))||pp),ls=Q(20396),Cl=Q.n(ls),Bs;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Bs||(Bs={}));var t,o,u,h,g;function b(e){var i=S();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},D=(t=(0,Lr.b2)(),o=(0,Lr.f3)(bt.IMapService),t(u=(h=function(e){(0,Rr.Z)(r,e);var i=b(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"indragging",!1),xn((0,le.Z)(n),"mapService",g,(0,le.Z)(n)),(0,A.Z)((0,le.Z)(n),"hammertime",void 0),(0,A.Z)((0,le.Z)(n),"lastClickTime",0),(0,A.Z)((0,le.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,le.Z)(n),"clickTimer",void 0),(0,A.Z)((0,le.Z)(n),"$containter",void 0),(0,A.Z)((0,le.Z)(n),"onDrag",function(v){var y=n.interactionEvent(v);y.type=I[y.type],y.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Bs.Drag,y)}),(0,A.Z)((0,le.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var y=n.interactionEvent(v);n.emit(Bs.Hover,y)}),(0,A.Z)((0,le.Z)(n),"onTouch",function(v){var y=v.touches[0];n.onHover({x:y.pageX,y:y.pageY,type:"touch"})}),(0,A.Z)((0,le.Z)(n),"onHover",function(v){var y=v.clientX,x=v.clientY,C=y,T=x,k=v.type,F=n.mapService.getMapContainer();if(F)if(Yi)C=C-F.left-0,T=T-F.top-0;else{var V=F.getBoundingClientRect(),K=V.top,ee=V.left;C=C-ee-F.clientLeft,T=T-K-F.clientTop}var be=n.mapService.containerToLngLat([C,T]);if(k==="click"){if(!Yi&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,be);return}if(k==="touch"){n.isDoubleTap(C,T,be);return}k!=="click"&&k!=="dblclick"&&n.emit(Bs.Hover,{x:C,y:T,lngLat:be,type:k,target:v})}),n}return(0,Mt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Bs.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(Bs.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(Bs.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(Bs.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Yi)oa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Cl()).Manager(a);s.add(new(Cl()).Tap({event:"dblclick",taps:2})),s.add(new(Cl()).Tap({event:"click"})),s.add(new(Cl()).Pan({threshold:0,pointers:0})),s.add(new(Cl()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Yi)oa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,v,y;p==="touch"?(y=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(y=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,k=C.left;v-=k,y-=T}var F=this.mapService.containerToLngLat([v,y]);return{x:v,y,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var v=this,y=new Date().getTime(),x="click";y-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(Bs.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=y,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(Bs.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(fc()),g=Ln(h.prototype,"mapService",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h))||u),N=Q(92137),Z=Q(87757),j=Q.n(Z),$=0;function re(e){if(Yi)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat($++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Te(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var O;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(O||(O={}));var He,Ne,rt,mt,Bt,Zt,nr,yr,Vr,Dn,sn,Zn,ln;function Mi(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mi(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mi(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Pn=(He=(0,Lr.b2)(),Ne=(0,Lr.f3)(bt.IMapService),rt=(0,Lr.f3)(bt.IRendererService),mt=(0,Lr.f3)(bt.IGlobalConfigService),Bt=(0,Lr.f3)(bt.IInteractionService),Zt=(0,Lr.f3)(bt.ILayerService),He(nr=(yr=function(){function e(){var i=this;(0,ft.Z)(this,e),xn(this,"mapService",Vr,this),xn(this,"rendererService",Dn,this),xn(this,"configService",sn,this),xn(this,"interactionService",Zn,this),xn(this,"layerService",ln,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,v=n.lngLat,y=n.type,x=n.target,C=!1,T=i.rendererService,k=T.getViewportSize,F=T.readPixels,V=T.getContainer,K=i.getContainerSize(V()),ee=K.width,be=K.height;ee*=Ra,be*=Ra;var je=r.getLayerConfig(),Ke=je.enableHighlight,et=je.enableSelect,At=s*Ra,It=p*Ra;if(At>ee-1*Ra||At<0||It>be-1*Ra||It<0)return!1;var Kt;if(Kt=F({x:Math.floor(At/i.pickBufferScale),y:Math.floor((be-(p+1)*Ra)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Kt[0]!==0||Kt[1]!==0||Kt[2]!==0){var hr=no(Kt),zr=r.getSource().getFeatureById(hr);hr!==r.getCurrentPickId()&&y==="mousemove"&&(y="mouseenter");var rn={x:s,y:p,type:y,lngLat:v,featureId:hr,feature:zr,target:x};zr&&(C=!0,r.setCurrentPickId(hr),i.triggerHoverOnLayer(r,rn))}else{var _r={x:s,y:p,lngLat:v,type:r.getCurrentPickId()!==null&&y==="mousemove"?"mouseout":"un"+y,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,qn(qn({},_r),{},{type:"unpick"})),i.triggerHoverOnLayer(r,_r),r.setCurrentPickId(null)}if(Ke&&i.highlightPickedFeature(r,Kt),et&&y==="click"&&((a=Kt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var Sn=no(Kt);r.getCurrentSelectedId()===null||Sn!==r.getCurrentSelectedId()?(i.selectFeature(r,Kt),r.setCurrentSelectedId(Sn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Mt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,v=n.getContainer,y=this.getContainerSize(v()),x=y.width,C=y.height;x*=Ra,C*=Ra,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.interactionService.on(Bs.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,N.Z)(j().mark(function n(a,s,p){var v=this,y,x,C,T;return j().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:y=this.rendererService,x=y.useFramebuffer,C=y.clear,T=y.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var V=v.pickBox(a,s);p(V)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(_r){var Sn=_r<0?0:_r;return Math.floor(Sn*Ra/a.pickBufferScale)}),p=(0,yn.Z)(s,4),v=p[0],y=p[1],x=p[2],C=p[3],T=this.rendererService,k=T.getViewportSize,F=T.readPixels,V=T.getContainer,K=this.getContainerSize(V()),ee=K.width,be=K.height;if(ee*=Ra,be*=Ra,v>(ee-1)*Ra/this.pickBufferScale||x<0||y>(be-1)*Ra/this.pickBufferScale||C<0)return[];var je,Ke=Math.min(ee/this.pickBufferScale,x)-v,et=Math.min(be/this.pickBufferScale,C)-y;je=F({x:v,y:Math.floor(be/this.pickBufferScale-(C+1)),width:Ke,height:et,data:new Uint8Array(Ke*et*4),framebuffer:this.pickingFBO});for(var At=[],It={},Kt=0;Kt<je.length/4;Kt=Kt+1){var hr=je.slice(Kt*4,Kt*4+4),zr=no(hr);if(zr!==-1&&!It[zr]){var rn=r.getSource().getFeatureById(zr);At.push(qn(qn({},rn),{},{pickedFeatureIdx:zr})),It[zr]=!0}}return At}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,v=a.cursorEnabled;if(v){var y=this.mapService.version,x=y==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Ra,height:r.height/Ra}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,N.Z)(j().mark(function n(a){var s;return j().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=Ra,s*=Ra,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,N.Z)(j().mark(function n(a){var s=this,p,v,y,x,C;return j().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:p=this.rendererService,v=p.getViewportSize,y=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),y(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(V){return V.needPick(a.type)}).reverse().some(function(V){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),V.hooks.beforePickingEncode.call(),V.renderModels(!0),V.hooks.afterPickingEncode.call();var K=s.pickFromPickingFBO(V,a);return K&&!V.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Te(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,yn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeHighlight.call([s,p,v])}},{key:"selectFeature",value:function(r,n){var a=(0,yn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeSelect.call([s,p,v])}}]),e}(),Vr=Ln(yr.prototype,"mapService",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=Ln(yr.prototype,"rendererService",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn=Ln(yr.prototype,"configService",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=Ln(yr.prototype,"interactionService",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ln=Ln(yr.prototype,"layerService",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yr))||nr),Bi=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ft.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Mt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),bi,qi,jn,sa,Ka,$a,po,Qa,yo;function Jo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=es(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function es(e,i){if(!!e){if(typeof e=="string")return Os(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Os(e,i)}}function Os(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var cs=(bi=(0,Lr.b2)(),qi=(0,Lr.f3)(bt.IRendererService),jn=(0,Lr.f3)(bt.IMapService),sa=(0,Lr.f3)(bt.IGlobalConfigService),bi(Ka=($a=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"clock",new Bi),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),xn(this,"renderService",po,this),xn(this,"mapService",Qa,this),xn(this,"configService",yo,this)}return(0,Mt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,N.Z)(j().mark(function n(){var a,s,p;return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){y.next=2;break}return y.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=Jo(this.layerList),y.prev=5,a.s();case 7:if((s=a.n()).done){y.next=20;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.getLayerConfig().enableMultiPassRenderer){y.next=16;break}return y.next=14,p.renderMultiPass();case 14:y.next=17;break;case 16:p.render();case 17:p.hooks.afterRender.call();case 18:y.next=7;break;case 20:y.next=25;break;case 22:y.prev=22,y.t0=y.catch(5),a.e(y.t0);case 25:return y.prev=25,a.f(),y.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return y.stop()}},n,this,[[5,22,25,28]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).forEach(function(a){r.layerList.push(a)})}),this.layerList.sort(function(n,a){return n.zIndex-a.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=oa.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Gi(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){oa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),po=Ln($a.prototype,"renderService",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa=Ln($a.prototype,"mapService",[jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo=Ln($a.prototype,"configService",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$a))||Ka),ts=Q(81253),Io=Q(14293),oo=Q.n(Io),Hi=function(){function e(i){var r=this;(0,ft.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var v,y=(v=r.scale)===null||v===void 0?void 0:v.scalers[p].func,x=y(s);return x})}),this.setProps(i)}return(0,Mt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Ce.Z)(r));if(!oo()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),La=["buffer","update","name"],ca,$i,Ns,xs,Za,Oo;function bs(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ia(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bs(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bs(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kc(e){return new Promise(function(i){return setTimeout(i,e)})}var Uu=(ca={},(0,A.Z)(ca,O.FLOAT,4),(0,A.Z)(ca,O.UNSIGNED_BYTE,1),(0,A.Z)(ca,O.UNSIGNED_SHORT,2),ca),mc=($i=(0,Lr.b2)(),Ns=(0,Lr.f3)(bt.IRendererService),$i(xs=(Za=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),xn(this,"rendererService",Oo,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Mt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Hi(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(ia(ia({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(et){return et.name===r});if(p&&p.descriptor){var v=p.descriptor,y=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,k=Uu[x.type||O.FLOAT];if(y){var F=this.featureLayout,V=F.elements,K=F.sizePerElement,ee=V.slice(a,s);if(!ee.length)return;var be=ee[0].offset,je=be*T*k,Ke=ee.map(function(et,At){for(var It=et.featureIdx,Kt=et.vertices,hr=et.normals,zr=Kt.length/K,rn=[],_r=0;_r<zr;_r++){var Sn=hr?hr.slice(_r*3,_r*3+3):[];rn.push.apply(rn,(0,Ce.Z)(y(n[It],It,Kt.slice(_r*K,_r*K+K),At,Sn)))}return rn}).reduce(function(et,At){return et.push.apply(et,(0,Ce.Z)(At)),et},[]);p.vertexAttribute.updateBuffer({data:Ke,offset:je})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(je){return je.resetDescriptor(),je.descriptor}),v=0,y=[],x=[],C=[],T=3;r.forEach(function(je,Ke){var et=s.triangulation(je,a),At=et.indices,It=et.vertices,Kt=et.normals,hr=et.size;At.forEach(function(Sn){x.push(Sn+v)}),T=hr;var zr=It.length/hr;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:Ke,vertices:It,normals:Kt,offset:v}),v+=zr;for(var rn=function(kn){var ui=(Kt==null?void 0:Kt.slice(kn*3,kn*3+3))||[],so=It.slice(kn*hr,kn*hr+hr);p.forEach(function(_o,Us){if(_o&&_o.update){var bu;(bu=_o.buffer.data).push.apply(bu,(0,Ce.Z)(_o.update(je,Ke,so,kn,ui)))}})},_r=0;_r<zr;_r++)rn(_r)});var k=this.rendererService,F=k.createAttribute,V=k.createBuffer,K=k.createElements,ee={};p.forEach(function(je,Ke){if(je){var et=je.buffer,At=je.update,It=je.name,Kt=(0,ts.Z)(je,La),hr=F(ia({buffer:V(et)},Kt));ee[je.name||""]=hr,s.attributes[Ke].vertexAttribute=hr}});var be=K({data:x,type:O.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:ee,elements:be},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Oo=Ln(Za.prototype,"rendererService",[Ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za))||xs),Ao=Q(67709),gc=Q.n(Ao),al,hp,Rf,dp,yc,vp,gh,mp,jp,yh,_h,_c,Vp,gp,$c,yp,xh,Es,Gp,Hp,bh,Wp,Xp,Yp,Eh,_p,Sh,xp,qp,kf,Kp,bp,ed;function gv(e){var i=Dd();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Dd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yv=(al=(0,Lr.b2)(),hp=(0,Lr.f3)(bt.SceneID),Rf=(0,Lr.f3)(bt.IIconService),dp=(0,Lr.f3)(bt.IFontService),yc=(0,Lr.f3)(bt.IControlService),vp=(0,Lr.f3)(bt.IGlobalConfigService),gh=(0,Lr.f3)(bt.IMapService),mp=(0,Lr.f3)(bt.ICoordinateSystemService),jp=(0,Lr.f3)(bt.IRendererService),yh=(0,Lr.f3)(bt.ILayerService),_h=(0,Lr.f3)(bt.ICameraService),_c=(0,Lr.f3)(bt.IInteractionService),Vp=(0,Lr.f3)(bt.IPickingService),gp=(0,Lr.f3)(bt.IShaderModuleService),$c=(0,Lr.f3)(bt.IMarkerService),yp=(0,Lr.f3)(bt.IPopupService),al(xh=(Es=function(e){(0,Rr.Z)(r,e);var i=gv(r);function r(){var n;return(0,ft.Z)(this,r),n=i.call(this),(0,A.Z)((0,le.Z)(n),"destroyed",!1),(0,A.Z)((0,le.Z)(n),"loaded",!1),(0,A.Z)((0,le.Z)(n),"loadFont",!1),(0,A.Z)((0,le.Z)(n),"fontFamily",""),xn((0,le.Z)(n),"id",Gp,(0,le.Z)(n)),xn((0,le.Z)(n),"iconService",Hp,(0,le.Z)(n)),xn((0,le.Z)(n),"fontService",bh,(0,le.Z)(n)),xn((0,le.Z)(n),"controlService",Wp,(0,le.Z)(n)),xn((0,le.Z)(n),"configService",Xp,(0,le.Z)(n)),xn((0,le.Z)(n),"map",Yp,(0,le.Z)(n)),xn((0,le.Z)(n),"coordinateSystemService",Eh,(0,le.Z)(n)),xn((0,le.Z)(n),"rendererService",_p,(0,le.Z)(n)),xn((0,le.Z)(n),"layerService",Sh,(0,le.Z)(n)),xn((0,le.Z)(n),"cameraService",xp,(0,le.Z)(n)),xn((0,le.Z)(n),"interactionService",qp,(0,le.Z)(n)),xn((0,le.Z)(n),"pickingService",kf,(0,le.Z)(n)),xn((0,le.Z)(n),"shaderModuleService",Kp,(0,le.Z)(n)),xn((0,le.Z)(n),"markerService",bp,(0,le.Z)(n)),xn((0,le.Z)(n),"popupService",ed,(0,le.Z)(n)),(0,A.Z)((0,le.Z)(n),"inited",!1),(0,A.Z)((0,le.Z)(n),"initPromise",void 0),(0,A.Z)((0,le.Z)(n),"rendering",!1),(0,A.Z)((0,le.Z)(n),"$container",void 0),(0,A.Z)((0,le.Z)(n),"canvas",void 0),(0,A.Z)((0,le.Z)(n),"markerContainer",void 0),(0,A.Z)((0,le.Z)(n),"hooks",void 0),(0,A.Z)((0,le.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),pn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,le.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Ps},n}return(0,Mt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,N.Z)(j().mark(function p(){return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){y.next=6;break}return y.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(Bs.Drag,s.addSceneEvent.bind(s));case 13:case"end":return y.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,N.Z)(j().mark(function p(){var v,y;return j().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=re(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=Na("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:gc()(s.$container,s.handleWindowResized),oa.matchMedia&&((y=oa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||y===void 0||y.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,N.Z)(j().mark(function p(){return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(Bs.Drag,s.addSceneEvent.bind(s));case 5:case"end":return y.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,N.Z)(j().mark(function p(){var v;return j().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"render",value:function(){var n=(0,N.Z)(j().mark(function s(){return j().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Na("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var y;(y=a.$container)===null||y===void 0||y.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Ao.unbind)(this.$container,this.handleWindowResized),oa.matchMedia){var v;(v=oa.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=Ra,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*p,x.height=y*p),this.rendererService.viewport({x:0,y:0,width:p*v,height:p*y})}},{key:"setCanvas",value:function(){var a,s,p=Ra,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*p,x.height=y*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(go.EventEmitter),Gp=Ln(Es.prototype,"id",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp=Ln(Es.prototype,"iconService",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh=Ln(Es.prototype,"fontService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp=Ln(Es.prototype,"controlService",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=Ln(Es.prototype,"configService",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=Ln(Es.prototype,"map",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eh=Ln(Es.prototype,"coordinateSystemService",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=Ln(Es.prototype,"rendererService",[jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=Ln(Es.prototype,"layerService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=Ln(Es.prototype,"cameraService",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=Ln(Es.prototype,"interactionService",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kf=Ln(Es.prototype,"pickingService",[Vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=Ln(Es.prototype,"shaderModuleService",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp=Ln(Es.prototype,"markerService",[$c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed=Ln(Es.prototype,"popupService",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Es))||xh),Fd=Q(44908),_v=Q.n(Fd);function Ch(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Ro=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Al(e){var i={};return e=e.replace(Ro,function(r,n,a){var s=a.split(":"),p=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(y,x){return y.push(Number(x.trim())),y},[]):v=new Array(Ch(n)).fill(0);break;default:}return i[p]=v,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var xv,Qc;function td(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $p(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?td(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):td(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ah="#define PI 3.14159265359",xc=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,rd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,wh=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,nd=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,id=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Bd=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,bv=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Th=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Ev=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Sv=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Cv=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Av=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,wv=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Zu=/precision\s+(high|low|medium)p\s+float/,ad=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Tv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,bc=(xv=(0,Lr.b2)(),xv(Qc=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,Mt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ah,fs:Ah}),this.registerModule("decode",{vs:xc,fs:""}),this.registerModule("projection",{vs:bv,fs:""}),this.registerModule("project",{vs:Bd,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Th}),this.registerModule("lighting",{vs:wh,fs:""}),this.registerModule("light",{vs:rd,fs:""}),this.registerModule("picking",{vs:id,fs:nd}),this.registerModule("styleMapping",{vs:Ev,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:wv,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Sv,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Cv,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Av,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,v=Al(a),y=v.content,x=v.uniforms,C=Al(s),T=C.content,k=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:$p($p($p({},x),k),p),vs:y}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),v=p.content,y=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,k=C,F=_v()(y.concat(T).concat(r)).reduce(function(V,K){return $p($p({},V),n.rawContentCache[K].uniforms)},{});return Zu.test(C)||(k=ad+C),this.moduleCache[r]={fs:k.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(Tv,function(v,y){var x=y.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var k=s.processModule(T,n,a),F=k.content;return F});return{content:p,includeList:n}}}]),e}())||Qc),od=Q(66213),Jc;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Jc||(Jc={}));var Lf,Ep,ef=(Lf=(0,Lr.b2)(),Lf(Ep=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,Mt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Jc.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(bt.IRendererService),this.cameraService=r.getContainer().get(bt.ICameraService),this.mapService=r.getContainer().get(bt.IMapService),this.interactionService=r.getContainer().get(bt.IInteractionService),this.layerService=r.getContainer().get(bt.ILayerService),this.shaderModuleService=r.getContainer().get(bt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Ep),Sp,Cp;function Mv(e){var i=Pv();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Pv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iv=(Sp=(0,Lr.b2)(),Sp(Cp=function(e){(0,Rr.Z)(r,e);var i=Mv(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,od.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(ef))||Cp),Nd,sd,ud,Kl,zd;function Ud(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Zd(e,i){if(!!e){if(typeof e=="string")return jd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jd(e,i)}}function jd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Vd=(Nd=(0,Lr.b2)(),sd=(0,Lr.f3)(bt.IPostProcessor),Nd(ud=(Kl=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"passes",[]),xn(this,"postProcessor",zd,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,Mt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,N.Z)(j().mark(function n(){var a,s,p;return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a=Ud(this.passes),y.prev=1,a.s();case 3:if((s=a.n()).done){y.next=9;break}return p=s.value,y.next=7,p.render(this.layer);case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),a.e(y.t0);case 14:return y.prev=14,a.f(),y.finish(14);case 17:return y.next=19,this.postProcessor.render(this.layer);case 19:case"end":return y.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Jc.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),zd=Ln(Kl.prototype,"postProcessor",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl))||ud),Gd,Hd;function ld(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ld(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ld(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mh(e){var i=Ov();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Ov(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cd=(Gd=(0,Lr.b2)(),Gd(Hd=function(e){(0,Rr.Z)(r,e);var i=Mh(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,le.Z)(n),"layer",void 0),(0,A.Z)((0,le.Z)(n),"width",0),(0,A.Z)((0,le.Z)(n),"height",0),(0,A.Z)((0,le.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,le.Z)(n),"pickFromPickingFBO",function(v){var y=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var k=n.rendererService,F=k.getViewportSize,V=k.readPixels,K=k.useFramebuffer,ee=F(),be=ee.width,je=ee.height,Ke=n.layer.getLayerConfig(),et=Ke.enableHighlight,At=Ke.enableSelect,It=y*Ra,Kt=x*Ra;if(!(It>be||It<0||Kt>je||Kt<0)){var hr;K(n.pickingFBO,function(){var zr;if(hr=V({x:Math.round(It),y:Math.round(je-(x+1)*Ra),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),hr[0]!==0||hr[1]!==0||hr[2]!==0){var rn=no(hr),_r=n.layer.getSource().getFeatureById(rn),Sn={x:y,y:x,type:T,lngLat:C,featureId:rn,feature:_r};_r&&(n.layer.setCurrentPickId(rn),n.triggerHoverOnLayer(Sn))}else{var kn={x:y,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Wd(Wd({},kn),{},{type:"unpick"})),n.triggerHoverOnLayer(kn),n.layer.setCurrentPickId(null)}et&&n.highlightPickedFeature(hr),At&&T==="click"&&((zr=hr)===null||zr===void 0?void 0:zr.toString())!==[0,0,0,0].toString()&&n.selectFeature(hr)})}}}),n}return(0,Mt.Z)(r,[{key:"getType",value:function(){return Jc.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,od.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,v=p.createTexture2D,y=p.createFramebuffer,x=p.getViewportSize,C=x(),T=C.width,k=C.height;this.pickingFBO=y({color:v({width:T,height:k,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.interactionService.on(Bs.Hover,this.pickFromPickingFBO),this.interactionService.on(Bs.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Bs.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,v=p.getViewportSize,y=p.useFramebuffer,x=p.clear,C=v(),T=C.width,k=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==k)&&(this.pickingFBO.resize({width:T,height:k}),this.width=T,this.height=k),y(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,yn.Z)(a,3),p=s[0],v=s[1],y=s[2];this.layer.hooks.beforeHighlight.call([p,v,y]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,yn.Z)(a,3),p=s[0],v=s[1],y=s[2];this.layer.hooks.beforeSelect.call([p,v,y]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=Ws(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=Ws(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(ef))||Hd),E0=Q(11700),Rv=Q.n(E0),S0=Q(68929),C0=Q.n(S0),kv,Lv,Dv,Xd,Fv;function Bv(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ju(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bv(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var fd=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ec=(kv=(0,Lr.b2)(),Lv=(0,Lr.f3)(bt.IShaderModuleService),kv(Dv=(Xd=function(){function e(){(0,ft.Z)(this,e),xn(this,"shaderModuleService",Fv,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",fd),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,Mt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Jc.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(bt.IRendererService),this.shaderModuleService=r.getContainer().get(bt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,v=a.createModel,y=this.setupShaders(),x=y.vs,C=y.fs,T=y.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:O.FLOAT}),size:2})},uniforms:ju(ju({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,v=p.useFramebuffer,y=p.getViewportSize,x=p.clear,C=y(),T=C.width,k=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=ju({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,k]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=ju(ju({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){oo()(r[a])||(n["u_".concat(Rv()(C0()(a)))]=r[a])}),n}}]),e}(),Fv=Ln(Xd.prototype,"shaderModuleService",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd))||Dv),Qp,Yd;function cm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Cx(e){var i=Ax();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Ax(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tx=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Mx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Px=(Qp=(0,Lr.b2)(),Qp(Yd=function(e){(0,Rr.Z)(r,e);var i=Cx(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Mx,fs:Tx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,y=this.rendererService.getViewportSize(),x=y.width,C=y.height;return{vs:s,fs:p,uniforms:fm(fm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return oo()(a.bloomRadius)||(s.u_radius=a.bloomRadius),oo()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),oo()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(Ec))||Yd),pm,hm;function dm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ix(e){var i=Ox();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Ox(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,kx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lx=(pm=(0,Lr.b2)(),pm(hm=function(e){(0,Rr.Z)(r,e);var i=Ix(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:kx,fs:Rx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,y=this.rendererService.getViewportSize(),x=y.width,C=y.height;return{vs:s,fs:p,uniforms:vm(vm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return oo()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(Ec))||hm),mm,gm;function ym(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _m(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ym(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ym(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Dx(e){var i=Fx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Fx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Nx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zx=(mm=(0,Lr.b2)(),mm(gm=function(e){(0,Rr.Z)(r,e);var i=Dx(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Nx,fs:Bx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,y=this.rendererService.getViewportSize(),x=y.width,C=y.height;return{vs:s,fs:p,uniforms:_m(_m({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return oo()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(Ec))||gm),xm,bm;function Em(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Em(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Em(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ux(e){var i=Zx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Zx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Vx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Gx=(xm=(0,Lr.b2)(),xm(bm=function(e){(0,Rr.Z)(r,e);var i=Ux(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Vx,fs:jx});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,v=a.uniforms,y=this.rendererService.getViewportSize(),x=y.width,C=y.height;return{vs:s,fs:p,uniforms:Sm(Sm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Ec))||bm),Cm,Am;function Hx(e){var i=Wx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Wx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Yx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qx=(Cm=(0,Lr.b2)(),Cm(Am=function(e){(0,Rr.Z)(r,e);var i=Hx(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Yx,fs:Xx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Ec))||Am),wm,Tm;function Mm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kx(e){var i=$x();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function $x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Jx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,eb=(wm=(0,Lr.b2)(),wm(Tm=function(e){(0,Rr.Z)(r,e);var i=Kx(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Jx,fs:Qx});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,v=a.uniforms,y=this.rendererService.getViewportSize(),x=y.width,C=y.height;return{vs:s,fs:p,uniforms:Pm(Pm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Ec))||Tm),Im,Om;function Rm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function km(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tb(e){var i=rb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function rb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ib=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ab=(Im=(0,Lr.b2)(),Im(Om=function(e){(0,Rr.Z)(r,e);var i=tb(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:ib,fs:nb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,v=a.uniforms,y=this.rendererService.getViewportSize(),x=y.width,C=y.height;return{vs:s,fs:p,uniforms:km(km({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Ec))||Om),Lm,Dm;function ob(e){var i=sb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ub=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,lb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cb=(Lm=(0,Lr.b2)(),Lm(Dm=function(e){(0,Rr.Z)(r,e);var i=ob(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:lb,fs:ub}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Ec))||Dm),Fm,Bm;function fb(e){var i=pb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,db=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,vb=(Fm=(0,Lr.b2)(),Fm(Bm=function(e){(0,Rr.Z)(r,e);var i=fb(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:hb,fs:db}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Ec))||Bm),Nm,zm,Um,Zm,pd,jm,mb=(Nm=(0,Lr.b2)(),zm=(0,Lr.f3)(bt.IRendererService),Um=(0,Lr.zY)(),Nm(Zm=(pd=function(){function e(){(0,ft.Z)(this,e),xn(this,"rendererService",jm,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,Mt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,v=s.height;return a({x:0,y:0,width:p,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,N.Z)(j().mark(function p(){return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return y.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,N.Z)(j().mark(function n(a,s){var p,v;return j().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,N.Z)(j().mark(function n(a){var s,p;return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:s=0;case 1:if(!(s<this.passes.length)){y.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){y.next=9;break}return y.next=7,this.renderBloomPass(a,p);case 7:y.next=12;break;case 9:return y.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,y.next=1;break;case 15:case"end":return y.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),jm=Ln(pd.prototype,"rendererService",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ln(pd.prototype,"init",[Um],Object.getOwnPropertyDescriptor(pd.prototype,"init"),pd.prototype),pd))||Zm),Vm,Gm;function gb(e){var i=yb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _b=(Vm=(0,Lr.b2)(),Vm(Gm=function(e){(0,Rr.Z)(r,e);var i=gb(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getType",value:function(){return Jc.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,od.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,v=s.clear,y=a.multiPassRenderer.getPostProcessor().getReadFBO();p(y,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:y}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(ef))||Gm),Hm,Wm,Xm,A0,Ym;function qm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Km(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xb(e){var i=bb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,$m=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Qm(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var Cb=1,Ab=(Hm=(0,Lr.b2)(),Wm=(0,Lr.f3)(bt.IShaderModuleService),Hm(Xm=(A0=function(e){(0,Rr.Z)(r,e);var i=xb(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),xn((0,le.Z)(n),"shaderModuleService",Ym,(0,le.Z)(n)),(0,A.Z)((0,le.Z)(n),"haltonSequence",[]),(0,A.Z)((0,le.Z)(n),"accumulatingId",0),(0,A.Z)((0,le.Z)(n),"frame",0),(0,A.Z)((0,le.Z)(n),"timer",void 0),(0,A.Z)((0,le.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,le.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,le.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,le.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,le.Z)(n),"blendModel",void 0),(0,A.Z)((0,le.Z)(n),"outputModel",void 0),(0,A.Z)((0,le.Z)(n),"copyModel",void 0),n}return(0,Mt.Z)(r,[{key:"getType",value:function(){return Jc.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,od.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,v=p.createFramebuffer,y=p.createTexture2D;this.sampleRenderTarget=v({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([Qm(x,2),Qm(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",Eb),this.outputModel=this.createTriangleModel("copy-pass",$m,{blend:{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE_MINUS_SRC_ALPHA,srcAlpha:O.ONE,dstAlpha:O.ONE_MINUS_SRC_ALPHA},equation:{rgb:O.FUNC_ADD,alpha:O.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",$m)}},{key:"render",value:function(a){var s=this,p=this.rendererService,v=p.clear,y=p.getViewportSize,x=p.useFramebuffer,C=y(),T=C.width,k=C.height;this.sampleRenderTarget.resize({width:T,height:k}),this.prevRenderTarget.resize({width:T,height:k}),this.outputRenderTarget.resize({width:T,height:k}),this.copyRenderTarget.resize({width:T,height:k}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var V=function K(ee){!s.accumulatingId||ee!==s.accumulatingId||s.isFinished()||(s.doRender(a),oa.requestAnimationFrame(function(){K(ee)}))};this.accumulatingId=Cb++,this.timer=oa.setTimeout(function(){V(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,v=p.clear,y=p.getViewportSize,x=p.useFramebuffer,C=y(),T=C.width,k=C.height,F=a.getLayerConfig(),V=F.jitterScale,K=V===void 0?1:V,ee=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ee[0]*2-1)/T*K,(ee[1]*2-1)/k*K),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var be=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:be.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var je=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=je,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,oa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:Sb,fs:s});var v=this.shaderModuleService.getModule(a),y=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,k=T.createAttribute,F=T.createBuffer,V=T.createModel;return V(Km({vs:y,fs:x,attributes:{a_Position:k({buffer:F({data:[-4,-4,4,-4,0,4],type:O.FLOAT}),size:2})},uniforms:Km({},C),depth:{enable:!1},count:3},p))}}]),r}(ef),Ym=Ln(A0.prototype,"shaderModuleService",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A0))||Xm),qd=new Lr.W2;qd.bind(bt.IGlobalConfigService).to(ki).inSingletonScope(),(0,Lr.GW)((0,Lr.b2)(),go.EventEmitter),qd.bind(bt.IEventEmitter).to(go.EventEmitter);var Jm=(0,Pd.Z)(qd,!1),w0=function(i){var r=Jm.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},l3=function(i){var r=Jm.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},$l=qd,wb=0;function Tb(){var e=new Lr.W2;return e.parent=qd,e.bind(bt.SceneID).toConstantValue("".concat(wb++)),e.bind(bt.IShaderModuleService).to(bc).inSingletonScope(),e.bind(bt.ILayerService).to(cs).inSingletonScope(),e.bind(bt.ISceneService).to(yv).inSingletonScope(),e.bind(bt.ICameraService).to(yi).inSingletonScope(),e.bind(bt.ICoordinateSystemService).to(b0).inSingletonScope(),e.bind(bt.IInteractionService).to(D).inSingletonScope(),e.bind(bt.IPickingService).to(Pn).inSingletonScope(),e.bind(bt.IControlService).to(Fi).inSingletonScope(),e.bind(bt.IMarkerService).to(Ri).inSingletonScope(),e.bind(bt.IIconService).to(ph).inSingletonScope(),e.bind(bt.IFontService).to(nl).inSingletonScope(),e.bind(bt.IPopupService).to(qo).inSingletonScope(),e.bind(bt.INormalPass).to(Iv).whenTargetNamed("clear"),e.bind(bt.INormalPass).to(cd).whenTargetNamed("pixelPicking"),e.bind(bt.INormalPass).to(_b).whenTargetNamed("render"),e.bind(bt.INormalPass).to(Ab).whenTargetNamed("taa"),e.bind(bt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(bt.INormalPass,r)}}),e.bind(bt.IPostProcessingPass).to(qx).whenTargetNamed("copy"),e.bind(bt.IPostProcessingPass).to(Px).whenTargetNamed("bloom"),e.bind(bt.IPostProcessingPass).to(Lx).whenTargetNamed("blurH"),e.bind(bt.IPostProcessingPass).to(zx).whenTargetNamed("blurV"),e.bind(bt.IPostProcessingPass).to(cb).whenTargetNamed("noise"),e.bind(bt.IPostProcessingPass).to(vb).whenTargetNamed("sepia"),e.bind(bt.IPostProcessingPass).to(Gx).whenTargetNamed("colorHalftone"),e.bind(bt.IPostProcessingPass).to(eb).whenTargetNamed("hexagonalPixelate"),e.bind(bt.IPostProcessingPass).to(ab).whenTargetNamed("ink"),e.bind(bt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(bt.IPostProcessingPass,r);return n.setName(r),n}}),e}function Mb(e){var i=new Lr.W2;return i.parent=e,i.bind(bt.IStyleAttributeService).to(mc).inSingletonScope(),i.bind(bt.IMultiPassRenderer).to(Vd).inSingletonScope(),i.bind(bt.IPostProcessor).to(mb).inSingletonScope(),i}var c3=Q(74691),Pb=null;function f3(e){return Pb.indexOf(e)}var Ib=2,p3=4,Ob=64,h3=128,Rb=256,kb=512,d3=8192,v3=16384,m3=32768,Lb=null,eg=131072,g3=262144,Db=524288,y3=1048576,Fb=2097152,_3=4194304,Bb=8388608,Nb=16777216,zb=null;function Nv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function x3(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,v=e.stroke,y=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],k=[],F=[Nv(i[0],i[1]),Nv(i[2],i[3])],V=[Nv(v[0],v[1]),Nv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(K){var ee=_slicedToArray(K,2),be=ee[0],je=ee[1];C.push([].concat(F,[(be+1)*Bb+(je+1)*Fb+getShapeIndex(s)*eg+r,(n+512)*Db+(a+512)*Ob])),T.push([].concat(V,[y,x])),k.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:k}}function b3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*zb+r*Nb+n*eg+r*Lb+n*kb+r*Rb+n*Ib+r}var Sc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Sc||(Sc={}));var $s;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})($s||($s={}));var Jp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Jp||(Jp={}));var Fn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Fn||(Fn={}));var Ub=["mapload","mapchange","mapAfterFrameChange"],Ph={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},T0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],eh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(eh||(eh={}));function tg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Zb(e){var i=jb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vb=0,zv=function(e){(0,Rr.Z)(r,e);var i=Zb(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this),(0,A.Z)((0,le.Z)(a),"controlOption",void 0),(0,A.Z)((0,le.Z)(a),"container",void 0),(0,A.Z)((0,le.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,le.Z)(a),"mapsService",void 0),(0,A.Z)((0,le.Z)(a),"renderService",void 0),(0,A.Z)((0,le.Z)(a),"layerService",void 0),(0,A.Z)((0,le.Z)(a),"controlService",void 0),(0,A.Z)((0,le.Z)(a),"isShow",void 0),a.controlOption=rg(rg({},a.getDefault()),n||{}),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:eh.TOPRIGHT,name:"".concat(Vb++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(bt.IMapService),this.renderService=a.get(bt.IRendererService),this.layerService=a.get(bt.ILayerService),this.controlService=a.get(bt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,v=this.controlService.controlCorners[p];return Bl(s,"l7-control"),p.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Bl(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;qu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;oc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(go.EventEmitter);function Gb(e){var i=Hb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E3=function(e){(0,Rr.Z)(r,e);var i=Gb(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,le.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,le.Z)(a),"layers",void 0),(0,A.Z)((0,le.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,le.Z)(a),"handlingClick",void 0),(0,A.Z)((0,le.Z)(a),"layersLink",void 0),(0,A.Z)((0,le.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,le.Z)(a),"separator",void 0),(0,A.Z)((0,le.Z)(a),"overlaysList",void 0),(0,A.Z)((0,le.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),da(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,le.Z)(a)),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:eh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Bl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Bl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):qu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return qu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Na("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Na("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Na("a",a+"-toggle",s);var y=this.layersLink;y.title="Layers",p||this.expand(),this.baseLayersList=Na("div",a+"-base",v),this.separator=Na("div",a+"-separator",v),this.overlaysList=Na("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,v=p===void 0?{}:p,y=s.overlayers,x=y===void 0?{}:y;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;Nl(this.baseLayersList),Nl(this.overlaysList),this.layerControlInputs=[];var a,s,p,v,y=0;for(p=0;p<this.layers.length;p++)v=this.layers[p],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,y+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&y>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,v=this.mapsService.getZoom(),y=a.length-1;y>=0;y--)if(s=a[y],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var v=this.controlOption,y=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;y&&this.layers.sort(function(T,k){return x(T.layer,k.layer,T.name,k.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=p,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),v=p&&p.inited&&a.layer.isVisible(),y;a.overlay?(y=document.createElement("input"),y.type="checkbox",y.className="l7-control-layers-selector",y.defaultChecked=v):y=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(y),y.layerId=a.layer.id,y.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(y),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,v=[],y=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?v.push(p):s.checked||y.push(p);y.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(zv);function Wb(e){var i=Xb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yb=function(e){(0,Rr.Z)(r,e);var i=Wb(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:eh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Na("div",a),p=Na("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(zv);function qb(e){var i=Kb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S3=function(e){(0,Rr.Z)(r,e);var i=qb(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,le.Z)(a),"mScale",void 0),(0,A.Z)((0,le.Z)(a),"iScale",void 0),da(["update"],(0,le.Z)(a)),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:eh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Na("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,v=a.containerToLngLat([0,p]),y=a.containerToLngLat([s,p]),x=_s([v.lng,v.lat],[y.lng,y.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,v=s.imperial;p&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,v,y;s>5280?(p=s/5280,v=this.getRoundNum(p),this.updateScale(this.iScale,v+" mi",v/p)):(y=this.getRoundNum(s),this.updateScale(this.iScale,y+" ft",y/s))}},{key:"updateScale",value:function(a,s,p){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,v=p.metric,y=p.imperial;v&&(this.mScale=Na("div",a,s)),y&&(this.iScale=Na("div",a,s))}}]),r}(zv);function $b(e){var i=Qb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C3=function(e){(0,Rr.Z)(r,e);var i=$b(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,le.Z)(a),"disabled",void 0),(0,A.Z)((0,le.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,le.Z)(a),"zoomOutButton",void 0),da(["updateDisabled","zoomIn","zoomOut"],(0,le.Z)(a)),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{position:eh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Na("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,v,y){var x=Na("a",p,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",y),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";qu(this.zoomInButton,s),qu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Bl(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Bl(this.zoomInButton,s)}}]),r}(zv);function ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ig(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ng(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jb(e){var i=e2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function e2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ag=function(e){(0,Rr.Z)(r,e);var i=Jb(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this),(0,A.Z)((0,le.Z)(a),"markerOption",void 0),(0,A.Z)((0,le.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,le.Z)(a),"popup",void 0),(0,A.Z)((0,le.Z)(a),"mapsService",void 0),(0,A.Z)((0,le.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,le.Z)(a),"lngLat",void 0),(0,A.Z)((0,le.Z)(a),"scene",void 0),(0,A.Z)((0,le.Z)(a),"added",!1),(0,A.Z)((0,le.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=ig(ig({},a.getDefault()),n),da(["update","onMove","onUp","addDragHandler","onMapClick"],(0,le.Z)(a)),a.init(),a}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:vl.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(bt.IMapService),this.sceneSerive=a.get(bt.ISceneService);var s=this.markerOption,p=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&oc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&oc(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),mo(s,"".concat(ku[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,v=this.lngLat,y=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([y,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var k=this.mapsService.getContainer(),F=0,V=0;if(k&&(F=k.scrollWidth,V=k.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>F){var K=this.mapsService.lngLatToContainer([y-360,x]);T.x=K.x}if(T.x<0){var ee=this.mapsService.lngLatToContainer([y+360,x]);T.x=ee.x}}(T.x>F||T.x<0||T.y>V||T.y<0)&&(s.style.display="none"),s.style.left=T.x+p[0]+"px",s.style.top=T.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,v=p.color,y=p.anchor;if(!s){this.defaultMarker=!0,s=Na("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Bl(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var k,F,V=((k=a.markerOption)===null||k===void 0?void 0:k.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=V)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),zl(s,y,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(go.EventEmitter);function og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?og(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t2(e){var i=r2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function r2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A3=function(e){(0,Rr.Z)(r,e);var i=t2(r);function r(n){var a,s;return(0,ft.Z)(this,r),s=i.call(this),(0,A.Z)((0,le.Z)(s),"markers",[]),(0,A.Z)((0,le.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,le.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,le.Z)(s),"points",[]),(0,A.Z)((0,le.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,le.Z)(s),"mapsService",void 0),(0,A.Z)((0,le.Z)(s),"scene",void 0),(0,A.Z)((0,le.Z)(s),"zoom",void 0),(0,A.Z)((0,le.Z)(s),"bbox",void 0),s.markerLayerOption=Uo()(s.getDefault(),n),da(["update"],(0,le.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Mt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(bt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;s&&this.addPoint(a,this.markers.length),this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),v=p.lng,y=p.lat,x={geometry:{type:"Point",coordinates:[v,y]},properties:sg(sg({},a.getExtData()),{},{marker_id:s})};this.points.push(x)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,v=p===void 0?0:p,y=a.maxZoom;this.clusterIndex=new(vu())({radius:s,minZoom:v,maxZoom:y}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,v=a[0].concat(a[1]),y=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],y.forEach(function(x){var C,T=p.markerLayerOption.clusterOption,k=T.field,F=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var V,K=p.getLeaves((V=x.properties)===null||V===void 0?void 0:V.cluster_id);if(x.properties.clusterData=K,k&&F){var ee=K==null?void 0:K.map(function(At){var It=(0,A.Z)({},k,At.properties[k]);return It}),be=lc(ee,k),je=Bc(F,be),Ke="point_"+F;x.properties[Ke]=je.toFixed(2)}}var et=p.clusterMarker(x);p.clusterMarkers.push(et),et.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,v=p.element,y=v===void 0?this.generateElement.bind(this):v,x=new ag({element:y(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Cn(this.bbox,s))&&(this.bbox=In(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(a){var s=Na("div","l7-marker-cluster"),p=Na("div","",s),v=Na("span","",p),y=this.markerLayerOption.clusterOption,x=y.field,C=y.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(go.EventEmitter);function ug(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ug(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ug(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function n2(e){var i=i2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function i2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cg=function(e){(0,Rr.Z)(r,e);var i=n2(r);function r(n){var a;return(0,ft.Z)(this,r),a=i.call(this),(0,A.Z)((0,le.Z)(a),"popupOption",void 0),(0,A.Z)((0,le.Z)(a),"mapsService",void 0),(0,A.Z)((0,le.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,le.Z)(a),"lngLat",void 0),(0,A.Z)((0,le.Z)(a),"content",void 0),(0,A.Z)((0,le.Z)(a),"closeButton",void 0),(0,A.Z)((0,le.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,le.Z)(a),"container",void 0),(0,A.Z)((0,le.Z)(a),"tip",void 0),(0,A.Z)((0,le.Z)(a),"scene",void 0),a.popupOption=lg(lg({},a.getdefault()),n),da(["update","onClickClose","remove"],(0,le.Z)(a)),a}return(0,Mt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(bt.IMapService),this.sceneSerive=a.get(bt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),v;for(p.innerHTML=a;v=p.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&oc(this.content),this.content=Na("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Na("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),p&&p.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:vl.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,v=p.className,y=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(k){return a.container.classList.add(k)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){a.container.addEventListener(k,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}y&&this.container.style.maxWidth!==y&&(this.container.style.maxWidth=y),this.updatePosition(),mo(this.container,"".concat(ku[x])),zl(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,v=this.popupOption.offsets,y=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=y.x+v[0]+"px",this.container.style.top=y.y-v[1]+"px"}}}]),r}(go.EventEmitter);function a2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}a2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var o2=Q(88307),s2=Q.n(o2),u2=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,v=r.size,y=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:y||0},v&&(this.attribute.size=v)}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ap,Kd,wp,Cc,$d,th,Qd,Uv,Df,Ih,_u,Ff,Bf,Zv,l2=(Ap={},(0,A.Z)(Ap,O.POINTS,"points"),(0,A.Z)(Ap,O.LINES,"lines"),(0,A.Z)(Ap,O.LINE_LOOP,"line loop"),(0,A.Z)(Ap,O.LINE_STRIP,"line strip"),(0,A.Z)(Ap,O.TRIANGLES,"triangles"),(0,A.Z)(Ap,O.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(Ap,O.TRIANGLE_STRIP,"triangle strip"),Ap),fg=(Kd={},(0,A.Z)(Kd,O.STATIC_DRAW,"static"),(0,A.Z)(Kd,O.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(Kd,O.STREAM_DRAW,"stream"),Kd),M0=(wp={},(0,A.Z)(wp,O.BYTE,"int8"),(0,A.Z)(wp,O.UNSIGNED_INT,"int16"),(0,A.Z)(wp,O.INT,"int32"),(0,A.Z)(wp,O.UNSIGNED_BYTE,"uint8"),(0,A.Z)(wp,O.UNSIGNED_SHORT,"uint16"),(0,A.Z)(wp,O.UNSIGNED_INT,"uint32"),(0,A.Z)(wp,O.FLOAT,"float"),wp),c2=(Cc={},(0,A.Z)(Cc,O.ALPHA,"alpha"),(0,A.Z)(Cc,O.LUMINANCE,"luminance"),(0,A.Z)(Cc,O.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Cc,O.RGB,"rgb"),(0,A.Z)(Cc,O.RGBA,"rgba"),(0,A.Z)(Cc,O.RGBA4,"rgba4"),(0,A.Z)(Cc,O.RGB5_A1,"rgb5 a1"),(0,A.Z)(Cc,O.RGB565,"rgb565"),(0,A.Z)(Cc,O.DEPTH_COMPONENT,"depth"),(0,A.Z)(Cc,O.DEPTH_STENCIL,"depth stencil"),Cc),f2=($d={},(0,A.Z)($d,O.DONT_CARE,"dont care"),(0,A.Z)($d,O.NICEST,"nice"),(0,A.Z)($d,O.FASTEST,"fast"),$d),pg=(th={},(0,A.Z)(th,O.NEAREST,"nearest"),(0,A.Z)(th,O.LINEAR,"linear"),(0,A.Z)(th,O.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(th,O.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(th,O.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(th,O.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),th),hg=(Qd={},(0,A.Z)(Qd,O.REPEAT,"repeat"),(0,A.Z)(Qd,O.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(Qd,O.MIRRORED_REPEAT,"mirror"),Qd),p2=(Uv={},(0,A.Z)(Uv,O.NONE,"none"),(0,A.Z)(Uv,O.BROWSER_DEFAULT_WEBGL,"browser"),Uv),h2=(Df={},(0,A.Z)(Df,O.NEVER,"never"),(0,A.Z)(Df,O.ALWAYS,"always"),(0,A.Z)(Df,O.LESS,"less"),(0,A.Z)(Df,O.LEQUAL,"lequal"),(0,A.Z)(Df,O.GREATER,"greater"),(0,A.Z)(Df,O.GEQUAL,"gequal"),(0,A.Z)(Df,O.EQUAL,"equal"),(0,A.Z)(Df,O.NOTEQUAL,"notequal"),Df),dg=(Ih={},(0,A.Z)(Ih,O.FUNC_ADD,"add"),(0,A.Z)(Ih,O.MIN_EXT,"min"),(0,A.Z)(Ih,O.MAX_EXT,"max"),(0,A.Z)(Ih,O.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Ih,O.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ih),jv=(_u={},(0,A.Z)(_u,O.ZERO,"zero"),(0,A.Z)(_u,O.ONE,"one"),(0,A.Z)(_u,O.SRC_COLOR,"src color"),(0,A.Z)(_u,O.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(_u,O.SRC_ALPHA,"src alpha"),(0,A.Z)(_u,O.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(_u,O.DST_COLOR,"dst color"),(0,A.Z)(_u,O.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(_u,O.DST_ALPHA,"dst alpha"),(0,A.Z)(_u,O.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(_u,O.CONSTANT_COLOR,"constant color"),(0,A.Z)(_u,O.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(_u,O.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(_u,O.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(_u,O.SRC_ALPHA_SATURATE,"src alpha saturate"),_u),d2=(Ff={},(0,A.Z)(Ff,O.NEVER,"never"),(0,A.Z)(Ff,O.ALWAYS,"always"),(0,A.Z)(Ff,O.LESS,"less"),(0,A.Z)(Ff,O.LEQUAL,"lequal"),(0,A.Z)(Ff,O.GREATER,"greater"),(0,A.Z)(Ff,O.GEQUAL,"gequal"),(0,A.Z)(Ff,O.EQUAL,"equal"),(0,A.Z)(Ff,O.NOTEQUAL,"notequal"),Ff),hd=(Bf={},(0,A.Z)(Bf,O.ZERO,"zero"),(0,A.Z)(Bf,O.KEEP,"keep"),(0,A.Z)(Bf,O.REPLACE,"replace"),(0,A.Z)(Bf,O.INVERT,"invert"),(0,A.Z)(Bf,O.INCR,"increment"),(0,A.Z)(Bf,O.DECR,"decrement"),(0,A.Z)(Bf,O.INCR_WRAP,"increment wrap"),(0,A.Z)(Bf,O.DECR_WRAP,"decrement wrap"),Bf),v2=(Zv={},(0,A.Z)(Zv,O.FRONT,"front"),(0,A.Z)(Zv,O.BACK,"back"),Zv),m2=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:fg[a||O.STATIC_DRAW],type:M0[s||O.UNSIGNED_BYTE]})}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),g2=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:fg[a||O.STATIC_DRAW],type:M0[s||O.UNSIGNED_BYTE],count:p})}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),y2=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,v=r.depth,y=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),_2=Q(36719),x2=Q.n(_2),b2=Q(68630),E2=Q.n(b2);function vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var S2=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,v=r.primitive,y=r.count,x=r.elements,C=r.depth,T=r.blend,k=r.stencil,F=r.cull,V=r.instances,K={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Ke){K[Ke]=i.prop(Ke)}));var ee={};Object.keys(s).forEach(function(Ke){ee[Ke]=s[Ke].get()});var be={attributes:ee,frag:a,uniforms:K,vert:n,blend:{},primitive:l2[v===void 0?O.TRIANGLES:v]};V&&(be.instances=V),y&&(be.count=y),x&&(be.elements=x.get()),this.initDepthDrawParams({depth:C},be),this.initBlendDrawParams({blend:T},be),this.initStencilDrawParams({stencil:k},be),this.initCullDrawParams({cull:F},be),this.drawCommand=i(be);var je=U()(be);je.blend=Nf(Nf({},je.blend),{},{enable:!1}),je.stencil=Nf(Nf({},je.stencil),{},{enable:!1}),this.drawPickCommand=i(je),this.drawParams=be}return(0,Mt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=Nf(Nf({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Nf(Nf({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var v=(0,Ge.Z)(a[p]);v==="boolean"||v==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:h2[a.func||O.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,v=a.equation,y=a.color,x=y===void 0?[0,0,0,0]:y;n.blend={enable:!!s,func:{srcRGB:jv[p&&p.srcRGB||O.SRC_ALPHA],srcAlpha:jv[p&&p.srcAlpha||O.SRC_ALPHA],dstRGB:jv[p&&p.dstRGB||O.ONE_MINUS_SRC_ALPHA],dstAlpha:jv[p&&p.dstAlpha||O.ONE_MINUS_SRC_ALPHA]},equation:{rgb:dg[v&&v.rgb||O.FUNC_ADD],alpha:dg[v&&v.alpha||O.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,v=p===void 0?-1:p,y=a.func,x=y===void 0?{cmp:O.ALWAYS,ref:0,mask:-1}:y,C=a.opFront,T=C===void 0?{fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP}:C,k=a.opBack,F=k===void 0?{fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP}:k;n.stencil={enable:!!s,mask:v,func:Nf(Nf({},x),{},{cmp:d2[x.cmp]}),opFront:{fail:hd[T.fail],zfail:hd[T.zfail],zpass:hd[T.zpass]},opBack:{fail:hd[F.fail],zfail:hd[F.zfail],zpass:hd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,v=p===void 0?O.BACK:p;n.cull={enable:!!s,face:v2[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||x2()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}E2()(n)&&Object.keys(n).forEach(function(v){p.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,y){Object.keys(v).forEach(function(x){p.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(y,"]"))})})}}]),e}(),C2=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?O.UNSIGNED_BYTE:a,p=r.width,v=r.height,y=r.flipY,x=y===void 0?!1:y,C=r.format,T=C===void 0?O.RGBA:C,k=r.mipmap,F=k===void 0?!1:k,V=r.wrapS,K=V===void 0?O.CLAMP_TO_EDGE:V,ee=r.wrapT,be=ee===void 0?O.CLAMP_TO_EDGE:ee,je=r.aniso,Ke=je===void 0?0:je,et=r.alignment,At=et===void 0?1:et,It=r.premultiplyAlpha,Kt=It===void 0?!1:It,hr=r.mag,zr=hr===void 0?O.NEAREST:hr,rn=r.min,_r=rn===void 0?O.NEAREST:rn,Sn=r.colorSpace,kn=Sn===void 0?O.BROWSER_DEFAULT_WEBGL:Sn,ui=r.x,so=ui===void 0?0:ui,_o=r.y,Us=_o===void 0?0:_o,bu=r.copy,Qs=bu===void 0?!1:bu;this.width=p,this.height=v;var wd={width:p,height:v,type:M0[s],format:c2[T],wrapS:hg[K],wrapT:hg[be],mag:pg[zr],min:pg[_r],alignment:At,flipY:x,colorSpace:p2[kn],premultiplyAlpha:Kt,aniso:Ke,x:so,y:Us,copy:Qs};n&&(wd.data=n),typeof F=="number"?wd.mipmap=f2[F]:typeof F=="boolean"&&(wd.mipmap=F),this.texture=i.texture(wd)}return(0,Mt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),mg,gg,A2=(mg=(0,Lr.b2)(),mg(gg=function(){function e(){var i=this;(0,ft.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new S2(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new u2(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new m2(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new g2(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new C2(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new y2(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,v=p===void 0?null:p,y={color:n,depth:a,stencil:s};y.framebuffer=v===null?v:v.get(),i.gl.clear(y)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,v=r.height,y={x:a,y:s,width:p,height:v};return n&&(y.framebuffer=n.get()),i.gl.read(y)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(Yi)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Mt.Z)(e,[{key:"init",value:function(){var i=(0,N.Z)(j().mark(function n(a,s){var p=this;return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return this.canvas=a,y.next=3,new Promise(function(x,C){s2()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(k,F){(k||!F)&&C(k),x(F)}})});case 3:this.gl=y.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return y.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||gg);function yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var w2=function(){function e(i){(0,ft.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=Tb();this.container=p,n.setContainer(p,r,a,s),p.bind(bt.IRendererService).to(A2).inSingletonScope(),this.sceneService=p.get(bt.ISceneService),this.mapService=p.get(bt.IMapService),this.iconService=p.get(bt.IIconService),this.fontService=p.get(bt.IFontService),this.controlService=p.get(bt.IControlService),this.layerService=p.get(bt.ILayerService),this.markerService=p.get(bt.IMarkerService),this.interactionService=p.get(bt.IInteractionService),this.popupService=p.get(bt.IPopupService),Yi?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Mt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=Mb(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,yn.Z)(a,2),p=s[0],v=s[1];n.fontService.addIconFont(p,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Yi?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){T0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){T0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){T0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||_g(_g({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(bt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ma(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new Yb({position:a}))}}]),e}(),T2=Q(52353),M2=Q.n(T2),P2=Q(13218),Vu=Q.n(P2),rh,xg=(rh={},(0,A.Z)(rh,Sc.additive,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Sc.none,{enable:!1}),(0,A.Z)(rh,Sc.normal,{enable:!0,func:{srcRGB:O.SRC_ALPHA,dstRGB:O.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Sc.subtractive,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE,srcAlpha:O.ZERO,dstAlpha:O.ONE_MINUS_SRC_COLOR},equation:{rgb:O.FUNC_SUBTRACT,alpha:O.FUNC_SUBTRACT}}),(0,A.Z)(rh,Sc.max,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE},equation:{rgb:O.MAX_EXT}}),(0,A.Z)(rh,Sc.min,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE},equation:{rgb:O.MIN_EXT}}),rh),I2=Q(81763),ga=Q.n(I2),O2=Q(1469),Oh=Q.n(O2),w3=1024;function ol(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function R2(e,i){e.opacity&&Vv("opacity",i,e.opacity),e.strokeWidth&&Vv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Vv("strokeOpacity",i,e.strokeOpacity),e.stroke&&k2("stroke",i,e.stroke),e.offsets&&bg("offsets",i,e.offsets),e.textOffset&&bg("textOffset",i,e.textOffset),e.thetaOffset&&Vv("thetaOffset",i,e.thetaOffset)}function Vv(e,i,r){E()(r)?ol(e,i,r,function(n){return n}):ga()(r)?ol(e,i,[r],void 0):Oh()(r)&&r.length===2?E()(r[0])&&P()(r[1])||E()(r[0])&&Oh()(r[1])&&ga()(r[1][0])&&ga()(r[1][1])?ol(e,i,r[0],r[1]):ol(e,i,[1],void 0):ol(e,i,[1],void 0)}function bg(e,i,r){E()(r)?ol(e,i,r,function(n){return n}):Oh()(r)&&r.length===2&&E()(r[0])&&P()(r[1])?ol(e,i,r[0],r[1]):Oh()(r)&&r.length===2&&ga()(r[0])&&ga()(r[1])?ol(e,i,r,void 0):ol(e,i,[0,0],void 0)}function k2(e,i,r){E()(r)?ol(e,i,r,void 0):Oh()(r)&&r.length===2&&(E()(r[0])&&P()(r[1])||E()(r[0])&&Oh()(r[1])&&r[1].length>0)?ol(e,i,r[0],r[1]):ol(e,i,"#fff",void 0)}function Eg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Sg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Eg(i).forEach(function(y){var x=(0,yn.Z)(y,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var L2=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function D2(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}L2.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var F2=["passes"],B2=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Cg,P0,Ag;function N2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=z2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function z2(e,i){if(!!e){if(typeof e=="string")return wg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wg(e,i)}}function wg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Tg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Tg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function U2(e){var i=Z2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mg=0,Rh=(Cg=w0(bt.IGlobalConfigService),P0=function(e){(0,Rr.Z)(r,e);var i=U2(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ft.Z)(this,r),n=i.call(this),(0,A.Z)((0,le.Z)(n),"id","".concat(Mg++)),(0,A.Z)((0,le.Z)(n),"name","".concat(Mg)),(0,A.Z)((0,le.Z)(n),"type",void 0),(0,A.Z)((0,le.Z)(n),"visible",!0),(0,A.Z)((0,le.Z)(n),"zIndex",0),(0,A.Z)((0,le.Z)(n),"minZoom",void 0),(0,A.Z)((0,le.Z)(n),"maxZoom",void 0),(0,A.Z)((0,le.Z)(n),"inited",!1),(0,A.Z)((0,le.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,le.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,le.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,le.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,le.Z)(n),"rendering",void 0),(0,A.Z)((0,le.Z)(n),"clusterZoom",0),(0,A.Z)((0,le.Z)(n),"layerType",void 0),(0,A.Z)((0,le.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,le.Z)(n),"hooks",{init:new Ls,afterInit:new Ls,beforeRender:new Ls,beforeRenderData:new os,afterRender:new ka,beforePickingEncode:new ka,afterPickingEncode:new ka,beforeHighlight:new ka(["pickedColor"]),afterHighlight:new ka,beforeSelect:new ka(["pickedColor"]),afterSelect:new ka,beforeDestroy:new ka,afterDestroy:new ka}),(0,A.Z)((0,le.Z)(n),"models",[]),(0,A.Z)((0,le.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,le.Z)(n),"plugins",void 0),(0,A.Z)((0,le.Z)(n),"sourceOption",void 0),(0,A.Z)((0,le.Z)(n),"layerModel",void 0),(0,A.Z)((0,le.Z)(n),"shapeOption",void 0),(0,A.Z)((0,le.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,le.Z)(n),"layerChildren",[]),xn((0,le.Z)(n),"configService",Ag,(0,le.Z)(n)),(0,A.Z)((0,le.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,le.Z)(n),"cameraService",void 0),(0,A.Z)((0,le.Z)(n),"coordinateService",void 0),(0,A.Z)((0,le.Z)(n),"iconService",void 0),(0,A.Z)((0,le.Z)(n),"fontService",void 0),(0,A.Z)((0,le.Z)(n),"pickingService",void 0),(0,A.Z)((0,le.Z)(n),"rendererService",void 0),(0,A.Z)((0,le.Z)(n),"layerService",void 0),(0,A.Z)((0,le.Z)(n),"interactionService",void 0),(0,A.Z)((0,le.Z)(n),"mapService",void 0),(0,A.Z)((0,le.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,le.Z)(n),"layerSource",void 0),(0,A.Z)((0,le.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,le.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,le.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,le.Z)(n),"container",void 0),(0,A.Z)((0,le.Z)(n),"encodedData",void 0),(0,A.Z)((0,le.Z)(n),"configSchema",void 0),(0,A.Z)((0,le.Z)(n),"currentPickId",null),(0,A.Z)((0,le.Z)(n),"rawConfig",void 0),(0,A.Z)((0,le.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,le.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,le.Z)(n),"scaleOptions",{}),(0,A.Z)((0,le.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,le.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,le.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,le.Z)(n),"isDestroied",!1),(0,A.Z)((0,le.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,v=s.fitBoundsOptions;p&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Mt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Gu(Gu({},this.needUpdateConfig),a);else{var s=this.container.get(bt.SceneID);R2(a,this),this.configService.setLayerConfig(s,this.id,Gu(Gu(Gu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(bt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(bt.IIconService),this.fontService=this.container.get(bt.IFontService),this.rendererService=this.container.get(bt.IRendererService),this.layerService=this.container.get(bt.ILayerService),this.interactionService=this.container.get(bt.IInteractionService),this.pickingService=this.container.get(bt.IPickingService),this.mapService=this.container.get(bt.IMapService);var p=this.getLayerConfig(),v=p.enableMultiPassRenderer,y=p.passes;v&&y!==null&&y!==void 0&&y.length&&y.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(bt.ICameraService),this.coordinateService=this.container.get(bt.ICoordinateSystemService),this.shaderModuleService=this.container.get(bt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(bt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(bt.IFactoryNormalPass),this.styleAttributeService=this.container.get(bt.IStyleAttributeService),this.multiPassRenderer=this.container.get(bt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(k){var F=k.attributeName,V=k.attributeField,K=k.attributeValues,ee=k.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Gu({field:V},a.splitValuesAndCallbackInAttribute(K,a.getLayerConfig()[F]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(bt.ILayerPlugin);var x=N2(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(k){x.e(k)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Gu(Gu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var v,y,x,C=(v=this.styleAttributeService)===null||v===void 0||(y=v.getLayerStyleAttribute("shape"))===null||y===void 0||(x=y.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),D2(this,C,T),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Vu()(a)?(s.enable=!0,s=Gu(Gu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){p.layerSource.setData(a,s)}),this}},{key:"style",value:function(a){var s=this,p=a.passes,v=(0,ts.Z)(a,F2);return p&&Eg(p).forEach(function(y){var x=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(y[0]);x&&x.updateOptions(y[1])}),this.rawConfig=Gu(Gu({},this.rawConfig),v),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(a,s){return Vu()(a)?this.scaleOptions=Gu(Gu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,N.Z)(j().mark(function s(){return j().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Vu()(a)?!0:a,Vu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Vu()(a)){var v=a.x,y=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Vu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Vu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:y,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Vu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Vu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ws(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Vu()(a)?!0:a,Vu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Vu()(a)){var v=a.x,y=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Vu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Vu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:y,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Vu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Vu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ws(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,v=s.minZoom,y=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=y&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),v=p.passes,y=v===void 0?[]:v;this.multiPassRenderer=Sg(this,y,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,v=p.some(function(y){return Math.abs(y)===Infinity});return v?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var y=s.domain().filter(function(x){return!M2()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return y}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,v=a.fragmentShader,y=a.triangulation,x=a.segmentNumber,C=(0,ts.Z)(a,B2);this.shaderModuleService.registerModule(s,{vs:p,fs:v});var T=this.shaderModuleService.getModule(s),k=T.vs,F=T.fs,V=T.uniforms,K=this.rendererService.createModel,ee=this.styleAttributeService.createAttributesAndIndices(this.encodedData,y,x),be=ee.attributes,je=ee.elements;return K(Gu({attributes:be,uniforms:V,fs:F,vs:k,elements:je,blend:xg[Sc.normal]},C))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,v=p===void 0?!0:p,y=s.enableSelect,x=y===void 0?!0:y,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,N.Z)(j().mark(function s(p){return j().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,p.render();case 2:case"end":return y.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Gu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:P()(a)?void 0:a||s,callback:P()(a)?a:void 0}}}]),r}(go.EventEmitter),Ag=Ln(P0.prototype,"configService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P0),j2=Q(18446),dd=Q.n(j2),Pg,I0,Ig;function V2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=G2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function G2(e,i){if(!!e){if(typeof e=="string")return Og(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Og(e,i)}}function Og(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ko=(Pg=w0(bt.IGlobalConfigService),I0=function(){function e(i){(0,ft.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),xn(this,"configService",Ig,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(bt.IRendererService),this.shaderModuleService=i.getContainer().get(bt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(bt.IStyleAttributeService),this.mapService=i.getContainer().get(bt.IMapService),this.iconService=i.getContainer().get(bt.IIconService),this.fontService=i.getContainer().get(bt.IFontService),this.cameraService=i.getContainer().get(bt.ICameraService),this.layerService=i.getContainer().get(bt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:O.NEAREST,min:O.NEAREST,width:1,height:1}))}return(0,Mt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return dd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),dd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),dd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),dd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),dd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),dd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ga()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ga()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ga()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ga()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return E()(r)?!!(0,$u.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Gi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Oh()(r)&&r.length===2&&ga()(r[0])&&ga()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=V2(a),p;try{for(s.s();!(p=s.n()).done;){var v=p.value,y=v.attr,x=v.count,C=n[y];C!==void 0?y==="stroke"?r.push.apply(r,(0,Ce.Z)(Gi(C))):y==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(ga()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=p*this.DATA_TEXTURE_WIDTH,y=[],x=0;x<s;x++){var C=n[x];this.patchData(y,C,a)}for(var T=y.length;T<v;T++)y.push(-1);return{data:y,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return xg[Sc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Ig=Ln(I0.prototype,"configService",[Pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0),H2=Q(9187),zf=Q.n(H2),Rg=100,T3=36,M3=40;function kg(e){return e/180*Math.acos(-1)}function Lg(e){var i=kg(e[0])+Math.PI/2,r=kg(e[1]),n=Rg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function P3(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,v=2+p,y=2*v,x=[],C=[],T=[],k=[],F=[],V=[],K=0;K<=v;K++){for(var ee=K/v,be=ee*Math.PI,je=0;je<=y;je++){var Ke=je/y,et=Ke*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-be),mat4.identity(r),mat4.rotateY(r,r,et),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),k.push.apply(k,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),V.push([Ke,1-ee]),k.push(Ke,1-ee)}if(K>0)for(var At=T.length,It=At-2*(y+1);It+y+2<At;It++)x.push([It,It+1,It+y+1]),C.push(It,It+1,It+y+1),x.push([It+y+1,It+1,It+y+2]),C.push(It+y+1,It+1,It+y+2)}return{cells:x,positions:T,uvs:V,positionsArr:k,indicesArr:C,normalArr:F}}var _i=Q(31437),Gv=_i.create(),I3=_i.create(),zs=_i.create(),nh=_i.create(),vd=_i.create();function O0(e,i,r,n,a){_i.add(e,r,n),_i.normalize(e,e),i=_i.fromValues(-e[1],e[0]);var s=_i.fromValues(-r[1],r[0]);return[a/_i.dot(i,s),i]}function ih(e,i){return _i.set(e,-i[1],i[0])}function md(e,i,r){return _i.sub(e,i,r),_i.normalize(e,e),e}function R0(e,i){return e[0]===i[0]&&e[1]===i[1]}function O3(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Dg=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ft.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",_i.fromValues(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Mt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var y,x,C,T=r[v-1];T.push((y=n[v-1][2])!==null&&y!==void 0?y:0);var k=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var V=n[v],K=v<r.length-1?[].concat((0,Ce.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,ee=v<n.length-1?n[v+1]:null,be=this.segment_gaode2(a,p,T,F,K,k,V,ee);p+=be}if(this.dash)for(var je=0;je<a.positions.length/6;je++)a.positions[je*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var y,x,C,T=r[v-1];T.push((y=n[v-1][2])!==null&&y!==void 0?y:0);var k=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var V=n[v],K=v<r.length-1?[].concat((0,Ce.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,ee=v<n.length-1?n[v+1]:null,be=this.simpleSegment(a,p,T,F,K,k,V,ee);p+=be}if(this.dash)for(var je=0;je<a.positions.length/6;je++)a.positions[je*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],y=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,v,y,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],y=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,v,y,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,v,y,x){var C=0,T=r.indices,k=r.positions,F=r.normals,V=this.cap==="square",K=this.join==="bevel",ee=ns([y[0],y[1]]),be=ns([v[0],v[1]]);md(zs,s,a);var je=0;if(this.dash&&(je=this.lineSegmentDistance(ee,be),this.totalDistance+=je),this.normal||(this.normal=_i.create(),ih(this.normal,zs)),!this.started)if(this.started=!0,V){var Ke=_i.create(),et=_i.create();_i.add(Ke,this.normal,zs),_i.add(et,this.normal,zs),F.push(et[0],et[1],0),F.push(Ke[0],Ke[1],0),k.push(a[0],a[1],a[2]|0,this.totalDistance-je,-this.thickness,a[2]|0),k.push(a[0],a[1],a[2]|0,this.totalDistance-je,this.thickness,a[2]|0)}else this.extrusions(k,F,a,this.normal,this.thickness,this.totalDistance-je);if(T.push(n+0,n+1,n+2),p){R0(s,p)&&_i.add(p,s,_i.normalize(p,_i.subtract(p,s,a))),md(nh,p,s);var Kt=O0(vd,_i.create(),zs,nh,this.thickness),hr=(0,yn.Z)(Kt,2),zr=hr[0],rn=hr[1],_r=_i.dot(vd,this.normal)<0?-1:1,Sn=K;if(!Sn&&this.join==="miter"){var kn=zr;kn>this.miterLimit&&(Sn=!0)}Sn?(F.push(this.normal[0],this.normal[1],0),F.push(rn[0],rn[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*_r,s[2]|0),T.push.apply(T,(0,Ce.Z)(this.lastFlip!==-_r?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),ih(Gv,nh),_i.copy(this.normal,Gv),F.push(this.normal[0],this.normal[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),C+=3):(this.extrusions(k,F,s,rn,zr,this.totalDistance),T.push.apply(T,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_r=-1,_i.copy(this.normal,rn),C+=2),this.lastFlip=_r}else{if(ih(this.normal,zs),V){var At=_i.create(),It=_i.create();_i.sub(It,zs,this.normal),_i.add(At,zs,this.normal),F.push(It[0],It[1],0),F.push(At[0],At[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(k,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var v=0,y=r.indices,x=r.positions,C=r.normals,T=ns([s[0],s[1]]),k=ns([a[0],a[1]]);md(zs,T,k);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,k),this.totalDistance+=F),this.normal||(this.normal=_i.create(),ih(this.normal,zs)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-F)),y.push(n+0,n+1,n+2),!p)ih(this.normal,zs),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),y.push.apply(y,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var V=ns([p[0],p[1]]);R0(T,V)&&_i.add(V,T,_i.normalize(V,_i.subtract(V,T,k))),md(nh,V,T);var K=O0(vd,_i.create(),zs,nh,this.thickness),ee=(0,yn.Z)(K,2),be=ee[0],je=ee[1],Ke=_i.dot(vd,this.normal)<0?-1:1;this.extrusions(x,C,s,je,be,this.totalDistance),y.push.apply(y,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ke=-1,_i.copy(this.normal,je),v+=2,this.lastFlip=Ke}return v}},{key:"segment",value:function(r,n,a,s,p){var v=0,y=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",k=this.join==="bevel",F=ns([s[0],s[1]]),V=ns([a[0],a[1]]);md(zs,F,V);var K=0;if(this.dash&&(K=this.lineSegmentDistance(F,V),this.totalDistance+=K),this.normal||(this.normal=_i.create(),ih(this.normal,zs)),!this.started)if(this.started=!0,T){var ee=_i.create(),be=_i.create();_i.add(ee,this.normal,zs),_i.add(be,this.normal,zs),C.push(be[0],be[1],0),C.push(ee[0],ee[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-K,-this.thickness,a[2]|0),x.push(a[0],a[1],a[2]|0,this.totalDistance-K,this.thickness,a[2]|0)}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-K);if(y.push(n+0,n+1,n+2),p){var et=ns([p[0],p[1]]);R0(F,et)&&_i.add(et,F,_i.normalize(et,_i.subtract(et,F,V))),md(nh,et,F);var At=O0(vd,_i.create(),zs,nh,this.thickness),It=(0,yn.Z)(At,2),Kt=It[0],hr=It[1],zr=_i.dot(vd,this.normal)<0?-1:1,rn=k;if(!rn&&this.join==="miter"){var _r=Kt;_r>this.miterLimit&&(rn=!0)}rn?(C.push(this.normal[0],this.normal[1],0),C.push(hr[0],hr[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*zr,s[2]|0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*zr,s[2]|0),y.push.apply(y,(0,Ce.Z)(this.lastFlip!==-zr?[n,n+2,n+3]:[n+2,n+1,n+3])),y.push(n+2,n+3,n+4),ih(Gv,nh),_i.copy(this.normal,Gv),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*zr,s[2]|0),v+=3):(this.extrusions(x,C,s,hr,Kt,this.totalDistance),y.push.apply(y,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),zr=-1,_i.copy(this.normal,hr),v+=2),this.lastFlip=zr}else{if(ih(this.normal,zs),T){var je=_i.create(),Ke=_i.create();_i.sub(Ke,zs,this.normal),_i.add(je,zs,this.normal),C.push(Ke[0],Ke[1],0),C.push(je[0],je[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);y.push.apply(y,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,p,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-p,a[2]|0),r.push(a[0],a[1],a[2]|0,v,p,a[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function kh(e){if(ga()(e[0]))return e;if(ga()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ga()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function W2(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,v=0,y=0;y<e.length;y+=2){var x=e[y],C=e[y+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,v++)}return{center:[s/v,p/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ga=Q(77160);function X2(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=zf().flatten(e),s=a.vertices,p=a.dimensions,v=[],y=[],x=0;x<s.length/p;x++)p===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=zf()(a.vertices,a.holes,a.dimensions);y.push.apply(y,(0,Ce.Z)(C));for(var T=function(V){var K=a.vertices.slice(V*p,(V+1)*p),ee=a.vertices.slice((V+1)*p,(V+2)*p);ee.length===0&&(ee=a.vertices.slice(0,p));var be=v.length/3;v.push(K[0],K[1],1,ee[0],ee[1],1,K[0],K[1],0,ee[0],ee[1],0),y.push.apply(y,(0,Ce.Z)([0,2,1,2,3,1].map(function(je){return je+be})))},k=0;k<n;k++)T(k);return{positions:v,index:y}}function Y2(e){var i=zf().flatten(e),r=zf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Fg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=zf().flatten(e),p=s.vertices,v=s.dimensions,y=[],x=[],C=[],T=0;T<p.length/v;T++)v===2?y.push(p[T*2],p[T*2+1],1,-1,-1):y.push(p[T*3],p[T*3+1],1,-1,-1),C.push(0,0,1);var k=zf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Ce.Z)(k));for(var F=function(ee){var be=s.vertices.slice(ee*v,(ee+1)*v),je=s.vertices.slice((ee+1)*v,(ee+2)*v);je.length===0&&(je=s.vertices.slice(0,v));var Ke=y.length/5;y.push(be[0],be[1],1,0,0,je[0],je[1],1,.1,0,be[0],be[1],0,0,.8,je[0],je[1],0,.1,.8);var et=q2([je[0],je[1],1],[be[0],be[1],0],[be[0],be[1],1],i);C.push.apply(C,(0,Ce.Z)(et).concat((0,Ce.Z)(et),(0,Ce.Z)(et),(0,Ce.Z)(et))),x.push.apply(x,(0,Ce.Z)([1,2,0,3,2,1].map(function(At){return At+Ke})))},V=0;V<a;V++)F(V);return{positions:y,index:x,normals:C}}function q2(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ga.create(),s=Ga.create(),p=Ga.create();n&&(e=Si(e),i=Si(i),r=Si(r));var v=Ga.fromValues.apply(Ga,(0,Ce.Z)(e)),y=Ga.fromValues.apply(Ga,(0,Ce.Z)(i)),x=Ga.fromValues.apply(Ga,(0,Ce.Z)(r));Ga.sub(a,x,y),Ga.sub(s,v,y),Ga.cross(p,a,s);var C=Ga.create();return Ga.normalize(C,p),C}var Ac,Lh;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Lh||(Lh={}));var Dh;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Dh||(Dh={}));function Jd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var v=Math.sin(p+Math.PI/4),y=Math.cos(p+Math.PI/4);return[v,y,0]});return s}function Bg(){return Jd(30)}function Ng(){return Jd(4)}function zg(){return Jd(3)}function Ug(){return Jd(6,1)}function Zg(){return Jd(5)}var gd=(Ac={},(0,A.Z)(Ac,Dh.CIRCLE,Bg),(0,A.Z)(Ac,Dh.HEXAGON,Ug),(0,A.Z)(Ac,Dh.TRIANGLE,zg),(0,A.Z)(Ac,Dh.SQUARE,Ng),(0,A.Z)(Ac,Dh.PENTAGON,Zg),(0,A.Z)(Ac,Lh.CYLINDER,Bg),(0,A.Z)(Ac,Lh.HEXAGONCOLUMN,Ug),(0,A.Z)(Ac,Lh.TRIANGLECOLUMN,zg),(0,A.Z)(Ac,Lh.SQUARECOLUMN,Ng),(0,A.Z)(Ac,Lh.PENTAGONCOLUMN,Zg),Ac),Hv={};function yd(e){var i=kh(e.coordinates);return{vertices:[].concat((0,Ce.Z)(i),(0,Ce.Z)(i),(0,Ce.Z)(i),(0,Ce.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function K2(e){var i=kh(e.coordinates),r=Lg(i);return{vertices:[].concat((0,Ce.Z)(r),(0,Ce.Z)(r),(0,Ce.Z)(r),(0,Ce.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function jg(e){var i=e.shape,r=tE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Vg(e){var i=kh(e.coordinates);return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}function Gg(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Dg({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var y=s[v],x=p[v];a.extrude_gaode2(y,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(k){a.extrude(k)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function $2(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Dg({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var y=s[v],x=p[v];a.simpleExtrude_gaode2(y,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(k){a.simpleExtrude(k)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function k0(e){var i=e.coordinates,r=zf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:zf()(n,s,a),vertices:n,size:a}}function Q2(e){var i=e.coordinates,r=zf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:zf()(n,s,a),vertices:J2(n),size:a+4}}function J2(e){for(var i=[],r=W2(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],v=e[s+1];i.push.apply(i,[p,v,0].concat((0,Ce.Z)(n),[a]))}return i}function Hg(e){var i=e.coordinates,r=Fg(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Wg(e){var i=e.shape,r=nE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function Xg(e){var i=e.coordinates,r=[].concat((0,Ce.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Ce.Z)(i[1]),[0,1,0],(0,Ce.Z)(i[0]),[0,0,1],(0,Ce.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Wv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Ce.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)p(v);return{vertices:a,indices:s,size:7}}function eE(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Xv(-1,1),a=Xv(1,1),s=Xv(-1,-1),p=Xv(1,-1),v=[].concat((0,Ce.Z)(i),(0,Ce.Z)(n),(0,Ce.Z)(i),(0,Ce.Z)(s),(0,Ce.Z)(i),(0,Ce.Z)(p),(0,Ce.Z)(i),(0,Ce.Z)(a)),y=[0,1,2,3,0,2];return{vertices:v,indices:y,size:5}}function tE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Hv&&Hv[e])return Hv[e];var r=gd[e]?gd[e]():gd.cylinder(),n=Fg([r],i);return Hv[e]=n,n}function R3(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,v,y=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,k=i.length;T<k;T+=3){s=i[T+0]*3,p=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],V=[e[p],e[p+1]],K=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),V=lngLatToMeters(V),K=lngLatToMeters(K));var ee=F,be=_slicedToArray(ee,2),je=be[0],Ke=be[1],et=vec3.fromValues(je,Ke,e[s+2]),At=V,It=_slicedToArray(At,2),Kt=It[0],hr=It[1],zr=vec3.fromValues(Kt,hr,e[p+2]),rn=K,_r=_slicedToArray(rn,2),Sn=_r[0],kn=_r[1],ui=vec3.fromValues(Sn,kn,e[v+2]);vec3.sub(y,ui,zr),vec3.sub(x,et,zr),vec3.cross(C,y,x),a[s]+=y[0],a[s+1]+=y[1],a[s+2]+=y[2],a[p]+=y[0],a[p+1]+=y[1],a[p+2]+=y[2],a[v]+=y[0],a[v+1]+=y[1],a[v+2]+=y[2]}return rE(a),a}function rE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function k3(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function nE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=gd[e]?gd[e]():gd.circle(),n=i.indexOf(e)===-1?Y2([r]):X2([r]);return n}function Xv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function L3(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function D3(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function iE(e){var i=aE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function aE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,uE=function(e){(0,Rr.Z)(r,e);var i=iE(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"cityCenter",void 0),(0,A.Z)((0,le.Z)(n),"cityMinSize",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.baseColor,y=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,k=T===void 0?"rgb(30,60,89)":T,F=a.time,V=F===void 0?0:F,K=a.sweep,ee=K===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:K;return{u_cityCenter:ee.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ee.sweepRadius,u_circleSweep:ee.enable?1:0,u_circleSweepColor:Gi(ee.sweepColor).slice(0,3),u_circleSweepSpeed:ee.sweepSpeed,u_opacity:p,u_baseColor:Gi(y),u_brightColor:Gi(C),u_windowColor:Gi(k),u_time:this.layer.getLayerAnimateTime()||V}}},{key:"calCityGeo",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],y=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(y+p)/2]);var x=this.mapService.lngLatToCoord([v,y]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,k=y-p;this.cityCenter=[(v+s)/2,(y+p)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(k,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:sE,fragmentShader:oE,triangulation:Hg,cull:{enable:!0,face:O.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,v,y,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){var x=s.size;return[v[3],v[4]]}}})}}]),r}(ko);function lE(e){var i=cE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function cE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fE=function(e){(0,Rr.Z)(r,e);var i=lE(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","PolygonLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new uE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Rh);function pE(e){var i=hE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function hE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,vE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,mE=function(e){(0,Rr.Z)(r,e);var i=pE(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:dE,fragmentShader:vE,triangulation:Wg,depth:{enable:!1},primitive:O.TRIANGLES,blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(ko);function gE(e){var i=yE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function yE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _E=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,xE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,bE=function(e){(0,Rr.Z)(r,e);var i=gE(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:_E,fragmentShader:xE,triangulation:jg,depth:{enable:!0},blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,v,y,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(ko);function EE(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,v=e/2,y=i/2,x=0;x<p;x++)for(var C=x-y,T=0;T<s;T++){var k=T-v;n.push(k/v,-C/y,0),a.push(T/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var V=0;V<e;V++){var K=V+s*F,ee=V+s*(F+1),be=V+1+s*(F+1),je=V+1+s*F;r.push(K,ee,je),r.push(ee,be,je)}return{vertices:n,indices:r,uvs:a}}var Yg,qg;function Kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SE(e){var i=CE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function CE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,wE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,TE=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,ME=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,PE=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,IE=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Qg=(Yg=(0,Lr.b2)(),Yg(qg=function(e){(0,Rr.Z)(r,e);var i=SE(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"colorTexture",void 0),(0,A.Z)((0,le.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,le.Z)(n),"intensityModel",void 0),(0,A.Z)((0,le.Z)(n),"colorModel",void 0),(0,A.Z)((0,le.Z)(n),"shapeType",void 0),n}return(0,Mt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,v=s.clear,y=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),k=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=k,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=k==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=y(),V=F.width,K=F.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(V/4),height:Math.floor(K/4),wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.LINEAR,mag:O.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Fn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:IE,fragmentShader:PE,triangulation:eE,depth:{enable:!1},cull:{enable:!0,face:du(this.mapService.version)},blend:{enable:!0,func:{srcRGB:O.ONE,srcAlpha:1,dstRGB:O.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:ME,fs:TE});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,k=x.uniforms,F=this.rendererService,V=F.createAttribute,K=F.createElements,ee=F.createBuffer,be=F.createModel;return be({vs:C,fs:T,attributes:{a_Position:V({buffer:ee({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:O.FLOAT}),size:3}),a_Uv:V({buffer:ee({data:[0,1,1,1,0,0,1,0],type:O.FLOAT}),size:2})},uniforms:$g({},k),depth:{enable:!1},blend:this.getBlend(),count:6,elements:K({data:[0,2,1,2,3,1],type:O.UNSIGNED_INT,count:6}),stencil:ja(p,y)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,v=p===void 0?10:p,y=a.radius,x=y===void 0?5:y;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=El();zp(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ce.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,k=C.height,F=EE(T/4,k/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:wE,fs:AE});var V=this.shaderModuleService.getModule("heatmap3dColor"),K=V.vs,ee=V.fs,be=V.uniforms,je=this.rendererService,Ke=je.createAttribute,et=je.createElements,At=je.createBuffer,It=je.createModel;return It({vs:K,fs:ee,attributes:{a_Position:Ke({buffer:At({data:F.vertices,type:O.FLOAT}),size:3}),a_Uv:Ke({buffer:At({data:F.uvs,type:O.FLOAT}),size:2})},primitive:O.TRIANGLES,uniforms:$g({},be),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:O.SRC_ALPHA,srcAlpha:1,dstRGB:O.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:et({data:F.indices,type:O.UNSIGNED_INT,count:F.indices.length}),stencil:ja(p,y)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,v=Xs(p);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.NEAREST,mag:O.NEAREST,flipY:!1})}}]),r}(ko))||qg);function OE(e){var i=RE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function RE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,LE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,DE=function(e){(0,Rr.Z)(r,e);var i=OE(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:LE,fragmentShader:kE,triangulation:Wg,depth:{enable:!1},primitive:O.TRIANGLES,blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(ko),FE={heatmap:Qg,heatmap3d:Qg,grid:mE,grid3d:bE,hexagon:DE},BE=FE;function NE(e){var i=zE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function zE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UE=function(e){(0,Rr.Z)(r,e);var i=NE(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","HeatMapLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new BE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),v=p.shape3d,y=this.getSource(),x=y.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(Rh);function ZE(e){var i=jE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VE=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,GE=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,HE=function(e){(0,Rr.Z)(r,e);var i=ZE(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,v=p===void 0?!1:p,y=s.maskInside,x=y===void 0?!0:y,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),Yi){var k=this.layerService.sceneService.getSceneConfig().canvas,F=k.createImage();F.crossOrigin="anonymous",F.src=C.data.originData,F.onload=function(){a.texture=T({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(V){a.texture=T({data:V[0],width:V[0].width,height:V[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:GE,fragmentShader:VE,triangulation:Xg,primitive:O.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ja(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){return[v[3],v[4]]}}})}}]),r}(ko),WE={image:HE},XE=WE;function YE(e){var i=qE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=function(e){(0,Rr.Z)(r,e);var i=YE(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","ImageLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new XE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(Rh);function $E(e){var i=QE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,eS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,tS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,rS=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,nS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,iS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,aS={solid:0,dash:1},oS=function(e){(0,Rr.Z)(r,e);var i=$E(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.textureBlend,x=y===void 0?"normal":y,C=a.lineType,T=C===void 0?"solid":C,k=a.dashArray,F=k===void 0?[10,5]:k,V=a.forward,K=V===void 0?!0:V,ee=a.lineTexture,be=ee===void 0?!1:ee,je=a.iconStep,Ke=je===void 0?100:je,et=a.segmentNumber,At=et===void 0?30:et,It=a.thetaOffset,Kt=It===void 0?.314:It;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Kt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Kt});var hr=this.layer.getEncodedData(),zr=this.calDataFrame(this.cellLength,hr,this.cellProperties),rn=zr.data,_r=zr.width,Sn=zr.height;this.rowCount=Sn,this.dataTexture=this.cellLength>0&&rn.length>0?this.createTexture2D({flipY:!0,data:rn,format:O.LUMINANCE,type:O.FLOAT,width:_r,height:Sn}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var kn=0,ui=[0,0,0,0],so=[0,0,0,0];return p&&v&&(ui=Gi(p),so=Gi(v),kn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ga()(Kt)?Kt:0,u_opacity:ga()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:At,u_line_type:aS[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:K?1:-1,u_texture:this.texture,u_line_texture:be?1:0,u_icon_step:Ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kn,u_sourceColor:ui,u_targetColor:so}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:JE,vert:eS,type:"dash"}:s&&p?{frag:nS,vert:iS,type:"linear"}:{frag:tS,vert:rS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,y=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),k=T.frag,F=T.vert,V=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+V,vertexShader:F,fragmentShader:k,triangulation:Wv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:ja(y,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(p,v,y,x){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.iconService.getIconMap(),T=p.texture,k=C[T]||{x:0,y:0},F=k.x,V=k.y;return[F,V]}}})}}]),r}(ko);function sS(e){var i=uS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function uS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,fS=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,pS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,hS={solid:0,dash:1},dS=function(e){(0,Rr.Z)(r,e);var i=sS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.textureBlend,x=y===void 0?"normal":y,C=a.lineType,T=C===void 0?"solid":C,k=a.dashArray,F=k===void 0?[10,5]:k,V=a.lineTexture,K=V===void 0?!1:V,ee=a.iconStep,be=ee===void 0?100:ee,je=a.segmentNumber,Ke=je===void 0?30:je,et=a.globalArcHeight,At=et===void 0?10:et;F.length===2&&F.push(0,0);var It=0,Kt=[0,0,0,0],hr=[0,0,0,0];if(p&&v&&(Kt=Gi(p),hr=Gi(v),It=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var zr=this.layer.getEncodedData(),rn=this.calDataFrame(this.cellLength,zr,this.cellProperties),_r=rn.data,Sn=rn.width,kn=rn.height;this.rowCount=kn,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:O.LUMINANCE,type:O.FLOAT,width:Sn,height:kn}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Rg,u_global_height:At,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ke,u_line_type:hS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:It,u_sourceColor:Kt,u_targetColor:hr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return s&&p?{frag:fS,vert:pS,type:"linear"}:{frag:lS,vert:cS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,y=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),k=T.frag,F=T.vert,V=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+V,vertexShader:F,fragmentShader:k,triangulation:Wv,blend:this.getBlend(),segmentNumber:p,stencil:ja(y,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(p,v,y,x){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.iconService.getIconMap(),T=p.texture,k=C[T]||{x:0,y:0},F=k.x,V=k.y;return[F,V]}}})}}]),r}(ko);function vS(e){var i=mS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function mS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,yS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,_S=function(e){(0,Rr.Z)(r,e);var i=vS(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.forward,x=y===void 0?!0:y,C=a.segmentNumber,T=C===void 0?30:C,k=a.thetaOffset,F=k===void 0?.314:k,V=0,K=[0,0,0,0],ee=[0,0,0,0];return p&&v&&(K=Gi(p),ee=Gi(v),V=1),{u_thetaOffset:F,u_opacity:ga()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:V,u_sourceColor:K,u_targetColor:ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:yS,fragmentShader:gS,triangulation:Wv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(s,p,v,y){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(ko);function xS(e){var i=bS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function bS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ES=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,SS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,CS={solid:0,dash:1},AS=function(e){(0,Rr.Z)(r,e);var i=xS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.textureBlend,x=y===void 0?"normal":y,C=a.lineType,T=C===void 0?"solid":C,k=a.dashArray,F=k===void 0?[10,5]:k,V=a.lineTexture,K=V===void 0?!1:V,ee=a.iconStep,be=ee===void 0?100:ee,je=a.segmentNumber,Ke=je===void 0?30:je;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var et=0,At=[0,0,0,0],It=[0,0,0,0];if(p&&v&&(At=Gi(p),It=Gi(v),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Kt=this.layer.getEncodedData(),hr=this.calDataFrame(this.cellLength,Kt,this.cellProperties),zr=hr.data,rn=hr.width,_r=hr.height;this.rowCount=_r,this.dataTexture=this.cellLength>0&&zr.length>0?this.createTexture2D({flipY:!0,data:zr,format:O.LUMINANCE,type:O.FLOAT,width:rn,height:_r}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ke,u_line_type:CS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:At,u_targetColor:It}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:SS,fragmentShader:ES,triangulation:Wv,depth:{enable:!1},blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(p,v,y,x){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.iconService.getIconMap(),T=p.texture,k=C[T]||{x:0,y:0},F=k.x,V=k.y;return[F,V]}}})}}]),r}(ko);function wS(e){var i=TS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function TS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MS=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,IS=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Jg=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,OS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,RS={solid:0,dash:1},ey=function(e){(0,Rr.Z)(r,e);var i=wS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.textureBlend,x=y===void 0?"normal":y,C=a.lineType,T=C===void 0?"solid":C,k=a.dashArray,F=k===void 0?[10,5,0,0]:k,V=a.lineTexture,K=V===void 0?!1:V,ee=a.iconStep,be=ee===void 0?100:ee,je=a.vertexHeightScale,Ke=je===void 0?20:je,et=a.borderWidth,At=et===void 0?0:et,It=a.borderColor,Kt=It===void 0?"#ccc":It,hr=a.raisingHeight,zr=hr===void 0?0:hr,rn=a.heightfixed,_r=rn===void 0?!1:rn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Sn=0,kn=[0,0,0,0],ui=[0,0,0,0];if(p&&v&&(kn=Gi(p),ui=Gi(v),Sn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var so=this.layer.getEncodedData(),_o=this.calDataFrame(this.cellLength,so,this.cellProperties),Us=_o.data,bu=_o.width,Qs=_o.height;this.rowCount=Qs,this.dataTexture=this.cellLength>0&&Us.length>0?this.createTexture2D({flipY:!0,data:Us,format:O.LUMINANCE,type:O.FLOAT,width:bu,height:Qs}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:RS[T],u_dash_array:F,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:At,u_borderColor:Gi(Kt),u_linearColor:Sn,u_sourceColor:kn,u_targetColor:ui,u_heightfixed:Number(_r),u_vertexScale:Ke,u_raisingHeight:Number(zr)}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),k=T.frag,F=T.vert,V=T.type;return[this.layer.buildLayerModel({moduleName:"line_"+V,vertexShader:F,fragmentShader:k,triangulation:Gg,primitive:O.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:ja(p,y)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:MS,vert:PS,type:"dash"}:s&&p?{frag:OS,vert:Jg,type:"linear"}:{frag:IS,vert:Jg,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){return[y[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){return[y[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,v,y,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){return[y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.iconService.getIconMap(),T=p.texture,k=C[T]||{x:0,y:0},F=k.x,V=k.y;return[F,V]}}})}}]),r}(ko);function kS(e){var i=LS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DS=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,FS=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,ty=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,BS=function(e){(0,Rr.Z)(r,e);var i=kS(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.vertexHeightScale,x=y===void 0?20:y,C=0,T=[0,0,0,0],k=[0,0,0,0];if(p&&v&&(T=Gi(p),k=Gi(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,F,this.cellProperties),K=V.data,ee=V.width,be=V.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:O.LUMINANCE,type:O.FLOAT,width:ee,height:be}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(s)?s:1,u_linearColor:C,u_sourceColor:T,u_targetColor:k,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:DS,vert:ty,type:"linear"}:{frag:FS,vert:ty,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,k=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+k,vertexShader:T,fragmentShader:C,triangulation:$2,primitive:O.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:ja(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,v,y,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){return[v[4]]}}})}}]),r}(ko);function NS(e){var i=zS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function zS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,ZS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,jS=function(e){(0,Rr.Z)(r,e);var i=NS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,y=a.textureBlend,x=y===void 0?"normal":y,C=a.heightfixed,T=C===void 0?!1:C,k=a.lineTexture,F=k===void 0?!1:k,V=a.iconStep,K=V===void 0?100:V,ee=a.iconStepCount,be=ee===void 0?1:ee;this.rendererService.getDirty()&&this.texture.bind();var je=0,Ke=[0,0,0,0],et=[0,0,0,0];if(p&&v&&(Ke=Gi(p),et=Gi(v),je=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var At=this.layer.getEncodedData(),It=this.calDataFrame(this.cellLength,At,this.cellProperties),Kt=It.data,hr=It.width,zr=It.height;this.rowCount=zr,this.dataTexture=this.cellLength>0&&Kt.length>0?this.createTexture2D({flipY:!0,data:Kt,format:O.LUMINANCE,type:O.FLOAT,width:hr,height:zr}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:be,u_icon_step:K,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:je,u_sourceColor:Ke,u_targetColor:et}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:ZS,fragmentShader:US,triangulation:Gg,primitive:O.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.lineType,v=p===void 0?"solid":p;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Fn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(x,C,T,k){return[T[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(x,C,T,k){return[T[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(x,C,T,k){var F=x.size,V=F===void 0?1:F;return Array.isArray(V)?[V[0],V[1]]:[V,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(x,C,T,k,F){return F}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(x,C,T,k){return[T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(x,C,T,k){var F=a.iconService.getIconMap(),V=x.texture,K=F[V]||{x:0,y:0},ee=K.x,be=K.y;return[ee,be]}}})}}]),r}(ko),VS={arc:oS,arcmini:_S,arc3d:dS,greatcircle:AS,wall:jS,line:ey,simple:BS},GS=VS;function HS(e){var i=WS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=function(e){(0,Rr.Z)(r,e);var i=HS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","LineLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new GS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(Rh);function YS(e){var i=qS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,$S=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,ry=function(e){(0,Rr.Z)(r,e);var i=YS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"raiseCount",0),(0,A.Z)((0,le.Z)(n),"raiserepeat",0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,y=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,k=T===void 0?!1:T,F=a.heightfixed,V=F===void 0?!1:F,K=a.opacityLinear,ee=K===void 0?{enable:!1,dir:"up"}:K,be=a.lightEnable,je=be===void 0?!0:be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var Ke=this.layer.getEncodedData(),et=this.calDataFrame(this.cellLength,Ke,this.cellProperties),At=et.data,It=et.width,Kt=et.height;this.rowCount=Kt,this.dataTexture=this.cellLength>0&&At.length>0?this.createTexture2D({flipY:!0,data:At,format:O.LUMINANCE,type:O.FLOAT,width:It,height:Kt}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}var hr=0,zr=[0,0,0,0],rn=[0,0,0,0];if(x&&C&&(zr=Gi(x),rn=Gi(C),hr=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var _r=p.speed,Sn=_r===void 0?.01:_r,kn=p.repeat,ui=kn===void 0?!1:kn;this.raiseCount+=Sn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(k),u_heightfixed:Number(V),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(y)?y:1,u_linearColor:hr,u_sourceColor:zr,u_targetColor:rn,u_opacitylinear:Number(ee.enable),u_opacitylinear_dir:ee.dir==="up"?1:0,u_lightEnable:Number(je)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,v=a.animateOption.repeat,y=v===void 0?1:v;return this.raiserepeat=y,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:$S,fragmentShader:KS,triangulation:jg,blend:this.getBlend(),cull:{enable:!0,face:du(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,v,y,x){var C=p.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,v,y,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,v){var y=kh(p.coordinates);return a?Lg([y[0],y[1]]):[y[0],y[1],0]}}})}}]),r}(ko),xu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(xu||(xu={}));function QS(e){var i=JS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ny=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  float r = v_radius / (v_radius + strokeWidth);

  // 'circle'
  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);
 
  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float PI = 3.14159;
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);

  // TODO: \u6839\u636E\u53E0\u52A0\u6C34\u6CE2\u6548\u679C
  gl_FragColor = vec4(v_color.xyz, v_color.a * opacity * intensity);

  if(u_additive > 0.0) {
    gl_FragColor *= gl_FragColor.a;
  } 

  // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6
  if(d < 0.5) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,eC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,L0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,iy=function(e){(0,Rr.Z)(r,e);var i=QS(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"meter2coord",1),(0,A.Z)((0,le.Z)(n),"isMeter",!1),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,y=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,k=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,V=F===void 0?[0,0]:F,K=a.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:y,strokeWidth:C,stroke:k,offsets:V})){this.judgeStyleAttributes({opacity:p,strokeOpacity:y,strokeWidth:C,stroke:k,offsets:V});var ee=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,ee,this.cellProperties),je=be.data,Ke=be.width,et=be.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:O.LUMINANCE,type:O.FLOAT,width:Ke,height:et}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:K==="additive"?1:0,u_globel:this.mapService.version===xu.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(p)?p:1,u_stroke_opacity:ga()(y)?y:1,u_stroke_width:ga()(C)?C:0,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),yd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==xu.L7MAP&&v!==xu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],y=a[3],x=[(s+v)/2,(p+y)/2],C=this.mapService.version;if(C===xu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),k=1,F=k*T.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),K=V.toLngLat();this.meter2coord=x[0]-K.lng;return}var ee=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,y===p?p+.1:y]);this.meter2coord=(ee+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),k=T.frag,F=T.vert,V=T.type,K=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill_"+V,vertexShader:F,fragmentShader:k,triangulation:K?K2:yd,depth:{enable:K},blend:this.getBlend(),stencil:ja(p,y),cull:{enable:!0,face:du(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:ny,vert:L0,type:"wave"};default:return{frag:ny,vert:L0,type:"wave"}}else return{frag:eC,vert:L0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(v,y,x,C){var T;if(s){var k=(0,yn.Z)(x,3),F=k[0],V=k[1],K=k[2],ee=Ga.fromValues(0,0,1),be=Ga.fromValues(F,0,K),je=F>=0?Ga.angle(ee,be):Math.PI*2-Ga.angle(ee,be),Ke=Math.PI*2-Math.asin(V/100),et=El();Up(et,et,je),fp(et,et,Ke);var At=Ga.fromValues(1,1,0);Ga.transformMat4(At,At,et),Ga.normalize(At,At);var It=Ga.fromValues(-1,1,0);Ga.transformMat4(It,It,et),Ga.normalize(It,It);var Kt=Ga.fromValues(-1,-1,0);Ga.transformMat4(Kt,Kt,et),Ga.normalize(Kt,Kt);var hr=Ga.fromValues(1,-1,0);Ga.transformMat4(hr,hr,et),Ga.normalize(hr,hr),T=[].concat((0,Ce.Z)(At),(0,Ce.Z)(It),(0,Ce.Z)(Kt),(0,Ce.Z)(hr))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var zr=C%4*3;return[T[zr],T[zr+1],T[zr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(v,y,x,C){var T=v.size,k=T===void 0?5:T;return Array.isArray(k)?[k[0]*a.meter2coord]:[k*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Fn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(v,y,x,C){var T=v.shape,k=T===void 0?2:T,F=a.layer.getLayerConfig().shape2d,V=F.indexOf(k);return[V]}}})}}]),r}(ko);function tC(e){var i=rC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,iC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,aC=function(e){(0,Rr.Z)(r,e);var i=tC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"meter2coord",1),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"isMeter",!1),(0,A.Z)((0,le.Z)(n),"radian",0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.LINEAR,min:O.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,y=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,k=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,V=F===void 0?[0,0]:F,K=a.blend,ee=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var be=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(be=-1),this.radian=ee!==void 0?be*Math.PI*ee/180:be*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:y,strokeWidth:C,stroke:k,offsets:V})){this.judgeStyleAttributes({opacity:p,strokeOpacity:y,strokeWidth:C,stroke:k,offsets:V});var je=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,je,this.cellProperties),et=Ke.data,At=Ke.width,It=Ke.height;this.rowCount=It,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:O.LUMINANCE,type:O.FLOAT,width:At,height:It}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:K==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ga()(p)?p:1,u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),yd)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==xu.L7MAP&&v!==xu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],y=a[3],x=[(s+v)/2,(p+y)/2],C=this.mapService.version;if(C===xu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),k=1,F=k*T.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),K=V.toLngLat();this.meter2coord=x[0]-K.lng;return}var ee=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,y===p?p+.1:y]);this.meter2coord=(ee+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,k=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+k,vertexShader:T,fragmentShader:C,triangulation:yd,depth:{enable:!1},blend:this.getBlend(),stencil:ja(p,y),cull:{enable:!0,face:du(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:nC,vert:iC,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Fn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.iconService.getIconMap(),T=p.shape,k=C[T]||{x:0,y:0},F=k.x,V=k.y;return[F,V]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,v,y,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(ko);function oC(e){var i=sC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function sC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,lC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,cC=function(e){(0,Rr.Z)(r,e);var i=oC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:lC,fragmentShader:uC,triangulation:Vg,primitive:O.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.fontService.mapping,T=p.shape,k=a.fontService.getGlyph(T),F=C[k],V=F.x,K=F.y;return[V,K]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:O.LINEAR,min:O.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,v=p===void 0?"normal":p,y=s.fontFamily,x=y===void 0?"sans-serif":y,C=this.layer.getEncodedData(),T=[];C.forEach(function(k){var F=k.shape,V=F===void 0?"":F;V=V.toString();var K=a.fontService.getGlyph(V);T.indexOf(K)===-1&&T.push(K)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(ko);function fC(e){var i=pC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function pC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,dC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,ay=function(e){(0,Rr.Z)(r,e);var i=fC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:O.LINEAR,min:O.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var y=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,y,this.cellProperties),C=x.data,T=x.width,k=x.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:O.LUMINANCE,type:O.FLOAT,width:T,height:k}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ga()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:dC,fragmentShader:hC,triangulation:Vg,primitive:O.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,v,y,x){var C=a.iconService.getIconMap(),T=p.shape,k=C[T]||{x:0,y:0},F=k.x,V=k.y;return[F,V]}}})}}]),r}(ko);function vC(e){var i=mC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function _C(e){var i=e.coordinates;return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}var oy=function(e){(0,Rr.Z)(r,e);var i=vC(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,y=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:y})){this.judgeStyleAttributes({opacity:p,offsets:y});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,k=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:O.LUMINANCE,type:O.FLOAT,width:k,height:F}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(p)?p:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:yC,fragmentShader:gC,triangulation:_C,depth:{enable:!1},primitive:O.POINTS,blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Sc.additive}}}]),r}(ko);function xC(e){var i=bC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EC=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,SC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,CC=function(e){(0,Rr.Z)(r,e);var i=xC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"meter2coord",1),(0,A.Z)((0,le.Z)(n),"isMeter",!1),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,y=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,k=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,V=F===void 0?[0,0]:F,K=a.blend,ee=a.speed,be=ee===void 0?1:ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:y,strokeWidth:C,stroke:k,offsets:V})){this.judgeStyleAttributes({opacity:p,strokeOpacity:y,strokeWidth:C,stroke:k,offsets:V});var je=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,je,this.cellProperties),et=Ke.data,At=Ke.width,It=Ke.height;this.rowCount=It,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:O.LUMINANCE,type:O.FLOAT,width:At,height:It}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:be,u_additive:K==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(p)?p:1,u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),yd)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==xu.L7MAP&&v!==xu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],y=a[3],x=[(s+v)/2,(p+y)/2],C=this.mapService.version;if(C===xu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),k=1,F=k*T.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),K=V.toLngLat();this.meter2coord=x[0]-K.lng;return}var ee=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,y===p?p+.1:y]);this.meter2coord=(ee+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,k=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+k,vertexShader:T,fragmentShader:C,triangulation:yd,depth:{enable:!1},blend:this.getBlend(),stencil:ja(p,y),cull:{enable:!0,face:du(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:EC,vert:SC,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,v,y,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Fn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,v,y,x){var C=p.shape,T=C===void 0?2:C,k=a.layer.getLayerConfig().shape2d,F=k.indexOf(T);return[F]}}})}}]),r}(ko);function AC(e){var i=wC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,MC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function PC(e){var i=e.coordinates;return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}var IC=function(e){(0,Rr.Z)(r,e);var i=AC(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,y=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,k=a.strokeWidth,F=k===void 0?0:k,V=a.stroke,K=V===void 0?"#fff":V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:y})){this.judgeStyleAttributes({opacity:p,offsets:y});var ee=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,ee,this.cellProperties),je=be.data,Ke=be.width,et=be.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:O.LUMINANCE,type:O.FLOAT,width:Ke,height:et}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(p)?p:1,u_offsets:this.isOffsetStatic(y)?y:[0,0],u_stroke_opacity:ga()(T)?T:1,u_stroke_width:ga()(F)?F:0,u_stroke_color:this.getStrokeColor(K)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:MC,fragmentShader:TC,triangulation:PC,depth:{enable:!1},primitive:O.POINTS,blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Sc.additive}}}]),r}(ko);function OC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=RC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function RC(e,i){if(!!e){if(typeof e=="string")return sy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sy(e,i)}}function sy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var kC=function(){function e(i,r,n){(0,ft.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Mt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,v){this.boxCells[p].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,p,v){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var y=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)y.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?y.filter(v):y}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,y,C,v),p?y.length>0:y}},{key:"queryCell",value:function(r,n,a,s,p,v,y,x){var C=y.seenUids,T=this.boxCells[p];if(T!==null){var k=this.bboxes,F=OC(T),V;try{for(F.s();!(V=F.n()).done;){var K=V.value;if(!C.box[K]){C.box[K]=!0;var ee=K*4;if(r<=k[ee+2]&&n<=k[ee+3]&&a>=k[ee+0]&&s>=k[ee+1]&&(!x||x(this.boxKeys[K]))){if(y.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[K],x1:k[ee],y1:k[ee+1],x2:k[ee+2],y2:k[ee+3]})}}}}catch(be){F.e(be)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,v,y,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),k=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),V=C;V<=k;V++)for(var K=T;K<=F;K++){var ee=this.xCellCount*K+V;if(p.call(this,r,n,a,s,ee,v,y,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),LC=kC,DC=function(){function e(i,r){(0,ft.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new LC(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Mt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=Dt(n,a,0,1),p=il(),v=So.apply(Pe,(0,Ce.Z)(r));return fn(p,s,v),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function uy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=FC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function FC(e,i){if(!!e){if(typeof e=="string")return ly(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ly(e,i)}}function ly(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function cy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function fy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var v=i[p].advance*s.scale,y=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=y}}function py(e,i,r,n,a,s,p){var v=(i-r)*a,y=(-n*p+.5)*s,x=uy(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=y}}catch(k){x.e(k)}finally{x.f()}}function BC(e,i,r,n,a,s,p){var v=-8,y=0,x=v,C=0,T=e.positionedGlyphs,k=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(je){if(je.split("").forEach(function(et){var At=i[et],It=0;At&&(T.push({glyph:et,x:y,y:x+It,vertical:!1,scale:1,metrics:At}),y+=At.advance+p)}),T.length!==F){var Ke=y-p;C=Math.max(Ke,C),fy(T,i,F,T.length-1,k)}y=0,x-=n+5});var V=cy(a),K=V.horizontalAlign,ee=V.verticalAlign;py(T,k,K,ee,C,n,r.length);var be=x-v;e.top+=-ee*be,e.bottom=e.top-be,e.left+=-K*C,e.right=e.left+C}function NC(e,i,r,n,a,s,p){var v=-8,y=0,x=v,C=0,T=e.positionedGlyphs,k=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(je){var Ke=i[je],et=0;if(Ke&&(T.push({glyph:je,x:Ke.advance/2,y:x+et,vertical:!1,scale:1,metrics:Ke}),y+=Ke.advance+p),T.length!==F){var At=y-p;C=Math.max(At,C),fy(T,i,F,T.length-1,k)}y=0,x-=n+5});var V=cy(a),K=V.horizontalAlign,ee=V.verticalAlign;py(T,k,K,ee,C,n,r.length);var be=x-v;e.top+=-ee*be,e.bottom=e.top-be,e.left+=-K*C,e.right=e.left+C}function zC(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,y=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:y.length,text:e};return v?NC(C,i,y,r,n,a,s):BC(C,i,y,r,n,a,s),x.length?C:!1}function UC(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=uy(a),v;try{for(p.s();!(v=p.n()).done;){var y=v.value,x=y.metrics,C=4,T=x.advance*y.scale/2,k=r?[y.x+T,y.y]:[0,0],F=r?[0,0]:[y.x+T+i[0],y.y+i[1]],V=(0-C)*y.scale-T+F[0],K=(0-C)*y.scale+F[1],ee=V+x.width*y.scale,be=K+x.height*y.scale,je={x:V,y:K},Ke={x:ee,y:K},et={x:V,y:be},At={x:ee,y:be};s.push({tl:je,tr:Ke,bl:et,br:At,tex:x,glyphOffset:k})}}catch(It){p.e(It)}finally{p.f()}return s}function ZC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function jC(e,i){if(!!e){if(typeof e=="string")return hy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hy(e,i)}}function hy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function VC(e){var i=GC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function gy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,y){n.push.apply(n,(0,Ce.Z)(p).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Ce.Z)(p),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Ce.Z)(p),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Ce.Z)(p),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+y*4,1+y*4,2+y*4,2+y*4,3+y*4,0+y*4)}),{vertices:n,indices:a,size:7}}var yy=function(e){(0,Rr.Z)(r,e);var i=VC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,le.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"currentZoom",-1),(0,A.Z)((0,le.Z)(n),"extent",void 0),(0,A.Z)((0,le.Z)(n),"textureHeight",0),(0,A.Z)((0,le.Z)(n),"textCount",0),(0,A.Z)((0,le.Z)(n),"preTextStyle",{}),(0,A.Z)((0,le.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),y=v.mask,x=y===void 0?!1:y,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:vy,fragmentShader:dy,triangulation:gy.bind((0,le.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:ja(x,T)})]}),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.stroke,y=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,k=T===void 0?"center":T,F=a.textAllowOverlap,V=F===void 0?!1:F,K=a.halo,ee=K===void 0?.5:K,be=a.gamma,je=be===void 0?2:be,Ke=a.raisingHeight,et=Ke===void 0?0:Ke,At=this.fontService,It=At.canvas,Kt=At.mapping;if(Object.keys(Kt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Kt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:V},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:y})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:y});var hr=this.layer.getEncodedData(),zr=this.calDataFrame(this.cellLength,hr,this.cellProperties),rn=zr.data,_r=zr.width,Sn=zr.height;this.rowCount=Sn,this.dataTexture=this.cellLength>0&&rn.length>0?this.createTexture2D({flipY:!0,data:rn,format:O.LUMINANCE,type:O.FLOAT,width:_r,height:Sn}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(et),u_opacity:ga()(p)?p:1,u_stroke_width:ga()(C)?C:0,u_stroke_color:this.getStrokeColor(y),u_sdf_map:this.texture,u_halo_blur:ee,u_gamma_scale:je,u_sdf_map_size:[It.width,It.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,v=a.textAllowOverlap,y=v===void 0?!0:v;return this.preTextStyle={textAnchor:p,textAllowOverlap:y},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,v=this.mapService.getZoom(),y=this.mapService.getBounds(),x=Cn(this.extent,y);return!p&&(Math.abs(this.currentZoom-v)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Fn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Fn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,v,y){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Fn.Attribute,descriptor:{name:"a_tex",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return In(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,y=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var k=T.shape,F=k===void 0?"":k;F=F.toString();var V=ZC(F),K;try{for(V.s();!(K=V.n()).done;){var ee=K.value;C.indexOf(ee)===-1&&C.push(ee)}}catch(be){V.e(be)}finally{V.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:y,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,y=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var k=T.shape,F=k===void 0?"":k;F="".concat(F),C.indexOf(F)===-1&&C.push(F)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:y,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,v=this.layer.getLayerConfig(),y=v.spacing,x=y===void 0?2:y,C=v.textAnchor,T=C===void 0?"center":C,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(F){var V=F.shape,K=V===void 0?"":V,ee=F.id,be=F.size,je=be===void 0?1:be,Ke=F.textOffset,et=Ke===void 0?[0,0]:Ke,At=zC(K.toString(),p,je,T,"left",x,et,a),It=UC(At,et,!1);return F.shaping=At,F.glyphQuads=It,F.centroid=kh(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?kh(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[ee]={shaping:At,glyphQuads:It,centroid:kh(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,v=p===void 0?[4,4]:p,y=s.textAllowOverlap,x=y===void 0?!1:y;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,k=C.height,F=new DC(T,k),V=this.glyphInfo.filter(function(K){var ee=K.shaping,be=K.id,je=be===void 0?0:be,Ke=K.version==="GAODE2.x"?K.originCentroid:K.centroid,et=K.size,At=et/24,It=a.mapService.lngLatToContainer(Ke),Kt=F.placeCollisionBox({x1:ee.left*At-v[0],x2:ee.right*At+v[0],y1:ee.top*At-v[1],y2:ee.bottom*At+v[1],anchorPointX:It.x,anchorPointY:It.y}),hr=Kt.box;return hr&&hr.length?(F.insertCollisionBox(hr,je),!0):!1});V.forEach(function(K){a.glyphInfoMap[K.id]=K})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:O.LINEAR,min:O.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:vy,fragmentShader:dy,triangulation:gy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:ja(p,y)})]}}]),r}(ko),HC={fillImage:aC,fill:iy,radar:CC,image:ay,normal:oy,simplePoint:IC,extrude:ry,text:yy,icon:cC},WC=HC;function XC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=YC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function YC(e,i){if(!!e){if(typeof e=="string")return _y(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _y(e,i)}}function _y(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qC(e){var i=KC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=function(e){(0,Rr.Z)(r,e);var i=qC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","PointLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new WC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,v=this.getLayerConfig(),y=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(y==null?void 0:y.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var T=XC(p),k;try{for(T.s();!(k=T.n()).done;){var F=k.value;if(typeof F=="string"&&C.hasOwnProperty(F))return"image"}}catch(V){T.e(V)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),v=p.shape2d,y=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(k){return k.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(y==null?void 0:y.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Rh);function QC(e){var i=JC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,rA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
// varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    gl_FragColor = mix(u_targetColor, u_sourceColor, sidey);
  } else {
    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }

  // gl_FragColor = v_Color;
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,nA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  // float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  // v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,iA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,aA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,oA=function(e){(0,Rr.Z)(r,e);var i=QC(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.heightfixed,y=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.sourceColor,k=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var F=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,F,this.cellProperties),K=V.data,ee=V.width,be=V.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:O.LUMINANCE,type:O.FLOAT,width:ee,height:be}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}var je=[1,1,1,1],Ke=[1,1,1,1];return T&&k&&(je=Gi(T),Ke=Gi(k)),{u_heightfixed:Number(y),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:ga()(p)?p:1,u_sourceColor:je,u_targetColor:Ke,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,k=x.type;return[this.layer.buildLayerModel({moduleName:k,vertexShader:T,fragmentShader:C,triangulation:Hg,stencil:ja(p,y),cull:{enable:!0,face:O.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:rA,vert:nA,type:"polygonExtrudeTexture"}:s?{frag:iA,vert:aA,type:"polygonExtrude"}:{frag:eA,vert:tA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.mapTexture;if(s){var p=this.layer.getSource().extent,v=(0,yn.Z)(p,4),y=v[0],x=v[1],C=v[2],T=v[3],k=C-y,F=T-x;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Fn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(K,ee,be,je,Ke){var et=be[0],At=be[1];return[(et-y)/k,(At-x)/F,be[4]]}}})}this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(K,ee,be,je,Ke){return Ke}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(K,ee,be,je){var Ke=K.size,et=Ke===void 0?10:Ke;return Array.isArray(et)?[et[0]]:[et]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),p){var y=new Image;y.crossOrigin="",y.src=p,y.onload=function(){a.texture=v({data:y,width:y.width,height:y.height,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.LINEAR,mag:O.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(ko);function sA(e){var i=uA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function uA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,cA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fA=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,pA=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,hA=function(e){(0,Rr.Z)(r,e);var i=sA(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.opacityLinear,y=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,k=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:O.LUMINANCE,type:O.FLOAT,width:k,height:F}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(p)?p:1,u_opacitylinear:Number(y.enable),u_dir:y.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,y=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?fA:pA,fragmentShader:p.enable?cA:lA,triangulation:p.enable?Q2:k0,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:O.BACK},stencil:ja(y,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Fn.Attribute,descriptor:{name:"a_linear",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(y,x,C,T,k){return[C[3],C[4],C[5]]}}})}}]),r}(ko);function dA(e){var i=vA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,gA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,yA=function(e){(0,Rr.Z)(r,e);var i=dA(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture1",void 0),(0,A.Z)((0,le.Z)(n),"texture2",void 0),(0,A.Z)((0,le.Z)(n),"texture3",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.watercolor,y=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var T=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,T,this.cellProperties),F=k.data,V=k.width,K=k.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:O.LUMINANCE,type:O.FLOAT,width:V,height:K}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Gi(y),u_watercolor2:Gi(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ga()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:gA,fragmentShader:mA,triangulation:k0,depth:{enable:!1},stencil:ja(p,y)})]}},{key:"clearModels",value:function(){var a;this.texture1.destroy(),this.texture2.destroy(),this.texture3.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,yn.Z)(a,4),p=s[0],v=s[1],y=s[2],x=s[3],C=y-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Fn.Attribute,descriptor:{name:"a_uv",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(F,V,K,ee,be){var je=(0,yn.Z)(K,2),Ke=je[0],et=je[1];return[(Ke-p)/C,(et-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),v(function(x){a.texture1=y(x[0]),a.texture2=y(x[1]),a.texture3=y(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],k=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];k.map(function(F){var V=new Image;V.crossOrigin="",V.src=F,T.push(V),V.onload=function(){C++,C===3&&x(T)}})}function y(x){return s({data:x,width:x.width,height:x.height,wrapS:O.MIRRORED_REPEAT,wrapT:O.MIRRORED_REPEAT,min:O.LINEAR,mag:O.LINEAR})}}}]),r}(ko);function _A(e){var i=xA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,EA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,SA=function(e){(0,Rr.Z)(r,e);var i=_A(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.speed,y=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,k=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:O.LUMINANCE,type:O.FLOAT,width:k,height:F}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:y,u_opacity:ga()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:EA,fragmentShader:bA,triangulation:k0,depth:{enable:!1},stencil:ja(p,y)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,yn.Z)(a,4),p=s[0],v=s[1],y=s[2],x=s[3],C=y-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Fn.Attribute,descriptor:{name:"a_uv",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(F,V,K,ee,be){var je=(0,yn.Z)(K,2),Ke=je[0],et=je[1];return[(Ke-p)/C,(et-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var y=new Image;y.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),y.src=p):y.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",y.onload=function(){a.texture=v({data:y,width:y.width,height:y.height,wrapS:O.MIRRORED_REPEAT,wrapT:O.MIRRORED_REPEAT,min:O.LINEAR,mag:O.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(ko),CA={fill:hA,line:ey,extrude:oA,text:yy,point_fill:iy,point_image:ay,point_normal:oy,point_extrude:ry,water:SA,ocean:yA},AA=CA;function wA(e){var i=TA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xy=function(e){(0,Rr.Z)(r,e);var i=wA(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","PolygonLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new AA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,v=s.shape3d,y=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":y.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(Rh);function MA(e){var i=PA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function PA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,OA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,by=function(e){(0,Rr.Z)(r,e);var i=MA(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"texture",void 0),(0,A.Z)((0,le.Z)(n),"colorTexture",void 0),n}return(0,Mt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.clampLow,y=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,k=T===void 0?-9999999:T,F=a.domain,V=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:V,u_clampLow:y,u_clampHigh:typeof C!="undefined"?C:y,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,y=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:O.LUMINANCE,type:O.FLOAT});var k=this.layer.getLayerConfig(),F=k.rampColors,V=Xs(F);return this.colorTexture=C({data:V.data,width:V.width,height:V.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:OA,fragmentShader:IA,triangulation:Xg,primitive:O.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ja(p,y)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,v,y){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,v=Xs(p);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(ko),RA={raster:by,raster3d:by},kA=RA;function LA(e){var i=DA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function DA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FA=function(e){(0,Rr.Z)(r,e);var i=LA(r);function r(){var n;(0,ft.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,le.Z)(n),"type","RasterLayer"),n}return(0,Mt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new kA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Rh),Ey,Sy,Cy,Ay,wy,ev,Ty,My,Py;function Iy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function BA(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Iy(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var NA=(Ey=(0,Lr.b2)(),Sy=(0,Lr.f3)(bt.IGlobalConfigService),Cy=(0,Lr.f3)(bt.IMapService),Ay=(0,Lr.f3)(bt.IFontService),Ey(wy=(ev=function(){function e(){(0,ft.Z)(this,e),xn(this,"configService",Ty,this),xn(this,"mapService",My,this),xn(this,"fontService",Py,this)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(k){return k.needRemapping}),T=x;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(T=x.filter(function(k){return a.applyAttributeMapping(y,k,p)[0]})),C.length&&(y!=null&&y.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,p)),y.needRemapping=!1):r.setEncodedData(a.mapping(C,T,r.getEncodedData(),p)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;y!=null&&y.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(y,T,p)[0]})),r.setEncodedData(this.mapping(v,C,void 0,p)),r.emit("dataUpdate",null)}},{key:"mapping",value:function(r,n,a,s){var p=this,v=n.map(function(y,x){var C=a?a[x]:{},T=BA({id:y._id,coordinates:y.coordinates},C);return r.filter(function(k){return k.scale!==void 0}).forEach(function(k){var F=p.applyAttributeMapping(k,y,s);k.needRemapping=!1,k.name==="color"&&(F=F.map(function(V){return Gi(V)})),T[k.name]=Array.isArray(F)&&F.length===1?F[0]:F,k.name==="shape"&&(T.shape=p.fontService.getIconFontKey(T[k.name]))}),T});return this.adjustData2Amap2Coordinates(v),this.adjustData2SimpleCoordinates(v),v}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===xu["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=xu["GAODE2.x"],a.originCoordinates=U()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=xu["GAODE2.x"],a.originCoordinates=U()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===xu.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var v=[];p.map(function(y){v.push(n.mapService.simpleMapCoord.unproject(y))}),a.push(v)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];p.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var y=r.mapping?r.mapping(v):[];return r.name==="color"&&!hu(y[0])?[a]:y}}]),e}(),Ty=Ln(ev.prototype,"configService",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),My=Ln(ev.prototype,"mapService",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=Ln(ev.prototype,"fontService",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev))||wy),Oy,Ry,zA=(Oy=(0,Lr.b2)(),Oy(Ry=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(bt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Md,options:Gh},p=s.data,v=s.options;r.setSource(new ch(p,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,v=p===void 0?0:p,y=s.maxZoom,x=y===void 0?16:y,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||Ry);function D0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function ky(e){return e.length===1&&(e=UA(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function UA(e){return function(i,r){return D0(e(i),r)}}var Ly=ky(D0),ZA=Ly.right,F3=Ly.left,Yv=ZA;function jA(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var Dy=Array.prototype,B3=Dy.slice,N3=Dy.map,F0=Math.sqrt(50),B0=Math.sqrt(10),N0=Math.sqrt(2);function Fy(e,i,r){var n,a=-1,s,p,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=qv(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/v;return n&&p.reverse(),p}function qv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=F0?10:s>=B0?5:s>=N0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=F0?10:s>=B0?5:s>=N0?2:1)}function z0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=F0?a*=10:s>=B0?a*=5:s>=N0&&(a*=2),i<e?-a:a}function z3(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,v,y=new Array(p);for(s=0;s<p;++s)y[s]=e(a[s],s,a);var x=i(y),C=x[0],T=x[1],k=r(y,C,T);Array.isArray(k)||(k=tickStep(C,T,k),k=range(Math.ceil(C/k)*k,T,k));for(var F=k.length;k[0]<=C;)k.shift(),--F;for(;k[F-1]>T;)k.pop(),--F;var V=new Array(F+1),K;for(s=0;s<=F;++s)K=V[s]=[],K.x0=s>0?k[s-1]:C,K.x1=s<F?k[s]:T;for(s=0;s<p;++s)v=y[s],C<=v&&v<=T&&V[bisect(k,v,0,F)].push(a[s]);return V}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function U3(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function VA(e){return e===null?NaN:+e}function GA(e,i,r){if(r==null&&(r=VA),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return p+(v-p)*(a-s)}}var wc="$";function Kv(){}Kv.prototype=By.prototype={constructor:Kv,has:function(e){return wc+e in this},get:function(e){return this[wc+e]},set:function(e,i){return this[wc+e]=i,this},remove:function(e){var i=wc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===wc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===wc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===wc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===wc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===wc&&++e;return e},empty:function(){for(var e in this)if(e[0]===wc)return!1;return!0},each:function(e){for(var i in this)i[0]===wc&&e(this[i],i.slice(1),this)}};function By(e,i){var r=new Kv;if(e instanceof Kv)e.each(function(v,y){r.set(y,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var U0=By;function Z3(){var e=[],i=[],r,n,a;function s(v,y,x,C){if(y>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,k=v.length,F=e[y++],V,K,ee=map(),be,je=x();++T<k;)(be=ee.get(V=F(K=v[T])+""))?be.push(K):ee.set(V,[K]);return ee.each(function(Ke,et){C(je,et,s(Ke,y,x,C))}),je}function p(v,y){if(++y>e.length)return v;var x,C=i[y-1];return n!=null&&y>=e.length?x=v.entries():(x=[],v.each(function(T,k){x.push({key:k,values:p(T,y)})})),C!=null?x.sort(function(T,k){return C(T.key,k.key)}):x}return a={object:function(v){return s(v,0,HA,WA)},map:function(v){return s(v,0,Ny,zy)},entries:function(v){return p(s(v,0,Ny,zy),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function HA(){return{}}function WA(e,i,r){e[i]=r}function Ny(){return map()}function zy(e,i,r){e.set(i,r)}function $v(){}var Fh=U0.prototype;$v.prototype=XA.prototype={constructor:$v,has:Fh.has,add:function(e){return e+="",this[wc+e]=e,this},remove:Fh.remove,clear:Fh.clear,values:Fh.keys,size:Fh.size,empty:Fh.empty,each:Fh.each};function XA(e,i){var r=new $v;if(e instanceof $v)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var j3=null,Uy=Array.prototype,Qv=Uy.map,Bh=Uy.slice;function ah(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function V3(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Zy={name:"implicit"};function Jv(){var e=U0(),i=[],r=[],n=Zy;function a(s){var p=s+"",v=e.get(p);if(!v){if(n!==Zy)return n;e.set(p,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=U0();for(var p=-1,v=s.length,y,x;++p<v;)e.has(x=(y=s[p])+"")||e.set(x,i.push(y));return a},a.range=function(s){return arguments.length?(r=Bh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return Jv(i,r).unknown(n)},ah.apply(a,arguments),a}function jy(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,v=0,y=0,x=.5;delete e.unknown;function C(){var T=i().length,k=n[1]<n[0],F=n[k-0],V=n[1-k];a=(V-F)/Math.max(1,T-v+y*2),p&&(a=Math.floor(a)),F+=(V-F-a*(T-v))*x,s=a*(1-v),p&&(F=Math.round(F),s=Math.round(s));var K=sequence(T).map(function(ee){return F+a*ee});return r(k?K.reverse():K)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(p=!!T,C()):p},e.padding=function(T){return arguments.length?(v=Math.min(1,y=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(y=+T,C()):y},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return jy(i(),n).round(p).paddingInner(v).paddingOuter(y).align(x)},initRange.apply(C(),arguments)}function Vy(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Vy(i())},e}function G3(){return Vy(jy.apply(null,arguments).paddingInner(1))}var YA=Q(26257),qA=Q(73626);function KA(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function $A(e){return function(){return e}}function Z0(e){return+e}var Gy=[0,1];function Tc(e){return e}function j0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:$A(isNaN(i)?NaN:.5)}function Hy(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function QA(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=j0(a,n),s=r(p,s)):(n=j0(n,a),s=r(s,p)),function(v){return s(n(v))}}function JA(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=j0(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(v){var y=Yv(e,v,1,n)-1;return s[y](a[y](v))}}function e0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function V0(){var e=Gy,i=Gy,r=YA.Z,n,a,s,p=Tc,v,y,x;function C(){return v=Math.min(e.length,i.length)>2?JA:QA,y=x=null,T}function T(k){return isNaN(k=+k)?s:(y||(y=v(e.map(n),i,r)))(n(p(k)))}return T.invert=function(k){return p(a((x||(x=v(i,e.map(n),qA.Z)))(k)))},T.domain=function(k){return arguments.length?(e=Qv.call(k,Z0),p===Tc||(p=Hy(e)),C()):e.slice()},T.range=function(k){return arguments.length?(i=Bh.call(k),C()):i.slice()},T.rangeRound=function(k){return i=Bh.call(k),r=KA,C()},T.clamp=function(k){return arguments.length?(p=k?Hy(e):Tc,T):p!==Tc},T.interpolate=function(k){return arguments.length?(r=k,C()):r},T.unknown=function(k){return arguments.length?(s=k,T):s},function(k,F){return n=k,a=F,C()}}function Wy(e,i){return V0()(e,i)}var ew=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function t0(e){if(!(i=ew.exec(e)))throw new Error("invalid format: "+e);var i;return new G0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}t0.prototype=G0.prototype;function G0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}G0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function tw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function r0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function _d(e){return e=r0(Math.abs(e)),e?e[1]:NaN}function rw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_d(i)/3)))*3-_d(Math.abs(e)))}function nw(e,i){return function(r,n){for(var a=r.length,s=[],p=0,v=e[0],y=0;a>0&&v>0&&(y+v+1>n&&(v=Math.max(1,n-y)),s.push(r.substring(a-=v,a+v)),!((y+=v+1)>n));)v=e[p=(p+1)%e.length];return s.reverse().join(i)}}function iw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function aw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var Xy;function ow(e,i){var r=r0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(Xy=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+r0(e,Math.max(0,i+s-1))[0]}function Yy(e,i){var r=r0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var qy={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:tw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return Yy(e*100,i)},r:Yy,s:ow,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ky(e){return e}var $y=Array.prototype.map,Qy=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function sw(e){var i=e.grouping===void 0||e.thousands===void 0?Ky:nw($y.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Ky:iw($y.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",y=e.nan===void 0?"NaN":e.nan+"";function x(T){T=t0(T);var k=T.fill,F=T.align,V=T.sign,K=T.symbol,ee=T.zero,be=T.width,je=T.comma,Ke=T.precision,et=T.trim,At=T.type;At==="n"?(je=!0,At="g"):qy[At]||(Ke===void 0&&(Ke=12),et=!0,At="g"),(ee||k==="0"&&F==="=")&&(ee=!0,k="0",F="=");var It=K==="$"?r:K==="#"&&/[boxX]/.test(At)?"0"+At.toLowerCase():"",Kt=K==="$"?n:/[%p]/.test(At)?p:"",hr=qy[At],zr=/[defgprs%]/.test(At);Ke=Ke===void 0?6:/[gprs]/.test(At)?Math.max(1,Math.min(21,Ke)):Math.max(0,Math.min(20,Ke));function rn(_r){var Sn=It,kn=Kt,ui,so,_o;if(At==="c")kn=hr(_r)+kn,_r="";else{_r=+_r;var Us=_r<0||1/_r<0;if(_r=isNaN(_r)?y:hr(Math.abs(_r),Ke),et&&(_r=aw(_r)),Us&&+_r==0&&V!=="+"&&(Us=!1),Sn=(Us?V==="("?V:v:V==="-"||V==="("?"":V)+Sn,kn=(At==="s"?Qy[8+Xy/3]:"")+kn+(Us&&V==="("?")":""),zr){for(ui=-1,so=_r.length;++ui<so;)if(_o=_r.charCodeAt(ui),48>_o||_o>57){kn=(_o===46?a+_r.slice(ui+1):_r.slice(ui))+kn,_r=_r.slice(0,ui);break}}}je&&!ee&&(_r=i(_r,Infinity));var bu=Sn.length+_r.length+kn.length,Qs=bu<be?new Array(be-bu+1).join(k):"";switch(je&&ee&&(_r=i(Qs+_r,Qs.length?be-kn.length:Infinity),Qs=""),F){case"<":_r=Sn+_r+kn+Qs;break;case"=":_r=Sn+Qs+_r+kn;break;case"^":_r=Qs.slice(0,bu=Qs.length>>1)+Sn+_r+kn+Qs.slice(bu);break;default:_r=Qs+Sn+_r+kn;break}return s(_r)}return rn.toString=function(){return T+""},rn}function C(T,k){var F=x((T=t0(T),T.type="f",T)),V=Math.max(-8,Math.min(8,Math.floor(_d(k)/3)))*3,K=Math.pow(10,-V),ee=Qy[8+V/3];return function(be){return F(K*be)+ee}}return{format:x,formatPrefix:C}}var n0,H0,Jy;uw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function uw(e){return n0=sw(e),H0=n0.format,Jy=n0.formatPrefix,n0}function lw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,_d(i)-_d(e))+1}function cw(e){return Math.max(0,-_d(Math.abs(e)))}function fw(e,i,r,n){var a=z0(e,i,r),s;switch(n=t0(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=rw(a,p))&&(n.precision=s),Jy(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=lw(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=cw(a))&&(n.precision=s-(n.type==="%")*2);break}}return H0(n)}function i0(e){var i=e.domain;return e.ticks=function(r){var n=i();return Fy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return fw(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],v=n[s],y;return v<p&&(y=p,p=v,v=y,y=a,a=s,s=y),y=qv(p,v,r),y>0?(p=Math.floor(p/y)*y,v=Math.ceil(v/y)*y,y=qv(p,v,r)):y<0&&(p=Math.ceil(p*y)/y,v=Math.floor(v*y)/y,y=qv(p,v,r)),y>0?(n[a]=Math.floor(p/y)*y,n[s]=Math.ceil(v/y)*y,i(n)):y<0&&(n[a]=Math.ceil(p*y)/y,n[s]=Math.floor(v*y)/y,i(n)),e},e}function e_(){var e=Wy(Tc,Tc);return e.copy=function(){return e0(e,e_())},ah.apply(e,arguments),i0(e)}function t_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Qv.call(n,Z0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return t_(e).unknown(i)},e=arguments.length?Qv.call(e,Z0):[0,1],i0(r)}function r_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function n_(e){return Math.log(e)}function i_(e){return Math.exp(e)}function pw(e){return-Math.log(-e)}function hw(e){return-Math.exp(-e)}function dw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function vw(e){return e===10?dw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function mw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function a_(e){return function(i){return-e(-i)}}function gw(e){var i=e(n_,i_),r=i.domain,n=10,a,s;function p(){return a=mw(n),s=vw(n),r()[0]<0?(a=a_(a),s=a_(s),e(pw,hw)):e(n_,i_),i}return i.base=function(v){return arguments.length?(n=+v,p()):n},i.domain=function(v){return arguments.length?(r(v),p()):r()},i.ticks=function(v){var y=r(),x=y[0],C=y[y.length-1],T;(T=C<x)&&(k=x,x=C,C=k);var k=a(x),F=a(C),V,K,ee,be=v==null?10:+v,je=[];if(!(n%1)&&F-k<be){if(k=Math.round(k)-1,F=Math.round(F)+1,x>0){for(;k<F;++k)for(K=1,V=s(k);K<n;++K)if(ee=V*K,!(ee<x)){if(ee>C)break;je.push(ee)}}else for(;k<F;++k)for(K=n-1,V=s(k);K>=1;--K)if(ee=V*K,!(ee<x)){if(ee>C)break;je.push(ee)}}else je=Fy(k,F,Math.min(F-k,be)).map(s);return T?je.reverse():je},i.tickFormat=function(v,y){if(y==null&&(y=n===10?".0e":","),typeof y!="function"&&(y=H0(y)),v===Infinity)return y;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?y(C):""}},i.nice=function(){return r(r_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function o_(){var e=gw(V0()).domain([1,10]);return e.copy=function(){return e0(e,o_()).base(e.base())},ah.apply(e,arguments),e}function s_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function u_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function yw(e){var i=1,r=e(s_(i),u_(i));return r.constant=function(n){return arguments.length?e(s_(i=+n),u_(i)):i},linearish(r)}function _w(){var e=yw(transformer());return e.copy=function(){return copy(e,_w()).constant(e.constant())},initRange.apply(e,arguments)}function l_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function xw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function bw(e){return e<0?-e*e:e*e}function Ew(e){var i=e(Tc,Tc),r=1;function n(){return r===1?e(Tc,Tc):r===.5?e(xw,bw):e(l_(r),l_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},i0(i)}function W0(){var e=Ew(V0());return e.copy=function(){return e0(e,W0()).exponent(e.exponent())},ah.apply(e,arguments),e}function H3(){return W0.apply(null,arguments).exponent(.5)}function c_(){var e=[],i=[],r=[],n;function a(){var p=0,v=Math.max(1,i.length);for(r=new Array(v-1);++p<v;)r[p-1]=GA(e,p/v);return s}function s(p){return isNaN(p=+p)?n:i[Yv(r,p)]}return s.invertExtent=function(p){var v=i.indexOf(p);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var v=0,y=p.length,x;v<y;++v)x=p[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(D0),a()},s.range=function(p){return arguments.length?(i=Bh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return c_().domain(e).range(i).unknown(n)},ah.apply(s,arguments)}function f_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(y){return y<=y?a[Yv(n,y,0,r)]:s}function v(){var y=-1;for(n=new Array(r);++y<r;)n[y]=((y+1)*i-(y-r)*e)/(r+1);return p}return p.domain=function(y){return arguments.length?(e=+y[0],i=+y[1],v()):[e,i]},p.range=function(y){return arguments.length?(r=(a=Bh.call(y)).length-1,v()):a.slice()},p.invertExtent=function(y){var x=a.indexOf(y);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(y){return arguments.length&&(s=y),p},p.thresholds=function(){return n.slice()},p.copy=function(){return f_().domain([e,i]).range(a).unknown(s)},ah.apply(i0(p),arguments)}function p_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[Yv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Bh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Bh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return p_().domain(e).range(i).unknown(r)},ah.apply(a,arguments)}var X0=new Date,Y0=new Date;function sl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),v=a.ceil(s);return s-p<v-s?p:v},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,v){var y=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<p)||!(v>0))return y;do y.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<p);return y},a.filter=function(s){return sl(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,v){if(p>=p)if(v<0)for(;++v<=0;)for(;i(p,-1),!s(p););else for(;--v>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return X0.setTime(+s),Y0.setTime(+p),e(X0),e(Y0),Math.floor(r(X0,Y0))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var q0=sl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});q0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var xd=q0,W3=q0.range,h_=sl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Sw=h_,X3=h_.range,a0=1e3,tv=6e4,d_=36e5,v_=864e5,m_=6048e5;function Nh(e){return sl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*tv)/m_})}var K0=Nh(0),o0=Nh(1),Cw=Nh(2),Aw=Nh(3),bd=Nh(4),ww=Nh(5),Tw=Nh(6),Y3=K0.range,q3=o0.range,K3=Cw.range,$3=Aw.range,Q3=bd.range,J3=ww.range,eP=Tw.range,g_=sl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*tv)/v_},function(e){return e.getDate()-1}),$0=g_,tP=g_.range,y_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*a0-e.getMinutes()*tv)},function(e,i){e.setTime(+e+i*d_)},function(e,i){return(i-e)/d_},function(e){return e.getHours()}),Mw=y_,rP=y_.range,__=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*a0)},function(e,i){e.setTime(+e+i*tv)},function(e,i){return(i-e)/tv},function(e){return e.getMinutes()}),Pw=__,nP=__.range,x_=sl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*a0)},function(e,i){return(i-e)/a0},function(e){return e.getUTCSeconds()}),Iw=x_,iP=x_.range,s0=sl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});s0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?sl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):s0};var Ow=s0,aP=s0.range;function zh(e){return sl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/m_})}var b_=zh(0),u0=zh(1),Rw=zh(2),kw=zh(3),Ed=zh(4),Lw=zh(5),Dw=zh(6),oP=b_.range,sP=u0.range,uP=Rw.range,lP=kw.range,cP=Ed.range,fP=Lw.range,pP=Dw.range,E_=sl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/v_},function(e){return e.getUTCDate()-1}),S_=E_,hP=E_.range,Q0=sl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Q0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var rv=Q0,dP=Q0.range;function J0(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function em(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function nv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function Fw(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,v=e.months,y=e.shortMonths,x=iv(a),C=av(a),T=iv(s),k=av(s),F=iv(p),V=av(p),K=iv(v),ee=av(v),be=iv(y),je=av(y),Ke={a:Us,A:bu,b:Qs,B:wd,c:null,d:P_,e:P_,f:aT,g:vT,G:gT,H:rT,I:nT,j:iT,L:I_,m:oT,M:sT,p:t3,q:r3,Q:F_,s:B_,S:uT,u:lT,U:cT,V:fT,w:pT,W:hT,x:null,X:null,y:dT,Y:mT,Z:yT,"%":D_},et={a:n3,A:i3,b:a3,B:o3,c:null,d:R_,e:R_,f:ET,g:RT,G:LT,H:_T,I:xT,j:bT,L:k_,m:ST,M:CT,p:s3,q:u3,Q:F_,s:B_,S:AT,u:wT,U:TT,V:MT,w:PT,W:IT,x:null,X:null,y:OT,Y:kT,Z:DT,"%":D_},At={a:rn,A:_r,b:Sn,B:kn,c:ui,d:T_,e:T_,f:Qw,g:w_,G:A_,H:M_,I:M_,j:Yw,L:$w,m:Xw,M:qw,p:zr,q:Ww,Q:eT,s:tT,S:Kw,u:Zw,U:jw,V:Vw,w:Uw,W:Gw,x:so,X:_o,y:w_,Y:A_,Z:Hw,"%":Jw};Ke.x=It(r,Ke),Ke.X=It(n,Ke),Ke.c=It(i,Ke),et.x=It(r,et),et.X=It(n,et),et.c=It(i,et);function It(ii,Pa){return function(eo){var mn=[],wl=-1,Vo=0,Ql=ii.length,Jl,Zh,Sx;for(eo instanceof Date||(eo=new Date(+eo));++wl<Ql;)ii.charCodeAt(wl)===37&&(mn.push(ii.slice(Vo,wl)),(Zh=C_[Jl=ii.charAt(++wl)])!=null?Jl=ii.charAt(++wl):Zh=Jl==="e"?" ":"0",(Sx=Pa[Jl])&&(Jl=Sx(eo,Zh)),mn.push(Jl),Vo=wl+1);return mn.push(ii.slice(Vo,wl)),mn.join("")}}function Kt(ii,Pa){return function(eo){var mn=nv(1900,void 0,1),wl=hr(mn,ii,eo+="",0),Vo,Ql;if(wl!=eo.length)return null;if("Q"in mn)return new Date(mn.Q);if("s"in mn)return new Date(mn.s*1e3+("L"in mn?mn.L:0));if(Pa&&!("Z"in mn)&&(mn.Z=0),"p"in mn&&(mn.H=mn.H%12+mn.p*12),mn.m===void 0&&(mn.m="q"in mn?mn.q:0),"V"in mn){if(mn.V<1||mn.V>53)return null;"w"in mn||(mn.w=1),"Z"in mn?(Vo=em(nv(mn.y,0,1)),Ql=Vo.getUTCDay(),Vo=Ql>4||Ql===0?u0.ceil(Vo):u0(Vo),Vo=S_.offset(Vo,(mn.V-1)*7),mn.y=Vo.getUTCFullYear(),mn.m=Vo.getUTCMonth(),mn.d=Vo.getUTCDate()+(mn.w+6)%7):(Vo=J0(nv(mn.y,0,1)),Ql=Vo.getDay(),Vo=Ql>4||Ql===0?o0.ceil(Vo):o0(Vo),Vo=$0.offset(Vo,(mn.V-1)*7),mn.y=Vo.getFullYear(),mn.m=Vo.getMonth(),mn.d=Vo.getDate()+(mn.w+6)%7)}else("W"in mn||"U"in mn)&&("w"in mn||(mn.w="u"in mn?mn.u%7:"W"in mn?1:0),Ql="Z"in mn?em(nv(mn.y,0,1)).getUTCDay():J0(nv(mn.y,0,1)).getDay(),mn.m=0,mn.d="W"in mn?(mn.w+6)%7+mn.W*7-(Ql+5)%7:mn.w+mn.U*7-(Ql+6)%7);return"Z"in mn?(mn.H+=mn.Z/100|0,mn.M+=mn.Z%100,em(mn)):J0(mn)}}function hr(ii,Pa,eo,mn){for(var wl=0,Vo=Pa.length,Ql=eo.length,Jl,Zh;wl<Vo;){if(mn>=Ql)return-1;if(Jl=Pa.charCodeAt(wl++),Jl===37){if(Jl=Pa.charAt(wl++),Zh=At[Jl in C_?Pa.charAt(wl++):Jl],!Zh||(mn=Zh(ii,eo,mn))<0)return-1}else if(Jl!=eo.charCodeAt(mn++))return-1}return mn}function zr(ii,Pa,eo){var mn=x.exec(Pa.slice(eo));return mn?(ii.p=C[mn[0].toLowerCase()],eo+mn[0].length):-1}function rn(ii,Pa,eo){var mn=F.exec(Pa.slice(eo));return mn?(ii.w=V[mn[0].toLowerCase()],eo+mn[0].length):-1}function _r(ii,Pa,eo){var mn=T.exec(Pa.slice(eo));return mn?(ii.w=k[mn[0].toLowerCase()],eo+mn[0].length):-1}function Sn(ii,Pa,eo){var mn=be.exec(Pa.slice(eo));return mn?(ii.m=je[mn[0].toLowerCase()],eo+mn[0].length):-1}function kn(ii,Pa,eo){var mn=K.exec(Pa.slice(eo));return mn?(ii.m=ee[mn[0].toLowerCase()],eo+mn[0].length):-1}function ui(ii,Pa,eo){return hr(ii,i,Pa,eo)}function so(ii,Pa,eo){return hr(ii,r,Pa,eo)}function _o(ii,Pa,eo){return hr(ii,n,Pa,eo)}function Us(ii){return p[ii.getDay()]}function bu(ii){return s[ii.getDay()]}function Qs(ii){return y[ii.getMonth()]}function wd(ii){return v[ii.getMonth()]}function t3(ii){return a[+(ii.getHours()>=12)]}function r3(ii){return 1+~~(ii.getMonth()/3)}function n3(ii){return p[ii.getUTCDay()]}function i3(ii){return s[ii.getUTCDay()]}function a3(ii){return y[ii.getUTCMonth()]}function o3(ii){return v[ii.getUTCMonth()]}function s3(ii){return a[+(ii.getUTCHours()>=12)]}function u3(ii){return 1+~~(ii.getUTCMonth()/3)}return{format:function(ii){var Pa=It(ii+="",Ke);return Pa.toString=function(){return ii},Pa},parse:function(ii){var Pa=Kt(ii+="",!1);return Pa.toString=function(){return ii},Pa},utcFormat:function(ii){var Pa=It(ii+="",et);return Pa.toString=function(){return ii},Pa},utcParse:function(ii){var Pa=Kt(ii+="",!0);return Pa.toString=function(){return ii},Pa}}}var C_={"-":"",_:" ","0":"0"},cu=/^\s*\d+/,Bw=/^%/,Nw=/[\\^$*+?|[\]().{}]/g;function Ja(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function zw(e){return e.replace(Nw,"\\$&")}function iv(e){return new RegExp("^(?:"+e.map(zw).join("|")+")","i")}function av(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function Uw(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function Zw(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function jw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Vw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function Gw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function A_(e,i,r){var n=cu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function w_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Hw(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Ww(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function Xw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function T_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Yw(e,i,r){var n=cu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function M_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function qw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function Kw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function $w(e,i,r){var n=cu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Qw(e,i,r){var n=cu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Jw(e,i,r){var n=Bw.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function eT(e,i,r){var n=cu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function tT(e,i,r){var n=cu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function P_(e,i){return Ja(e.getDate(),i,2)}function rT(e,i){return Ja(e.getHours(),i,2)}function nT(e,i){return Ja(e.getHours()%12||12,i,2)}function iT(e,i){return Ja(1+$0.count(xd(e),e),i,3)}function I_(e,i){return Ja(e.getMilliseconds(),i,3)}function aT(e,i){return I_(e,i)+"000"}function oT(e,i){return Ja(e.getMonth()+1,i,2)}function sT(e,i){return Ja(e.getMinutes(),i,2)}function uT(e,i){return Ja(e.getSeconds(),i,2)}function lT(e){var i=e.getDay();return i===0?7:i}function cT(e,i){return Ja(K0.count(xd(e)-1,e),i,2)}function O_(e){var i=e.getDay();return i>=4||i===0?bd(e):bd.ceil(e)}function fT(e,i){return e=O_(e),Ja(bd.count(xd(e),e)+(xd(e).getDay()===4),i,2)}function pT(e){return e.getDay()}function hT(e,i){return Ja(o0.count(xd(e)-1,e),i,2)}function dT(e,i){return Ja(e.getFullYear()%100,i,2)}function vT(e,i){return e=O_(e),Ja(e.getFullYear()%100,i,2)}function mT(e,i){return Ja(e.getFullYear()%1e4,i,4)}function gT(e,i){var r=e.getDay();return e=r>=4||r===0?bd(e):bd.ceil(e),Ja(e.getFullYear()%1e4,i,4)}function yT(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Ja(i/60|0,"0",2)+Ja(i%60,"0",2)}function R_(e,i){return Ja(e.getUTCDate(),i,2)}function _T(e,i){return Ja(e.getUTCHours(),i,2)}function xT(e,i){return Ja(e.getUTCHours()%12||12,i,2)}function bT(e,i){return Ja(1+S_.count(rv(e),e),i,3)}function k_(e,i){return Ja(e.getUTCMilliseconds(),i,3)}function ET(e,i){return k_(e,i)+"000"}function ST(e,i){return Ja(e.getUTCMonth()+1,i,2)}function CT(e,i){return Ja(e.getUTCMinutes(),i,2)}function AT(e,i){return Ja(e.getUTCSeconds(),i,2)}function wT(e){var i=e.getUTCDay();return i===0?7:i}function TT(e,i){return Ja(b_.count(rv(e)-1,e),i,2)}function L_(e){var i=e.getUTCDay();return i>=4||i===0?Ed(e):Ed.ceil(e)}function MT(e,i){return e=L_(e),Ja(Ed.count(rv(e),e)+(rv(e).getUTCDay()===4),i,2)}function PT(e){return e.getUTCDay()}function IT(e,i){return Ja(u0.count(rv(e)-1,e),i,2)}function OT(e,i){return Ja(e.getUTCFullYear()%100,i,2)}function RT(e,i){return e=L_(e),Ja(e.getUTCFullYear()%100,i,2)}function kT(e,i){return Ja(e.getUTCFullYear()%1e4,i,4)}function LT(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ed(e):Ed.ceil(e),Ja(e.getUTCFullYear()%1e4,i,4)}function DT(){return"+0000"}function D_(){return"%"}function F_(e){return+e}function B_(e){return Math.floor(+e/1e3)}var Sd,N_,FT,BT,NT;zT({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function zT(e){return Sd=Fw(e),N_=Sd.format,FT=Sd.parse,BT=Sd.utcFormat,NT=Sd.utcParse,Sd}var ov=1e3,sv=ov*60,uv=sv*60,lv=uv*24,UT=lv*7,z_=lv*30,tm=lv*365;function ZT(e){return new Date(e)}function jT(e){return e instanceof Date?+e:+new Date(+e)}function U_(e,i,r,n,a,s,p,v,y){var x=Wy(Tc,Tc),C=x.invert,T=x.domain,k=y(".%L"),F=y(":%S"),V=y("%I:%M"),K=y("%I %p"),ee=y("%a %d"),be=y("%b %d"),je=y("%B"),Ke=y("%Y"),et=[[p,1,ov],[p,5,5*ov],[p,15,15*ov],[p,30,30*ov],[s,1,sv],[s,5,5*sv],[s,15,15*sv],[s,30,30*sv],[a,1,uv],[a,3,3*uv],[a,6,6*uv],[a,12,12*uv],[n,1,lv],[n,2,2*lv],[r,1,UT],[i,1,z_],[i,3,3*z_],[e,1,tm]];function At(Kt){return(p(Kt)<Kt?k:s(Kt)<Kt?F:a(Kt)<Kt?V:n(Kt)<Kt?K:i(Kt)<Kt?r(Kt)<Kt?ee:be:e(Kt)<Kt?je:Ke)(Kt)}function It(Kt,hr,zr,rn){if(Kt==null&&(Kt=10),typeof Kt=="number"){var _r=Math.abs(zr-hr)/Kt,Sn=ky(function(kn){return kn[2]}).right(et,_r);Sn===et.length?(rn=z0(hr/tm,zr/tm,Kt),Kt=e):Sn?(Sn=et[_r/et[Sn-1][2]<et[Sn][2]/_r?Sn-1:Sn],rn=Sn[1],Kt=Sn[0]):(rn=Math.max(z0(hr,zr,Kt),1),Kt=v)}return rn==null?Kt:Kt.every(rn)}return x.invert=function(Kt){return new Date(C(Kt))},x.domain=function(Kt){return arguments.length?T(Qv.call(Kt,jT)):T().map(ZT)},x.ticks=function(Kt,hr){var zr=T(),rn=zr[0],_r=zr[zr.length-1],Sn=_r<rn,kn;return Sn&&(kn=rn,rn=_r,_r=kn),kn=It(Kt,rn,_r,hr),kn=kn?kn.range(rn,_r+1):[],Sn?kn.reverse():kn},x.tickFormat=function(Kt,hr){return hr==null?At:y(hr)},x.nice=function(Kt,hr){var zr=T();return(Kt=It(Kt,zr[0],zr[zr.length-1],hr))?T(r_(zr,Kt)):x},x.copy=function(){return e0(x,U_(e,i,r,n,a,s,p,v,y))},x}function VT(){return ah.apply(U_(xd,Sw,K0,$0,Mw,Pw,Iw,Ow,N_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function vP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function l0(){var e=0,i=1,r,n,a,s,p=identity,v=!1,y;function x(C){return isNaN(C=+C)?y:p(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(y=C,x):y},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function c0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function GT(){var e=linearish(l0()(identity));return e.copy=function(){return c0(e,GT())},initInterpolator.apply(e,arguments)}function HT(){var e=loggish(l0()).domain([1,10]);return e.copy=function(){return c0(e,HT()).base(e.base())},initInterpolator.apply(e,arguments)}function WT(){var e=symlogish(l0());return e.copy=function(){return c0(e,WT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Z_(){var e=powish(l0());return e.copy=function(){return c0(e,Z_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function mP(){return Z_.apply(null,arguments).exponent(.5)}function XT(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return XT(i).domain(e)},initInterpolator.apply(r,arguments)}function f0(){var e=0,i=.5,r=1,n,a,s,p,v,y=identity,x,C=!1,T;function k(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-a)*(F<a?p:v),y(C?Math.max(0,Math.min(1,F)):F))}return k.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),k):[e,i,r]},k.clamp=function(F){return arguments.length?(C=!!F,k):C},k.interpolator=function(F){return arguments.length?(y=F,k):y},k.unknown=function(F){return arguments.length?(T=F,k):T},function(F){return x=F,n=F(e),a=F(i),s=F(r),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),k}}function YT(){var e=linearish(f0()(identity));return e.copy=function(){return copy(e,YT())},initInterpolator.apply(e,arguments)}function qT(){var e=loggish(f0()).domain([.1,1,10]);return e.copy=function(){return copy(e,qT()).base(e.base())},initInterpolator.apply(e,arguments)}function KT(){var e=symlogish(f0());return e.copy=function(){return copy(e,KT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function j_(){var e=powish(f0());return e.copy=function(){return copy(e,j_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function gP(){return j_.apply(null,arguments).exponent(.5)}var tf,V_,G_,H_,rm,W_,$T=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,QT=(tf={},(0,A.Z)(tf,$s.LINEAR,e_),(0,A.Z)(tf,$s.POWER,W0),(0,A.Z)(tf,$s.LOG,o_),(0,A.Z)(tf,$s.IDENTITY,t_),(0,A.Z)(tf,$s.TIME,VT),(0,A.Z)(tf,$s.QUANTILE,c_),(0,A.Z)(tf,$s.QUANTIZE,f_),(0,A.Z)(tf,$s.THRESHOLD,p_),(0,A.Z)(tf,$s.CAT,Jv),tf),JT=(V_=(0,Lr.b2)(),G_=(0,Lr.f3)(bt.IGlobalConfigService),V_(H_=(rm=function(){function e(){(0,ft.Z)(this,e),xn(this,"configService",W_,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(p||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var v=r.getSource().data.dataArray;if(v.length===0)return;var y=p.filter(function(x){return x.needRescale});y.length&&a.caculateScalesForAttributes(y,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,v=s.name;p.names=a.parseFields(s.scale.field||[]);var y=[];p.names.forEach(function(x){y.push(a.getOrCreateScale(x,s,n))}),y.some(function(x){return x.type===Jp.VARIABLE})?(p.type=Jp.VARIABLE,y.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&p.values.length>2){var k=x.scale.ticks(p.values.length);v==="color"&&x.scale.domain(k)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=Jp.CONSTANT,p.defaultValues=y.map(function(x,C){return x.scale(p.names[C])})),p.scalers=y.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,y=this.createScale(r,n.name,v,a);return y}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:E()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,v,y=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:Jp.VARIABLE,option:y};if(!s||!s.length)return y&&y.type?x.scale=this.createDefaultScale(y):(x.scale=Jv([r]),x.type=Jp.CONSTANT),x;var C=(v=s.find(function(F){return!oo()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||oo()(C)&&!y)x.scale=Jv([r]),x.type=Jp.CONSTANT;else{var T=y&&y.type||this.getDefaultType(C);a==="text"&&(T=$s.CAT);var k=this.createDefaultScaleConfig(T,r,s);Object.assign(k,y),x.scale=this.createDefaultScale(k),x.option=k}return x}},{key:"getDefaultType",value:function(r){var n=$s.LINEAR;return typeof r=="string"&&(n=$T.test(r)?$s.TIME:$s.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==$s.CAT&&r!==$s.QUANTILE?s.domain=jA(p):r===$s.CAT?s.domain=_v()(p):r===$s.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=QT[n]();return a&&s.domain(a),s}}]),e}(),W_=Ln(rm.prototype,"configService",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm))||H_),X_,Y_,q_,K_,p0,$_,Q_;function J_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function e5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J_(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var t5=(X_=(0,Lr.b2)(),Y_=(0,Lr.f3)(bt.ICameraService),q_=(0,Lr.f3)(bt.IRendererService),X_(K_=(p0=function(){function e(){(0,ft.Z)(this,e),xn(this,"cameraService",$_,this),xn(this,"rendererService",Q_,this)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(e5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),$_=Ln(p0.prototype,"cameraService",[Y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q_=Ln(p0.prototype,"rendererService",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0))||K_),e1,t1,r5=(e1=(0,Lr.b2)(),e1(t1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||t1),r1,n1,n5=(r1=(0,Lr.b2)(),r1(n1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||n1),i1,a1,i5=["type"];function o1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function cv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?o1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var s1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},a5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},o5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},s5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},yP=null;function u5(e){var i={u_DirectionalLights:new Array(3).fill(cv({},o5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(cv({},s5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[a5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,ts.Z)(r,i5),v=s1[s].lights,y=s1[s].num,x=i[y];i[v][x]=cv(cv({},i[v][x]),p),i[y]++}),i}var l5=(i1=(0,Lr.b2)(),i1(a1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(cv({},u5()))})})}}]),e}())||a1),u1,l1,c1,nm,f1,c5=(u1=(0,Lr.b2)(),l1=(0,Lr.f3)(bt.IGlobalConfigService),u1(c1=(nm=function(){function e(){(0,ft.Z)(this,e),xn(this,"configService",f1,this),(0,A.Z)(this,"enabled",void 0)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var y=r.getLayerConfig(),x=y.enableMultiPassRenderer,C=y.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=Sg(r,T,p,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var y=s.getViewportSize(),x=y.width,C=y.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),f1=Ln(nm.prototype,"configService",[l1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm))||c1),p1,h1,h0={NONE:0,ENCODE:1,HIGHLIGHT:2},f5=(p1=(0,Lr.b2)(),p1(h1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:Fn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:O.FLOAT},size:3,update:function(y,x){var C=y.id;return p?Ws(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:h0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:h0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),y=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof y=="string"?Gi(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:no(new Uint8Array(p))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:h0.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),y=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof y=="string"?Gi(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:no(new Uint8Array(p))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:h0.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||h1),d1,v1,p5=(d1=(0,Lr.b2)(),d1(v1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Fn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:O.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:Fn.Attribute,descriptor:{name:"filter",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Fn.Attribute,descriptor:{name:"a_Color",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:Fn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(a,s,p,v){return[s]}}})}}]),e}())||v1),m1,g1,y1,_1,x1,b1,Cd,E1,S1,C1,A1,h5=(m1=(0,Lr.b2)(),g1=(0,Lr.f3)(bt.ICameraService),y1=(0,Lr.f3)(bt.ICoordinateSystemService),_1=(0,Lr.f3)(bt.IRendererService),x1=(0,Lr.f3)(bt.IMapService),m1(b1=(Cd=function(){function e(){(0,ft.Z)(this,e),xn(this,"cameraService",E1,this),xn(this,"coordinateSystemService",S1,this),xn(this,"rendererService",C1,this),xn(this,"mapService",A1,this)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),y=v.width,x=v.height;r.models.forEach(function(C){var T;C.addUniforms((T={},(0,A.Z)(T,Ph.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(T,Ph.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(T,Ph.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(T,Ph.Zoom,n.cameraService.getZoom()),(0,A.Z)(T,Ph.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(T,Ph.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(T,Ph.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(T,vc.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(T,vc.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(T,vc.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(T,vc.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(T,vc.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(T,vc.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(T,vc.Mvp,s),(0,A.Z)(T,"u_SceneCenterMKT",p),(0,A.Z)(T,"u_ViewportSize",[y,x]),(0,A.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(T,"u_DevicePixelRatio",oa.devicePixelRatio),(0,A.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),E1=Ln(Cd.prototype,"cameraService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S1=Ln(Cd.prototype,"coordinateSystemService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C1=Ln(Cd.prototype,"rendererService",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A1=Ln(Cd.prototype,"mapService",[x1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||b1),w1,T1,d5=(w1=(0,Lr.b2)(),w1(T1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||T1),M1,P1,v5=(M1=(0,Lr.b2)(),M1(P1=function(){function e(){(0,ft.Z)(this,e)}return(0,Mt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(y){return y.needRegenerateVertices=!1});return}s.filter(function(y){return y.needRegenerateVertices}).forEach(function(y){a.updateAttributeByFeatureRange(y.name,r.getEncodedData(),y.featureRange.startIndex,y.featureRange.endIndex),y.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||P1);$l.bind(bt.ILayerPlugin).to(zA).inRequestScope(),$l.bind(bt.ILayerPlugin).to(p5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(JT).inRequestScope(),$l.bind(bt.ILayerPlugin).to(NA).inRequestScope(),$l.bind(bt.ILayerPlugin).to(n5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(v5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(d5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(c5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(h5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(t5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(l5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(f5).inRequestScope(),$l.bind(bt.ILayerPlugin).to(r5).inRequestScope();var _P="2.8.21";function I1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?I1(Object(r),!0).forEach(function(n){m5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function m5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function bP(e,i){return x5(e)||_5(e,i)||y5(e,i)||g5()}function g5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y5(e,i){if(!!e){if(typeof e=="string")return O1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O1(e,i)}}function O1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function x5(e){if(Array.isArray(e))return e}var EP=null,SP=null,R1,im,k1;function L1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function D1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?L1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var b5=(R1=w0(bt.IGlobalConfigService),im=function(){function e(i){(0,ft.Z)(this,e),xn(this,"configService",k1,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,Mt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(bt.MapConfig).toConstantValue(D1(D1({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(bt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),k1=Ln(im.prototype,"configService",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im),E5=Q(6158),fv=Q.n(E5);function pv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function d0(e,i){var r=fn([],i,e);return ve(r,r,1/r[3]),r}function CP(e,i){var r=e%i;return r<0?i+r:r}function AP(e,i,r){return r*i+(1-r)*e}function Uh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var rf=Math.PI,F1=rf/4,Tp=rf/180,B1=180/rf,am=512,om=4003e4,S5=1.5;function N1(e){return Math.pow(2,e)}function C5(e){return Math.log2(e)}function v0(e,i){var r=(0,yn.Z)(e,2),n=r[0],a=r[1];Uh(Number.isFinite(n)&&Number.isFinite(i)),Uh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=am;var s=n*Tp,p=a*Tp,v=i*(s+rf)/(2*rf),y=i*(rf-Math.log(Math.tan(F1+p*.5)))/(2*rf);return[v,y]}function sm(e,i){var r=(0,yn.Z)(e,2),n=r[0],a=r[1];i*=am;var s=n/i*(2*rf)-rf,p=2*(Math.atan(Math.exp(rf-a/i*(2*rf)))-F1);return[s*B1,p*B1]}function wP(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Tp);return C5(om*r)-9}function z1(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:N1(n),Uh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},y=am*a,x=Math.cos(i*Tp),C=y/360,T=C/x,k=y/om/x;if(v.pixelsPerMeter=[k,-k,k],v.metersPerPixel=[1/k,-1/k,1/k],v.pixelsPerDegree=[C,-T,k],v.degreesPerPixel=[1/C,-1/T,1/k],p){var F=Tp*Math.tan(i*Tp)/x,V=C*F/2,K=y/om*F,ee=K/T*k;v.pixelsPerDegree2=[0,-V,K],v.pixelsPerMeter2=[ee,0,ee]}return v}function TP(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),v=p[0],y=p[1],x=p[2],C=1,T=z1({longitude:n,latitude:a,scale:C,highPrecision:!0}),k=T.pixelsPerMeter,F=T.pixelsPerMeter2,V=v0(e,C);V[0]+=v*(k[0]+F[0]*y),V[1]+=y*(k[1]+F[1]*y);var K=sm(V,C),ee=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[K[0],K[1],ee]:K}function A5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,v=e.flipY,y=v===void 0?!1:v,x=pv();return up(x,x,[0,0,-a]),lp(x,x,[1,1,1/i]),fp(x,x,-r*Tp),Xc(x,x,n*Tp),y&&lp(x,x,[1,-1,1]),p&&up(x,x,Ga.negate([],p)),x}function w5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?S5:n,s=e.pitch,p=s===void 0?0:s,v=e.nearZMultiplier,y=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=p*Tp,k=Math.atan(.5/a),F=Math.sin(k)*a/Math.sin(Math.PI/2-T-k),V=Math.cos(Math.PI/2-T)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:y,far:V*C}}function T5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,v=w5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),y=v.fov,x=v.aspect,C=v.near,T=v.far,k=Sr([],y,x,C,T);return k}function M5(e,i){var r=(0,yn.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return Uh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),d0(i,[n,a,p,1])}function U1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,yn.Z)(e,3),a=n[0],s=n[1],p=n[2];if(Uh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var v=d0(i,[a,s,p,1]);return v}var y=d0(i,[a,s,0,1]),x=d0(i,[a,s,1,1]),C=y[2],T=x[2],k=C===T?0:((r||0)-C)/(T-C);return _i.lerp([],y,x,k)}var Z1=pv(),P5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?Z1:a,p=i.projectionMatrix,v=p===void 0?Z1:p;(0,ft.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var y=pv();Bu(y,y,this.projectionMatrix),Bu(y,y,this.viewMatrix),this.viewProjectionMatrix=y;var x=pv();lp(x,x,[this.width/2,-this.height/2,1]),up(x,x,[1,-1,0]),Bu(x,x,this.viewProjectionMatrix);var C=zp(pv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Mt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&hn(r.projectionMatrix,this.projectionMatrix)&&hn(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),v=M5(p,this.pixelProjectionMatrix),y=(0,yn.Z)(v,2),x=y[0],C=y[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,v=(0,yn.Z)(r,3),y=v[0],x=v[1],C=v[2],T=s?x:this.height-x,k=p&&p*this.pixelsPerMeter,F=U1([y,T,C],this.pixelUnprojectionMatrix,k),V=this.unprojectPosition(F),K=(0,yn.Z)(V,3),ee=K[0],be=K[1],je=K[2];return Number.isFinite(C)?[ee,be,je]:Number.isFinite(p)?[ee,be,p]:[ee,be]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,yn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,p,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,yn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,p,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function I5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,v=p===void 0?24:p,y=e.padding,x=y===void 0?0:y,C=e.offset,T=C===void 0?[0,0]:C,k=(0,yn.Z)(n,2),F=(0,yn.Z)(k[0],2),V=F[0],K=F[1],ee=(0,yn.Z)(k[1],2),be=ee[0],je=ee[1];if(Number.isFinite(x)){var Ke=x;x={top:Ke,bottom:Ke,left:Ke,right:Ke}}else Uh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var et=new j1({width:i,height:r,longitude:0,latitude:0,zoom:0}),At=et.project([V,je]),It=et.project([be,K]),Kt=[Math.max(Math.abs(It[0]-At[0]),s),Math.max(Math.abs(It[1]-At[1]),s)],hr=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Uh(hr[0]>0&&hr[1]>0);var zr=hr[0]/Kt[0],rn=hr[1]/Kt[1],_r=(x.right-x.left)/2/zr,Sn=(x.bottom-x.top)/2/rn,kn=[(It[0]+At[0])/2+_r,(It[1]+At[1])/2+Sn],ui=et.unproject(kn),so=et.zoom+Math.log2(Math.abs(Math.min(zr,rn)));return{longitude:ui[0],latitude:ui[1],zoom:Math.min(so,v)}}var j1=function(e){(0,Rr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,v=p===void 0?0:p,y=n.longitude,x=y===void 0?0:y,C=n.zoom,T=C===void 0?0:C,k=n.pitch,F=k===void 0?0:k,V=n.bearing,K=V===void 0?0:V,ee=n.altitude,be=ee===void 0?1.5:ee,je=n.nearZMultiplier,Ke=n.farZMultiplier;(0,ft.Z)(this,i),a=a||1,s=s||1;var et=N1(T);be=Math.max(.75,be);var At=v0([x,v],et);At[2]=0;var It=T5({width:a,height:s,pitch:F,bearing:K,altitude:be,nearZMultiplier:je||1/s,farZMultiplier:Ke||1.01}),Kt=A5({height:s,center:At,pitch:F,bearing:K,altitude:be,flipY:!0});return r=(0,cn.Z)(this,(0,_t.Z)(i).call(this,{width:a,height:s,viewMatrix:Kt,projectionMatrix:It})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=F,r.bearing=K,r.altitude=be,r.scale=et,r.center=At,r.pixelsPerMeter=z1((0,le.Z)((0,le.Z)(r))).pixelsPerMeter[2],Object.freeze((0,le.Z)((0,le.Z)(r))),r}return(0,Mt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return v0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return sm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=U1(s,this.pixelUnprojectionMatrix),v=v0(a,this.scale),y=_i.add([],v,_i.negate([],p)),x=_i.add([],this.center,y);return sm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,v=I5(Object.assign({width:s,height:p,bounds:n},a)),y=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:p,longitude:y,latitude:x,zoom:C})}}]),i}(P5),O5=function(){function e(){(0,ft.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,Mt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,v=r.viewportHeight,y=r.viewportWidth;this.viewport=new j1({width:y,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),R5=function(){function e(i){(0,ft.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,Mt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),V1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},k5=["id","attributionControl","style","token","rotation","mapInstance"],G1,H1,W1,X1,Y1,q1,Ad,K1,$1,Q1,J1;function ex(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function L5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ex(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}D5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=fv();var tx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},F5=0,B5=12,rx="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",N5=(G1=(0,Lr.b2)(),H1=(0,Lr.f3)(bt.MapConfig),W1=(0,Lr.f3)(bt.IGlobalConfigService),X1=(0,Lr.f3)(bt.ICoordinateSystemService),Y1=(0,Lr.f3)(bt.IEventEmitter),G1(q1=(Ad=function(){function e(){var i=this;(0,ft.Z)(this,e),(0,A.Z)(this,"version",xu.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new R5),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),xn(this,"config",K1,this),xn(this,"configService",$1,this),xn(this,"coordinateSystemService",Q1,this),xn(this,"eventEmitter",J1,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?B5:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(lu.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(lu.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Mt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Na("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Ub.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(tx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(tx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,v=a.y,y=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:p,y,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),y=v.meterInMercatorCoordinateUnits(),x=El();return up(x,x,Ga.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),lp(x,x,Ga.fromValues(y*s[0],-y*s[1],y*s[2])),fp(x,x,a[0]),Up(x,x,a[1]),Xc(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,N.Z)(j().mark(function n(){var a,s,p,v,y,x,C,T,k,F,V,K,ee;return j().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,v=a.attributionControl,y=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,k=T===void 0?rx:T,F=a.rotation,V=F===void 0?0:F,K=a.mapInstance,ee=(0,ts.Z)(a,k5),this.viewport=new O5,!K&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),k===rx&&C!=="blank"&&!window.mapboxgl.accessToken&&!K&&console.warn(this.configService.getSceneWarninfo("MapToken")),!K&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=k),K?(this.map=K,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(L5({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:y,bearing:V},ee))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return je.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(fv()).LngLat(r[0],r[1]),s=new(fv()).LngLat(n[0],n[1]),p=a.distanceTo(s),v=fv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),y=fv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=y.x,k=y.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-k,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+F5++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:V1[r]?V1[r]:r}}]),e}(),K1=Ln(Ad.prototype,"config",[H1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$1=Ln(Ad.prototype,"configService",[W1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q1=Ln(Ad.prototype,"coordinateSystemService",[X1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J1=Ln(Ad.prototype,"eventEmitter",[Y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad))||q1);function z5(e){var i=U5();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function U5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Z5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}Z5(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var j5=function(e){(0,Rr.Z)(r,e);var i=z5(r);function r(){return(0,ft.Z)(this,r),i.apply(this,arguments)}return(0,Mt.Z)(r,[{key:"getServiceConstructor",value:function(){return N5}}]),r}(b5);function nx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ix(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nx(Object(r),!0).forEach(function(n){V5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function G5(e,i){return Y5(e)||X5(e,i)||W5(e,i)||H5()}function H5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W5(e,i){if(!!e){if(typeof e=="string")return ax(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ax(e,i)}}function ax(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function X5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function Y5(e){if(Array.isArray(e))return e}var q5=ye.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,ye.createRef)(),v=(0,ye.useState)(),y=G5(v,2),x=y[0],C=y[1];return(0,ye.useEffect)(function(){var T=new w2(ix(ix({id:p.current},a),{},{map:new j5(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,ye.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ye.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,ye.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ye.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,ye.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),ye.createElement(m.Provider,{value:x},(0,ye.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),K5=q5;function ox(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function MP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ox(Object(r),!0).forEach(function(n){$5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ox(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function PP(e,i){return tM(e)||eM(e,i)||J5(e,i)||Q5()}function Q5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function J5(e,i){if(!!e){if(typeof e=="string")return sx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sx(e,i)}}function sx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function eM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function tM(e){if(Array.isArray(e))return e}var IP=null,OP=null;function ux(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function RP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ux(Object(r),!0).forEach(function(n){rM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ux(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function kP(e,i){return oM(e)||aM(e,i)||iM(e,i)||nM()}function nM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iM(e,i){if(!!e){if(typeof e=="string")return lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lx(e,i)}}function lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function aM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function oM(e){if(Array.isArray(e))return e}var LP=null,DP=null;function FP(e,i){return cM(e)||lM(e,i)||uM(e,i)||sM()}function sM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uM(e,i){if(!!e){if(typeof e=="string")return cx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cx(e,i)}}function cx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function lM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function cM(e){if(Array.isArray(e))return e}var BP=null,NP=null;function fx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fx(Object(r),!0).forEach(function(n){fM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function UP(e,i){if(e==null)return{};var r=pM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function pM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var ZP=null,px=Q(73935);function hx(e,i){return mM(e)||vM(e,i)||dM(e,i)||hM()}function hM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dM(e,i){if(!!e){if(typeof e=="string")return dx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dx(e,i)}}function dx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function mM(e){if(Array.isArray(e))return e}var vx=ye.useEffect,mx=ye.useState,gM=/\B([A-Z])/g,yM=function(i){return i.replace(gM,"-$1").toLowerCase()};function jP(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=mx(),p=hx(s,2),v=p[0],y=p[1],x=useSceneValue(),C=mx(function(){return document.createElement("div")}),T=hx(C,1),k=T[0];return vx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(k.className=i),r){var V=Object.keys(r).map(function(K){return"".concat(yM(K),":").concat(r[K])}).join(";");k.style.cssText=V}return k},F.onRemove=function(){},y(F),x.addControl(F),function(){x.removeControl(F)}},[]),vx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,k)}var gx=(0,ye.createContext)({});function VP(){return useContext(gx)}var Uf=Q(96486),GP=ye.useEffect,_M=ye.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Uf.isEqual),HP=ye.useEffect,xM=ye.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Uf.isEqual),WP=ye.useEffect,bM=ye.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Uf.isEqual),EM=ye.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Uf.isEqual),SM=ye.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Uf.isEqual),XP=ye.useEffect,CM=ye.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Uf.isEqual),AM=ye.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Uf.isEqual),wM=ye.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Uf.isEqual),TM=["data"];function MM(e,i){if(e==null)return{};var r=PM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function PM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var IM=ye.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=MM(n,TM);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Uf.isEqual),YP=ye.useEffect,OM=ye.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Uf.isEqual);function RM(e,i){return FM(e)||DM(e,i)||LM(e,i)||kM()}function kM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LM(e,i){if(!!e){if(typeof e=="string")return yx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yx(e,i)}}function yx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function DM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,v=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function FM(e){if(Array.isArray(e))return e}var hv=ye.useEffect,BM=ye.useState;function _x(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,v=i.scale,y=i.active,x=i.select,C=i.filter,T=i.animate,k=i.options,F=i.onLayerLoaded,V=Oe(),K=BM(function(){var je;switch(e){case"polygonLayer":je=new xy(k);break;case"lineLayer":je=new XS(k);break;case"pointLayer":je=new $C(k);break;case"heatmapLayer":je=new UE(k);break;case"rasterLayer":je=new FA(k);break;case"imageLayer":je=new KE(k);break;case"citybuildingLayer":je=new fE(k);break;default:je=new xy(k)}return je.on("inited",function(){F&&F(je,V)}),je}),ee=RM(K,1),be=ee[0];return hv(function(){return V.addLayer(be),function(){V.removeLayer(be)}},[]),hv(function(){be.inited&&k&&be.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),hv(function(){be.inited&&(k==null?void 0:k.zIndex)&&be.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),hv(function(){be.inited&&(k==null?void 0:k.blend)&&be.setBlend(k.blend)},[k==null?void 0:k.blend]),hv(function(){V.render()}),ye.createElement(gx.Provider,{value:be},ye.createElement(IM,{layer:be,source:r}),v&&ye.createElement(SM,{layer:be,scale:v}),n&&ye.createElement(bM,{layer:be,color:n}),p&&ye.createElement(wM,{layer:be,size:p}),a&&ye.createElement(AM,{layer:be,shape:a}),s&&ye.createElement(OM,{layer:be,style:s}),y&&ye.createElement(_M,{layer:be,active:y}),x&&ye.createElement(CM,{layer:be,select:x}),C&&ye.createElement(EM,{layer:be,filter:C}),T&&ye.createElement(xM,{layer:be,animate:T}),i.children)}var qP=null,KP=null,NM=ye.memo(function(i){return _x("pointLayer",i)}),zM=ye.memo(function(i){return _x("heatmapLayer",i)}),$P=null,QP=null,JP=null,eI=ye.useEffect,tI=null,rI=null;function m0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?m0=function(r){return typeof r}:m0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},m0(e)}function xx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function g0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xx(Object(r),!0).forEach(function(n){UM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function ZM(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function bx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jM(e,i,r){return i&&bx(e.prototype,i),r&&bx(e,r),e}function VM(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&um(e,i)}function um(e,i){return um=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},um(e,i)}function GM(e){var i=XM();return function(){var n=y0(e),a;if(i){var s=y0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return HM(this,a)}}function HM(e,i){if(i&&(m0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WM(e)}function WM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function y0(e){return y0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},y0(e)}var nI=function(e){VM(r,e);var i=GM(r);function r(n){var a;return ZM(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return jM(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,v=s.children,y=s.option,x=s.lngLat,C=new cg(g0(g0({},y),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,v,y,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(y=v.lnglat)===null||y===void 0?void 0:y.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],F=T.toString()!==k.toString();if(F){var V;this.popup.remove(),this.popup=new cg(g0(g0({},this.props.option),{},{stopPropagation:(V=this.props.option)===null||V===void 0?void 0:V.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return ye.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,px.createPortal)(a.props.children,a.el)})}}]),r}(ye.PureComponent);function _0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_0=function(r){return typeof r}:_0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_0(e)}function YM(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ex(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qM(e,i,r){return i&&Ex(e.prototype,i),r&&Ex(e,r),e}function KM(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&lm(e,i)}function lm(e,i){return lm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},lm(e,i)}function $M(e){var i=e3();return function(){var n=x0(e),a;if(i){var s=x0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return QM(this,a)}}function QM(e,i){if(i&&(_0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JM(e)}function JM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function e3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function x0(e){return x0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},x0(e)}var iI=function(e){KM(r,e);var i=$M(r);function r(n){var a;return YM(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return qM(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,v=a.option,y=a.onMarkerLoaded,x=new ag(v);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,y&&y(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return ye.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,px.createPortal)(a.props.children,a.el)})}}]),r}(ye.PureComponent),aI=ye.useEffect,oI=null,sI=null,uI=ye.useEffect,lI=null},66213:function(Ar,ne,Q){"use strict";Q.d(ne,{Z:function(){return m}});var Pe=Q(77608);function ye(Oe,W){for(;!Object.prototype.hasOwnProperty.call(Oe,W)&&(Oe=(0,Pe.Z)(Oe),Oe!==null););return Oe}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(W,pe,ce){var Be=ye(W,pe);if(!!Be){var _e=Object.getOwnPropertyDescriptor(Be,pe);return _e.get?_e.get.call(arguments.length<3?W:ce):_e.value}},m.apply(this,arguments)}},31795:function(Ar,ne,Q){var Pe=Q(75752);Ar.exports.geometry=ye,Ar.exports.ring=Oe;function ye(pe){var ce=0,Be;switch(pe.type){case"Polygon":return m(pe.coordinates);case"MultiPolygon":for(Be=0;Be<pe.coordinates.length;Be++)ce+=m(pe.coordinates[Be]);return ce;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Be=0;Be<pe.geometries.length;Be++)ce+=ye(pe.geometries[Be]);return ce}}function m(pe){var ce=0;if(pe&&pe.length>0){ce+=Math.abs(Oe(pe[0]));for(var Be=1;Be<pe.length;Be++)ce-=Math.abs(Oe(pe[Be]))}return ce}function Oe(pe){var ce,Be,_e,tt,pt,Et,Jt,ur=0,kt=pe.length;if(kt>2){for(Jt=0;Jt<kt;Jt++)Jt===kt-2?(tt=kt-2,pt=kt-1,Et=0):Jt===kt-1?(tt=kt-1,pt=0,Et=1):(tt=Jt,pt=Jt+1,Et=Jt+2),ce=pe[tt],Be=pe[pt],_e=pe[Et],ur+=(W(_e[0])-W(ce[0]))*Math.sin(W(Be[1]));ur=ur*Pe.RADIUS*Pe.RADIUS/2}return ur}function W(pe){return pe*Math.PI/180}},38163:function(Ar,ne,Q){var Pe=Q(31795);Ar.exports=ye;function ye(Be,_e){switch(Be&&Be.type||null){case"FeatureCollection":return Be.features=Be.features.map(m(ye,_e)),Be;case"GeometryCollection":return Be.geometries=Be.geometries.map(m(ye,_e)),Be;case"Feature":return Be.geometry=ye(Be.geometry,_e),Be;case"Polygon":case"MultiPolygon":return Oe(Be,_e);default:return Be}}function m(Be,_e){return function(tt){return Be(tt,_e)}}function Oe(Be,_e){return Be.type==="Polygon"?Be.coordinates=W(Be.coordinates,_e):Be.type==="MultiPolygon"&&(Be.coordinates=Be.coordinates.map(m(W,_e))),Be}function W(Be,_e){_e=!!_e,Be[0]=pe(Be[0],_e);for(var tt=1;tt<Be.length;tt++)Be[tt]=pe(Be[tt],!_e);return Be}function pe(Be,_e){return ce(Be)===_e?Be:Be.reverse()}function ce(Be){return Pe.ring(Be)>=0}},86582:function(Ar,ne,Q){"use strict";Q.d(ne,{Z:function(){return pe}});var Pe=Q(72560);function ye(ce){if(Array.isArray(ce))return(0,Pe.Z)(ce)}function m(ce){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(ce))return Array.from(ce)}var Oe=Q(64254);function W(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pe(ce){return ye(ce)||m(ce)||(0,Oe.Z)(ce)||W()}},53645:function(){},9187:function(Ar){"use strict";Ar.exports=ne,Ar.exports.default=ne;function ne(A,Ce,ke){ke=ke||2;var xt=Ce&&Ce.length,ht=xt?Ce[0]*ke:A.length,Ft=Q(A,0,ht,ke,!0),Gt=[];if(!Ft||Ft.next===Ft.prev)return Gt;var Er,Qn,gn,di,Hn,ai,vi;if(xt&&(Ft=ce(A,Ce,Ft,ke)),A.length>80*ke){Er=gn=A[0],Qn=di=A[1];for(var Xn=ke;Xn<ht;Xn+=ke)Hn=A[Xn],ai=A[Xn+1],Hn<Er&&(Er=Hn),ai<Qn&&(Qn=ai),Hn>gn&&(gn=Hn),ai>di&&(di=ai);vi=Math.max(gn-Er,di-Qn),vi=vi!==0?1/vi:0}return ye(Ft,Gt,ke,Er,Qn,vi),Gt}function Q(A,Ce,ke,xt,ht){var Ft,Gt;if(ht===Qr(A,Ce,ke,xt)>0)for(Ft=Ce;Ft<ke;Ft+=xt)Gt=Xt(Ft,A[Ft],A[Ft+1],Gt);else for(Ft=ke-xt;Ft>=Ce;Ft-=xt)Gt=Xt(Ft,A[Ft],A[Ft+1],Gt);return Gt&&dt(Gt,Gt.next)&&(wr(Gt),Gt=Gt.next),Gt}function Pe(A,Ce){if(!A)return A;Ce||(Ce=A);var ke=A,xt;do if(xt=!1,!ke.steiner&&(dt(ke,ke.next)||ct(ke.prev,ke,ke.next)===0)){if(wr(ke),ke=Ce=ke.prev,ke===ke.next)break;xt=!0}else ke=ke.next;while(xt||ke!==Ce);return Ce}function ye(A,Ce,ke,xt,ht,Ft,Gt){if(!!A){!Gt&&Ft&&Et(A,xt,ht,Ft);for(var Er=A,Qn,gn;A.prev!==A.next;){if(Qn=A.prev,gn=A.next,Ft?Oe(A,xt,ht,Ft):m(A)){Ce.push(Qn.i/ke),Ce.push(A.i/ke),Ce.push(gn.i/ke),wr(A),A=gn.next,Er=gn.next;continue}if(A=gn,A===Er){Gt?Gt===1?(A=W(Pe(A),Ce,ke),ye(A,Ce,ke,xt,ht,Ft,2)):Gt===2&&pe(A,Ce,ke,xt,ht,Ft):ye(Pe(A),Ce,ke,xt,ht,Ft,1);break}}}}function m(A){var Ce=A.prev,ke=A,xt=A.next;if(ct(Ce,ke,xt)>=0)return!1;for(var ht=A.next.next;ht!==A.prev;){if(er(Ce.x,Ce.y,ke.x,ke.y,xt.x,xt.y,ht.x,ht.y)&&ct(ht.prev,ht,ht.next)>=0)return!1;ht=ht.next}return!0}function Oe(A,Ce,ke,xt){var ht=A.prev,Ft=A,Gt=A.next;if(ct(ht,Ft,Gt)>=0)return!1;for(var Er=ht.x<Ft.x?ht.x<Gt.x?ht.x:Gt.x:Ft.x<Gt.x?Ft.x:Gt.x,Qn=ht.y<Ft.y?ht.y<Gt.y?ht.y:Gt.y:Ft.y<Gt.y?Ft.y:Gt.y,gn=ht.x>Ft.x?ht.x>Gt.x?ht.x:Gt.x:Ft.x>Gt.x?Ft.x:Gt.x,di=ht.y>Ft.y?ht.y>Gt.y?ht.y:Gt.y:Ft.y>Gt.y?Ft.y:Gt.y,Hn=ur(Er,Qn,Ce,ke,xt),ai=ur(gn,di,Ce,ke,xt),vi=A.prevZ,Xn=A.nextZ;vi&&vi.z>=Hn&&Xn&&Xn.z<=ai;){if(vi!==A.prev&&vi!==A.next&&er(ht.x,ht.y,Ft.x,Ft.y,Gt.x,Gt.y,vi.x,vi.y)&&ct(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,Xn!==A.prev&&Xn!==A.next&&er(ht.x,ht.y,Ft.x,Ft.y,Gt.x,Gt.y,Xn.x,Xn.y)&&ct(Xn.prev,Xn,Xn.next)>=0))return!1;Xn=Xn.nextZ}for(;vi&&vi.z>=Hn;){if(vi!==A.prev&&vi!==A.next&&er(ht.x,ht.y,Ft.x,Ft.y,Gt.x,Gt.y,vi.x,vi.y)&&ct(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;Xn&&Xn.z<=ai;){if(Xn!==A.prev&&Xn!==A.next&&er(ht.x,ht.y,Ft.x,Ft.y,Gt.x,Gt.y,Xn.x,Xn.y)&&ct(Xn.prev,Xn,Xn.next)>=0)return!1;Xn=Xn.nextZ}return!0}function W(A,Ce,ke){var xt=A;do{var ht=xt.prev,Ft=xt.next.next;!dt(ht,Ft)&&ir(ht,xt,xt.next,Ft)&&qe(ht,Ft)&&qe(Ft,ht)&&(Ce.push(ht.i/ke),Ce.push(xt.i/ke),Ce.push(Ft.i/ke),wr(xt),wr(xt.next),xt=A=Ft),xt=xt.next}while(xt!==A);return Pe(xt)}function pe(A,Ce,ke,xt,ht,Ft){var Gt=A;do{for(var Er=Gt.next.next;Er!==Gt.prev;){if(Gt.i!==Er.i&&jt(Gt,Er)){var Qn=Qe(Gt,Er);Gt=Pe(Gt,Gt.next),Qn=Pe(Qn,Qn.next),ye(Gt,Ce,ke,xt,ht,Ft),ye(Qn,Ce,ke,xt,ht,Ft);return}Er=Er.next}Gt=Gt.next}while(Gt!==A)}function ce(A,Ce,ke,xt){var ht=[],Ft,Gt,Er,Qn,gn;for(Ft=0,Gt=Ce.length;Ft<Gt;Ft++)Er=Ce[Ft]*xt,Qn=Ft<Gt-1?Ce[Ft+1]*xt:A.length,gn=Q(A,Er,Qn,xt,!1),gn===gn.next&&(gn.steiner=!0),ht.push(kt(gn));for(ht.sort(Be),Ft=0;Ft<ht.length;Ft++)ke=_e(ht[Ft],ke),ke=Pe(ke,ke.next);return ke}function Be(A,Ce){return A.x-Ce.x}function _e(A,Ce){var ke=tt(A,Ce);if(!ke)return Ce;var xt=Qe(ke,A),ht=Pe(ke,ke.next);return Pe(xt,xt.next),Ce===ke?ht:Ce}function tt(A,Ce){var ke=Ce,xt=A.x,ht=A.y,Ft=-Infinity,Gt;do{if(ht<=ke.y&&ht>=ke.next.y&&ke.next.y!==ke.y){var Er=ke.x+(ht-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Er<=xt&&Er>Ft){if(Ft=Er,Er===xt){if(ht===ke.y)return ke;if(ht===ke.next.y)return ke.next}Gt=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Ce);if(!Gt)return null;if(xt===Ft)return Gt;var Qn=Gt,gn=Gt.x,di=Gt.y,Hn=Infinity,ai;ke=Gt;do xt>=ke.x&&ke.x>=gn&&xt!==ke.x&&er(ht<di?xt:Ft,ht,gn,di,ht<di?Ft:xt,ht,ke.x,ke.y)&&(ai=Math.abs(ht-ke.y)/(xt-ke.x),qe(ke,A)&&(ai<Hn||ai===Hn&&(ke.x>Gt.x||ke.x===Gt.x&&pt(Gt,ke)))&&(Gt=ke,Hn=ai)),ke=ke.next;while(ke!==Qn);return Gt}function pt(A,Ce){return ct(A.prev,A,Ce.prev)<0&&ct(Ce.next,A,A.next)<0}function Et(A,Ce,ke,xt){var ht=A;do ht.z===null&&(ht.z=ur(ht.x,ht.y,Ce,ke,xt)),ht.prevZ=ht.prev,ht.nextZ=ht.next,ht=ht.next;while(ht!==A);ht.prevZ.nextZ=null,ht.prevZ=null,Jt(ht)}function Jt(A){var Ce,ke,xt,ht,Ft,Gt,Er,Qn,gn=1;do{for(ke=A,A=null,Ft=null,Gt=0;ke;){for(Gt++,xt=ke,Er=0,Ce=0;Ce<gn&&(Er++,xt=xt.nextZ,!!xt);Ce++);for(Qn=gn;Er>0||Qn>0&&xt;)Er!==0&&(Qn===0||!xt||ke.z<=xt.z)?(ht=ke,ke=ke.nextZ,Er--):(ht=xt,xt=xt.nextZ,Qn--),Ft?Ft.nextZ=ht:A=ht,ht.prevZ=Ft,Ft=ht;ke=xt}Ft.nextZ=null,gn*=2}while(Gt>1);return A}function ur(A,Ce,ke,xt,ht){return A=32767*(A-ke)*ht,Ce=32767*(Ce-xt)*ht,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Ce=(Ce|Ce<<8)&16711935,Ce=(Ce|Ce<<4)&252645135,Ce=(Ce|Ce<<2)&858993459,Ce=(Ce|Ce<<1)&1431655765,A|Ce<<1}function kt(A){var Ce=A,ke=A;do(Ce.x<ke.x||Ce.x===ke.x&&Ce.y<ke.y)&&(ke=Ce),Ce=Ce.next;while(Ce!==A);return ke}function er(A,Ce,ke,xt,ht,Ft,Gt,Er){return(ht-Gt)*(Ce-Er)-(A-Gt)*(Ft-Er)>=0&&(A-Gt)*(xt-Er)-(ke-Gt)*(Ce-Er)>=0&&(ke-Gt)*(Ft-Er)-(ht-Gt)*(xt-Er)>=0}function jt(A,Ce){return A.next.i!==Ce.i&&A.prev.i!==Ce.i&&!ut(A,Ce)&&(qe(A,Ce)&&qe(Ce,A)&&St(A,Ce)&&(ct(A.prev,A,Ce.prev)||ct(A,Ce.prev,Ce))||dt(A,Ce)&&ct(A.prev,A,A.next)>0&&ct(Ce.prev,Ce,Ce.next)>0)}function ct(A,Ce,ke){return(Ce.y-A.y)*(ke.x-Ce.x)-(Ce.x-A.x)*(ke.y-Ce.y)}function dt(A,Ce){return A.x===Ce.x&&A.y===Ce.y}function ir(A,Ce,ke,xt){var ht=Wt(ct(A,Ce,ke)),Ft=Wt(ct(A,Ce,xt)),Gt=Wt(ct(ke,xt,A)),Er=Wt(ct(ke,xt,Ce));return!!(ht!==Ft&&Gt!==Er||ht===0&&Y(A,ke,Ce)||Ft===0&&Y(A,xt,Ce)||Gt===0&&Y(ke,A,xt)||Er===0&&Y(ke,Ce,xt))}function Y(A,Ce,ke){return Ce.x<=Math.max(A.x,ke.x)&&Ce.x>=Math.min(A.x,ke.x)&&Ce.y<=Math.max(A.y,ke.y)&&Ce.y>=Math.min(A.y,ke.y)}function Wt(A){return A>0?1:A<0?-1:0}function ut(A,Ce){var ke=A;do{if(ke.i!==A.i&&ke.next.i!==A.i&&ke.i!==Ce.i&&ke.next.i!==Ce.i&&ir(ke,ke.next,A,Ce))return!0;ke=ke.next}while(ke!==A);return!1}function qe(A,Ce){return ct(A.prev,A,A.next)<0?ct(A,Ce,A.next)>=0&&ct(A,A.prev,Ce)>=0:ct(A,Ce,A.prev)<0||ct(A,A.next,Ce)<0}function St(A,Ce){var ke=A,xt=!1,ht=(A.x+Ce.x)/2,Ft=(A.y+Ce.y)/2;do ke.y>Ft!=ke.next.y>Ft&&ke.next.y!==ke.y&&ht<(ke.next.x-ke.x)*(Ft-ke.y)/(ke.next.y-ke.y)+ke.x&&(xt=!xt),ke=ke.next;while(ke!==A);return xt}function Qe(A,Ce){var ke=new Gr(A.i,A.x,A.y),xt=new Gr(Ce.i,Ce.x,Ce.y),ht=A.next,Ft=Ce.prev;return A.next=Ce,Ce.prev=A,ke.next=ht,ht.prev=ke,xt.next=ke,ke.prev=xt,Ft.next=xt,xt.prev=Ft,xt}function Xt(A,Ce,ke,xt){var ht=new Gr(A,Ce,ke);return xt?(ht.next=xt.next,ht.prev=xt,xt.next.prev=ht,xt.next=ht):(ht.prev=ht,ht.next=ht),ht}function wr(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Gr(A,Ce,ke){this.i=A,this.x=Ce,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ne.deviation=function(A,Ce,ke,xt){var ht=Ce&&Ce.length,Ft=ht?Ce[0]*ke:A.length,Gt=Math.abs(Qr(A,0,Ft,ke));if(ht)for(var Er=0,Qn=Ce.length;Er<Qn;Er++){var gn=Ce[Er]*ke,di=Er<Qn-1?Ce[Er+1]*ke:A.length;Gt-=Math.abs(Qr(A,gn,di,ke))}var Hn=0;for(Er=0;Er<xt.length;Er+=3){var ai=xt[Er]*ke,vi=xt[Er+1]*ke,Xn=xt[Er+2]*ke;Hn+=Math.abs((A[ai]-A[Xn])*(A[vi+1]-A[ai+1])-(A[ai]-A[vi])*(A[Xn+1]-A[ai+1]))}return Gt===0&&Hn===0?0:Math.abs((Hn-Gt)/Gt)};function Qr(A,Ce,ke,xt){for(var ht=0,Ft=Ce,Gt=ke-xt;Ft<ke;Ft+=xt)ht+=(A[Gt]-A[Ft])*(A[Ft+1]+A[Gt+1]),Gt=Ft;return ht}ne.flatten=function(A){for(var Ce=A[0][0].length,ke={vertices:[],holes:[],dimensions:Ce},xt=0,ht=0;ht<A.length;ht++){for(var Ft=0;Ft<A[ht].length;Ft++)for(var Gt=0;Gt<Ce;Gt++)ke.vertices.push(A[ht][Ft][Gt]);ht>0&&(xt+=A[ht-1].length,ke.holes.push(xt))}return ke}},67709:function(Ar){function ne(Pe){var ye=Pe.target||Pe.srcElement;ye.__resizeRAF__&&cancelAnimationFrame(ye.__resizeRAF__),ye.__resizeRAF__=requestAnimationFrame(function(){var m=ye.__resizeTrigger__,Oe=m&&m.__resizeListeners__;Oe&&Oe.forEach(function(W){W.call(m,Pe)})})}var Q=function(ye,m){var Oe=this,W=Oe.document,pe,ce=W.attachEvent;typeof navigator!="undefined"&&(pe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Be(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ne)}if(!ye.__resizeListeners__)if(ye.__resizeListeners__=[],ce)ye.__resizeTrigger__=ye,ye.attachEvent("onresize",ne);else{getComputedStyle(ye).position==="static"&&(ye.style.position="relative");var _e=ye.__resizeTrigger__=W.createElement("object");_e.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),_e.setAttribute("class","resize-sensor"),_e.setAttribute("tabindex","-1"),_e.setAttribute("title",""),_e.__resizeElement__=ye,_e.onload=Be,_e.type="text/html",pe&&ye.appendChild(_e),_e.data="about:blank",pe||ye.appendChild(_e)}ye.__resizeListeners__.push(m)};Ar.exports=typeof window=="undefined"?Q:Q.bind(window),Ar.exports.unbind=function(Pe,ye){var m=document.attachEvent,Oe=Pe.__resizeListeners__||[];if(ye){var W=Oe.indexOf(ye);W!==-1&&Oe.splice(W,1)}else Oe=Pe.__resizeListeners__=[];if(!Oe.length){if(m)Pe.detachEvent("onresize",ne);else if(Pe.__resizeTrigger__){var pe=Pe.__resizeTrigger__.contentDocument,ce=pe&&pe.defaultView;ce&&(ce.removeEventListener("resize",ne),delete ce.__resizeTrigger__),Pe.__resizeTrigger__=!Pe.removeChild(Pe.__resizeTrigger__)}delete Pe.__resizeListeners__}}},26729:function(Ar){"use strict";var ne=Object.prototype.hasOwnProperty,Q="~";function Pe(){}Object.create&&(Pe.prototype=Object.create(null),new Pe().__proto__||(Q=!1));function ye(pe,ce,Be){this.fn=pe,this.context=ce,this.once=Be||!1}function m(pe,ce,Be,_e,tt){if(typeof Be!="function")throw new TypeError("The listener must be a function");var pt=new ye(Be,_e||pe,tt),Et=Q?Q+ce:ce;return pe._events[Et]?pe._events[Et].fn?pe._events[Et]=[pe._events[Et],pt]:pe._events[Et].push(pt):(pe._events[Et]=pt,pe._eventsCount++),pe}function Oe(pe,ce){--pe._eventsCount==0?pe._events=new Pe:delete pe._events[ce]}function W(){this._events=new Pe,this._eventsCount=0}W.prototype.eventNames=function(){var ce=[],Be,_e;if(this._eventsCount===0)return ce;for(_e in Be=this._events)ne.call(Be,_e)&&ce.push(Q?_e.slice(1):_e);return Object.getOwnPropertySymbols?ce.concat(Object.getOwnPropertySymbols(Be)):ce},W.prototype.listeners=function(ce){var Be=Q?Q+ce:ce,_e=this._events[Be];if(!_e)return[];if(_e.fn)return[_e.fn];for(var tt=0,pt=_e.length,Et=new Array(pt);tt<pt;tt++)Et[tt]=_e[tt].fn;return Et},W.prototype.listenerCount=function(ce){var Be=Q?Q+ce:ce,_e=this._events[Be];return _e?_e.fn?1:_e.length:0},W.prototype.emit=function(ce,Be,_e,tt,pt,Et){var Jt=Q?Q+ce:ce;if(!this._events[Jt])return!1;var ur=this._events[Jt],kt=arguments.length,er,jt;if(ur.fn){switch(ur.once&&this.removeListener(ce,ur.fn,void 0,!0),kt){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Be),!0;case 3:return ur.fn.call(ur.context,Be,_e),!0;case 4:return ur.fn.call(ur.context,Be,_e,tt),!0;case 5:return ur.fn.call(ur.context,Be,_e,tt,pt),!0;case 6:return ur.fn.call(ur.context,Be,_e,tt,pt,Et),!0}for(jt=1,er=new Array(kt-1);jt<kt;jt++)er[jt-1]=arguments[jt];ur.fn.apply(ur.context,er)}else{var ct=ur.length,dt;for(jt=0;jt<ct;jt++)switch(ur[jt].once&&this.removeListener(ce,ur[jt].fn,void 0,!0),kt){case 1:ur[jt].fn.call(ur[jt].context);break;case 2:ur[jt].fn.call(ur[jt].context,Be);break;case 3:ur[jt].fn.call(ur[jt].context,Be,_e);break;case 4:ur[jt].fn.call(ur[jt].context,Be,_e,tt);break;default:if(!er)for(dt=1,er=new Array(kt-1);dt<kt;dt++)er[dt-1]=arguments[dt];ur[jt].fn.apply(ur[jt].context,er)}}return!0},W.prototype.on=function(ce,Be,_e){return m(this,ce,Be,_e,!1)},W.prototype.once=function(ce,Be,_e){return m(this,ce,Be,_e,!0)},W.prototype.removeListener=function(ce,Be,_e,tt){var pt=Q?Q+ce:ce;if(!this._events[pt])return this;if(!Be)return Oe(this,pt),this;var Et=this._events[pt];if(Et.fn)Et.fn===Be&&(!tt||Et.once)&&(!_e||Et.context===_e)&&Oe(this,pt);else{for(var Jt=0,ur=[],kt=Et.length;Jt<kt;Jt++)(Et[Jt].fn!==Be||tt&&!Et[Jt].once||_e&&Et[Jt].context!==_e)&&ur.push(Et[Jt]);ur.length?this._events[pt]=ur.length===1?ur[0]:ur:Oe(this,pt)}return this},W.prototype.removeAllListeners=function(ce){var Be;return ce?(Be=Q?Q+ce:ce,this._events[Be]&&Oe(this,Be)):(this._events=new Pe,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=Q,W.EventEmitter=W,Ar.exports=W},7375:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var Q=Symbol.for("INJECTION");function Pe(pe,ce,Be,_e){function tt(){return _e&&!Reflect.hasMetadata(Q,this,ce)&&Reflect.defineMetadata(Q,Be(),this,ce),Reflect.hasMetadata(Q,this,ce)?Reflect.getMetadata(Q,this,ce):Be()}function pt(Et){Reflect.defineMetadata(Q,Et,this,ce)}Object.defineProperty(pe,ce,{configurable:!0,enumerable:!0,get:tt,set:pt})}function ye(pe,ce){return function(Be){return function(_e,tt){var pt=function(){return pe.get(Be)};Pe(_e,tt,pt,ce)}}}ne.makePropertyInjectDecorator=ye;function m(pe,ce){return function(Be,_e){return function(tt,pt){var Et=function(){return pe.getNamed(Be,_e)};Pe(tt,pt,Et,ce)}}}ne.makePropertyInjectNamedDecorator=m;function Oe(pe,ce){return function(Be,_e,tt){return function(pt,Et){var Jt=function(){return pe.getTagged(Be,_e,tt)};Pe(pt,Et,Jt,ce)}}}ne.makePropertyInjectTaggedDecorator=Oe;function W(pe,ce){return function(Be){return function(_e,tt){var pt=function(){return pe.getAll(Be)};Pe(_e,tt,pt,ce)}}}ne.makePropertyMultiInjectDecorator=W},84879:function(Ar,ne,Q){"use strict";var Pe;Pe={value:!0};var ye=Q(7375);function m(Oe,W){W===void 0&&(W=!0);var pe=ye.makePropertyInjectDecorator(Oe,W),ce=ye.makePropertyInjectNamedDecorator(Oe,W),Be=ye.makePropertyInjectTaggedDecorator(Oe,W),_e=ye.makePropertyMultiInjectDecorator(Oe,W);return{lazyInject:pe,lazyInjectNamed:ce,lazyInjectTagged:Be,lazyMultiInject:_e}}ne.Z=m},99934:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagProperty=ne.tagParameter=ne.decorate=void 0;var Pe=Q(16674),ye=Q(6867);function m(_e,tt,pt,Et){var Jt=ye.TAGGED;W(Jt,_e,tt,Et,pt)}ne.tagParameter=m;function Oe(_e,tt,pt){var Et=ye.TAGGED_PROP;W(Et,_e.constructor,tt,pt)}ne.tagProperty=Oe;function W(_e,tt,pt,Et,Jt){var ur={},kt=typeof Jt=="number",er=Jt!==void 0&&kt?Jt.toString():pt;if(kt&&pt!==void 0)throw new Error(Pe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(_e,tt)&&(ur=Reflect.getMetadata(_e,tt));var jt=ur[er];if(!Array.isArray(jt))jt=[];else for(var ct=0,dt=jt;ct<dt.length;ct++){var ir=dt[ct];if(ir.key===Et.key)throw new Error(Pe.DUPLICATED_METADATA+" "+ir.key.toString())}jt.push(Et),ur[er]=jt,Reflect.defineMetadata(_e,ur,tt)}function pe(_e,tt){Reflect.decorate(_e,tt)}function ce(_e,tt){return function(pt,Et){tt(pt,Et,_e)}}function Be(_e,tt,pt){typeof pt=="number"?pe([ce(pt,_e)],tt):typeof pt=="string"?Reflect.decorate([_e],tt,pt):pe([_e],tt)}ne.decorate=Be},5744:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.inject=ne.LazyServiceIdentifer=void 0;var Pe=Q(16674),ye=Q(6867),m=Q(47738),Oe=Q(99934),W=function(){function ce(Be){this._cb=Be}return ce.prototype.unwrap=function(){return this._cb()},ce}();ne.LazyServiceIdentifer=W;function pe(ce){return function(Be,_e,tt){if(ce===void 0)throw new Error(Pe.UNDEFINED_INJECT_ANNOTATION(Be.name));var pt=new m.Metadata(ye.INJECT_TAG,ce);typeof tt=="number"?Oe.tagParameter(Be,_e,tt,pt):Oe.tagProperty(Be,_e,pt)}}ne.inject=pe},64315:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.injectable=void 0;var Pe=Q(16674),ye=Q(6867);function m(){return function(Oe){if(Reflect.hasOwnMetadata(ye.PARAM_TYPES,Oe))throw new Error(Pe.DUPLICATED_INJECTABLE_DECORATOR);var W=Reflect.getMetadata(ye.DESIGN_PARAM_TYPES,Oe)||[];return Reflect.defineMetadata(ye.PARAM_TYPES,W,Oe),Oe}}ne.injectable=m},71693:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiInject=void 0;var Pe=Q(6867),ye=Q(47738),m=Q(99934);function Oe(W){return function(pe,ce,Be){var _e=new ye.Metadata(Pe.MULTI_INJECT_TAG,W);typeof Be=="number"?m.tagParameter(pe,ce,Be,_e):m.tagProperty(pe,ce,_e)}}ne.multiInject=Oe},38085:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.named=void 0;var Pe=Q(6867),ye=Q(47738),m=Q(99934);function Oe(W){return function(pe,ce,Be){var _e=new ye.Metadata(Pe.NAMED_TAG,W);typeof Be=="number"?m.tagParameter(pe,ce,Be,_e):m.tagProperty(pe,ce,_e)}}ne.named=Oe},6515:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.optional=void 0;var Pe=Q(6867),ye=Q(47738),m=Q(99934);function Oe(){return function(W,pe,ce){var Be=new ye.Metadata(Pe.OPTIONAL_TAG,!0);typeof ce=="number"?m.tagParameter(W,pe,ce,Be):m.tagProperty(W,pe,Be)}}ne.optional=Oe},7014:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.postConstruct=void 0;var Pe=Q(16674),ye=Q(6867),m=Q(47738);function Oe(){return function(W,pe,ce){var Be=new m.Metadata(ye.POST_CONSTRUCT,pe);if(Reflect.hasOwnMetadata(ye.POST_CONSTRUCT,W.constructor))throw new Error(Pe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ye.POST_CONSTRUCT,Be,W.constructor)}}ne.postConstruct=Oe},32052:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagged=void 0;var Pe=Q(47738),ye=Q(99934);function m(Oe,W){return function(pe,ce,Be){var _e=new Pe.Metadata(Oe,W);typeof Be=="number"?ye.tagParameter(pe,ce,Be,_e):ye.tagProperty(pe,ce,_e)}}ne.tagged=m},55638:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.targetName=void 0;var Pe=Q(6867),ye=Q(47738),m=Q(99934);function Oe(W){return function(pe,ce,Be){var _e=new ye.Metadata(Pe.NAME_TAG,W);m.tagParameter(pe,ce,Be,_e)}}ne.targetName=Oe},86757:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.unmanaged=void 0;var Pe=Q(6867),ye=Q(47738),m=Q(99934);function Oe(){return function(W,pe,ce){var Be=new ye.Metadata(Pe.UNMANAGED_TAG,!0);m.tagParameter(W,pe,ce,Be)}}ne.unmanaged=Oe},44290:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Binding=void 0;var Pe=Q(28421),ye=Q(37791),m=function(){function Oe(W,pe){this.id=ye.id(),this.activated=!1,this.serviceIdentifier=W,this.scope=pe,this.type=Pe.BindingTypeEnum.Invalid,this.constraint=function(ce){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Oe.prototype.clone=function(){var W=new Oe(this.serviceIdentifier,this.scope);return W.activated=W.scope===Pe.BindingScopeEnum.Singleton?this.activated:!1,W.implementationType=this.implementationType,W.dynamicValue=this.dynamicValue,W.scope=this.scope,W.type=this.type,W.factory=this.factory,W.provider=this.provider,W.constraint=this.constraint,W.onActivation=this.onActivation,W.cache=this.cache,W},Oe}();ne.Binding=m},23184:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingCount=void 0;var Q={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ne.BindingCount=Q},16674:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.STACK_OVERFLOW=ne.CIRCULAR_DEPENDENCY_IN_FACTORY=ne.POST_CONSTRUCT_ERROR=ne.MULTIPLE_POST_CONSTRUCT_METHODS=ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ne.ARGUMENTS_LENGTH_MISMATCH=ne.INVALID_DECORATOR_OPERATION=ne.INVALID_TO_SELF_VALUE=ne.INVALID_FUNCTION_BINDING=ne.INVALID_MIDDLEWARE_RETURN=ne.NO_MORE_SNAPSHOTS_AVAILABLE=ne.INVALID_BINDING_TYPE=ne.NOT_IMPLEMENTED=ne.CIRCULAR_DEPENDENCY=ne.UNDEFINED_INJECT_ANNOTATION=ne.MISSING_INJECT_ANNOTATION=ne.MISSING_INJECTABLE_ANNOTATION=ne.NOT_REGISTERED=ne.CANNOT_UNBIND=ne.AMBIGUOUS_MATCH=ne.KEY_NOT_FOUND=ne.NULL_ARGUMENT=ne.DUPLICATED_METADATA=ne.DUPLICATED_INJECTABLE_DECORATOR=void 0,ne.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ne.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ne.NULL_ARGUMENT="NULL argument",ne.KEY_NOT_FOUND="Key Not Found",ne.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ne.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ne.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ne.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ne.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Q=function(Oe){return"@inject called with undefined this could mean that the class "+Oe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ne.UNDEFINED_INJECT_ANNOTATION=Q,ne.CIRCULAR_DEPENDENCY="Circular dependency found:",ne.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ne.INVALID_BINDING_TYPE="Invalid binding type:",ne.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ne.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ne.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ne.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ne.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Pe=function(){for(var Oe=[],W=0;W<arguments.length;W++)Oe[W]=arguments[W];return"The number of constructor arguments in the derived class "+(Oe[0]+" must be >= than the number of constructor arguments of its base class.")};ne.ARGUMENTS_LENGTH_MISMATCH=Pe,ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ne.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ye=function(){for(var Oe=[],W=0;W<arguments.length;W++)Oe[W]=arguments[W];return"@postConstruct error in class "+Oe[0]+": "+Oe[1]};ne.POST_CONSTRUCT_ERROR=ye;var m=function(){for(var Oe=[],W=0;W<arguments.length;W++)Oe[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+Oe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Oe[1]+"'.")};ne.CIRCULAR_DEPENDENCY_IN_FACTORY=m,ne.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.TargetTypeEnum=ne.BindingTypeEnum=ne.BindingScopeEnum=void 0;var Q={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ne.BindingScopeEnum=Q;var Pe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ne.BindingTypeEnum=Pe;var ye={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ne.TargetTypeEnum=ye},6867:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.NON_CUSTOM_TAG_KEYS=ne.POST_CONSTRUCT=ne.DESIGN_PARAM_TYPES=ne.PARAM_TYPES=ne.TAGGED_PROP=ne.TAGGED=ne.MULTI_INJECT_TAG=ne.INJECT_TAG=ne.OPTIONAL_TAG=ne.UNMANAGED_TAG=ne.NAME_TAG=ne.NAMED_TAG=void 0,ne.NAMED_TAG="named",ne.NAME_TAG="name",ne.UNMANAGED_TAG="unmanaged",ne.OPTIONAL_TAG="optional",ne.INJECT_TAG="inject",ne.MULTI_INJECT_TAG="multi_inject",ne.TAGGED="inversify:tagged",ne.TAGGED_PROP="inversify:tagged_props",ne.PARAM_TYPES="inversify:paramtypes",ne.DESIGN_PARAM_TYPES="design:paramtypes",ne.POST_CONSTRUCT="post_construct";function Q(){return[ne.INJECT_TAG,ne.MULTI_INJECT_TAG,ne.NAME_TAG,ne.UNMANAGED_TAG,ne.NAMED_TAG,ne.OPTIONAL_TAG]}ne.NON_CUSTOM_TAG_KEYS=Q()},51389:function(Ar,ne,Q){"use strict";var Pe=this&&this.__awaiter||function(jt,ct,dt,ir){function Y(Wt){return Wt instanceof dt?Wt:new dt(function(ut){ut(Wt)})}return new(dt||(dt=Promise))(function(Wt,ut){function qe(Xt){try{Qe(ir.next(Xt))}catch(wr){ut(wr)}}function St(Xt){try{Qe(ir.throw(Xt))}catch(wr){ut(wr)}}function Qe(Xt){Xt.done?Wt(Xt.value):Y(Xt.value).then(qe,St)}Qe((ir=ir.apply(jt,ct||[])).next())})},ye=this&&this.__generator||function(jt,ct){var dt={label:0,sent:function(){if(Wt[0]&1)throw Wt[1];return Wt[1]},trys:[],ops:[]},ir,Y,Wt,ut;return ut={next:qe(0),throw:qe(1),return:qe(2)},typeof Symbol=="function"&&(ut[Symbol.iterator]=function(){return this}),ut;function qe(Qe){return function(Xt){return St([Qe,Xt])}}function St(Qe){if(ir)throw new TypeError("Generator is already executing.");for(;dt;)try{if(ir=1,Y&&(Wt=Qe[0]&2?Y.return:Qe[0]?Y.throw||((Wt=Y.return)&&Wt.call(Y),0):Y.next)&&!(Wt=Wt.call(Y,Qe[1])).done)return Wt;switch(Y=0,Wt&&(Qe=[Qe[0]&2,Wt.value]),Qe[0]){case 0:case 1:Wt=Qe;break;case 4:return dt.label++,{value:Qe[1],done:!1};case 5:dt.label++,Y=Qe[1],Qe=[0];continue;case 7:Qe=dt.ops.pop(),dt.trys.pop();continue;default:if(Wt=dt.trys,!(Wt=Wt.length>0&&Wt[Wt.length-1])&&(Qe[0]===6||Qe[0]===2)){dt=0;continue}if(Qe[0]===3&&(!Wt||Qe[1]>Wt[0]&&Qe[1]<Wt[3])){dt.label=Qe[1];break}if(Qe[0]===6&&dt.label<Wt[1]){dt.label=Wt[1],Wt=Qe;break}if(Wt&&dt.label<Wt[2]){dt.label=Wt[2],dt.ops.push(Qe);break}Wt[2]&&dt.ops.pop(),dt.trys.pop();continue}Qe=ct.call(jt,dt)}catch(Xt){Qe=[6,Xt],Y=0}finally{ir=Wt=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(jt,ct){for(var dt=0,ir=ct.length,Y=jt.length;dt<ir;dt++,Y++)jt[Y]=ct[dt];return jt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.Container=void 0;var Oe=Q(44290),W=Q(16674),pe=Q(28421),ce=Q(6867),Be=Q(51377),_e=Q(86311),tt=Q(31927),pt=Q(15451),Et=Q(37791),Jt=Q(55800),ur=Q(85700),kt=Q(80175),er=function(){function jt(ct){this._appliedMiddleware=[];var dt=ct||{};if(typeof dt!="object")throw new Error(""+W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=pe.BindingScopeEnum.Transient;else if(dt.defaultScope!==pe.BindingScopeEnum.Singleton&&dt.defaultScope!==pe.BindingScopeEnum.Transient&&dt.defaultScope!==pe.BindingScopeEnum.Request)throw new Error(""+W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=Et.id(),this._bindingDictionary=new kt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Be.MetadataReader}return jt.merge=function(ct,dt){for(var ir=[],Y=2;Y<arguments.length;Y++)ir[Y-2]=arguments[Y];var Wt=new jt,ut=m([ct,dt],ir).map(function(Qe){return _e.getBindingDictionary(Qe)}),qe=_e.getBindingDictionary(Wt);function St(Qe,Xt){Qe.traverse(function(wr,Gr){Gr.forEach(function(Qr){Xt.add(Qr.serviceIdentifier,Qr.clone())})})}return ut.forEach(function(Qe){St(Qe,qe)}),Wt},jt.prototype.load=function(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];for(var ir=this._getContainerModuleHelpersFactory(),Y=0,Wt=ct;Y<Wt.length;Y++){var ut=Wt[Y],qe=ir(ut.id);ut.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)}},jt.prototype.loadAsync=function(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];return Pe(this,void 0,void 0,function(){var ir,Y,Wt,ut,qe;return ye(this,function(St){switch(St.label){case 0:ir=this._getContainerModuleHelpersFactory(),Y=0,Wt=ct,St.label=1;case 1:return Y<Wt.length?(ut=Wt[Y],qe=ir(ut.id),[4,ut.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)]):[3,4];case 2:St.sent(),St.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},jt.prototype.unload=function(){for(var ct=this,dt=[],ir=0;ir<arguments.length;ir++)dt[ir]=arguments[ir];var Y=function(Wt){return function(ut){return ut.moduleId===Wt}};dt.forEach(function(Wt){var ut=Y(Wt.id);ct._bindingDictionary.removeByCondition(ut)})},jt.prototype.bind=function(ct){var dt=this.options.defaultScope||pe.BindingScopeEnum.Transient,ir=new Oe.Binding(ct,dt);return this._bindingDictionary.add(ct,ir),new pt.BindingToSyntax(ir)},jt.prototype.rebind=function(ct){return this.unbind(ct),this.bind(ct)},jt.prototype.unbind=function(ct){try{this._bindingDictionary.remove(ct)}catch(dt){throw new Error(W.CANNOT_UNBIND+" "+Jt.getServiceIdentifierAsString(ct))}},jt.prototype.unbindAll=function(){this._bindingDictionary=new kt.Lookup},jt.prototype.isBound=function(ct){var dt=this._bindingDictionary.hasKey(ct);return!dt&&this.parent&&(dt=this.parent.isBound(ct)),dt},jt.prototype.isBoundNamed=function(ct,dt){return this.isBoundTagged(ct,ce.NAMED_TAG,dt)},jt.prototype.isBoundTagged=function(ct,dt,ir){var Y=!1;if(this._bindingDictionary.hasKey(ct)){var Wt=this._bindingDictionary.get(ct),ut=_e.createMockRequest(this,ct,dt,ir);Y=Wt.some(function(qe){return qe.constraint(ut)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(ct,dt,ir)),Y},jt.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},jt.prototype.restore=function(){var ct=this._snapshots.pop();if(ct===void 0)throw new Error(W.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ct.bindings,this._middleware=ct.middleware},jt.prototype.createChild=function(ct){var dt=new jt(ct||this.options);return dt.parent=this,dt},jt.prototype.applyMiddleware=function(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(ct);var ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=ct.reduce(function(Y,Wt){return Wt(Y)},ir)},jt.prototype.applyCustomMetadataReader=function(ct){this._metadataReader=ct},jt.prototype.get=function(ct){return this._get(!1,!1,pe.TargetTypeEnum.Variable,ct)},jt.prototype.getTagged=function(ct,dt,ir){return this._get(!1,!1,pe.TargetTypeEnum.Variable,ct,dt,ir)},jt.prototype.getNamed=function(ct,dt){return this.getTagged(ct,ce.NAMED_TAG,dt)},jt.prototype.getAll=function(ct){return this._get(!0,!0,pe.TargetTypeEnum.Variable,ct)},jt.prototype.getAllTagged=function(ct,dt,ir){return this._get(!1,!0,pe.TargetTypeEnum.Variable,ct,dt,ir)},jt.prototype.getAllNamed=function(ct,dt){return this.getAllTagged(ct,ce.NAMED_TAG,dt)},jt.prototype.resolve=function(ct){var dt=this.createChild();return dt.bind(ct).toSelf(),this._appliedMiddleware.forEach(function(ir){dt.applyMiddleware(ir)}),dt.get(ct)},jt.prototype._getContainerModuleHelpersFactory=function(){var ct=this,dt=function(qe,St){qe._binding.moduleId=St},ir=function(qe){return function(St){var Qe=ct.bind.bind(ct),Xt=Qe(St);return dt(Xt,qe),Xt}},Y=function(qe){return function(St){var Qe=ct.unbind.bind(ct);Qe(St)}},Wt=function(qe){return function(St){var Qe=ct.isBound.bind(ct);return Qe(St)}},ut=function(qe){return function(St){var Qe=ct.rebind.bind(ct),Xt=Qe(St);return dt(Xt,qe),Xt}};return function(qe){return{bindFunction:ir(qe),isboundFunction:Wt(qe),rebindFunction:ut(qe),unbindFunction:Y(qe)}}},jt.prototype._get=function(ct,dt,ir,Y,Wt,ut){var qe=null,St={avoidConstraints:ct,contextInterceptor:function(Qe){return Qe},isMultiInject:dt,key:Wt,serviceIdentifier:Y,targetType:ir,value:ut};if(this._middleware){if(qe=this._middleware(St),qe==null)throw new Error(W.INVALID_MIDDLEWARE_RETURN)}else qe=this._planAndResolve()(St);return qe},jt.prototype._planAndResolve=function(){var ct=this;return function(dt){var ir=_e.plan(ct._metadataReader,ct,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);ir=dt.contextInterceptor(ir);var Y=tt.resolve(ir);return Y}},jt}();ne.Container=er},33244:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.AsyncContainerModule=ne.ContainerModule=void 0;var Pe=Q(37791),ye=function(){function Oe(W){this.id=Pe.id(),this.registry=W}return Oe}();ne.ContainerModule=ye;var m=function(){function Oe(W){this.id=Pe.id(),this.registry=W}return Oe}();ne.AsyncContainerModule=m},85700:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.ContainerSnapshot=void 0;var Q=function(){function Pe(){}return Pe.of=function(ye,m){var Oe=new Pe;return Oe.bindings=ye,Oe.middleware=m,Oe},Pe}();ne.ContainerSnapshot=Q},80175:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Lookup=void 0;var Pe=Q(16674),ye=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(Oe,W){if(Oe==null)throw new Error(Pe.NULL_ARGUMENT);if(W==null)throw new Error(Pe.NULL_ARGUMENT);var pe=this._map.get(Oe);pe!==void 0?(pe.push(W),this._map.set(Oe,pe)):this._map.set(Oe,[W])},m.prototype.get=function(Oe){if(Oe==null)throw new Error(Pe.NULL_ARGUMENT);var W=this._map.get(Oe);if(W!==void 0)return W;throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.remove=function(Oe){if(Oe==null)throw new Error(Pe.NULL_ARGUMENT);if(!this._map.delete(Oe))throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(Oe){var W=this;this._map.forEach(function(pe,ce){var Be=pe.filter(function(_e){return!Oe(_e)});Be.length>0?W._map.set(ce,Be):W._map.delete(ce)})},m.prototype.hasKey=function(Oe){if(Oe==null)throw new Error(Pe.NULL_ARGUMENT);return this._map.has(Oe)},m.prototype.clone=function(){var Oe=new m;return this._map.forEach(function(W,pe){W.forEach(function(ce){return Oe.add(pe,ce.clone())})}),Oe},m.prototype.traverse=function(Oe){this._map.forEach(function(W,pe){Oe(pe,W)})},m}();ne.Lookup=ye},86700:function(Ar,ne,Q){"use strict";var Pe;Pe={value:!0},Pe=Pe=Pe=Pe=Pe=Pe=ne.GW=Pe=Pe=ne.zY=Pe=Pe=Pe=Pe=Pe=ne.f3=Pe=Pe=ne.b2=Pe=Pe=Pe=Pe=Pe=ne.W2=Pe=void 0;var ye=Q(6867);Pe=ye;var m=Q(51389);Object.defineProperty(ne,"W2",{enumerable:!0,get:function(){return m.Container}});var Oe=Q(28421);Pe={enumerable:!0,get:function(){return Oe.BindingScopeEnum}},Pe={enumerable:!0,get:function(){return Oe.BindingTypeEnum}},Pe={enumerable:!0,get:function(){return Oe.TargetTypeEnum}};var W=Q(33244);Pe={enumerable:!0,get:function(){return W.AsyncContainerModule}},Pe={enumerable:!0,get:function(){return W.ContainerModule}};var pe=Q(64315);Object.defineProperty(ne,"b2",{enumerable:!0,get:function(){return pe.injectable}});var ce=Q(32052);Pe={enumerable:!0,get:function(){return ce.tagged}};var Be=Q(38085);Pe={enumerable:!0,get:function(){return Be.named}};var _e=Q(5744);Object.defineProperty(ne,"f3",{enumerable:!0,get:function(){return _e.inject}}),Pe={enumerable:!0,get:function(){return _e.LazyServiceIdentifer}};var tt=Q(6515);Pe={enumerable:!0,get:function(){return tt.optional}};var pt=Q(86757);Pe={enumerable:!0,get:function(){return pt.unmanaged}};var Et=Q(71693);Pe={enumerable:!0,get:function(){return Et.multiInject}};var Jt=Q(55638);Pe={enumerable:!0,get:function(){return Jt.targetName}};var ur=Q(7014);Object.defineProperty(ne,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var kt=Q(51377);Pe={enumerable:!0,get:function(){return kt.MetadataReader}};var er=Q(37791);Pe={enumerable:!0,get:function(){return er.id}};var jt=Q(99934);Object.defineProperty(ne,"GW",{enumerable:!0,get:function(){return jt.decorate}});var ct=Q(80758);Pe={enumerable:!0,get:function(){return ct.traverseAncerstors}},Pe={enumerable:!0,get:function(){return ct.taggedConstraint}},Pe={enumerable:!0,get:function(){return ct.namedConstraint}},Pe={enumerable:!0,get:function(){return ct.typeConstraint}};var dt=Q(55800);Pe={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var ir=Q(70600);Pe={enumerable:!0,get:function(){return ir.multiBindToService}}},95228:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Context=void 0;var Pe=Q(37791),ye=function(){function m(Oe){this.id=Pe.id(),this.container=Oe}return m.prototype.addPlan=function(Oe){this.plan=Oe},m.prototype.setCurrentRequest=function(Oe){this.currentRequest=Oe},m}();ne.Context=ye},47738:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Metadata=void 0;var Pe=Q(6867),ye=function(){function m(Oe,W){this.key=Oe,this.value=W}return m.prototype.toString=function(){return this.key===Pe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();ne.Metadata=ye},51377:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.MetadataReader=void 0;var Pe=Q(6867),ye=function(){function m(){}return m.prototype.getConstructorMetadata=function(Oe){var W=Reflect.getMetadata(Pe.PARAM_TYPES,Oe),pe=Reflect.getMetadata(Pe.TAGGED,Oe);return{compilerGeneratedMetadata:W,userGeneratedMetadata:pe||{}}},m.prototype.getPropertiesMetadata=function(Oe){var W=Reflect.getMetadata(Pe.TAGGED_PROP,Oe)||[];return W},m}();ne.MetadataReader=ye},55314:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Plan=void 0;var Q=function(){function Pe(ye,m){this.parentContext=ye,this.rootRequest=m}return Pe}();ne.Plan=Q},86311:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.getBindingDictionary=ne.createMockRequest=ne.plan=void 0;var Pe=Q(23184),ye=Q(16674),m=Q(28421),Oe=Q(6867),W=Q(85265),pe=Q(55800),ce=Q(95228),Be=Q(47738),_e=Q(55314),tt=Q(6e3),pt=Q(6748),Et=Q(18924);function Jt(Y){return Y._bindingDictionary}ne.getBindingDictionary=Jt;function ur(Y,Wt,ut,qe,St,Qe){var Xt=Y?Oe.MULTI_INJECT_TAG:Oe.INJECT_TAG,wr=new Be.Metadata(Xt,ut),Gr=new Et.Target(Wt,qe,ut,wr);if(St!==void 0){var Qr=new Be.Metadata(St,Qe);Gr.metadata.push(Qr)}return Gr}function kt(Y,Wt,ut,qe,St){var Qe=ct(ut.container,St.serviceIdentifier),Xt=[];return Qe.length===Pe.BindingCount.NoBindingsAvailable&&ut.container.options.autoBindInjectable&&typeof St.serviceIdentifier=="function"&&Y.getConstructorMetadata(St.serviceIdentifier).compilerGeneratedMetadata&&(ut.container.bind(St.serviceIdentifier).toSelf(),Qe=ct(ut.container,St.serviceIdentifier)),Wt?Xt=Qe:Xt=Qe.filter(function(wr){var Gr=new pt.Request(wr.serviceIdentifier,ut,qe,wr,St);return wr.constraint(Gr)}),er(St.serviceIdentifier,Xt,St,ut.container),Xt}function er(Y,Wt,ut,qe){switch(Wt.length){case Pe.BindingCount.NoBindingsAvailable:if(ut.isOptional())return Wt;var St=pe.getServiceIdentifierAsString(Y),Qe=ye.NOT_REGISTERED;throw Qe+=pe.listMetadataForTarget(St,ut),Qe+=pe.listRegisteredBindingsForServiceIdentifier(qe,St,ct),new Error(Qe);case Pe.BindingCount.OnlyOneBindingAvailable:if(!ut.isArray())return Wt;case Pe.BindingCount.MultipleBindingsAvailable:default:if(ut.isArray())return Wt;var St=pe.getServiceIdentifierAsString(Y),Qe=ye.AMBIGUOUS_MATCH+" "+St;throw Qe+=pe.listRegisteredBindingsForServiceIdentifier(qe,St,ct),new Error(Qe)}}function jt(Y,Wt,ut,qe,St,Qe){var Xt,wr;if(St===null){Xt=kt(Y,Wt,qe,null,Qe),wr=new pt.Request(ut,qe,null,Xt,Qe);var Gr=new _e.Plan(qe,wr);qe.addPlan(Gr)}else Xt=kt(Y,Wt,qe,St,Qe),wr=St.addChildRequest(Qe.serviceIdentifier,Xt,Qe);Xt.forEach(function(Qr){var A=null;if(Qe.isArray())A=wr.addChildRequest(Qr.serviceIdentifier,Qr,Qe);else{if(Qr.cache)return;A=wr}if(Qr.type===m.BindingTypeEnum.Instance&&Qr.implementationType!==null){var Ce=tt.getDependencies(Y,Qr.implementationType);if(!qe.container.options.skipBaseClassChecks){var ke=tt.getBaseClassDependencyCount(Y,Qr.implementationType);if(Ce.length<ke){var xt=ye.ARGUMENTS_LENGTH_MISMATCH(tt.getFunctionName(Qr.implementationType));throw new Error(xt)}}Ce.forEach(function(ht){jt(Y,!1,ht.serviceIdentifier,qe,A,ht)})}})}function ct(Y,Wt){var ut=[],qe=Jt(Y);return qe.hasKey(Wt)?ut=qe.get(Wt):Y.parent!==null&&(ut=ct(Y.parent,Wt)),ut}function dt(Y,Wt,ut,qe,St,Qe,Xt,wr){wr===void 0&&(wr=!1);var Gr=new ce.Context(Wt),Qr=ur(ut,qe,St,"",Qe,Xt);try{return jt(Y,wr,St,Gr,null,Qr),Gr}catch(A){throw W.isStackOverflowExeption(A)&&Gr.plan&&pe.circularDependencyToException(Gr.plan.rootRequest),A}}ne.plan=dt;function ir(Y,Wt,ut,qe){var St=new Et.Target(m.TargetTypeEnum.Variable,"",Wt,new Be.Metadata(ut,qe)),Qe=new ce.Context(Y),Xt=new pt.Request(Wt,Qe,null,[],St);return Xt}ne.createMockRequest=ir},88460:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.QueryableString=void 0;var Q=function(){function Pe(ye){this.str=ye}return Pe.prototype.startsWith=function(ye){return this.str.indexOf(ye)===0},Pe.prototype.endsWith=function(ye){var m="",Oe=ye.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},Oe)},Pe.prototype.contains=function(ye){return this.str.indexOf(ye)!==-1},Pe.prototype.equals=function(ye){return this.str===ye},Pe.prototype.value=function(){return this.str},Pe}();ne.QueryableString=Q},6e3:function(Ar,ne,Q){"use strict";var Pe=this&&this.__spreadArray||function(kt,er){for(var jt=0,ct=er.length,dt=kt.length;jt<ct;jt++,dt++)kt[dt]=er[jt];return kt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.getFunctionName=ne.getBaseClassDependencyCount=ne.getDependencies=void 0;var ye=Q(5744),m=Q(16674),Oe=Q(28421),W=Q(6867),pe=Q(55800);Object.defineProperty(ne,"getFunctionName",{enumerable:!0,get:function(){return pe.getFunctionName}});var ce=Q(18924);function Be(kt,er){var jt=pe.getFunctionName(er),ct=_e(kt,jt,er,!1);return ct}ne.getDependencies=Be;function _e(kt,er,jt,ct){var dt=kt.getConstructorMetadata(jt),ir=dt.compilerGeneratedMetadata;if(ir===void 0){var Y=m.MISSING_INJECTABLE_ANNOTATION+" "+er+".";throw new Error(Y)}var Wt=dt.userGeneratedMetadata,ut=Object.keys(Wt),qe=jt.length===0&&ut.length>0,St=ut.length>jt.length,Qe=qe||St?ut.length:jt.length,Xt=pt(ct,er,ir,Wt,Qe),wr=Et(kt,jt),Gr=Pe(Pe([],Xt),wr);return Gr}function tt(kt,er,jt,ct,dt){var ir=dt[kt.toString()]||[],Y=ur(ir),Wt=Y.unmanaged!==!0,ut=ct[kt],qe=Y.inject||Y.multiInject;if(ut=qe||ut,ut instanceof ye.LazyServiceIdentifer&&(ut=ut.unwrap()),Wt){var St=ut===Object,Qe=ut===Function,Xt=ut===void 0,wr=St||Qe||Xt;if(!er&&wr){var Gr=m.MISSING_INJECT_ANNOTATION+" argument "+kt+" in class "+jt+".";throw new Error(Gr)}var Qr=new ce.Target(Oe.TargetTypeEnum.ConstructorArgument,Y.targetName,ut);return Qr.metadata=ir,Qr}return null}function pt(kt,er,jt,ct,dt){for(var ir=[],Y=0;Y<dt;Y++){var Wt=Y,ut=tt(Wt,kt,er,jt,ct);ut!==null&&ir.push(ut)}return ir}function Et(kt,er){for(var jt=kt.getPropertiesMetadata(er),ct=[],dt=Object.keys(jt),ir=0,Y=dt;ir<Y.length;ir++){var Wt=Y[ir],ut=jt[Wt],qe=ur(jt[Wt]),St=qe.targetName||Wt,Qe=qe.inject||qe.multiInject,Xt=new ce.Target(Oe.TargetTypeEnum.ClassProperty,St,Qe);Xt.metadata=ut,ct.push(Xt)}var wr=Object.getPrototypeOf(er.prototype).constructor;if(wr!==Object){var Gr=Et(kt,wr);ct=Pe(Pe([],ct),Gr)}return ct}function Jt(kt,er){var jt=Object.getPrototypeOf(er.prototype).constructor;if(jt!==Object){var ct=pe.getFunctionName(jt),dt=_e(kt,ct,jt,!0),ir=dt.map(function(ut){return ut.metadata.filter(function(qe){return qe.key===W.UNMANAGED_TAG})}),Y=[].concat.apply([],ir).length,Wt=dt.length-Y;return Wt>0?Wt:Jt(kt,jt)}else return 0}ne.getBaseClassDependencyCount=Jt;function ur(kt){var er={};return kt.forEach(function(jt){er[jt.key.toString()]=jt.value}),{inject:er[W.INJECT_TAG],multiInject:er[W.MULTI_INJECT_TAG],targetName:er[W.NAME_TAG],unmanaged:er[W.UNMANAGED_TAG]}}},6748:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Request=void 0;var Pe=Q(37791),ye=function(){function m(Oe,W,pe,ce,Be){this.id=Pe.id(),this.serviceIdentifier=Oe,this.parentContext=W,this.parentRequest=pe,this.target=Be,this.childRequests=[],this.bindings=Array.isArray(ce)?ce:[ce],this.requestScope=pe===null?new Map:null}return m.prototype.addChildRequest=function(Oe,W,pe){var ce=new m(Oe,this.parentContext,this,W,pe);return this.childRequests.push(ce),ce},m}();ne.Request=ye},18924:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Target=void 0;var Pe=Q(6867),ye=Q(37791),m=Q(47738),Oe=Q(88460),W=function(){function pe(ce,Be,_e,tt){this.id=ye.id(),this.type=ce,this.serviceIdentifier=_e,this.name=new Oe.QueryableString(Be||""),this.metadata=new Array;var pt=null;typeof tt=="string"?pt=new m.Metadata(Pe.NAMED_TAG,tt):tt instanceof m.Metadata&&(pt=tt),pt!==null&&this.metadata.push(pt)}return pe.prototype.hasTag=function(ce){for(var Be=0,_e=this.metadata;Be<_e.length;Be++){var tt=_e[Be];if(tt.key===ce)return!0}return!1},pe.prototype.isArray=function(){return this.hasTag(Pe.MULTI_INJECT_TAG)},pe.prototype.matchesArray=function(ce){return this.matchesTag(Pe.MULTI_INJECT_TAG)(ce)},pe.prototype.isNamed=function(){return this.hasTag(Pe.NAMED_TAG)},pe.prototype.isTagged=function(){return this.metadata.some(function(ce){return Pe.NON_CUSTOM_TAG_KEYS.every(function(Be){return ce.key!==Be})})},pe.prototype.isOptional=function(){return this.matchesTag(Pe.OPTIONAL_TAG)(!0)},pe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ce){return ce.key===Pe.NAMED_TAG})[0]:null},pe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ce){return Pe.NON_CUSTOM_TAG_KEYS.every(function(Be){return ce.key!==Be})}):null},pe.prototype.matchesNamedTag=function(ce){return this.matchesTag(Pe.NAMED_TAG)(ce)},pe.prototype.matchesTag=function(ce){var Be=this;return function(_e){for(var tt=0,pt=Be.metadata;tt<pt.length;tt++){var Et=pt[tt];if(Et.key===ce&&Et.value===_e)return!0}return!1}},pe}();ne.Target=W},52279:function(Ar,ne,Q){"use strict";var Pe=this&&this.__spreadArray||function(_e,tt){for(var pt=0,Et=tt.length,Jt=_e.length;pt<Et;pt++,Jt++)_e[Jt]=tt[pt];return _e};Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolveInstance=void 0;var ye=Q(16674),m=Q(28421),Oe=Q(6867);function W(_e,tt,pt){var Et=tt.filter(function(ur){return ur.target!==null&&ur.target.type===m.TargetTypeEnum.ClassProperty}),Jt=Et.map(pt);return Et.forEach(function(ur,kt){var er="";er=ur.target.name.value();var jt=Jt[kt];_e[er]=jt}),_e}function pe(_e,tt){return new(_e.bind.apply(_e,Pe([void 0],tt)))}function ce(_e,tt){if(Reflect.hasMetadata(Oe.POST_CONSTRUCT,_e)){var pt=Reflect.getMetadata(Oe.POST_CONSTRUCT,_e);try{tt[pt.value]()}catch(Et){throw new Error(ye.POST_CONSTRUCT_ERROR(_e.name,Et.message))}}}function Be(_e,tt,pt){var Et=null;if(tt.length>0){var Jt=tt.filter(function(kt){return kt.target!==null&&kt.target.type===m.TargetTypeEnum.ConstructorArgument}),ur=Jt.map(pt);Et=pe(_e,ur),Et=W(Et,tt,pt)}else Et=new _e;return ce(_e,Et),Et}ne.resolveInstance=Be},31927:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolve=void 0;var Pe=Q(16674),ye=Q(28421),m=Q(85265),Oe=Q(55800),W=Q(52279),pe=function(_e,tt,pt){try{return pt()}catch(Et){throw m.isStackOverflowExeption(Et)?new Error(Pe.CIRCULAR_DEPENDENCY_IN_FACTORY(_e,tt.toString())):Et}},ce=function(_e){return function(tt){tt.parentContext.setCurrentRequest(tt);var pt=tt.bindings,Et=tt.childRequests,Jt=tt.target&&tt.target.isArray(),ur=!tt.parentRequest||!tt.parentRequest.target||!tt.target||!tt.parentRequest.target.matchesArray(tt.target.serviceIdentifier);if(Jt&&ur)return Et.map(function(ir){var Y=ce(_e);return Y(ir)});var kt=null;if(tt.target.isOptional()&&pt.length===0)return;var er=pt[0],jt=er.scope===ye.BindingScopeEnum.Singleton,ct=er.scope===ye.BindingScopeEnum.Request;if(jt&&er.activated)return er.cache;if(ct&&_e!==null&&_e.has(er.id))return _e.get(er.id);if(er.type===ye.BindingTypeEnum.ConstantValue)kt=er.cache,er.activated=!0;else if(er.type===ye.BindingTypeEnum.Function)kt=er.cache,er.activated=!0;else if(er.type===ye.BindingTypeEnum.Constructor)kt=er.implementationType;else if(er.type===ye.BindingTypeEnum.DynamicValue&&er.dynamicValue!==null)kt=pe("toDynamicValue",er.serviceIdentifier,function(){return er.dynamicValue(tt.parentContext)});else if(er.type===ye.BindingTypeEnum.Factory&&er.factory!==null)kt=pe("toFactory",er.serviceIdentifier,function(){return er.factory(tt.parentContext)});else if(er.type===ye.BindingTypeEnum.Provider&&er.provider!==null)kt=pe("toProvider",er.serviceIdentifier,function(){return er.provider(tt.parentContext)});else if(er.type===ye.BindingTypeEnum.Instance&&er.implementationType!==null)kt=W.resolveInstance(er.implementationType,Et,ce(_e));else{var dt=Oe.getServiceIdentifierAsString(tt.serviceIdentifier);throw new Error(Pe.INVALID_BINDING_TYPE+" "+dt)}return typeof er.onActivation=="function"&&(kt=er.onActivation(tt.parentContext,kt)),jt&&(er.cache=kt,er.activated=!0),ct&&_e!==null&&!_e.has(er.id)&&_e.set(er.id,kt),kt}};function Be(_e){var tt=ce(_e.plan.rootRequest.requestScope);return tt(_e.plan.rootRequest)}ne.resolve=Be},83366:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInSyntax=void 0;var Pe=Q(28421),ye=Q(71325),m=function(){function Oe(W){this._binding=W}return Oe.prototype.inRequestScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Request,new ye.BindingWhenOnSyntax(this._binding)},Oe.prototype.inSingletonScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},Oe.prototype.inTransientScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Transient,new ye.BindingWhenOnSyntax(this._binding)},Oe}();ne.BindingInSyntax=m},74889:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInWhenOnSyntax=void 0;var Pe=Q(83366),ye=Q(51811),m=Q(98370),Oe=function(){function W(pe){this._binding=pe,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding),this._bindingInSyntax=new Pe.BindingInSyntax(pe)}return W.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},W.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},W.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},W.prototype.when=function(pe){return this._bindingWhenSyntax.when(pe)},W.prototype.whenTargetNamed=function(pe){return this._bindingWhenSyntax.whenTargetNamed(pe)},W.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},W.prototype.whenTargetTagged=function(pe,ce){return this._bindingWhenSyntax.whenTargetTagged(pe,ce)},W.prototype.whenInjectedInto=function(pe){return this._bindingWhenSyntax.whenInjectedInto(pe)},W.prototype.whenParentNamed=function(pe){return this._bindingWhenSyntax.whenParentNamed(pe)},W.prototype.whenParentTagged=function(pe,ce){return this._bindingWhenSyntax.whenParentTagged(pe,ce)},W.prototype.whenAnyAncestorIs=function(pe){return this._bindingWhenSyntax.whenAnyAncestorIs(pe)},W.prototype.whenNoAncestorIs=function(pe){return this._bindingWhenSyntax.whenNoAncestorIs(pe)},W.prototype.whenAnyAncestorNamed=function(pe){return this._bindingWhenSyntax.whenAnyAncestorNamed(pe)},W.prototype.whenAnyAncestorTagged=function(pe,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(pe,ce)},W.prototype.whenNoAncestorNamed=function(pe){return this._bindingWhenSyntax.whenNoAncestorNamed(pe)},W.prototype.whenNoAncestorTagged=function(pe,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(pe,ce)},W.prototype.whenAnyAncestorMatches=function(pe){return this._bindingWhenSyntax.whenAnyAncestorMatches(pe)},W.prototype.whenNoAncestorMatches=function(pe){return this._bindingWhenSyntax.whenNoAncestorMatches(pe)},W.prototype.onActivation=function(pe){return this._bindingOnSyntax.onActivation(pe)},W}();ne.BindingInWhenOnSyntax=Oe},51811:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingOnSyntax=void 0;var Pe=Q(98370),ye=function(){function m(Oe){this._binding=Oe}return m.prototype.onActivation=function(Oe){return this._binding.onActivation=Oe,new Pe.BindingWhenSyntax(this._binding)},m}();ne.BindingOnSyntax=ye},15451:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingToSyntax=void 0;var Pe=Q(16674),ye=Q(28421),m=Q(74889),Oe=Q(71325),W=function(){function pe(ce){this._binding=ce}return pe.prototype.to=function(ce){return this._binding.type=ye.BindingTypeEnum.Instance,this._binding.implementationType=ce,new m.BindingInWhenOnSyntax(this._binding)},pe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Pe.INVALID_TO_SELF_VALUE);var ce=this._binding.serviceIdentifier;return this.to(ce)},pe.prototype.toConstantValue=function(ce){return this._binding.type=ye.BindingTypeEnum.ConstantValue,this._binding.cache=ce,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ye.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},pe.prototype.toDynamicValue=function(ce){return this._binding.type=ye.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ce,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},pe.prototype.toConstructor=function(ce){return this._binding.type=ye.BindingTypeEnum.Constructor,this._binding.implementationType=ce,this._binding.scope=ye.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},pe.prototype.toFactory=function(ce){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=ce,this._binding.scope=ye.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},pe.prototype.toFunction=function(ce){if(typeof ce!="function")throw new Error(Pe.INVALID_FUNCTION_BINDING);var Be=this.toConstantValue(ce);return this._binding.type=ye.BindingTypeEnum.Function,this._binding.scope=ye.BindingScopeEnum.Singleton,Be},pe.prototype.toAutoFactory=function(ce){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=function(Be){var _e=function(){return Be.container.get(ce)};return _e},this._binding.scope=ye.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},pe.prototype.toProvider=function(ce){return this._binding.type=ye.BindingTypeEnum.Provider,this._binding.provider=ce,this._binding.scope=ye.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},pe.prototype.toService=function(ce){this.toDynamicValue(function(Be){return Be.container.get(ce)})},pe}();ne.BindingToSyntax=W},71325:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenOnSyntax=void 0;var Pe=Q(51811),ye=Q(98370),m=function(){function Oe(W){this._binding=W,this._bindingWhenSyntax=new ye.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Pe.BindingOnSyntax(this._binding)}return Oe.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Oe.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Oe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Oe.prototype.whenTargetTagged=function(W,pe){return this._bindingWhenSyntax.whenTargetTagged(W,pe)},Oe.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Oe.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Oe.prototype.whenParentTagged=function(W,pe){return this._bindingWhenSyntax.whenParentTagged(W,pe)},Oe.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Oe.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Oe.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Oe.prototype.whenAnyAncestorTagged=function(W,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,pe)},Oe.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Oe.prototype.whenNoAncestorTagged=function(W,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(W,pe)},Oe.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Oe.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Oe.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Oe}();ne.BindingWhenOnSyntax=m},98370:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenSyntax=void 0;var Pe=Q(51811),ye=Q(80758),m=function(){function Oe(W){this._binding=W}return Oe.prototype.when=function(W){return this._binding.constraint=W,new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenTargetNamed=function(W){return this._binding.constraint=ye.namedConstraint(W),new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(W){var pe=W.target!==null&&!W.target.isNamed()&&!W.target.isTagged();return pe},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenTargetTagged=function(W,pe){return this._binding.constraint=ye.taggedConstraint(W)(pe),new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenInjectedInto=function(W){return this._binding.constraint=function(pe){return ye.typeConstraint(W)(pe.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenParentNamed=function(W){return this._binding.constraint=function(pe){return ye.namedConstraint(W)(pe.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenParentTagged=function(W,pe){return this._binding.constraint=function(ce){return ye.taggedConstraint(W)(pe)(ce.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorIs=function(W){return this._binding.constraint=function(pe){return ye.traverseAncerstors(pe,ye.typeConstraint(W))},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorIs=function(W){return this._binding.constraint=function(pe){return!ye.traverseAncerstors(pe,ye.typeConstraint(W))},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorNamed=function(W){return this._binding.constraint=function(pe){return ye.traverseAncerstors(pe,ye.namedConstraint(W))},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorNamed=function(W){return this._binding.constraint=function(pe){return!ye.traverseAncerstors(pe,ye.namedConstraint(W))},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorTagged=function(W,pe){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.taggedConstraint(W)(pe))},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorTagged=function(W,pe){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.taggedConstraint(W)(pe))},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorMatches=function(W){return this._binding.constraint=function(pe){return ye.traverseAncerstors(pe,W)},new Pe.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorMatches=function(W){return this._binding.constraint=function(pe){return!ye.traverseAncerstors(pe,W)},new Pe.BindingOnSyntax(this._binding)},Oe}();ne.BindingWhenSyntax=m},80758:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.typeConstraint=ne.namedConstraint=ne.taggedConstraint=ne.traverseAncerstors=void 0;var Pe=Q(6867),ye=Q(47738),m=function(ce,Be){var _e=ce.parentRequest;return _e!==null?Be(_e)?!0:m(_e,Be):!1};ne.traverseAncerstors=m;var Oe=function(ce){return function(Be){var _e=function(tt){return tt!==null&&tt.target!==null&&tt.target.matchesTag(ce)(Be)};return _e.metaData=new ye.Metadata(ce,Be),_e}};ne.taggedConstraint=Oe;var W=Oe(Pe.NAMED_TAG);ne.namedConstraint=W;var pe=function(ce){return function(Be){var _e=null;if(Be!==null)if(_e=Be.bindings[0],typeof ce=="string"){var tt=_e.serviceIdentifier;return tt===ce}else{var pt=Be.bindings[0].implementationType;return ce===pt}return!1}};ne.typeConstraint=pe},70600:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiBindToService=void 0;var Q=function(Pe){return function(ye){return function(){for(var m=[],Oe=0;Oe<arguments.length;Oe++)m[Oe]=arguments[Oe];return m.forEach(function(W){return Pe.bind(W).toService(ye)})}}};ne.multiBindToService=Q},85265:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.isStackOverflowExeption=void 0;var Pe=Q(16674);function ye(m){return m instanceof RangeError||m.message===Pe.STACK_OVERFLOW}ne.isStackOverflowExeption=ye},37791:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.id=void 0;var Q=0;function Pe(){return Q++}ne.id=Pe},55800:function(Ar,ne,Q){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.circularDependencyToException=ne.listMetadataForTarget=ne.listRegisteredBindingsForServiceIdentifier=ne.getServiceIdentifierAsString=ne.getFunctionName=void 0;var Pe=Q(16674);function ye(_e){if(typeof _e=="function"){var tt=_e;return tt.name}else{if(typeof _e=="symbol")return _e.toString();var tt=_e;return tt}}ne.getServiceIdentifierAsString=ye;function m(_e,tt,pt){var Et="",Jt=pt(_e,tt);return Jt.length!==0&&(Et=`
Registered bindings:`,Jt.forEach(function(ur){var kt="Object";ur.implementationType!==null&&(kt=Be(ur.implementationType)),Et=Et+`
 `+kt,ur.constraint.metaData&&(Et=Et+" - "+ur.constraint.metaData)})),Et}ne.listRegisteredBindingsForServiceIdentifier=m;function Oe(_e,tt){return _e.parentRequest===null?!1:_e.parentRequest.serviceIdentifier===tt?!0:Oe(_e.parentRequest,tt)}function W(_e){function tt(Et,Jt){Jt===void 0&&(Jt=[]);var ur=ye(Et.serviceIdentifier);return Jt.push(ur),Et.parentRequest!==null?tt(Et.parentRequest,Jt):Jt}var pt=tt(_e);return pt.reverse().join(" --> ")}function pe(_e){_e.childRequests.forEach(function(tt){if(Oe(tt,tt.serviceIdentifier)){var pt=W(tt);throw new Error(Pe.CIRCULAR_DEPENDENCY+" "+pt)}else pe(tt)})}ne.circularDependencyToException=pe;function ce(_e,tt){if(tt.isTagged()||tt.isNamed()){var pt="",Et=tt.getNamedTag(),Jt=tt.getCustomTags();return Et!==null&&(pt+=Et.toString()+`
`),Jt!==null&&Jt.forEach(function(ur){pt+=ur.toString()+`
`})," "+_e+`
 `+_e+" - "+pt}else return" "+_e}ne.listMetadataForTarget=ce;function Be(_e){if(_e.name)return _e.name;var tt=_e.toString(),pt=tt.match(/^function\s*([^\s(]+)/);return pt?pt[1]:"Anonymous function: "+tt}ne.getFunctionName=Be},31745:function(Ar){"use strict";Ar.exports=Q,Ar.exports.default=Q;var ne=1e20;function Q(W,pe,ce,Be,_e,tt){this.fontSize=W||24,this.buffer=pe===void 0?3:pe,this.cutoff=Be||.25,this.fontFamily=_e||"sans-serif",this.fontWeight=tt||"normal",this.radius=ce||8;var pt=this.size=this.fontSize+this.buffer*2,Et=pt+this.buffer*2,Jt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Jt?this.canvas=my.createOffscreenCanvas(pt,pt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=pt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Et*Et),this.gridInner=new Float64Array(Et*Et),this.f=new Float64Array(Et),this.z=new Float64Array(Et+1),this.v=new Uint16Array(Et),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Jt?this.middle=Math.round(pt/2*1):this.middle=Math.round(pt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pe(W,pe,ce,Be,_e,tt,pt){tt.fill(ne,0,pe*ce),pt.fill(0,0,pe*ce);for(var Et=(pe-Be)/2,Jt=0;Jt<_e;Jt++)for(var ur=0;ur<Be;ur++){var kt=(Jt+Et)*pe+ur+Et,er=W.data[4*(Jt*Be+ur)+3]/255;if(er===1)tt[kt]=0,pt[kt]=ne;else if(er===0)tt[kt]=ne,pt[kt]=0;else{var jt=Math.max(0,.5-er),ct=Math.max(0,er-.5);tt[kt]=jt*jt,pt[kt]=ct*ct}}}function ye(W,pe,ce,Be,_e,tt,pt){for(var Et=0;Et<pe*ce;Et++){var Jt=Math.sqrt(Be[Et])-Math.sqrt(_e[Et]);W[Et]=Math.round(255-255*(Jt/tt+pt))}}Q.prototype._draw=function(W,pe){var ce=this.ctx.measureText(W),Be=ce.width,_e=2*this.buffer,tt,pt,Et,Jt,ur,kt,er,jt;pe&&this.useMetrics?(ur=Math.floor(ce.actualBoundingBoxAscent),jt=this.buffer+Math.ceil(ce.actualBoundingBoxAscent),kt=this.buffer,er=this.buffer,pt=Math.min(this.size,Math.ceil(ce.actualBoundingBoxRight-ce.actualBoundingBoxLeft)),Jt=Math.min(this.size-kt,Math.ceil(ce.actualBoundingBoxAscent+ce.actualBoundingBoxDescent)),tt=pt+_e,Et=Jt+_e,this.ctx.textBaseline="alphabetic"):(tt=pt=this.size,Et=Jt=this.size,ur=19*this.fontSize/24,kt=er=0,jt=this.middle,this.ctx.textBaseline="middle");var ct;pt&&Jt&&(this.ctx.clearRect(er,kt,pt,Jt),this.ctx.fillText(W,this.buffer,jt),ct=this.ctx.getImageData(er,kt,pt,Jt));var dt=new Uint8ClampedArray(tt*Et);return Pe(ct,tt,Et,pt,Jt,this.gridOuter,this.gridInner),m(this.gridOuter,tt,Et,this.f,this.v,this.z),m(this.gridInner,tt,Et,this.f,this.v,this.z),ye(dt,tt,Et,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:pt,height:Jt,sdfWidth:tt,sdfHeight:Et,top:ur,left:0,advance:Be}}},Q.prototype.draw=function(W){return this._draw(W,!1).data},Q.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function m(W,pe,ce,Be,_e,tt){for(var pt=0;pt<pe;pt++)Oe(W,pt,pe,ce,Be,_e,tt);for(var Et=0;Et<ce;Et++)Oe(W,Et*pe,1,pe,Be,_e,tt)}function Oe(W,pe,ce,Be,_e,tt,pt){var Et,Jt,ur,kt;for(tt[0]=0,pt[0]=-ne,pt[1]=ne,Et=0;Et<Be;Et++)_e[Et]=W[pe+Et*ce];for(Et=1,Jt=0,ur=0;Et<Be;Et++){do kt=tt[Jt],ur=(_e[Et]-_e[kt]+Et*Et-kt*kt)/(Et-kt)/2;while(ur<=pt[Jt]&&--Jt>-1);Jt++,tt[Jt]=Et,pt[Jt]=ur,pt[Jt+1]=ne}for(Et=0,Jt=0;Et<Be;Et++){for(;pt[Jt+1]<Et;)Jt++;kt=tt[Jt],W[pe+Et*ce]=_e[kt]+(Et-kt)*(Et-kt)}}},18857:function(Ar,ne,Q){"use strict";Q.r(ne),Q.d(ne,{Function:function(){return js},Interpreter:function(){return ya},default:function(){return ul},evaluate:function(){return Hu},vm:function(){return Pe}});var Pe={};Q.r(Pe),Q.d(Pe,{Script:function(){return ec},compileFunction:function(){return nf},createContext:function(){return rs},runInContext:function(){return Ml},runInNewContext:function(){return Zs}});var ye={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Oe={5:m,"5module":m+" export import",6:m+" const class extends export import super"},W=/^in(stanceof)?$/,pe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ce="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Be=new RegExp("["+pe+"]"),_e=new RegExp("["+pe+ce+"]");pe=ce=null;var tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],pt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Et(_,M){for(var B=65536,R=0;R<M.length;R+=2){if(B+=M[R],B>_)return!1;if(B+=M[R+1],B>=_)return!0}}function Jt(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Be.test(String.fromCharCode(_)):M===!1?!1:Et(_,tt)}function ur(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&_e.test(String.fromCharCode(_)):M===!1?!1:Et(_,tt)||Et(_,pt)}var kt=function(M,B){B===void 0&&(B={}),this.label=M,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function er(_,M){return new kt(_,{beforeExpr:!0,binop:M})}var jt={beforeExpr:!0},ct={startsExpr:!0},dt={};function ir(_,M){return M===void 0&&(M={}),M.keyword=_,dt[_]=new kt(_,M)}var Y={num:new kt("num",ct),regexp:new kt("regexp",ct),string:new kt("string",ct),name:new kt("name",ct),eof:new kt("eof"),bracketL:new kt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new kt("]"),braceL:new kt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new kt("}"),parenL:new kt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new kt(")"),comma:new kt(",",jt),semi:new kt(";",jt),colon:new kt(":",jt),dot:new kt("."),question:new kt("?",jt),questionDot:new kt("?."),arrow:new kt("=>",jt),template:new kt("template"),invalidTemplate:new kt("invalidTemplate"),ellipsis:new kt("...",jt),backQuote:new kt("`",ct),dollarBraceL:new kt("${",{beforeExpr:!0,startsExpr:!0}),eq:new kt("=",{beforeExpr:!0,isAssign:!0}),assign:new kt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new kt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new kt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:er("||",1),logicalAND:er("&&",2),bitwiseOR:er("|",3),bitwiseXOR:er("^",4),bitwiseAND:er("&",5),equality:er("==/!=/===/!==",6),relational:er("</>/<=/>=",7),bitShift:er("<</>>/>>>",8),plusMin:new kt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:er("%",10),star:er("*",10),slash:er("/",10),starstar:new kt("**",{beforeExpr:!0}),coalesce:er("??",1),_break:ir("break"),_case:ir("case",jt),_catch:ir("catch"),_continue:ir("continue"),_debugger:ir("debugger"),_default:ir("default",jt),_do:ir("do",{isLoop:!0,beforeExpr:!0}),_else:ir("else",jt),_finally:ir("finally"),_for:ir("for",{isLoop:!0}),_function:ir("function",ct),_if:ir("if"),_return:ir("return",jt),_switch:ir("switch"),_throw:ir("throw",jt),_try:ir("try"),_var:ir("var"),_const:ir("const"),_while:ir("while",{isLoop:!0}),_with:ir("with"),_new:ir("new",{beforeExpr:!0,startsExpr:!0}),_this:ir("this",ct),_super:ir("super",ct),_class:ir("class",ct),_extends:ir("extends",jt),_export:ir("export"),_import:ir("import",ct),_null:ir("null",ct),_true:ir("true",ct),_false:ir("false",ct),_in:ir("in",{beforeExpr:!0,binop:7}),_instanceof:ir("instanceof",{beforeExpr:!0,binop:7}),_typeof:ir("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ir("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ir("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Wt=/\r\n?|\n|\u2028|\u2029/,ut=new RegExp(Wt.source,"g");function qe(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var St=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Xt=Object.prototype,wr=Xt.hasOwnProperty,Gr=Xt.toString;function Qr(_,M){return wr.call(_,M)}var A=Array.isArray||function(_){return Gr.call(_)==="[object Array]"};function Ce(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(M,B){this.line=M,this.column=B};ke.prototype.offset=function(M){return new ke(this.line,this.column+M)};var xt=function(M,B,R){this.start=B,this.end=R,M.sourceFile!==null&&(this.source=M.sourceFile)};function ht(_,M){for(var B=1,R=0;;){ut.lastIndex=R;var X=ut.exec(_);if(X&&X.index<M)++B,R=X.index+X[0].length;else return new ke(B,M-R)}}var Ft={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Gt(_){var M={};for(var B in Ft)M[B]=_&&Qr(_,B)?_[B]:Ft[B];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),A(M.onToken)){var R=M.onToken;M.onToken=function(X){return R.push(X)}}return A(M.onComment)&&(M.onComment=Er(M,M.onComment)),M}function Er(_,M){return function(B,R,X,me,Ge,ot){var st={type:B?"Block":"Line",value:R,start:X,end:me};_.locations&&(st.loc=new xt(this,Ge,ot)),_.ranges&&(st.range=[X,me]),M.push(st)}}var Qn=1,gn=2,di=Qn|gn,Hn=4,ai=8,vi=16,Xn=32,mi=64,fa=128;function Wi(_,M){return gn|(_?Hn:0)|(M?ai:0)}var Li=0,Qi=1,pa=2,Lo=3,Ia=4,_a=5,Ni=function(M,B,R){this.options=M=Gt(M),this.sourceFile=M.sourceFile,this.keywords=Ce(Oe[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var X="";if(M.allowReserved!==!0){for(var me=M.ecmaVersion;!(X=ye[me]);me--);M.sourceType==="module"&&(X+=" await")}this.reservedWords=Ce(X);var Ge=(X?X+" ":"")+ye.strict;this.reservedWordsStrict=Ce(Ge),this.reservedWordsStrictBind=Ce(Ge+" "+ye.strictBind),this.input=String(B),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Wt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Qn),this.regexpState=null},aa={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ni.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},aa.inFunction.get=function(){return(this.currentVarScope().flags&gn)>0},aa.inGenerator.get=function(){return(this.currentVarScope().flags&ai)>0},aa.inAsync.get=function(){return(this.currentVarScope().flags&Hn)>0},aa.allowSuper.get=function(){return(this.currentThisScope().flags&mi)>0},aa.allowDirectSuper.get=function(){return(this.currentThisScope().flags&fa)>0},aa.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ni.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&gn)>0},Ni.extend=function(){for(var M=[],B=arguments.length;B--;)M[B]=arguments[B];for(var R=this,X=0;X<M.length;X++)R=M[X](R);return R},Ni.parse=function(M,B){return new this(B,M).parse()},Ni.parseExpressionAt=function(M,B,R){var X=new this(R,M,B);return X.nextToken(),X.parseExpression()},Ni.tokenizer=function(M,B){return new this(B,M)},Object.defineProperties(Ni.prototype,aa);var Ji=Ni.prototype,Ss=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Ji.strictDirective=function(_){for(;;){Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length;var M=Ss.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){Qe.lastIndex=_+M[0].length;var B=Qe.exec(this.input),R=B.index+B[0].length,X=this.input.charAt(R);return X===";"||X==="}"||Wt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(X)||X==="!"&&this.input.charAt(R+1)==="=")}_+=M[0].length,Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length,this.input[_]===";"&&_++}},Ji.eat=function(_){return this.type===_?(this.next(),!0):!1},Ji.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},Ji.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Ji.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Ji.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||Wt.test(this.input.slice(this.lastTokEnd,this.start))},Ji.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Ji.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},Ji.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},Ji.expect=function(_){this.eat(_)||this.unexpected()},Ji.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function he(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Ji.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=M?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},Ji.checkExpressionErrors=function(_,M){if(!_)return!1;var B=_.shorthandAssign,R=_.doubleProto;if(!M)return B>=0||R>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Ji.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Ji.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var oi=Ni.prototype;oi.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==Y.eof;){var B=this.parseStatement(null,!0,M);_.body.push(B)}if(this.inModule)for(var R=0,X=Object.keys(this.undefinedExports);R<X.length;R+=1){var me=X[R];this.raiseRecoverable(this.undefinedExports[me].start,"Export '"+me+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var xo={kind:"loop"},Js={kind:"switch"};oi.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qe.lastIndex=this.pos;var M=Qe.exec(this.input),B=this.pos+M[0].length,R=this.input.charCodeAt(B);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(Jt(R,!0)){for(var X=B+1;ur(this.input.charCodeAt(X),!0);)++X;var me=this.input.slice(B,X);if(!W.test(me))return!0}return!1},oi.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qe.lastIndex=this.pos;var _=Qe.exec(this.input),M=this.pos+_[0].length;return!Wt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!ur(this.input.charAt(M+8)))},oi.parseStatement=function(_,M,B){var R=this.type,X=this.startNode(),me;switch(this.isLet(_)&&(R=Y._var,me="let"),R){case Y._break:case Y._continue:return this.parseBreakContinueStatement(X,R.keyword);case Y._debugger:return this.parseDebuggerStatement(X);case Y._do:return this.parseDoStatement(X);case Y._for:return this.parseForStatement(X);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(X,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass(X,!0);case Y._if:return this.parseIfStatement(X);case Y._return:return this.parseReturnStatement(X);case Y._switch:return this.parseSwitchStatement(X);case Y._throw:return this.parseThrowStatement(X);case Y._try:return this.parseTryStatement(X);case Y._const:case Y._var:return me=me||this.value,_&&me!=="var"&&this.unexpected(),this.parseVarStatement(X,me);case Y._while:return this.parseWhileStatement(X);case Y._with:return this.parseWithStatement(X);case Y.braceL:return this.parseBlock(!0,X);case Y.semi:return this.parseEmptyStatement(X);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&R===Y._import){Qe.lastIndex=this.pos;var Ge=Qe.exec(this.input),ot=this.pos+Ge[0].length,st=this.input.charCodeAt(ot);if(st===40||st===46)return this.parseExpressionStatement(X,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===Y._import?this.parseImport(X):this.parseExport(X,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(X,!0,!_);var tr=this.value,ar=this.parseExpression();return R===Y.name&&ar.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement(X,tr,ar,_):this.parseExpressionStatement(X,ar)}},oi.parseBreakContinueStatement=function(_,M){var B=M==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var X=this.labels[R];if((_.label==null||X.name===_.label.name)&&(X.kind!=null&&(B||X.kind==="loop")||_.label&&B))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},oi.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},oi.parseDoStatement=function(_){return this.next(),this.labels.push(xo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},oi.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(xo),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var B=this.isLet();if(this.type===Y._var||this.type===Y._const||B){var R=this.startNode(),X=B?"let":this.value;return this.next(),this.parseVar(R,!0,X),this.finishNode(R,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,R)):(M>-1&&this.unexpected(M),this.parseFor(_,R))}var me=new he,Ge=this.parseExpression(!0,me);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(Ge,!1,me),this.checkLVal(Ge),this.parseForIn(_,Ge)):(this.checkExpressionErrors(me,!0),M>-1&&this.unexpected(M),this.parseFor(_,Ge))},oi.parseFunctionStatement=function(_,M,B){return this.next(),this.parseFunction(_,$t|(B?0:Ir),!1,M)},oi.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},oi.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},oi.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(Js),this.enterScope(0);for(var M,B=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var R=this.type===Y._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),R?M.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,M.test=null),this.expect(Y.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},oi.parseThrowStatement=function(_){return this.next(),Wt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Nt=[];oi.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var M=this.startNode();if(this.next(),this.eat(Y.parenL)){M.param=this.parseBindingAtom();var B=M.param.type==="Identifier";this.enterScope(B?Xn:0),this.checkLVal(M.param,B?Ia:pa),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},oi.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},oi.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(xo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},oi.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},oi.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},oi.parseLabeledStatement=function(_,M,B,R){for(var X=0,me=this.labels;X<me.length;X+=1){var Ge=me[X];Ge.name===M&&this.raise(B.start,"Label '"+M+"' is already declared")}for(var ot=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,st=this.labels.length-1;st>=0;st--){var tr=this.labels[st];if(tr.statementStart===_.start)tr.statementStart=this.start,tr.kind=ot;else break}return this.labels.push({name:M,kind:ot,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},oi.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},oi.parseBlock=function(_,M,B){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var R=this.parseStatement(null);M.body.push(R)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},oi.parseFor=function(_,M){return _.init=M,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},oi.parseForIn=function(_,M){var B=this.type===Y._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},oi.parseVar=function(_,M,B){for(_.declarations=[],_.kind=B;;){var R=this.startNode();if(this.parseVarId(R,B),this.eat(Y.eq)?R.init=this.parseMaybeAssign(M):B==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(M&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(Y.comma))break}return _},oi.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?Qi:pa,!1)};var $t=1,Ir=2,nn=4;oi.parseFunction=function(_,M,B,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===Y.star&&M&Ir&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!R),M&$t&&(_.id=M&nn&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(M&Ir)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Qi:pa:Lo));var X=this.yieldPos,me=this.awaitPos,Ge=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Wi(_.async,_.generator)),M&$t||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=X,this.awaitPos=me,this.awaitIdentPos=Ge,this.finishNode(_,M&$t?"FunctionDeclaration":"FunctionExpression")},oi.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},oi.parseClass=function(_,M){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var R=this.startNode(),X=!1;for(R.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var me=this.parseClassElement(_.superClass!==null);me&&(R.body.push(me),me.type==="MethodDefinition"&&me.kind==="constructor"&&(X&&this.raise(me.start,"Duplicate constructor in the same class"),X=!0))}return this.strict=B,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},oi.parseClassElement=function(_){var M=this;if(this.eat(Y.semi))return null;var B=this.startNode(),R=function(st,tr){tr===void 0&&(tr=!1);var ar=M.start,Tn=M.startLoc;return M.eatContextual(st)?M.type!==Y.parenL&&(!tr||!M.canInsertSemicolon())?!0:(B.key&&M.unexpected(),B.computed=!1,B.key=M.startNodeAt(ar,Tn),B.key.name=st,M.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=R("static");var X=this.eat(Y.star),me=!1;X||(this.options.ecmaVersion>=8&&R("async",!0)?(me=!0,X=this.options.ecmaVersion>=9&&this.eat(Y.star)):R("get")?B.kind="get":R("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var Ge=B.key,ot=!1;return!B.computed&&!B.static&&(Ge.type==="Identifier"&&Ge.name==="constructor"||Ge.type==="Literal"&&Ge.value==="constructor")?(B.kind!=="method"&&this.raise(Ge.start,"Constructor can't have get/set modifier"),X&&this.raise(Ge.start,"Constructor can't be a generator"),me&&this.raise(Ge.start,"Constructor can't be an async method"),B.kind="constructor",ot=_):B.static&&Ge.type==="Identifier"&&Ge.name==="prototype"&&this.raise(Ge.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,X,me,ot),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},oi.parseClassMethod=function(_,M,B,R){return _.value=this.parseMethod(M,B,R),this.finishNode(_,"MethodDefinition")},oi.parseClassId=function(_,M){this.type===Y.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,pa,!1)):(M===!0&&this.unexpected(),_.id=null)},oi.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},oi.parseExport=function(_,M){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(M,"default",this.lastTokStart);var B;if(this.type===Y._function||(B=this.isAsyncFunction())){var R=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(R,$t|nn,!1,B)}else if(this.type===Y._class){var X=this.startNode();_.declaration=this.parseClass(X,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var me=0,Ge=_.specifiers;me<Ge.length;me+=1){var ot=Ge[me];this.checkUnreserved(ot.local),this.checkLocalExport(ot.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},oi.checkExport=function(_,M,B){!_||(Qr(_,M)&&this.raiseRecoverable(B,"Duplicate export '"+M+"'"),_[M]=!0)},oi.checkPatternExport=function(_,M){var B=M.type;if(B==="Identifier")this.checkExport(_,M.name,M.start);else if(B==="ObjectPattern")for(var R=0,X=M.properties;R<X.length;R+=1){var me=X[R];this.checkPatternExport(_,me)}else if(B==="ArrayPattern")for(var Ge=0,ot=M.elements;Ge<ot.length;Ge+=1){var st=ot[Ge];st&&this.checkPatternExport(_,st)}else B==="Property"?this.checkPatternExport(_,M.value):B==="AssignmentPattern"?this.checkPatternExport(_,M.left):B==="RestElement"?this.checkPatternExport(_,M.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},oi.checkVariableExport=function(_,M){if(!!_)for(var B=0,R=M;B<R.length;B+=1){var X=R[B];this.checkPatternExport(_,X.id)}},oi.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},oi.parseExportSpecifiers=function(_){var M=[],B=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(B)B=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),M.push(this.finishNode(R,"ExportSpecifier"))}return M},oi.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=Nt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},oi.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===Y.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,pa),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,pa),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(M)M=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var X=this.startNode();X.imported=this.parseIdent(!0),this.eatContextual("as")?X.local=this.parseIdent():(this.checkUnreserved(X.imported),X.local=X.imported),this.checkLVal(X.local,pa),_.push(this.finishNode(X,"ImportSpecifier"))}return _},oi.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},oi.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var wn=Ni.prototype;wn.toAssignable=function(_,M,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var R=0,X=_.properties;R<X.length;R+=1){var me=X[R];this.toAssignable(me,M),me.type==="RestElement"&&(me.argument.type==="ArrayPattern"||me.argument.type==="ObjectPattern")&&this.raise(me.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},wn.toAssignableList=function(_,M){for(var B=_.length,R=0;R<B;R++){var X=_[R];X&&this.toAssignable(X,M)}if(B){var me=_[B-1];this.options.ecmaVersion===6&&M&&me&&me.type==="RestElement"&&me.argument.type!=="Identifier"&&this.unexpected(me.argument.start)}return _},wn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},wn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},wn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},wn.parseBindingList=function(_,M,B){for(var R=[],X=!0;!this.eat(_);)if(X?X=!1:this.expect(Y.comma),M&&this.type===Y.comma)R.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var me=this.parseRestBinding();this.parseBindingListItem(me),R.push(me),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var Ge=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Ge),R.push(Ge)}}return R},wn.parseBindingListItem=function(_){return _},wn.parseMaybeDefault=function(_,M,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return B;var R=this.startNodeAt(_,M);return R.left=B,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},wn.checkLVal=function(_,M,B){switch(M===void 0&&(M=Li),_.type){case"Identifier":M===pa&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&(Qr(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),M!==Li&&M!==_a&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,X=_.properties;R<X.length;R+=1){var me=X[R];this.checkLVal(me,M,B)}break;case"Property":this.checkLVal(_.value,M,B);break;case"ArrayPattern":for(var Ge=0,ot=_.elements;Ge<ot.length;Ge+=1){var st=ot[Ge];st&&this.checkLVal(st,M,B)}break;case"AssignmentPattern":this.checkLVal(_.left,M,B);break;case"RestElement":this.checkLVal(_.argument,M,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,B);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var zn=Ni.prototype;zn.checkPropClash=function(_,M,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,X;switch(R.type){case"Identifier":X=R.name;break;case"Literal":X=String(R.value);break;default:return}var me=_.kind;if(this.options.ecmaVersion>=6){X==="__proto__"&&me==="init"&&(M.proto&&(B?B.doubleProto<0&&(B.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),M.proto=!0);return}X="$"+X;var Ge=M[X];if(Ge){var ot;me==="init"?ot=this.strict&&Ge.init||Ge.get||Ge.set:ot=Ge.init||Ge[me],ot&&this.raiseRecoverable(R.start,"Redefinition of property")}else Ge=M[X]={init:!1,get:!1,set:!1};Ge[me]=!0}},zn.parseExpression=function(_,M){var B=this.start,R=this.startLoc,X=this.parseMaybeAssign(_,M);if(this.type===Y.comma){var me=this.startNodeAt(B,R);for(me.expressions=[X];this.eat(Y.comma);)me.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(me,"SequenceExpression")}return X},zn.parseMaybeAssign=function(_,M,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,X=-1,me=-1;M?(X=M.parenthesizedAssign,me=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new he,R=!0);var Ge=this.start,ot=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var st=this.parseMaybeConditional(_,M);if(B&&(st=B.call(this,st,Ge,ot)),this.type.isAssign){var tr=this.startNodeAt(Ge,ot);return tr.operator=this.value,tr.left=this.type===Y.eq?this.toAssignable(st,!1,M):st,R||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=tr.left.start&&(M.shorthandAssign=-1),this.checkLVal(st),this.next(),tr.right=this.parseMaybeAssign(_),this.finishNode(tr,"AssignmentExpression")}else R&&this.checkExpressionErrors(M,!0);return X>-1&&(M.parenthesizedAssign=X),me>-1&&(M.trailingComma=me),st},zn.parseMaybeConditional=function(_,M){var B=this.start,R=this.startLoc,X=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return X;if(this.eat(Y.question)){var me=this.startNodeAt(B,R);return me.test=X,me.consequent=this.parseMaybeAssign(),this.expect(Y.colon),me.alternate=this.parseMaybeAssign(_),this.finishNode(me,"ConditionalExpression")}return X},zn.parseExprOps=function(_,M){var B=this.start,R=this.startLoc,X=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||X.start===B&&X.type==="ArrowFunctionExpression"?X:this.parseExprOp(X,B,R,-1,_)},zn.parseExprOp=function(_,M,B,R,X){var me=this.type.binop;if(me!=null&&(!X||this.type!==Y._in)&&me>R){var Ge=this.type===Y.logicalOR||this.type===Y.logicalAND,ot=this.type===Y.coalesce;ot&&(me=Y.logicalAND.binop);var st=this.value;this.next();var tr=this.start,ar=this.startLoc,Tn=this.parseExprOp(this.parseMaybeUnary(null,!1),tr,ar,me,X),ti=this.buildBinary(M,B,_,Tn,st,Ge||ot);return(Ge&&this.type===Y.coalesce||ot&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ti,M,B,R,X)}return _},zn.buildBinary=function(_,M,B,R,X,me){var Ge=this.startNodeAt(_,M);return Ge.left=B,Ge.operator=X,Ge.right=R,this.finishNode(Ge,me?"LogicalExpression":"BinaryExpression")},zn.parseMaybeUnary=function(_,M){var B=this.start,R=this.startLoc,X;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))X=this.parseAwait(),M=!0;else if(this.type.prefix){var me=this.startNode(),Ge=this.type===Y.incDec;me.operator=this.value,me.prefix=!0,this.next(),me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),Ge?this.checkLVal(me.argument):this.strict&&me.operator==="delete"&&me.argument.type==="Identifier"?this.raiseRecoverable(me.start,"Deleting local variable in strict mode"):M=!0,X=this.finishNode(me,Ge?"UpdateExpression":"UnaryExpression")}else{if(X=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return X;for(;this.type.postfix&&!this.canInsertSemicolon();){var ot=this.startNodeAt(B,R);ot.operator=this.value,ot.prefix=!1,ot.argument=X,this.checkLVal(X),this.next(),X=this.finishNode(ot,"UpdateExpression")}}return!M&&this.eat(Y.starstar)?this.buildBinary(B,R,X,this.parseMaybeUnary(null,!1),"**",!1):X},zn.parseExprSubscripts=function(_){var M=this.start,B=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var X=this.parseSubscripts(R,M,B);return _&&X.type==="MemberExpression"&&(_.parenthesizedAssign>=X.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=X.start&&(_.parenthesizedBind=-1)),X},zn.parseSubscripts=function(_,M,B,R){for(var X=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,me=!1;;){var Ge=this.parseSubscript(_,M,B,R,X,me);if(Ge.optional&&(me=!0),Ge===_||Ge.type==="ArrowFunctionExpression"){if(me){var ot=this.startNodeAt(M,B);ot.expression=Ge,Ge=this.finishNode(ot,"ChainExpression")}return Ge}_=Ge}},zn.parseSubscript=function(_,M,B,R,X,me){var Ge=this.options.ecmaVersion>=11,ot=Ge&&this.eat(Y.questionDot);R&&ot&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var st=this.eat(Y.bracketL);if(st||ot&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var tr=this.startNodeAt(M,B);tr.object=_,tr.property=st?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),tr.computed=!!st,st&&this.expect(Y.bracketR),Ge&&(tr.optional=ot),_=this.finishNode(tr,"MemberExpression")}else if(!R&&this.eat(Y.parenL)){var ar=new he,Tn=this.yieldPos,ti=this.awaitPos,Rn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ji=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,ar);if(X&&!ot&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Tn,this.awaitPos=ti,this.awaitIdentPos=Rn,this.parseArrowExpression(this.startNodeAt(M,B),ji,!0);this.checkExpressionErrors(ar,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ti||this.awaitPos,this.awaitIdentPos=Rn||this.awaitIdentPos;var ua=this.startNodeAt(M,B);ua.callee=_,ua.arguments=ji,Ge&&(ua.optional=ot),_=this.finishNode(ua,"CallExpression")}else if(this.type===Y.backQuote){(ot||me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ea=this.startNodeAt(M,B);Ea.tag=_,Ea.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ea,"TaggedTemplateExpression")}return _},zn.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var M,B=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(M,"Super");case Y._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case Y.name:var R=this.start,X=this.startLoc,me=this.containsEsc,Ge=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!me&&Ge.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(R,X),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(R,X),[Ge],!1);if(this.options.ecmaVersion>=8&&Ge.name==="async"&&this.type===Y.name&&!me)return Ge=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,X),[Ge],!0)}return Ge;case Y.regexp:var ot=this.value;return M=this.parseLiteral(ot.value),M.regex={pattern:ot.pattern,flags:ot.flags},M;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return M=this.startNode(),M.value=this.type===Y._null?null:this.type===Y._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case Y.parenL:var st=this.start,tr=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(tr)&&(_.parenthesizedAssign=st),_.parenthesizedBind<0&&(_.parenthesizedBind=st)),tr;case Y.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},zn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},zn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var M=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},zn.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},zn.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},zn.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},zn.parseParenAndDistinguishExpression=function(_){var M=this.start,B=this.startLoc,R,X=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var me=this.start,Ge=this.startLoc,ot=[],st=!0,tr=!1,ar=new he,Tn=this.yieldPos,ti=this.awaitPos,Rn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(st?st=!1:this.expect(Y.comma),X&&this.afterTrailingComma(Y.parenR,!0)){tr=!0;break}else if(this.type===Y.ellipsis){Rn=this.start,ot.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ot.push(this.parseMaybeAssign(!1,ar,this.parseParenItem));var ji=this.start,ua=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Tn,this.awaitPos=ti,this.parseParenArrowList(M,B,ot);(!ot.length||tr)&&this.unexpected(this.lastTokStart),Rn&&this.unexpected(Rn),this.checkExpressionErrors(ar,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ti||this.awaitPos,ot.length>1?(R=this.startNodeAt(me,Ge),R.expressions=ot,this.finishNodeAt(R,"SequenceExpression",ji,ua)):R=ot[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ea=this.startNodeAt(M,B);return Ea.expression=R,this.finishNode(Ea,"ParenthesizedExpression")}else return R},zn.parseParenItem=function(_){return _},zn.parseParenArrowList=function(_,M,B){return this.parseArrowExpression(this.startNodeAt(_,M),B)};var xi=[];zn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=M;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,X=this.startLoc,me=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,X,!0),me&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=xi,this.finishNode(_,"NewExpression")},zn.parseTemplateElement=function(_){var M=_.isTagged,B=this.startNode();return this.type===Y.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===Y.backQuote,this.finishNode(B,"TemplateElement")},zn.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var B=this.startNode();this.next(),B.expressions=[];var R=this.parseTemplateElement({isTagged:M});for(B.quasis=[R];!R.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(Y.braceR),B.quasis.push(R=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(B,"TemplateLiteral")},zn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!Wt.test(this.input.slice(this.lastTokEnd,this.start))},zn.parseObj=function(_,M){var B=this.startNode(),R=!0,X={};for(B.properties=[],this.next();!this.eat(Y.braceR);){if(R)R=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var me=this.parseProperty(_,M);_||this.checkPropClash(me,X,M),B.properties.push(me)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},zn.parseProperty=function(_,M){var B=this.startNode(),R,X,me,Ge;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===Y.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,M),this.type===Y.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||M)&&(me=this.start,Ge=this.startLoc),_||(R=this.eat(Y.star)));var ot=this.containsEsc;return this.parsePropertyName(B),!_&&!ot&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(B)?(X=!0,R=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(B,M)):X=!1,this.parsePropertyValue(B,_,R,X,me,Ge,M,ot),this.finishNode(B,"Property")},zn.parsePropertyValue=function(_,M,B,R,X,me,Ge,ot){if((B||R)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Ge),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,R);else if(!M&&!ot&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(B||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var st=_.kind==="get"?0:1;if(_.value.params.length!==st){var tr=_.value.start;_.kind==="get"?this.raiseRecoverable(tr,"getter should have no params"):this.raiseRecoverable(tr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=X),_.kind="init",M?_.value=this.parseMaybeDefault(X,me,_.key):this.type===Y.eq&&Ge?(Ge.shorthandAssign<0&&(Ge.shorthandAssign=this.start),_.value=this.parseMaybeDefault(X,me,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},zn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},zn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},zn.parseMethod=function(_,M,B){var R=this.startNode(),X=this.yieldPos,me=this.awaitPos,Ge=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Wi(M,R.generator)|mi|(B?fa:0)),this.expect(Y.parenL),R.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=X,this.awaitPos=me,this.awaitIdentPos=Ge,this.finishNode(R,"FunctionExpression")},zn.parseArrowExpression=function(_,M,B){var R=this.yieldPos,X=this.awaitPos,me=this.awaitIdentPos;return this.enterScope(Wi(B,!1)|vi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=X,this.awaitIdentPos=me,this.finishNode(_,"ArrowFunctionExpression")},zn.parseFunctionBody=function(_,M,B){var R=M&&this.type!==Y.braceL,X=this.strict,me=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var Ge=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!X||Ge)&&(me=this.strictDirective(this.end),me&&Ge&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ot=this.labels;this.labels=[],me&&(this.strict=!0),this.checkParams(_,!X&&!me&&!M&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,_a),_.body=this.parseBlock(!1,void 0,me&&!X),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ot}this.exitScope()},zn.isSimpleParamList=function(_){for(var M=0,B=_;M<B.length;M+=1){var R=B[M];if(R.type!=="Identifier")return!1}return!0},zn.checkParams=function(_,M){for(var B={},R=0,X=_.params;R<X.length;R+=1){var me=X[R];this.checkLVal(me,Qi,M?null:B)}},zn.parseExprList=function(_,M,B,R){for(var X=[],me=!0;!this.eat(_);){if(me)me=!1;else if(this.expect(Y.comma),M&&this.afterTrailingComma(_))break;var Ge=void 0;B&&this.type===Y.comma?Ge=null:this.type===Y.ellipsis?(Ge=this.parseSpread(R),R&&this.type===Y.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):Ge=this.parseMaybeAssign(!1,R),X.push(Ge)}return X},zn.checkUnreserved=function(_){var M=_.start,B=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(M,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,B).indexOf("\\")!==-1)){var X=this.strict?this.reservedWordsStrict:this.reservedWords;X.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+R+"' is reserved"))}},zn.parseIdent=function(_,M){var B=this.startNode();return this.type===Y.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},zn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(Y.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},zn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var fi=Ni.prototype;fi.raise=function(_,M){var B=ht(this.input,_);M+=" ("+B.line+":"+B.column+")";var R=new SyntaxError(M);throw R.pos=_,R.loc=B,R.raisedAt=this.pos,R},fi.raiseRecoverable=fi.raise,fi.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var En=Ni.prototype,Ii=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};En.enterScope=function(_){this.scopeStack.push(new Ii(_))},En.exitScope=function(){this.scopeStack.pop()},En.treatFunctionsAsVarInScope=function(_){return _.flags&gn||!this.inModule&&_.flags&Qn},En.declareName=function(_,M,B){var R=!1;if(M===pa){var X=this.currentScope();R=X.lexical.indexOf(_)>-1||X.functions.indexOf(_)>-1||X.var.indexOf(_)>-1,X.lexical.push(_),this.inModule&&X.flags&Qn&&delete this.undefinedExports[_]}else if(M===Ia){var me=this.currentScope();me.lexical.push(_)}else if(M===Lo){var Ge=this.currentScope();this.treatFunctionsAsVar?R=Ge.lexical.indexOf(_)>-1:R=Ge.lexical.indexOf(_)>-1||Ge.var.indexOf(_)>-1,Ge.functions.push(_)}else for(var ot=this.scopeStack.length-1;ot>=0;--ot){var st=this.scopeStack[ot];if(st.lexical.indexOf(_)>-1&&!(st.flags&Xn&&st.lexical[0]===_)||!this.treatFunctionsAsVarInScope(st)&&st.functions.indexOf(_)>-1){R=!0;break}if(st.var.push(_),this.inModule&&st.flags&Qn&&delete this.undefinedExports[_],st.flags&di)break}R&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},En.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},En.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},En.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&di)return M}},En.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&di&&!(M.flags&vi))return M}};var Pi=function(M,B,R){this.type="",this.start=B,this.end=0,M.options.locations&&(this.loc=new xt(M,R)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[B,0])},to=Ni.prototype;to.startNode=function(){return new Pi(this,this.start,this.startLoc)},to.startNodeAt=function(_,M){return new Pi(this,_,M)};function fs(_,M,B,R){return _.type=M,_.end=B,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=B),_}to.finishNode=function(_,M){return fs.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},to.finishNodeAt=function(_,M,B,R){return fs.call(this,_,M,B,R)};var Go=function(M,B,R,X,me){this.token=M,this.isExpr=!!B,this.preserveSpace=!!R,this.override=X,this.generator=!!me},Da={b_stat:new Go("{",!1),b_expr:new Go("{",!0),b_tmpl:new Go("${",!1),p_stat:new Go("(",!1),p_expr:new Go("(",!0),q_tmpl:new Go("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Go("function",!1),f_expr:new Go("function",!0),f_expr_gen:new Go("function",!0,!1,null,!0),f_gen:new Go("function",!1,!1,null,!0)},xa=Ni.prototype;xa.initialContext=function(){return[Da.b_stat]},xa.braceIsBlock=function(_){var M=this.curContext();return M===Da.f_expr||M===Da.f_stat?!0:_===Y.colon&&(M===Da.b_stat||M===Da.b_expr)?!M.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?Wt.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?M===Da.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},xa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},xa.updateContext=function(_){var M,B=this.type;B.keyword&&_===Y.dot?this.exprAllowed=!1:(M=B.updateContext)?M.call(this,_):this.exprAllowed=B.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Da.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Da.b_stat:Da.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(Da.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var M=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(M?Da.p_stat:Da.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&Wt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===Da.b_stat)?this.context.push(Da.f_expr):this.context.push(Da.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===Da.q_tmpl?this.context.pop():this.context.push(Da.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var M=this.context.length-1;this.context[M]===Da.f_expr?this.context[M]=Da.f_expr_gen:this.context[M]=Da.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var G="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",q=G+" Extended_Pictographic",te=q,de={9:G,10:q,11:te},Me="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ve="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",$e=Ve+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",oe=$e+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Re={9:Ve,10:$e,11:oe},lt={};function cr(_){var M=lt[_]={binary:Ce(de[_]+" "+Me),nonBinary:{General_Category:Ce(Me),Script:Ce(Re[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}cr(9),cr(10),cr(11);var Rt=Ni.prototype,Lt=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=lt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Lt.prototype.reset=function(M,B,R){var X=R.indexOf("u")!==-1;this.start=M|0,this.source=B+"",this.flags=R,this.switchU=X&&this.parser.options.ecmaVersion>=6,this.switchN=X&&this.parser.options.ecmaVersion>=9},Lt.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},Lt.prototype.at=function(M,B){B===void 0&&(B=!1);var R=this.source,X=R.length;if(M>=X)return-1;var me=R.charCodeAt(M);if(!(B||this.switchU)||me<=55295||me>=57344||M+1>=X)return me;var Ge=R.charCodeAt(M+1);return Ge>=56320&&Ge<=57343?(me<<10)+Ge-56613888:me},Lt.prototype.nextIndex=function(M,B){B===void 0&&(B=!1);var R=this.source,X=R.length;if(M>=X)return X;var me=R.charCodeAt(M),Ge;return!(B||this.switchU)||me<=55295||me>=57344||M+1>=X||(Ge=R.charCodeAt(M+1))<56320||Ge>57343?M+1:M+2},Lt.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},Lt.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},Lt.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},Lt.prototype.eat=function(M,B){return B===void 0&&(B=!1),this.current(B)===M?(this.advance(B),!0):!1};function pr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Rt.validateRegExpFlags=function(_){for(var M=_.validFlags,B=_.flags,R=0;R<B.length;R++){var X=B.charAt(R);M.indexOf(X)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf(X,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Rt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Rt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,B=_.backReferenceNames;M<B.length;M+=1){var R=B[M];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Rt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Rt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Rt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Rt.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=M,!1},Rt.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},Rt.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},Rt.regexp_eatBracedQuantifier=function(_,M){var B=_.pos;if(_.eat(123)){var R=0,X=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(X=_.lastIntValue),_.eat(125)))return X!==-1&&X<R&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=B}return!1},Rt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Rt.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},Rt.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},Rt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Rt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Rt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Rt.regexp_eatSyntaxCharacter=function(_){var M=_.current();return _n(M)?(_.lastIntValue=M,_.advance(),!0):!1};function _n(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Rt.regexp_eatPatternCharacters=function(_){for(var M=_.pos,B=0;(B=_.current())!==-1&&!_n(B);)_.advance();return _.pos!==M},Rt.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},Rt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Rt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Rt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=pr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=pr(_.lastIntValue);return!0}return!1},Rt.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,R=_.current(B);return _.advance(B),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(R=_.lastIntValue),un(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function un(_){return Jt(_,!0)||_===36||_===95}Rt.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,R=_.current(B);return _.advance(B),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(R=_.lastIntValue),Ct(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function Ct(_){return ur(_,!0)||_===36||_===95||_===8204||_===8205}Rt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Rt.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=M}return!1},Rt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Rt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Rt.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},Rt.regexp_eatZero=function(_){return _.current()===48&&!yn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Rt.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},Rt.regexp_eatControlLetter=function(_){var M=_.current();return Kr(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function Kr(_){return _>=65&&_<=90||_>=97&&_<=122}Rt.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var B=_.pos,R=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var X=_.lastIntValue;if(R&&X>=55296&&X<=56319){var me=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var Ge=_.lastIntValue;if(Ge>=56320&&Ge<=57343)return _.lastIntValue=(X-55296)*1024+(Ge-56320)+65536,!0}_.pos=me,_.lastIntValue=X}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Dr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function Dr(_){return _>=0&&_<=1114111}Rt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},Rt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},Rt.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Hr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Hr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Rt.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,R),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var X=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,X),!0}return!1},Rt.regexp_validateUnicodePropertyNameAndValue=function(_,M,B){Qr(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(B)||_.raise("Invalid property value")},Rt.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},Rt.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";pi(M=_.current());)_.lastStringValue+=pr(M),_.advance();return _.lastStringValue!==""};function pi(_){return Kr(_)||_===95}Rt.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";$r(M=_.current());)_.lastStringValue+=pr(M),_.advance();return _.lastStringValue!==""};function $r(_){return pi(_)||yn(_)}Rt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Rt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Rt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(M===-1||B===-1)&&_.raise("Invalid character class"),M!==-1&&B!==-1&&M>B&&_.raise("Range out of order in character class")}}},Rt.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||Ci(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Rt.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Rt.regexp_eatClassControlLetter=function(_){var M=_.current();return yn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},Rt.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},Rt.regexp_eatDecimalDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;yn(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==M};function yn(_){return _>=48&&_<=57}Rt.regexp_eatHexDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;Zi(B=_.current());)_.lastIntValue=16*_.lastIntValue+li(B),_.advance();return _.pos!==M};function Zi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function li(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Rt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+B*8+_.lastIntValue:_.lastIntValue=M*8+B}else _.lastIntValue=M;return!0}return!1},Rt.regexp_eatOctalDigit=function(_){var M=_.current();return Ci(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ci(_){return _>=48&&_<=55}Rt.regexp_eatFixedHexDigits=function(_,M){var B=_.pos;_.lastIntValue=0;for(var R=0;R<M;++R){var X=_.current();if(!Zi(X))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+li(X),_.advance()}return!0};var gi=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new xt(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},ft=Ni.prototype;ft.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new gi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ft.getToken=function(){return this.next(),new gi(this)},typeof Symbol!="undefined"&&(ft[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===Y.eof,value:M}}}}),ft.curContext=function(){return this.context[this.context.length-1]},ft.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ft.readToken=function(_){return Jt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ft.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},ft.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){ut.lastIndex=M;for(var R;(R=ut.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,B),M,this.pos,_,this.curPosition())},ft.skipLineComment=function(_){for(var M=this.pos,B=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!qe(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,B,this.curPosition())},ft.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&St.test(String.fromCharCode(_)))++this.pos;else break e}}},ft.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=M,this.updateContext(B)},ft.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},ft.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},ft.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),B=1,R=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++B,R=Y.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(Y.assign,B+1):this.finishOp(R,B)},ft.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return M===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},ft.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},ft.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Wt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):M===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},ft.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),B=1;return M===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(Y.assign,B+1):this.finishOp(Y.bitShift,B)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(B=2),this.finishOp(Y.relational,B))},ft.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},ft.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(Y.questionDot,2)}if(M===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},ft.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(_)+"'")},ft.finishOp=function(_,M){var B=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,B)},ft.readRegexp=function(){for(var _,M,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Wt.test(R)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(R==="[")M=!0;else if(R==="]"&&M)M=!1;else if(R==="/"&&!M)break;_=R==="\\"}++this.pos}var X=this.input.slice(B,this.pos);++this.pos;var me=this.pos,Ge=this.readWord1();this.containsEsc&&this.unexpected(me);var ot=this.regexpState||(this.regexpState=new Lt(this));ot.reset(B,X,Ge),this.validateRegExpFlags(ot),this.validateRegExpPattern(ot);var st=null;try{st=new RegExp(X,Ge)}catch(tr){}return this.finishToken(Y.regexp,{pattern:X,flags:Ge,value:st})},ft.readInt=function(_,M,B){for(var R=this.options.ecmaVersion>=12&&M===void 0,X=B&&this.input.charCodeAt(this.pos)===48,me=this.pos,Ge=0,ot=0,st=0,tr=M==null?Infinity:M;st<tr;++st,++this.pos){var ar=this.input.charCodeAt(this.pos),Tn=void 0;if(R&&ar===95){X&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ot===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),st===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ot=ar;continue}if(ar>=97?Tn=ar-97+10:ar>=65?Tn=ar-65+10:ar>=48&&ar<=57?Tn=ar-48:Tn=Infinity,Tn>=_)break;ot=ar,Ge=Ge*_+Tn}return R&&ot===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===me||M!=null&&this.pos-me!==M?null:Ge};function Mt(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function wa(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ft.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=wa(this.input.slice(M,this.pos)),++this.pos):Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,B)},ft.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var B=this.pos-M>=2&&this.input.charCodeAt(M)===48;B&&this.strict&&this.raise(M,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&R===110){var X=wa(this.input.slice(M,this.pos));return++this.pos,Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,X)}B&&/[89]/.test(this.input.slice(M,this.pos))&&(B=!1),R===46&&!B&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!B&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var me=Mt(this.input.slice(M,this.pos),B);return this.finishToken(Y.num,me)},ft.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Ei(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ft.readString=function(_){for(var M="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(M+=this.input.slice(B,this.pos),M+=this.readEscapedChar(!1),B=this.pos):(qe(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(B,this.pos++),this.finishToken(Y.string,M)};var Ai={};ft.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ai)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ft.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ai;this.raise(_,M)},ft.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(Y.template,_));if(B===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(qe(B)){switch(_+=this.input.slice(M,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},ft.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ft.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],X=parseInt(R,8);return X>255&&(R=R.slice(0,-1),X=parseInt(R,8)),this.pos+=R.length-1,M=this.input.charCodeAt(this.pos),(R!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(X)}return qe(M)?"":String.fromCharCode(M)}},ft.readHexChar=function(_){var M=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(M,"Bad character escape sequence"),B},ft.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,B=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var X=this.fullCharCodeAtPos();if(ur(X,R))this.pos+=X<=65535?1:2;else if(X===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Ge=this.readCodePoint();(M?Jt:ur)(Ge,R)||this.invalidStringToken(me,"Invalid Unicode escape"),_+=Ei(Ge),B=this.pos}else break;M=!1}return _+this.input.slice(B,this.pos)},ft.readWord=function(){var _=this.readWord1(),M=Y.name;return this.keywords.test(_)&&(M=dt[_]),this.finishToken(M,_)};var Di="7.4.1";Ni.acorn={Parser:Ni,version:Di,defaultOptions:Ft,Position:ke,SourceLocation:xt,getLineInfo:ht,Node:Pi,TokenType:kt,tokTypes:Y,keywordTypes:dt,TokContext:Go,tokContexts:Da,isIdentifierChar:ur,isIdentifierStart:Jt,Token:gi,isNewLine:qe,lineBreak:Wt,lineBreakG:ut,nonASCIIwhitespace:St};function Rr(_,M){return Ni.parse(_,M)}function cn(_,M,B){return Ni.parseExpressionAt(_,M,B)}function _t(_,M){return Ni.tokenizer(_,M)}function ea(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function le(_){var M=typeof Map=="function"?new Map:void 0;return le=function(R){if(R===null||!fu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(R))return M.get(R);M.set(R,X)}function X(){return Ki(R,arguments,Ta(this).constructor)}return X.prototype=Object.create(R.prototype,{constructor:{value:X,enumerable:!1,writable:!0,configurable:!0}}),Fa(X,R)},le(_)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Ki(_,M,B){return Ko()?Ki=Reflect.construct:Ki=function(X,me,Ge){var ot=[null];ot.push.apply(ot,me);var st=Function.bind.apply(X,ot),tr=new st;return Ge&&Fa(tr,Ge.prototype),tr},Ki.apply(null,arguments)}function fu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function Fa(_,M){return Fa=Object.setPrototypeOf||function(R,X){return R.__proto__=X,R},Fa(_,M)}function Ta(_){return Ta=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},Ta(_)}var Ha=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(le(Error)),ta=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(le(SyntaxError)),wo=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(le(ReferenceError)),Ho=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(le(TypeError)),Eu=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ha),ho=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(ta),Do=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(wo),ra={UnknownError:[3001,"%0",Eu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Eu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Do],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Do],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Do],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Do],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Do],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Do],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Do],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Do],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Do],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Do],FunctionUndefinedReferenceError:[2001,"%0 is not a function",wo],VariableUndefinedReferenceError:[2002,"%0 is not defined",wo],IsNotConstructor:[2003,"%0 is not a constructor",Ho]};function Wa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Fo(_,M,B){return Wa()?Fo=Reflect.construct:Fo=function(X,me,Ge){var ot=[null];ot.push.apply(ot,me);var st=Function.bind.apply(X,ot),tr=new st;return Ge&&Xa(tr,Ge.prototype),tr},Fo.apply(null,arguments)}function Xa(_,M){return Xa=Object.setPrototypeOf||function(R,X){return R.__proto__=X,R},Xa(_,M)}var Cs="0.0.3";function Tl(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var ps=Object.prototype.hasOwnProperty,J=Symbol("Break"),ge=Symbol("Continue"),We=Symbol("DefaultCase"),Tt=Symbol("EmptyStatementReturn"),Mr=Symbol("WithScopeName"),Mn=Symbol("SuperScopeName"),wi=Symbol("RootScopeName"),ro=Symbol("GlobalScopeName");function Oa(_){return typeof _=="function"}var Ba=function(){function _(B){this.interpreter=B}var M=_.prototype;return M.generator=function(){var R=this.interpreter;function X(){return this.getCurrentScope()}function me(){return this.getGlobalScope()}function Ge(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:X.bind(R),getGlobalScope:me.bind(R),getCurrentContext:Ge.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Wo(_,M,B){if(B===void 0&&(B=!0),!(_ instanceof Ba))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var R=_.generator(),X=R.getOptions(),me={timeout:X.timeout,_initEnv:function(){B||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},Ge=B?R.getGlobalScope():R.getCurrentScope(),ot=new ya(Ge,me);return ot.evaluate(M)}}Object.defineProperty(Wo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function hs(_){if(!(_ instanceof Ba))throw new Error("Illegal call");for(var M=_.generator(),B=arguments.length,R=new Array(B>1?B-1:0),X=1;X<B;X++)R[X-1]=arguments[X];var me=R.pop(),Ge=new ya(M.getGlobalScope(),M.getOptions()),ot=`
		    (function anonymous(`+R.join(",")+`){
		        `+me+`
		    });
		    `;return Ge.evaluate(ot)}Object.defineProperty(hs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var uo=function(M){this.value=M},To=function(M){this.value=M},ds=function(M){this.value=M},As=function(M,B,R){B===void 0&&(B=null),this.name=R,this.parent=B,this.data=M,this.labelStack=[]};function Rs(){}function eu(_,M){return _===void 0&&(_=null),new As(Object.create(null),_,M)}function vs(_){return Object.create(_)}var ha={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Wo,Function:hs};typeof JSON!="undefined"&&(ha.JSON=JSON),typeof Promise!="undefined"&&(ha.Promise=Promise),typeof Set!="undefined"&&(ha.Set=Set),typeof Map!="undefined"&&(ha.Map=Map),typeof Symbol!="undefined"&&(ha.Symbol=Symbol),typeof Proxy!="undefined"&&(ha.Proxy=Proxy),typeof WeakMap!="undefined"&&(ha.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ha.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ha.Reflect=Reflect);var ya=function(){function _(B,R){B===void 0&&(B=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(R){var X;if(R instanceof As)X=R;else{var me=null,Ge=this.createSuperScope(R);this.options.rootContext&&(me=new As(vs(this.options.rootContext),Ge,wi)),X=new As(R,me||Ge,ro)}this.globalScope=X,this.currentScope=this.globalScope,this.globalContext=X.data,this.currentContext=X.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ot=this.options._initEnv;ot&&ot.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(R){return R instanceof Eu||R instanceof Do||R instanceof ho},M.createSuperScope=function(R){var X=Object.assign({},ha),me=Object.keys(X);return me.forEach(function(Ge){Ge in R&&delete X[Ge]}),new As(X,null,Mn)},M.setCurrentContext=function(R){this.currentContext=R},M.setCurrentScope=function(R){this.currentScope=R},M.evaluate=function(R){R===void 0&&(R="");var X;if(!!R)return X=Rr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(X,R)},M.appendCode=function(R){return this.evaluate(R)},M.evaluateNode=function(R,X){var me=this;X===void 0&&(X=""),this.value=void 0,this.source=X,this.sourceList.push(X),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ge=this.getCurrentScope(),ot=this.getCurrentContext(),st=Ge.labelStack.concat([]),tr=this.callStack.concat([]),ar=function(){me.setCurrentScope(Ge),me.setCurrentContext(ot),Ge.labelStack=st,me.callStack=tr};try{var Tn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Tn()}catch(ti){throw ti}finally{ar(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(R,X,me){var Ge=R[1].replace("%0",String(X));return me!==null&&(Ge+=this.getNodePosition(me||this.lastExecNode)),Ge},M.createError=function(R,X){return new X(R)},M.createThrowError=function(R,X){return this.createError(R,X)},M.createInternalThrowError=function(R,X,me){return this.createError(this.createErrorMessage(R,X,me),R[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,X=Date.now();return X-this.execStartTime>R},M.getNodePosition=function(R){if(R){var X="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+X:""}return""},M.createClosure=function(R){var X=this,me;switch(R.type){case"BinaryExpression":me=this.binaryExpressionHandler(R);break;case"LogicalExpression":me=this.logicalExpressionHandler(R);break;case"UnaryExpression":me=this.unaryExpressionHandler(R);break;case"UpdateExpression":me=this.updateExpressionHandler(R);break;case"ObjectExpression":me=this.objectExpressionHandler(R);break;case"ArrayExpression":me=this.arrayExpressionHandler(R);break;case"CallExpression":me=this.callExpressionHandler(R);break;case"NewExpression":me=this.newExpressionHandler(R);break;case"MemberExpression":me=this.memberExpressionHandler(R);break;case"ThisExpression":me=this.thisExpressionHandler(R);break;case"SequenceExpression":me=this.sequenceExpressionHandler(R);break;case"Literal":me=this.literalHandler(R);break;case"Identifier":me=this.identifierHandler(R);break;case"AssignmentExpression":me=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":me=this.functionDeclarationHandler(R);break;case"VariableDeclaration":me=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":me=this.programHandler(R);break;case"ExpressionStatement":me=this.expressionStatementHandler(R);break;case"EmptyStatement":me=this.emptyStatementHandler(R);break;case"ReturnStatement":me=this.returnStatementHandler(R);break;case"FunctionExpression":me=this.functionExpressionHandler(R);break;case"IfStatement":me=this.ifStatementHandler(R);break;case"ConditionalExpression":me=this.conditionalExpressionHandler(R);break;case"ForStatement":me=this.forStatementHandler(R);break;case"WhileStatement":me=this.whileStatementHandler(R);break;case"DoWhileStatement":me=this.doWhileStatementHandler(R);break;case"ForInStatement":me=this.forInStatementHandler(R);break;case"WithStatement":me=this.withStatementHandler(R);break;case"ThrowStatement":me=this.throwStatementHandler(R);break;case"TryStatement":me=this.tryStatementHandler(R);break;case"ContinueStatement":me=this.continueStatementHandler(R);break;case"BreakStatement":me=this.breakStatementHandler(R);break;case"SwitchStatement":me=this.switchStatementHandler(R);break;case"LabeledStatement":me=this.labeledStatementHandler(R);break;case"DebuggerStatement":me=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(ra.NodeTypeSyntaxError,R.type,R)}return function(){var Ge=X.options.timeout;if(Ge&&Ge>0&&X.checkTimeout())throw X.createInternalThrowError(ra.ExecutionTimeOutError,Ge,null);return X.lastExecNode=R,me.apply(void 0,arguments)}},M.binaryExpressionHandler=function(R){var X=this,me=this.createClosure(R.left),Ge=this.createClosure(R.right);return function(){var ot=me(),st=Ge();switch(R.operator){case"==":return ot==st;case"!=":return ot!=st;case"===":return ot===st;case"!==":return ot!==st;case"<":return ot<st;case"<=":return ot<=st;case">":return ot>st;case">=":return ot>=st;case"<<":return ot<<st;case">>":return ot>>st;case">>>":return ot>>>st;case"+":return ot+st;case"-":return ot-st;case"*":return ot*st;case"**":return Math.pow(ot,st);case"/":return ot/st;case"%":return ot%st;case"|":return ot|st;case"^":return ot^st;case"&":return ot&st;case"in":return ot in st;case"instanceof":return ot instanceof st;default:throw X.createInternalThrowError(ra.BinaryOperatorSyntaxError,R.operator,R)}}},M.logicalExpressionHandler=function(R){var X=this,me=this.createClosure(R.left),Ge=this.createClosure(R.right);return function(){switch(R.operator){case"||":return me()||Ge();case"&&":return me()&&Ge();default:throw X.createInternalThrowError(ra.LogicalOperatorSyntaxError,R.operator,R)}}},M.unaryExpressionHandler=function(R){var X=this;switch(R.operator){case"delete":var me=this.createObjectGetter(R.argument),Ge=this.createNameGetter(R.argument);return function(){var ar=me(),Tn=Ge();return delete ar[Tn]};default:var ot;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var st=this.createObjectGetter(R.argument),tr=this.createNameGetter(R.argument);ot=function(){return st()[tr()]}}else ot=this.createClosure(R.argument);return function(){var ar=ot();switch(R.operator){case"-":return-ar;case"+":return+ar;case"!":return!ar;case"~":return~ar;case"void":return;case"typeof":return typeof ar;default:throw X.createInternalThrowError(ra.UnaryOperatorSyntaxError,R.operator,R)}}}},M.updateExpressionHandler=function(R){var X=this,me=this.createObjectGetter(R.argument),Ge=this.createNameGetter(R.argument);return function(){var ot=me(),st=Ge();switch(X.assertVariable(ot,st,R),R.operator){case"++":return R.prefix?++ot[st]:ot[st]++;case"--":return R.prefix?--ot[st]:ot[st]--;default:throw X.createInternalThrowError(ra.UpdateOperatorSyntaxError,R.operator,R)}}},M.objectExpressionHandler=function(R){var X=this,me=[];function Ge(st){return st.type==="Identifier"?st.name:st.type==="Literal"?st.value:this.throwError(ra.ObjectStructureSyntaxError,st.type,st)}var ot=Object.create(null);return R.properties.forEach(function(st){var tr=st.kind,ar=Ge(st.key);(!ot[ar]||tr==="init")&&(ot[ar]={}),ot[ar][tr]=X.createClosure(st.value),me.push({key:ar,property:st})}),function(){for(var st={},tr=me.length,ar=0;ar<tr;ar++){var Tn=me[ar],ti=Tn.key,Rn=ot[ti],ji=Rn.init?Rn.init():void 0,ua=Rn.get?Rn.get():function(){},Ea=Rn.set?Rn.set():function(Wu){};if("set"in Rn||"get"in Rn){var zi={configurable:!0,enumerable:!0,get:ua,set:Ea};Object.defineProperty(st,ti,zi)}else{var ms=Tn.property,tu=ms.kind;ms.key.type==="Identifier"&&ms.value.type==="FunctionExpression"&&tu==="init"&&!ms.value.id&&Tl(ji,ms.key.name),st[ti]=ji}}return st}},M.arrayExpressionHandler=function(R){var X=this,me=R.elements.map(function(Ge){return Ge&&X.createClosure(Ge)});return function(){for(var Ge=me.length,ot=Array(Ge),st=0;st<Ge;st++){var tr=me[st];tr&&(ot[st]=tr())}return ot}},M.safeObjectGet=function(R,X,me){return R[X]},M.createCallFunctionGetter=function(R){var X=this;switch(R.type){case"MemberExpression":var me=this.createClosure(R.object),Ge=this.createMemberKeyGetter(R),ot=this.source;return function(){var tr=me(),ar=Ge(),Tn=X.safeObjectGet(tr,ar,R);if(!Tn||!Oa(Tn)){var ti=ot.slice(R.start,R.end);throw X.createInternalThrowError(ra.FunctionUndefinedReferenceError,ti,R)}return Tn.__IS_EVAL_FUNC?function(Rn){return Tn(new Ba(X),Rn,!0)}:Tn.__IS_FUNCTION_FUNC?function(){for(var Rn=arguments.length,ji=new Array(Rn),ua=0;ua<Rn;ua++)ji[ua]=arguments[ua];return Tn.apply(void 0,[new Ba(X)].concat(ji))}:Tn.bind(tr)};default:var st=this.createClosure(R);return function(){var tr="";R.type==="Identifier"&&(tr=R.name);var ar=st();if(!ar||!Oa(ar))throw X.createInternalThrowError(ra.FunctionUndefinedReferenceError,tr,R);if(R.type==="Identifier"&&ar.__IS_EVAL_FUNC&&tr==="eval")return function(Rn){var ji=X.getScopeFromName(tr,X.getCurrentScope()),ua=ji.name===Mn||ji.name===ro||ji.name===wi;return ar(new Ba(X),Rn,!ua)};if(ar.__IS_EVAL_FUNC)return function(Rn){return ar(new Ba(X),Rn,!0)};if(ar.__IS_FUNCTION_FUNC)return function(){for(var Rn=arguments.length,ji=new Array(Rn),ua=0;ua<Rn;ua++)ji[ua]=arguments[ua];return ar.apply(void 0,[new Ba(X)].concat(ji))};var Tn=X.options.globalContextInFunction;if(R.type==="Identifier"){var ti=X.getIdentifierScope(R);ti.name===Mr&&(Tn=ti.data)}return ar.bind(Tn)}}},M.callExpressionHandler=function(R){var X=this,me=this.createCallFunctionGetter(R.callee),Ge=R.arguments.map(function(ot){return X.createClosure(ot)});return function(){return me().apply(void 0,Ge.map(function(ot){return ot()}))}},M.functionExpressionHandler=function(R){var X=this,me=this,Ge=this.source,ot=this.collectDeclVars,st=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var tr=R.id?R.id.name:"",ar=R.params.length,Tn=R.params.map(function(ua){return X.createParamNameGetter(ua)}),ti=this.createClosure(R.body),Rn=this.collectDeclVars,ji=this.collectDeclFuncs;return this.collectDeclVars=ot,this.collectDeclFuncs=st,function(){var ua=me.getCurrentScope(),Ea=function zi(){for(var ms=arguments.length,tu=new Array(ms),Wu=0;Wu<ms;Wu++)tu[Wu]=arguments[Wu];me.callStack.push(""+tr);var af=me.getCurrentScope(),ll=eu(ua,"FunctionScope("+tr+")");me.setCurrentScope(ll),me.addDeclarationsToScope(Rn,ji,ll),tr&&(ll.data[tr]=zi),ll.data.arguments=arguments,Tn.forEach(function(Cu,Au){ll.data[Cu()]=tu[Au]});var Mc=me.getCurrentContext();me.setCurrentContext(this);var Su=ti();if(me.setCurrentContext(Mc),me.setCurrentScope(af),me.callStack.pop(),Su instanceof uo)return Su.value};return Tl(Ea,tr),Object.defineProperty(Ea,"length",{value:ar,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ea,"toString",{value:function(){return Ge.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ea,"valueOf",{value:function(){return Ge.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ea}},M.newExpressionHandler=function(R){var X=this,me=this.source,Ge=this.createClosure(R.callee),ot=R.arguments.map(function(st){return X.createClosure(st)});return function(){var st=Ge();if(!Oa(st)||st.__IS_EVAL_FUNC){var tr=R.callee,ar=me.slice(tr.start,tr.end);throw X.createInternalThrowError(ra.IsNotConstructor,ar,R)}return st.__IS_FUNCTION_FUNC?st.apply(void 0,[new Ba(X)].concat(ot.map(function(Tn){return Tn()}))):Fo(st,ot.map(function(Tn){return Tn()}))}},M.memberExpressionHandler=function(R){var X=this.createClosure(R.object),me=this.createMemberKeyGetter(R);return function(){var Ge=X(),ot=me();return Ge[ot]}},M.thisExpressionHandler=function(R){var X=this;return function(){return X.getCurrentContext()}},M.sequenceExpressionHandler=function(R){var X=this,me=R.expressions.map(function(Ge){return X.createClosure(Ge)});return function(){for(var Ge,ot=me.length,st=0;st<ot;st++){var tr=me[st];Ge=tr()}return Ge}},M.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},M.identifierHandler=function(R){var X=this;return function(){var me=X.getCurrentScope(),Ge=X.getScopeDataFromName(R.name,me);return X.assertVariable(Ge,R.name,R),Ge[R.name]}},M.getIdentifierScope=function(R){var X=this.getCurrentScope(),me=this.getScopeFromName(R.name,X);return me},M.assignmentExpressionHandler=function(R){var X=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var me=this.createObjectGetter(R.left),Ge=this.createNameGetter(R.left),ot=this.createClosure(R.right);return function(){var st=me(),tr=Ge(),ar=ot();switch(R.operator!=="="&&X.assertVariable(st,tr,R),R.operator){case"=":return st[tr]=ar;case"+=":return st[tr]+=ar;case"-=":return st[tr]-=ar;case"*=":return st[tr]*=ar;case"**=":return st[tr]=Math.pow(st[tr],ar);case"/=":return st[tr]/=ar;case"%=":return st[tr]%=ar;case"<<=":return st[tr]<<=ar;case">>=":return st[tr]>>=ar;case">>>=":return st[tr]>>>=ar;case"&=":return st[tr]&=ar;case"^=":return st[tr]^=ar;case"|=":return st[tr]|=ar;default:throw X.createInternalThrowError(ra.AssignmentExpressionSyntaxError,R.type,R)}}},M.functionDeclarationHandler=function(R){if(R.id){var X=this.functionExpressionHandler(R);Object.defineProperty(X,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,X)}return function(){return Tt}},M.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(ra.VariableTypeSyntaxError,R.type,R)},M.variableDeclarationHandler=function(R){for(var X=this,me,Ge=[],ot=0;ot<R.declarations.length;ot++){var st=R.declarations[ot];this.varDeclaration(this.getVariableName(st.id)),st.init&&Ge.push({type:"AssignmentExpression",operator:"=",left:st.id,right:st.init})}return Ge.length&&(me=this.createClosure({type:"BlockStatement",body:Ge})),function(){if(me){var tr=X.isVarDeclMode;X.isVarDeclMode=!0,me(),X.isVarDeclMode=tr}return Tt}},M.assertVariable=function(R,X,me){if(R===this.globalScope.data&&!(X in R))throw this.createInternalThrowError(ra.VariableUndefinedReferenceError,X,me)},M.programHandler=function(R){var X=this,me=R.body.map(function(Ge){return X.createClosure(Ge)});return function(){for(var Ge=Tt,ot=0;ot<me.length;ot++){var st=me[ot],tr=X.setValue(st());if(tr!==Tt&&(Ge=tr,Ge instanceof uo||Ge instanceof To||Ge instanceof ds||Ge===J||Ge===ge))break}return Ge}},M.expressionStatementHandler=function(R){return this.createClosure(R.expression)},M.emptyStatementHandler=function(R){return function(){return Tt}},M.returnStatementHandler=function(R){var X=R.argument?this.createClosure(R.argument):Rs;return function(){return new uo(X())}},M.ifStatementHandler=function(R){var X=this.createClosure(R.test),me=this.createClosure(R.consequent),Ge=R.alternate?this.createClosure(R.alternate):function(){return Tt};return function(){return X()?me():Ge()}},M.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},M.forStatementHandler=function(R){var X=this,me=Rs,Ge=R.test?this.createClosure(R.test):function(){return!0},ot=Rs,st=this.createClosure(R.body);return R.type==="ForStatement"&&(me=R.init?this.createClosure(R.init):me,ot=R.update?this.createClosure(R.update):Rs),function(tr){var ar,Tn=Tt,ti=R.type==="DoWhileStatement";for(tr&&tr.type==="LabeledStatement"&&(ar=tr.label.name),me();ti||Ge();ot()){ti=!1;var Rn=X.setValue(st());if(!(Rn===Tt||Rn===ge)){if(Rn===J)break;if(Tn=Rn,Tn instanceof ds&&Tn.value===ar){Tn=Tt;continue}if(Tn instanceof uo||Tn instanceof To||Tn instanceof ds)break}}return Tn}},M.whileStatementHandler=function(R){return this.forStatementHandler(R)},M.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},M.forInStatementHandler=function(R){var X=this,me=R.left,Ge=this.createClosure(R.right),ot=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),me=R.left.declarations[0].id),function(st){var tr,ar=Tt,Tn;st&&st.type==="LabeledStatement"&&(tr=st.label.name);var ti=Ge();for(Tn in ti){X.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:me,right:{type:"Literal",value:Tn}})();var Rn=X.setValue(ot());if(!(Rn===Tt||Rn===ge)){if(Rn===J)break;if(ar=Rn,ar instanceof ds&&ar.value===tr){ar=Tt;continue}if(ar instanceof uo||ar instanceof To||ar instanceof ds)break}}return ar}},M.withStatementHandler=function(R){var X=this,me=this.createClosure(R.object),Ge=this.createClosure(R.body);return function(){var ot=me(),st=X.getCurrentScope(),tr=new As(ot,st,Mr);X.setCurrentScope(tr);var ar=X.setValue(Ge());return X.setCurrentScope(st),ar}},M.throwStatementHandler=function(R){var X=this,me=this.createClosure(R.argument);return function(){throw X.setValue(void 0),me()}},M.tryStatementHandler=function(R){var X=this,me=this.createClosure(R.block),Ge=R.handler?this.catchClauseHandler(R.handler):null,ot=R.finalizer?this.createClosure(R.finalizer):null;return function(){var st=X.getCurrentScope(),tr=X.getCurrentContext(),ar=st.labelStack.concat([]),Tn=X.callStack.concat([]),ti=Tt,Rn,ji,ua=function(){X.setCurrentScope(st),X.setCurrentContext(tr),st.labelStack=ar,X.callStack=Tn};try{ti=X.setValue(me()),ti instanceof uo&&(Rn=ti)}catch(Ea){if(ua(),X.isInterruptThrow(Ea))throw Ea;if(Ge)try{ti=X.setValue(Ge(Ea)),ti instanceof uo&&(Rn=ti)}catch(zi){if(ua(),X.isInterruptThrow(zi))throw zi;ji=zi}}if(ot)try{ti=ot(),ti instanceof uo&&(Rn=ti)}catch(Ea){if(ua(),X.isInterruptThrow(Ea))throw Ea;ji=Ea}if(ji)throw ji;return Rn||ti}},M.catchClauseHandler=function(R){var X=this,me=this.createParamNameGetter(R.param),Ge=this.createClosure(R.body);return function(ot){var st,tr=X.getCurrentScope(),ar=tr.data,Tn=me(),ti=ps.call(ar,Tn),Rn=ar[Tn];return ar[Tn]=ot,st=Ge(),ti?ar[Tn]=Rn:delete ar[Tn],st}},M.continueStatementHandler=function(R){return function(){return R.label?new ds(R.label.name):ge}},M.breakStatementHandler=function(R){return function(){return R.label?new To(R.label.name):J}},M.switchStatementHandler=function(R){var X=this,me=this.createClosure(R.discriminant),Ge=R.cases.map(function(ot){return X.switchCaseHandler(ot)});return function(){for(var ot=me(),st=!1,tr,ar,Tn,ti=0;ti<Ge.length;ti++){var Rn=Ge[ti](),ji=Rn.testClosure();if(ji===We){Tn=Rn;continue}if(st||ji===ot){if(st=!0,ar=X.setValue(Rn.bodyClosure()),ar===Tt)continue;if(ar===J||(tr=ar,tr instanceof uo||tr instanceof To||tr instanceof ds||tr===ge))break}}if(!st&&Tn){ar=X.setValue(Tn.bodyClosure());var ua=ar===Tt||ar===J||ar===ge;ua||(tr=ar)}return tr}},M.switchCaseHandler=function(R){var X=R.test?this.createClosure(R.test):function(){return We},me=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:X,bodyClosure:me}}},M.labeledStatementHandler=function(R){var X=this,me=R.label.name,Ge=this.createClosure(R.body);return function(){var ot,st=X.getCurrentScope();return st.labelStack.push(me),ot=Ge(R),ot instanceof To&&ot.value===me&&(ot=Tt),st.labelStack.pop(),ot}},M.debuggerStatementHandler=function(R){return function(){debugger;return Tt}},M.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(ra.ParamTypeSyntaxError,R.type,R)},M.createObjectKeyGetter=function(R){var X;return R.type==="Identifier"?X=function(){return R.name}:X=this.createClosure(R),function(){return X()}},M.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},M.createObjectGetter=function(R){var X=this;switch(R.type){case"Identifier":return function(){return X.getScopeDataFromName(R.name,X.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(ra.AssignmentTypeSyntaxError,R.type,R)}},M.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(ra.AssignmentTypeSyntaxError,R.type,R)}},M.varDeclaration=function(R){var X=this.collectDeclVars;X[R]=void 0},M.funcDeclaration=function(R,X){var me=this.collectDeclFuncs;me[R]=X},M.addDeclarationsToScope=function(R,X,me){var Ge=me.data;for(var ot in X){var st=X[ot];Ge[ot]=st&&st()}for(var tr in R)tr in Ge||(Ge[tr]=void 0)},M.getScopeValue=function(R,X){var me=this.getScopeFromName(R,X);return me.data[R]},M.getScopeDataFromName=function(R,X){return this.getScopeFromName(R,X).data},M.getScopeFromName=function(R,X){var me=X;do if(R in me.data)return me;while(me=me.parent);return this.globalScope},M.setValue=function(R){var X=this.callStack.length;return this.isVarDeclMode||X||R===Tt||R===J||R===ge||R instanceof To||R instanceof ds||(this.value=R instanceof uo?R.value:R),R},M.getValue=function(){return this.value},_}();ya.version=Cs,ya.eval=Wo,ya.Function=hs,ya.ecmaVersion=5,ya.globalContextInFunction=void 0,ya.global=Object.create(null);function rs(_){return _===void 0&&(_=Object.create(null)),_}function nf(_,M,B){M===void 0&&(M=[]),B===void 0&&(B={});var R=B.parsingContext,X=B.timeout===void 0?0:B.timeout,me=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,Ge=new ya(R,{ecmaVersion:B.ecmaVersion,timeout:X,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return Ge.evaluate(me)}function Ml(_,M,B){var R=new ya(M,B);return R.evaluate(_)}var Zs=Ml,ec=function(){function _(B){this._code=B}var M=_.prototype;return M.runInContext=function(R){return Ml(this._code,R)},M.runInNewContext=function(R){return Ml(this._code,R)},_}(),Hu=function(_,M,B){return Ml(_,M,B)};function js(){for(var _=arguments.length,M=new Array(_),B=0;B<_;B++)M[B]=arguments[B];var R=M.pop();return nf(R||"",M)}var ul=Hu},20396:function(Ar,ne,Q){var Pe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ye,m,Oe,W){"use strict";var pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ce=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Be=pe||ce,_e=["","webkit","Moz","MS","ms","o"],tt=Be?"":m.createElement("div"),pt="function",Et=Math.round,Jt=Math.abs,ur=Date.now;function kt(J,ge,We){return setTimeout(ut(J,We),ge)}function er(J,ge,We){return Array.isArray(J)?(jt(J,We[ge],We),!0):!1}function jt(J,ge,We){var Tt;if(!!J)if(J.forEach)J.forEach(ge,We);else if(J.length!==W)for(Tt=0;Tt<J.length;)ge.call(We,J[Tt],Tt,J),Tt++;else for(Tt in J)J.hasOwnProperty(Tt)&&ge.call(We,J[Tt],Tt,J)}function ct(J,ge,We){var Tt="DEPRECATED METHOD: "+ge+`
`+We+` AT 
`;return function(){var Mr=new Error("get-stack-trace"),Mn=Mr&&Mr.stack?Mr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",wi=ye.console&&(ye.console.warn||ye.console.log);return wi&&wi.call(ye.console,Tt,Mn),J.apply(this,arguments)}}var dt;typeof Object.assign!="function"?dt=function(ge){if(ge===W||ge===null)throw new TypeError("Cannot convert undefined or null to object");for(var We=Object(ge),Tt=1;Tt<arguments.length;Tt++){var Mr=arguments[Tt];if(Mr!==W&&Mr!==null)for(var Mn in Mr)Mr.hasOwnProperty(Mn)&&(We[Mn]=Mr[Mn])}return We}:dt=Object.assign;var ir=ct(function(ge,We,Tt){for(var Mr=Object.keys(We),Mn=0;Mn<Mr.length;)(!Tt||Tt&&ge[Mr[Mn]]===W)&&(ge[Mr[Mn]]=We[Mr[Mn]]),Mn++;return ge},"extend","Use `assign`."),Y=ct(function(ge,We){return ir(ge,We,!0)},"merge","Use `assign`.");function Wt(J,ge,We){var Tt=ge.prototype,Mr;Mr=J.prototype=Object.create(Tt),Mr.constructor=J,Mr._super=Tt,We&&dt(Mr,We)}function ut(J,ge){return function(){return J.apply(ge,arguments)}}function qe(J,ge){return typeof J==pt?J.apply(ge&&ge[0]||W,ge):J}function St(J,ge){return J===W?ge:J}function Qe(J,ge,We){jt(Qr(ge),function(Tt){J.addEventListener(Tt,We,!1)})}function Xt(J,ge,We){jt(Qr(ge),function(Tt){J.removeEventListener(Tt,We,!1)})}function wr(J,ge){for(;J;){if(J==ge)return!0;J=J.parentNode}return!1}function Gr(J,ge){return J.indexOf(ge)>-1}function Qr(J){return J.trim().split(/\s+/g)}function A(J,ge,We){if(J.indexOf&&!We)return J.indexOf(ge);for(var Tt=0;Tt<J.length;){if(We&&J[Tt][We]==ge||!We&&J[Tt]===ge)return Tt;Tt++}return-1}function Ce(J){return Array.prototype.slice.call(J,0)}function ke(J,ge,We){for(var Tt=[],Mr=[],Mn=0;Mn<J.length;){var wi=ge?J[Mn][ge]:J[Mn];A(Mr,wi)<0&&Tt.push(J[Mn]),Mr[Mn]=wi,Mn++}return We&&(ge?Tt=Tt.sort(function(Oa,Ba){return Oa[ge]>Ba[ge]}):Tt=Tt.sort()),Tt}function xt(J,ge){for(var We,Tt,Mr=ge[0].toUpperCase()+ge.slice(1),Mn=0;Mn<_e.length;){if(We=_e[Mn],Tt=We?We+Mr:ge,Tt in J)return Tt;Mn++}return W}var ht=1;function Ft(){return ht++}function Gt(J){var ge=J.ownerDocument||J;return ge.defaultView||ge.parentWindow||ye}var Er=/mobile|tablet|ip(ad|hone|od)|android/i,Qn="ontouchstart"in ye,gn=xt(ye,"PointerEvent")!==W,di=Qn&&Er.test(navigator.userAgent),Hn="touch",ai="pen",vi="mouse",Xn="kinect",mi=25,fa=1,Wi=2,Li=4,Qi=8,pa=1,Lo=2,Ia=4,_a=8,Ni=16,aa=Lo|Ia,Ji=_a|Ni,Ss=aa|Ji,he=["x","y"],oi=["clientX","clientY"];function xo(J,ge){var We=this;this.manager=J,this.callback=ge,this.element=J.element,this.target=J.options.inputTarget,this.domHandler=function(Tt){qe(J.options.enable,[J])&&We.handler(Tt)},this.init()}xo.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(Gt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Xt(this.element,this.evEl,this.domHandler),this.evTarget&&Xt(this.target,this.evTarget,this.domHandler),this.evWin&&Xt(Gt(this.element),this.evWin,this.domHandler)}};function Js(J){var ge,We=J.options.inputClass;return We?ge=We:gn?ge=Me:di?ge=Lt:Qn?ge=Ct:ge=xa,new ge(J,Nt)}function Nt(J,ge,We){var Tt=We.pointers.length,Mr=We.changedPointers.length,Mn=ge&fa&&Tt-Mr==0,wi=ge&(Li|Qi)&&Tt-Mr==0;We.isFirst=!!Mn,We.isFinal=!!wi,Mn&&(J.session={}),We.eventType=ge,$t(J,We),J.emit("hammer.input",We),J.recognize(We),J.session.prevInput=We}function $t(J,ge){var We=J.session,Tt=ge.pointers,Mr=Tt.length;We.firstInput||(We.firstInput=wn(ge)),Mr>1&&!We.firstMultiple?We.firstMultiple=wn(ge):Mr===1&&(We.firstMultiple=!1);var Mn=We.firstInput,wi=We.firstMultiple,ro=wi?wi.center:Mn.center,Oa=ge.center=zn(Tt);ge.timeStamp=ur(),ge.deltaTime=ge.timeStamp-Mn.timeStamp,ge.angle=Ii(ro,Oa),ge.distance=En(ro,Oa),Ir(We,ge),ge.offsetDirection=fi(ge.deltaX,ge.deltaY);var Ba=xi(ge.deltaTime,ge.deltaX,ge.deltaY);ge.overallVelocityX=Ba.x,ge.overallVelocityY=Ba.y,ge.overallVelocity=Jt(Ba.x)>Jt(Ba.y)?Ba.x:Ba.y,ge.scale=wi?to(wi.pointers,Tt):1,ge.rotation=wi?Pi(wi.pointers,Tt):0,ge.maxPointers=We.prevInput?ge.pointers.length>We.prevInput.maxPointers?ge.pointers.length:We.prevInput.maxPointers:ge.pointers.length,nn(We,ge);var Wo=J.element;wr(ge.srcEvent.target,Wo)&&(Wo=ge.srcEvent.target),ge.target=Wo}function Ir(J,ge){var We=ge.center,Tt=J.offsetDelta||{},Mr=J.prevDelta||{},Mn=J.prevInput||{};(ge.eventType===fa||Mn.eventType===Li)&&(Mr=J.prevDelta={x:Mn.deltaX||0,y:Mn.deltaY||0},Tt=J.offsetDelta={x:We.x,y:We.y}),ge.deltaX=Mr.x+(We.x-Tt.x),ge.deltaY=Mr.y+(We.y-Tt.y)}function nn(J,ge){var We=J.lastInterval||ge,Tt=ge.timeStamp-We.timeStamp,Mr,Mn,wi,ro;if(ge.eventType!=Qi&&(Tt>mi||We.velocity===W)){var Oa=ge.deltaX-We.deltaX,Ba=ge.deltaY-We.deltaY,Wo=xi(Tt,Oa,Ba);Mn=Wo.x,wi=Wo.y,Mr=Jt(Wo.x)>Jt(Wo.y)?Wo.x:Wo.y,ro=fi(Oa,Ba),J.lastInterval=ge}else Mr=We.velocity,Mn=We.velocityX,wi=We.velocityY,ro=We.direction;ge.velocity=Mr,ge.velocityX=Mn,ge.velocityY=wi,ge.direction=ro}function wn(J){for(var ge=[],We=0;We<J.pointers.length;)ge[We]={clientX:Et(J.pointers[We].clientX),clientY:Et(J.pointers[We].clientY)},We++;return{timeStamp:ur(),pointers:ge,center:zn(ge),deltaX:J.deltaX,deltaY:J.deltaY}}function zn(J){var ge=J.length;if(ge===1)return{x:Et(J[0].clientX),y:Et(J[0].clientY)};for(var We=0,Tt=0,Mr=0;Mr<ge;)We+=J[Mr].clientX,Tt+=J[Mr].clientY,Mr++;return{x:Et(We/ge),y:Et(Tt/ge)}}function xi(J,ge,We){return{x:ge/J||0,y:We/J||0}}function fi(J,ge){return J===ge?pa:Jt(J)>=Jt(ge)?J<0?Lo:Ia:ge<0?_a:Ni}function En(J,ge,We){We||(We=he);var Tt=ge[We[0]]-J[We[0]],Mr=ge[We[1]]-J[We[1]];return Math.sqrt(Tt*Tt+Mr*Mr)}function Ii(J,ge,We){We||(We=he);var Tt=ge[We[0]]-J[We[0]],Mr=ge[We[1]]-J[We[1]];return Math.atan2(Mr,Tt)*180/Math.PI}function Pi(J,ge){return Ii(ge[1],ge[0],oi)+Ii(J[1],J[0],oi)}function to(J,ge){return En(ge[0],ge[1],oi)/En(J[0],J[1],oi)}var fs={mousedown:fa,mousemove:Wi,mouseup:Li},Go="mousedown",Da="mousemove mouseup";function xa(){this.evEl=Go,this.evWin=Da,this.pressed=!1,xo.apply(this,arguments)}Wt(xa,xo,{handler:function(ge){var We=fs[ge.type];We&fa&&ge.button===0&&(this.pressed=!0),We&Wi&&ge.which!==1&&(We=Li),!!this.pressed&&(We&Li&&(this.pressed=!1),this.callback(this.manager,We,{pointers:[ge],changedPointers:[ge],pointerType:vi,srcEvent:ge}))}});var G={pointerdown:fa,pointermove:Wi,pointerup:Li,pointercancel:Qi,pointerout:Qi},q={2:Hn,3:ai,4:vi,5:Xn},te="pointerdown",de="pointermove pointerup pointercancel";!Be&&ye.MSPointerEvent&&!ye.PointerEvent&&(te="MSPointerDown",de="MSPointerMove MSPointerUp MSPointerCancel");function Me(){this.evEl=te,this.evWin=de,xo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Wt(Me,xo,{handler:function(ge){var We=this.store,Tt=!1,Mr=ge.type.toLowerCase().replace("ms",""),Mn=G[Mr],wi=q[ge.pointerType]||ge.pointerType,ro=wi==Hn,Oa=A(We,ge.pointerId,"pointerId");Mn&fa&&(ge.button===0||ro)?Oa<0&&(We.push(ge),Oa=We.length-1):Mn&(Li|Qi)&&(Tt=!0),!(Oa<0)&&(We[Oa]=ge,this.callback(this.manager,Mn,{pointers:We,changedPointers:[ge],pointerType:wi,srcEvent:ge}),Tt&&We.splice(Oa,1))}});var Ve={touchstart:fa,touchmove:Wi,touchend:Li,touchcancel:Qi},$e="touchstart",oe="touchstart touchmove touchend touchcancel";function Re(){this.evTarget=$e,this.evWin=oe,this.started=!1,xo.apply(this,arguments)}Wt(Re,xo,{handler:function(ge){var We=Ve[ge.type];if(We===fa&&(this.started=!0),!!this.started){var Tt=lt.call(this,ge,We);We&(Li|Qi)&&Tt[0].length-Tt[1].length==0&&(this.started=!1),this.callback(this.manager,We,{pointers:Tt[0],changedPointers:Tt[1],pointerType:Hn,srcEvent:ge})}}});function lt(J,ge){var We=Ce(J.touches),Tt=Ce(J.changedTouches);return ge&(Li|Qi)&&(We=ke(We.concat(Tt),"identifier",!0)),[We,Tt]}var cr={touchstart:fa,touchmove:Wi,touchend:Li,touchcancel:Qi},Rt="touchstart touchmove touchend touchcancel";function Lt(){this.evTarget=Rt,this.targetIds={},xo.apply(this,arguments)}Wt(Lt,xo,{handler:function(ge){var We=cr[ge.type],Tt=pr.call(this,ge,We);!Tt||this.callback(this.manager,We,{pointers:Tt[0],changedPointers:Tt[1],pointerType:Hn,srcEvent:ge})}});function pr(J,ge){var We=Ce(J.touches),Tt=this.targetIds;if(ge&(fa|Wi)&&We.length===1)return Tt[We[0].identifier]=!0,[We,We];var Mr,Mn,wi=Ce(J.changedTouches),ro=[],Oa=this.target;if(Mn=We.filter(function(Ba){return wr(Ba.target,Oa)}),ge===fa)for(Mr=0;Mr<Mn.length;)Tt[Mn[Mr].identifier]=!0,Mr++;for(Mr=0;Mr<wi.length;)Tt[wi[Mr].identifier]&&ro.push(wi[Mr]),ge&(Li|Qi)&&delete Tt[wi[Mr].identifier],Mr++;if(!!ro.length)return[ke(Mn.concat(ro),"identifier",!0),ro]}var _n=2500,un=25;function Ct(){xo.apply(this,arguments);var J=ut(this.handler,this);this.touch=new Lt(this.manager,J),this.mouse=new xa(this.manager,J),this.primaryTouch=null,this.lastTouches=[]}Wt(Ct,xo,{handler:function(ge,We,Tt){var Mr=Tt.pointerType==Hn,Mn=Tt.pointerType==vi;if(!(Mn&&Tt.sourceCapabilities&&Tt.sourceCapabilities.firesTouchEvents)){if(Mr)Kr.call(this,We,Tt);else if(Mn&&Hr.call(this,Tt))return;this.callback(ge,We,Tt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Kr(J,ge){J&fa?(this.primaryTouch=ge.changedPointers[0].identifier,Dr.call(this,ge)):J&(Li|Qi)&&Dr.call(this,ge)}function Dr(J){var ge=J.changedPointers[0];if(ge.identifier===this.primaryTouch){var We={x:ge.clientX,y:ge.clientY};this.lastTouches.push(We);var Tt=this.lastTouches,Mr=function(){var Mn=Tt.indexOf(We);Mn>-1&&Tt.splice(Mn,1)};setTimeout(Mr,_n)}}function Hr(J){for(var ge=J.srcEvent.clientX,We=J.srcEvent.clientY,Tt=0;Tt<this.lastTouches.length;Tt++){var Mr=this.lastTouches[Tt],Mn=Math.abs(ge-Mr.x),wi=Math.abs(We-Mr.y);if(Mn<=un&&wi<=un)return!0}return!1}var pi=Be?W:xt(tt.style,"touchAction"),$r=pi!==W,yn="compute",Zi="auto",li="manipulation",Ci="none",gi="pan-x",ft="pan-y",Mt=Ai();function wa(J,ge){this.manager=J,this.set(ge)}wa.prototype={set:function(J){J==yn&&(J=this.compute()),$r&&this.manager.element.style&&Mt[J]&&(this.manager.element.style[pi]=J),this.actions=J.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var J=[];return jt(this.manager.recognizers,function(ge){qe(ge.options.enable,[ge])&&(J=J.concat(ge.getTouchAction()))}),Ei(J.join(" "))},preventDefaults:function(J){var ge=J.srcEvent,We=J.offsetDirection;if(this.manager.session.prevented){ge.preventDefault();return}var Tt=this.actions,Mr=Gr(Tt,Ci)&&!Mt[Ci],Mn=Gr(Tt,ft)&&!Mt[ft],wi=Gr(Tt,gi)&&!Mt[gi];if(Mr){var ro=J.pointers.length===1,Oa=J.distance<2,Ba=J.deltaTime<250;if(ro&&Oa&&Ba)return}if(!(wi&&Mn)&&(Mr||Mn&&We&aa||wi&&We&Ji))return this.preventSrc(ge)},preventSrc:function(J){this.manager.session.prevented=!0,J.preventDefault()}};function Ei(J){if(Gr(J,Ci))return Ci;var ge=Gr(J,gi),We=Gr(J,ft);return ge&&We?Ci:ge||We?ge?gi:ft:Gr(J,li)?li:Zi}function Ai(){if(!$r)return!1;var J={};if(Be)return J;var ge=ye.CSS&&ye.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(We){J[We]=ge?ye.CSS.supports("touch-action",We):!0}),J}var Di=1,Rr=2,cn=4,_t=8,ea=_t,le=16,Ko=32;function Ki(J){this.options=dt({},this.defaults,J||{}),this.id=Ft(),this.manager=null,this.options.enable=St(this.options.enable,!0),this.state=Di,this.simultaneous={},this.requireFail=[]}Ki.prototype={defaults:{},set:function(J){return dt(this.options,J),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(J){if(er(J,"recognizeWith",this))return this;var ge=this.simultaneous;return J=Ta(J,this),ge[J.id]||(ge[J.id]=J,J.recognizeWith(this)),this},dropRecognizeWith:function(J){return er(J,"dropRecognizeWith",this)?this:(J=Ta(J,this),delete this.simultaneous[J.id],this)},requireFailure:function(J){if(er(J,"requireFailure",this))return this;var ge=this.requireFail;return J=Ta(J,this),A(ge,J)===-1&&(ge.push(J),J.requireFailure(this)),this},dropRequireFailure:function(J){if(er(J,"dropRequireFailure",this))return this;J=Ta(J,this);var ge=A(this.requireFail,J);return ge>-1&&this.requireFail.splice(ge,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(J){return!!this.simultaneous[J.id]},emit:function(J){var ge=this,We=this.state;function Tt(Mr){ge.manager.emit(Mr,J)}We<_t&&Tt(ge.options.event+fu(We)),Tt(ge.options.event),J.additionalEvent&&Tt(J.additionalEvent),We>=_t&&Tt(ge.options.event+fu(We))},tryEmit:function(J){if(this.canEmit())return this.emit(J);this.state=Ko},canEmit:function(){for(var J=0;J<this.requireFail.length;){if(!(this.requireFail[J].state&(Ko|Di)))return!1;J++}return!0},recognize:function(J){var ge=dt({},J);if(!qe(this.options.enable,[this,ge])){this.reset(),this.state=Ko;return}this.state&(ea|le|Ko)&&(this.state=Di),this.state=this.process(ge),this.state&(Rr|cn|_t|le)&&this.tryEmit(ge)},process:function(J){},getTouchAction:function(){},reset:function(){}};function fu(J){return J&le?"cancel":J&_t?"end":J&cn?"move":J&Rr?"start":""}function Fa(J){return J==Ni?"down":J==_a?"up":J==Lo?"left":J==Ia?"right":""}function Ta(J,ge){var We=ge.manager;return We?We.get(J):J}function Ha(){Ki.apply(this,arguments)}Wt(Ha,Ki,{defaults:{pointers:1},attrTest:function(J){var ge=this.options.pointers;return ge===0||J.pointers.length===ge},process:function(J){var ge=this.state,We=J.eventType,Tt=ge&(Rr|cn),Mr=this.attrTest(J);return Tt&&(We&Qi||!Mr)?ge|le:Tt||Mr?We&Li?ge|_t:ge&Rr?ge|cn:Rr:Ko}});function ta(){Ha.apply(this,arguments),this.pX=null,this.pY=null}Wt(ta,Ha,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ss},getTouchAction:function(){var J=this.options.direction,ge=[];return J&aa&&ge.push(ft),J&Ji&&ge.push(gi),ge},directionTest:function(J){var ge=this.options,We=!0,Tt=J.distance,Mr=J.direction,Mn=J.deltaX,wi=J.deltaY;return Mr&ge.direction||(ge.direction&aa?(Mr=Mn===0?pa:Mn<0?Lo:Ia,We=Mn!=this.pX,Tt=Math.abs(J.deltaX)):(Mr=wi===0?pa:wi<0?_a:Ni,We=wi!=this.pY,Tt=Math.abs(J.deltaY))),J.direction=Mr,We&&Tt>ge.threshold&&Mr&ge.direction},attrTest:function(J){return Ha.prototype.attrTest.call(this,J)&&(this.state&Rr||!(this.state&Rr)&&this.directionTest(J))},emit:function(J){this.pX=J.deltaX,this.pY=J.deltaY;var ge=Fa(J.direction);ge&&(J.additionalEvent=this.options.event+ge),this._super.emit.call(this,J)}});function wo(){Ha.apply(this,arguments)}Wt(wo,Ha,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(J){return this._super.attrTest.call(this,J)&&(Math.abs(J.scale-1)>this.options.threshold||this.state&Rr)},emit:function(J){if(J.scale!==1){var ge=J.scale<1?"in":"out";J.additionalEvent=this.options.event+ge}this._super.emit.call(this,J)}});function Ho(){Ki.apply(this,arguments),this._timer=null,this._input=null}Wt(Ho,Ki,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zi]},process:function(J){var ge=this.options,We=J.pointers.length===ge.pointers,Tt=J.distance<ge.threshold,Mr=J.deltaTime>ge.time;if(this._input=J,!Tt||!We||J.eventType&(Li|Qi)&&!Mr)this.reset();else if(J.eventType&fa)this.reset(),this._timer=kt(function(){this.state=ea,this.tryEmit()},ge.time,this);else if(J.eventType&Li)return ea;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(J){this.state===ea&&(J&&J.eventType&Li?this.manager.emit(this.options.event+"up",J):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function Eu(){Ha.apply(this,arguments)}Wt(Eu,Ha,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(J){return this._super.attrTest.call(this,J)&&(Math.abs(J.rotation)>this.options.threshold||this.state&Rr)}});function ho(){Ha.apply(this,arguments)}Wt(ho,Ha,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:aa|Ji,pointers:1},getTouchAction:function(){return ta.prototype.getTouchAction.call(this)},attrTest:function(J){var ge=this.options.direction,We;return ge&(aa|Ji)?We=J.overallVelocity:ge&aa?We=J.overallVelocityX:ge&Ji&&(We=J.overallVelocityY),this._super.attrTest.call(this,J)&&ge&J.offsetDirection&&J.distance>this.options.threshold&&J.maxPointers==this.options.pointers&&Jt(We)>this.options.velocity&&J.eventType&Li},emit:function(J){var ge=Fa(J.offsetDirection);ge&&this.manager.emit(this.options.event+ge,J),this.manager.emit(this.options.event,J)}});function Do(){Ki.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Wt(Do,Ki,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[li]},process:function(J){var ge=this.options,We=J.pointers.length===ge.pointers,Tt=J.distance<ge.threshold,Mr=J.deltaTime<ge.time;if(this.reset(),J.eventType&fa&&this.count===0)return this.failTimeout();if(Tt&&Mr&&We){if(J.eventType!=Li)return this.failTimeout();var Mn=this.pTime?J.timeStamp-this.pTime<ge.interval:!0,wi=!this.pCenter||En(this.pCenter,J.center)<ge.posThreshold;this.pTime=J.timeStamp,this.pCenter=J.center,!wi||!Mn?this.count=1:this.count+=1,this._input=J;var ro=this.count%ge.taps;if(ro===0)return this.hasRequireFailures()?(this._timer=kt(function(){this.state=ea,this.tryEmit()},ge.interval,this),Rr):ea}return Ko},failTimeout:function(){return this._timer=kt(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ea&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ra(J,ge){return ge=ge||{},ge.recognizers=St(ge.recognizers,ra.defaults.preset),new Xa(J,ge)}ra.VERSION="2.0.7",ra.defaults={domEvents:!1,touchAction:yn,enable:!0,inputTarget:null,inputClass:null,preset:[[Eu,{enable:!1}],[wo,{enable:!1},["rotate"]],[ho,{direction:aa}],[ta,{direction:aa},["swipe"]],[Do],[Do,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Wa=1,Fo=2;function Xa(J,ge){this.options=dt({},ra.defaults,ge||{}),this.options.inputTarget=this.options.inputTarget||J,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=J,this.input=Js(this),this.touchAction=new wa(this,this.options.touchAction),Cs(this,!0),jt(this.options.recognizers,function(We){var Tt=this.add(new We[0](We[1]));We[2]&&Tt.recognizeWith(We[2]),We[3]&&Tt.requireFailure(We[3])},this)}Xa.prototype={set:function(J){return dt(this.options,J),J.touchAction&&this.touchAction.update(),J.inputTarget&&(this.input.destroy(),this.input.target=J.inputTarget,this.input.init()),this},stop:function(J){this.session.stopped=J?Fo:Wa},recognize:function(J){var ge=this.session;if(!ge.stopped){this.touchAction.preventDefaults(J);var We,Tt=this.recognizers,Mr=ge.curRecognizer;(!Mr||Mr&&Mr.state&ea)&&(Mr=ge.curRecognizer=null);for(var Mn=0;Mn<Tt.length;)We=Tt[Mn],ge.stopped!==Fo&&(!Mr||We==Mr||We.canRecognizeWith(Mr))?We.recognize(J):We.reset(),!Mr&&We.state&(Rr|cn|_t)&&(Mr=ge.curRecognizer=We),Mn++}},get:function(J){if(J instanceof Ki)return J;for(var ge=this.recognizers,We=0;We<ge.length;We++)if(ge[We].options.event==J)return ge[We];return null},add:function(J){if(er(J,"add",this))return this;var ge=this.get(J.options.event);return ge&&this.remove(ge),this.recognizers.push(J),J.manager=this,this.touchAction.update(),J},remove:function(J){if(er(J,"remove",this))return this;if(J=this.get(J),J){var ge=this.recognizers,We=A(ge,J);We!==-1&&(ge.splice(We,1),this.touchAction.update())}return this},on:function(J,ge){if(J!==W&&ge!==W){var We=this.handlers;return jt(Qr(J),function(Tt){We[Tt]=We[Tt]||[],We[Tt].push(ge)}),this}},off:function(J,ge){if(J!==W){var We=this.handlers;return jt(Qr(J),function(Tt){ge?We[Tt]&&We[Tt].splice(A(We[Tt],ge),1):delete We[Tt]}),this}},emit:function(J,ge){this.options.domEvents&&Tl(J,ge);var We=this.handlers[J]&&this.handlers[J].slice();if(!(!We||!We.length)){ge.type=J,ge.preventDefault=function(){ge.srcEvent.preventDefault()};for(var Tt=0;Tt<We.length;)We[Tt](ge),Tt++}},destroy:function(){this.element&&Cs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Cs(J,ge){var We=J.element;if(!!We.style){var Tt;jt(J.options.cssProps,function(Mr,Mn){Tt=xt(We.style,Mn),ge?(J.oldCssProps[Tt]=We.style[Tt],We.style[Tt]=Mr):We.style[Tt]=J.oldCssProps[Tt]||""}),ge||(J.oldCssProps={})}}function Tl(J,ge){if(!Be){var We=m.createEvent("Event");We.initEvent(J,!0,!0),We.gesture=ge,ge.target.dispatchEvent(We)}}if(!Be){dt(ra,{INPUT_START:fa,INPUT_MOVE:Wi,INPUT_END:Li,INPUT_CANCEL:Qi,STATE_POSSIBLE:Di,STATE_BEGAN:Rr,STATE_CHANGED:cn,STATE_ENDED:_t,STATE_RECOGNIZED:ea,STATE_CANCELLED:le,STATE_FAILED:Ko,DIRECTION_NONE:pa,DIRECTION_LEFT:Lo,DIRECTION_RIGHT:Ia,DIRECTION_UP:_a,DIRECTION_DOWN:Ni,DIRECTION_HORIZONTAL:aa,DIRECTION_VERTICAL:Ji,DIRECTION_ALL:Ss,Manager:Xa,Input:xo,TouchAction:wa,TouchInput:Lt,MouseInput:xa,PointerEventInput:Me,TouchMouseInput:Ct,SingleTouchInput:Re,Recognizer:Ki,AttrRecognizer:Ha,Tap:Do,Pan:ta,Swipe:ho,Pinch:wo,Rotate:Eu,Press:Ho,on:Qe,off:Xt,each:jt,merge:Y,extend:ir,assign:dt,inherit:Wt,bindFn:ut,prefixed:xt});var ps=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ps.Hammer=ra,Pe=function(){return ra}.call(ne,Q,ne,Ar),Pe!==W&&(Ar.exports=Pe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ar,ne,Q){(function(Pe,ye){Ar.exports=ye(Q(18857))})(this,function(Pe){"use strict";var ye=function(z){return z instanceof Uint8Array||z instanceof Uint16Array||z instanceof Uint32Array||z instanceof Int8Array||z instanceof Int16Array||z instanceof Int32Array||z instanceof Float32Array||z instanceof Float64Array||z instanceof Uint8ClampedArray},m=function(z,fe){for(var De=Object.keys(fe),Ot=0;Ot<De.length;++Ot)z[De[Ot]]=fe[De[Ot]];return z},Oe=`
`;function W(z){return typeof atob!="undefined"?atob(z):"base64:"+z}function pe(z){var fe=new Error("(regl) "+z);throw console.error(fe),fe}function ce(z,fe){z||pe(fe)}function Be(z){return z?": "+z:""}function _e(z,fe,De){z in fe||pe("unknown parameter ("+z+")"+Be(De)+". possible values: "+Object.keys(fe).join())}function tt(z,fe){ye(z)||pe("invalid parameter type"+Be(fe)+". must be a typed array")}function pt(z,fe){switch(fe){case"number":return typeof z=="number";case"object":return typeof z=="object";case"string":return typeof z=="string";case"boolean":return typeof z=="boolean";case"function":return typeof z=="function";case"undefined":return typeof z=="undefined";case"symbol":return typeof z=="symbol"}}function Et(z,fe,De){pt(z,fe)||pe("invalid parameter type"+Be(De)+". expected "+fe+", got "+typeof z)}function Jt(z,fe){z>=0&&(z|0)===z||pe("invalid parameter type, ("+z+")"+Be(fe)+". must be a nonnegative integer")}function ur(z,fe,De){fe.indexOf(z)<0&&pe("invalid value"+Be(De)+". must be one of: "+fe)}var kt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function er(z){Object.keys(z).forEach(function(fe){kt.indexOf(fe)<0&&pe('invalid regl constructor argument "'+fe+'". must be one of '+kt)})}function jt(z,fe){for(z=z+"";z.length<fe;)z=" "+z;return z}function ct(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function dt(z,fe){this.number=z,this.line=fe,this.errors=[]}function ir(z,fe,De){this.file=z,this.line=fe,this.message=De}function Y(){var z=new Error,fe=(z.stack||z).toString(),De=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(fe);if(De)return De[1];var Ot=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(fe);return Ot?Ot[1]:"unknown"}function Wt(){var z=new Error,fe=(z.stack||z).toString(),De=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(fe);if(De)return De[1];var Ot=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(fe);return Ot?Ot[1]:"unknown"}function ut(z,fe){var De=z.split(`
`),Ot=1,rr=0,Pt={unknown:new ct,0:new ct};Pt.unknown.name=Pt[0].name=fe||Y(),Pt.unknown.lines.push(new dt(0,""));for(var Yt=0;Yt<De.length;++Yt){var sr=De[Yt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(sr);if(dr)switch(dr[1]){case"line":var mr=/(\d+)(\s+\d+)?/.exec(dr[2]);mr&&(Ot=mr[1]|0,mr[2]&&(rr=mr[2]|0,rr in Pt||(Pt[rr]=new ct)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);Sr&&(Pt[rr].name=Sr[1]?W(Sr[2]):Sr[2]);break}Pt[rr].lines.push(new dt(Ot++,sr))}return Object.keys(Pt).forEach(function(Tr){var Zr=Pt[Tr];Zr.lines.forEach(function(vr){Zr.index[vr.number]=vr})}),Pt}function qe(z){var fe=[];return z.split(`
`).forEach(function(De){if(!(De.length<5)){var Ot=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(De);Ot?fe.push(new ir(Ot[1]|0,Ot[2]|0,Ot[3].trim())):De.length>0&&fe.push(new ir("unknown",0,De))}}),fe}function St(z,fe){fe.forEach(function(De){var Ot=z[De.file];if(Ot){var rr=Ot.index[De.line];if(rr){rr.errors.push(De),Ot.hasErrors=!0;return}}z.unknown.hasErrors=!0,z.unknown.lines[0].errors.push(De)})}function Qe(z,fe,De,Ot,rr){if(!z.getShaderParameter(fe,z.COMPILE_STATUS)){var Pt=z.getShaderInfoLog(fe),Yt=Ot===z.FRAGMENT_SHADER?"fragment":"vertex";ke(De,"string",Yt+" shader source must be a string",rr);var sr=ut(De,rr),dr=qe(Pt);St(sr,dr),Object.keys(sr).forEach(function(mr){var Sr=sr[mr];if(!Sr.hasErrors)return;var Tr=[""],Zr=[""];function vr(Cr,nt){Tr.push(Cr),Zr.push(nt||"")}vr("file number "+mr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(Cr){if(Cr.errors.length>0){vr(jt(Cr.number,4)+"|  ","background-color:yellow; font-weight:bold"),vr(Cr.line+Oe,"color:red; background-color:yellow; font-weight:bold");var nt=0;Cr.errors.forEach(function(Ut){var gr=Ut.message,Fr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(gr);if(Fr){var or=Fr[1];switch(gr=Fr[2],or){case"assign":or="=";break}nt=Math.max(Cr.line.indexOf(or,nt),0)}else nt=0;vr(jt("| ",6)),vr(jt("^^^",nt+3)+Oe,"font-weight:bold"),vr(jt("| ",6)),vr(gr+Oe,"font-weight:bold")}),vr(jt("| ",6)+Oe)}else vr(jt(Cr.number,4)+"|  "),vr(Cr.line+Oe,"color:red")}),typeof document!="undefined"&&!window.chrome?(Zr[0]=Tr.join("%c"),console.log.apply(console,Zr)):console.log(Tr.join(""))}),ce.raise("Error compiling "+Yt+" shader, "+sr[0].name)}}function Xt(z,fe,De,Ot,rr){if(!z.getProgramParameter(fe,z.LINK_STATUS)){var Pt=z.getProgramInfoLog(fe),Yt=ut(De,rr),sr=ut(Ot,rr),dr='Error linking program with vertex shader, "'+sr[0].name+'", and fragment shader "'+Yt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+Oe+"%c"+Pt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+Oe+Pt),ce.raise(dr)}}function wr(z){z._commandRef=Y()}function Gr(z,fe,De,Ot){wr(z);function rr(dr){return dr?Ot.id(dr):0}z._fragId=rr(z.static.frag),z._vertId=rr(z.static.vert);function Pt(dr,mr){Object.keys(mr).forEach(function(Sr){dr[Ot.id(Sr)]=!0})}var Yt=z._uniformSet={};Pt(Yt,fe.static),Pt(Yt,fe.dynamic);var sr=z._attributeSet={};Pt(sr,De.static),Pt(sr,De.dynamic),z._hasCount="count"in z.static||"count"in z.dynamic||"elements"in z.static||"elements"in z.dynamic}function Qr(z,fe){var De=Wt();pe(z+" in command "+(fe||Y())+(De==="unknown"?"":" called from "+De))}function A(z,fe,De){z||Qr(fe,De||Y())}function Ce(z,fe,De,Ot){z in fe||Qr("unknown parameter ("+z+")"+Be(De)+". possible values: "+Object.keys(fe).join(),Ot||Y())}function ke(z,fe,De,Ot){pt(z,fe)||Qr("invalid parameter type"+Be(De)+". expected "+fe+", got "+typeof z,Ot||Y())}function xt(z){z()}function ht(z,fe,De){z.texture?ur(z.texture._texture.internalformat,fe,"unsupported texture format for attachment"):ur(z.renderbuffer._renderbuffer.format,De,"unsupported renderbuffer format for attachment")}var Ft=33071,Gt=9728,Er=9984,Qn=9985,gn=9986,di=9987,Hn=5120,ai=5121,vi=5122,Xn=5123,mi=5124,fa=5125,Wi=5126,Li=32819,Qi=32820,pa=33635,Lo=34042,Ia=36193,_a={};_a[Hn]=_a[ai]=1,_a[vi]=_a[Xn]=_a[Ia]=_a[pa]=_a[Li]=_a[Qi]=2,_a[mi]=_a[fa]=_a[Wi]=_a[Lo]=4;function Ni(z,fe){return z===Qi||z===Li||z===pa?2:z===Lo?4:_a[z]*fe}function aa(z){return!(z&z-1)&&!!z}function Ji(z,fe,De){var Ot,rr=fe.width,Pt=fe.height,Yt=fe.channels;ce(rr>0&&rr<=De.maxTextureSize&&Pt>0&&Pt<=De.maxTextureSize,"invalid texture shape"),(z.wrapS!==Ft||z.wrapT!==Ft)&&ce(aa(rr)&&aa(Pt),"incompatible wrap mode for texture, both width and height must be power of 2"),fe.mipmask===1?rr!==1&&Pt!==1&&ce(z.minFilter!==Er&&z.minFilter!==gn&&z.minFilter!==Qn&&z.minFilter!==di,"min filter requires mipmap"):(ce(aa(rr)&&aa(Pt),"texture must be a square power of 2 to support mipmapping"),ce(fe.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),fe.type===Wi&&(De.extensions.indexOf("oes_texture_float_linear")<0&&ce(z.minFilter===Gt&&z.magFilter===Gt,"filter not supported, must enable oes_texture_float_linear"),ce(!z.genMipmaps,"mipmap generation not supported with float textures"));var sr=fe.images;for(Ot=0;Ot<16;++Ot)if(sr[Ot]){var dr=rr>>Ot,mr=Pt>>Ot;ce(fe.mipmask&1<<Ot,"missing mipmap data");var Sr=sr[Ot];if(ce(Sr.width===dr&&Sr.height===mr,"invalid shape for mip images"),ce(Sr.format===fe.format&&Sr.internalformat===fe.internalformat&&Sr.type===fe.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Tr=Math.ceil(Ni(Sr.type,Yt)*dr/Sr.unpackAlignment)*Sr.unpackAlignment;ce(Sr.data.byteLength===Tr*mr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else z.genMipmaps||ce((fe.mipmask&1<<Ot)==0,"extra mipmap data");fe.compressed&&ce(!z.genMipmaps,"mipmap generation for compressed images not supported")}function Ss(z,fe,De,Ot){var rr=z.width,Pt=z.height,Yt=z.channels;ce(rr>0&&rr<=Ot.maxTextureSize&&Pt>0&&Pt<=Ot.maxTextureSize,"invalid texture shape"),ce(rr===Pt,"cube map must be square"),ce(fe.wrapS===Ft&&fe.wrapT===Ft,"wrap mode not supported by cube map");for(var sr=0;sr<De.length;++sr){var dr=De[sr];ce(dr.width===rr&&dr.height===Pt,"inconsistent cube map face shape"),fe.genMipmaps&&(ce(!dr.compressed,"can not generate mipmap for compressed textures"),ce(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var mr=dr.images,Sr=0;Sr<16;++Sr){var Tr=mr[Sr];if(Tr){var Zr=rr>>Sr,vr=Pt>>Sr;ce(dr.mipmask&1<<Sr,"missing mipmap data"),ce(Tr.width===Zr&&Tr.height===vr,"invalid shape for mip images"),ce(Tr.format===z.format&&Tr.internalformat===z.internalformat&&Tr.type===z.type,"incompatible type for mip image"),Tr.compressed||(Tr.data?ce(Tr.data.byteLength===Zr*vr*Math.max(Ni(Tr.type,Yt),Tr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Tr.element||Tr.copy)}}}}var he=m(ce,{optional:xt,raise:pe,commandRaise:Qr,command:A,parameter:_e,commandParameter:Ce,constructor:er,type:Et,commandType:ke,isTypedArray:tt,nni:Jt,oneOf:ur,shaderError:Qe,linkError:Xt,callSite:Wt,saveCommandRef:wr,saveDrawInfo:Gr,framebufferFormat:ht,guessCommand:Y,texture2D:Ji,textureCube:Ss}),oi=0,xo=0,Js=5,Nt=6;function $t(z,fe){this.id=oi++,this.type=z,this.data=fe}function Ir(z){return z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function nn(z){if(z.length===0)return[];var fe=z.charAt(0),De=z.charAt(z.length-1);if(z.length>1&&fe===De&&(fe==='"'||fe==="'"))return['"'+Ir(z.substr(1,z.length-2))+'"'];var Ot=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(z);if(Ot)return nn(z.substr(0,Ot.index)).concat(nn(Ot[1])).concat(nn(z.substr(Ot.index+Ot[0].length)));var rr=z.split(".");if(rr.length===1)return['"'+Ir(z)+'"'];for(var Pt=[],Yt=0;Yt<rr.length;++Yt)Pt=Pt.concat(nn(rr[Yt]));return Pt}function wn(z){return"["+nn(z).join("][")+"]"}function zn(z,fe){return new $t(z,wn(fe+""))}function xi(z){return typeof z=="function"&&!z._reglType||z instanceof $t}function fi(z,fe){if(typeof z=="function")return new $t(xo,z);if(typeof z=="number"||typeof z=="boolean")return new $t(Js,z);if(Array.isArray(z))return new $t(Nt,z.map(function(De,Ot){return fi(De,fe+"["+Ot+"]")}));if(z instanceof $t)return z;he(!1,"invalid option type in uniform "+fe)}var En={DynamicVariable:$t,define:zn,isDynamic:xi,unbox:fi,accessor:wn},Ii={next:typeof requestAnimationFrame=="function"?function(z){return requestAnimationFrame(z)}:function(z){return setTimeout(z,16)},cancel:typeof cancelAnimationFrame=="function"?function(z){return cancelAnimationFrame(z)}:clearTimeout},Pi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,to=Pi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fs(){var z={"":0},fe=[""];return{id:function(De){var Ot=z[De];return Ot||(Ot=z[De]=fe.length,fe.push(De),Ot)},str:function(De){return fe[De]}}}function Go(z,fe,De){var Ot=document.createElement("canvas");m(Ot.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),z.appendChild(Ot),z===document.body&&(Ot.style.position="absolute",m(z.style,{margin:0,padding:0}));function rr(){var sr=window.innerWidth,dr=window.innerHeight;if(z!==document.body){var mr=Ot.getBoundingClientRect();sr=mr.right-mr.left,dr=mr.bottom-mr.top}Ot.width=De*sr,Ot.height=De*dr}var Pt;z!==document.body&&typeof ResizeObserver=="function"?(Pt=new ResizeObserver(function(){setTimeout(rr)}),Pt.observe(z)):window.addEventListener("resize",rr,!1);function Yt(){Pt?Pt.disconnect():window.removeEventListener("resize",rr),z.removeChild(Ot)}return rr(),{canvas:Ot,onDestroy:Yt}}function Da(z,fe){function De(Ot){try{return z.getContext(Ot,fe)}catch(rr){return null}}return De("webgl")||De("experimental-webgl")||De("webgl-experimental")}function xa(z){return typeof z.nodeName=="string"&&typeof z.appendChild=="function"&&typeof z.getBoundingClientRect=="function"}function G(z){return typeof z.drawArrays=="function"||typeof z.drawElements=="function"}function q(z){return typeof z=="string"?z.split():(he(Array.isArray(z),"invalid extension array"),z)}function te(z){return typeof z=="string"?(he(typeof document!="undefined","not supported outside of DOM"),document.querySelector(z)):z}function de(z){var fe=z||{},De,Ot,rr,Pt,Yt={},sr=[],dr=[],mr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Tr=function(Cr){Cr&&he.raise(Cr)},Zr=function(){};if(typeof fe=="string"?(he(typeof document!="undefined","selector queries only supported in DOM environments"),De=document.querySelector(fe),he(De,"invalid query string for element")):typeof fe=="object"?xa(fe)?De=fe:G(fe)?(Pt=fe,rr=Pt.canvas):(he.constructor(fe),"gl"in fe?Pt=fe.gl:"canvas"in fe?rr=te(fe.canvas):"container"in fe&&(Ot=te(fe.container)),"attributes"in fe&&(Yt=fe.attributes,he.type(Yt,"object","invalid context attributes")),"extensions"in fe&&(sr=q(fe.extensions)),"optionalExtensions"in fe&&(dr=q(fe.optionalExtensions)),"onDone"in fe&&(he.type(fe.onDone,"function","invalid or missing onDone callback"),Tr=fe.onDone),"profile"in fe&&(Sr=!!fe.profile),"pixelRatio"in fe&&(mr=+fe.pixelRatio,he(mr>0,"invalid pixel ratio"))):he.raise("invalid arguments to regl"),De&&(De.nodeName.toLowerCase()==="canvas"?rr=De:Ot=De),!Pt){if(!rr){he(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var vr=Go(Ot||document.body,Tr,mr);if(!vr)return null;rr=vr.canvas,Zr=vr.onDestroy}Yt.premultipliedAlpha===void 0&&(Yt.premultipliedAlpha=!0),Pt=Da(rr,Yt)}return Pt?{gl:Pt,canvas:rr,container:Ot,extensions:sr,optionalExtensions:dr,pixelRatio:mr,profile:Sr,onDone:Tr,onDestroy:Zr}:(Zr(),Tr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Me(z,fe){var De={};function Ot(sr){he.type(sr,"string","extension name must be string");var dr=sr.toLowerCase(),mr;try{mr=De[dr]=rr(sr)}catch(Sr){}return!!mr}function rr(sr){return z.getExtension(sr)?z.getExtension(sr):z.getExtension(sr.toLowerCase())?z.getExtension(sr.toLowerCase()):null}for(var Pt=0;Pt<fe.extensions.length;++Pt){var Yt=fe.extensions[Pt];if(!Ot(Yt))return fe.onDestroy(),fe.onDone('"'+Yt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return fe.optionalExtensions.forEach(Ot),{extensions:De,restore:function(){Object.keys(De).forEach(function(sr){if(De[sr]&&!Ot(sr))throw new Error("(regl): error restoring extension "+sr)})}}}function Ve(z,fe){for(var De=Array(z),Ot=0;Ot<z;++Ot)De[Ot]=fe(Ot);return De}var $e=5120,oe=5121,Re=5122,lt=5123,cr=5124,Rt=5125,Lt=5126;function pr(z){for(var fe=16;fe<=1<<28;fe*=16)if(z<=fe)return fe;return 0}function _n(z){var fe,De;return fe=(z>65535)<<4,z>>>=fe,De=(z>255)<<3,z>>>=De,fe|=De,De=(z>15)<<2,z>>>=De,fe|=De,De=(z>3)<<1,z>>>=De,fe|=De,fe|z>>1}function un(){var z=Ve(8,function(){return[]});function fe(Pt){var Yt=pr(Pt),sr=z[_n(Yt)>>2];return sr.length>0?sr.pop():new ArrayBuffer(Yt)}function De(Pt){z[_n(Pt.byteLength)>>2].push(Pt)}function Ot(Pt,Yt){var sr=null;switch(Pt){case $e:sr=new Int8Array(fe(Yt),0,Yt);break;case oe:sr=new Uint8Array(fe(Yt),0,Yt);break;case Re:sr=new Int16Array(fe(2*Yt),0,Yt);break;case lt:sr=new Uint16Array(fe(2*Yt),0,Yt);break;case cr:sr=new Int32Array(fe(4*Yt),0,Yt);break;case Rt:sr=new Uint32Array(fe(4*Yt),0,Yt);break;case Lt:sr=new Float32Array(fe(4*Yt),0,Yt);break;default:return null}return sr.length!==Yt?sr.subarray(0,Yt):sr}function rr(Pt){De(Pt.buffer)}return{alloc:fe,free:De,allocType:Ot,freeType:rr}}var Ct=un();Ct.zero=un();var Kr=3408,Dr=3410,Hr=3411,pi=3412,$r=3413,yn=3414,Zi=3415,li=33901,Ci=33902,gi=3379,ft=3386,Mt=34921,wa=36347,Ei=36348,Ai=35661,Di=35660,Rr=34930,cn=36349,_t=34076,ea=34024,le=7936,Ko=7937,Ki=7938,fu=35724,Fa=34047,Ta=36063,Ha=34852,ta=3553,wo=34067,Ho=34069,Eu=33984,ho=6408,Do=5126,ra=5121,Wa=36160,Fo=36053,Xa=36064,Cs=16384,Tl=function(z,fe){var De=1;fe.ext_texture_filter_anisotropic&&(De=z.getParameter(Fa));var Ot=1,rr=1;fe.webgl_draw_buffers&&(Ot=z.getParameter(Ha),rr=z.getParameter(Ta));var Pt=!!fe.oes_texture_float;if(Pt){var Yt=z.createTexture();z.bindTexture(ta,Yt),z.texImage2D(ta,0,ho,1,1,0,ho,Do,null);var sr=z.createFramebuffer();if(z.bindFramebuffer(Wa,sr),z.framebufferTexture2D(Wa,Xa,ta,Yt,0),z.bindTexture(ta,null),z.checkFramebufferStatus(Wa)!==Fo)Pt=!1;else{z.viewport(0,0,1,1),z.clearColor(1,0,0,1),z.clear(Cs);var dr=Ct.allocType(Do,4);z.readPixels(0,0,1,1,ho,Do,dr),z.getError()?Pt=!1:(z.deleteFramebuffer(sr),z.deleteTexture(Yt),Pt=dr[0]===1),Ct.freeType(dr)}}var mr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!mr){var Tr=z.createTexture(),Zr=Ct.allocType(ra,36);z.activeTexture(Eu),z.bindTexture(wo,Tr),z.texImage2D(Ho,0,ho,3,3,0,ho,ra,Zr),Ct.freeType(Zr),z.bindTexture(wo,null),z.deleteTexture(Tr),Sr=!z.getError()}return{colorBits:[z.getParameter(Dr),z.getParameter(Hr),z.getParameter(pi),z.getParameter($r)],depthBits:z.getParameter(yn),stencilBits:z.getParameter(Zi),subpixelBits:z.getParameter(Kr),extensions:Object.keys(fe).filter(function(vr){return!!fe[vr]}),maxAnisotropic:De,maxDrawbuffers:Ot,maxColorAttachments:rr,pointSizeDims:z.getParameter(li),lineWidthDims:z.getParameter(Ci),maxViewportDims:z.getParameter(ft),maxCombinedTextureUnits:z.getParameter(Ai),maxCubeMapSize:z.getParameter(_t),maxRenderbufferSize:z.getParameter(ea),maxTextureUnits:z.getParameter(Rr),maxTextureSize:z.getParameter(gi),maxAttributes:z.getParameter(Mt),maxVertexUniforms:z.getParameter(wa),maxVertexTextureUnits:z.getParameter(Di),maxVaryingVectors:z.getParameter(Ei),maxFragmentUniforms:z.getParameter(cn),glsl:z.getParameter(fu),renderer:z.getParameter(Ko),vendor:z.getParameter(le),version:z.getParameter(Ki),readFloat:Pt,npotTextureCube:Sr}};function ps(z){return!!z&&typeof z=="object"&&Array.isArray(z.shape)&&Array.isArray(z.stride)&&typeof z.offset=="number"&&z.shape.length===z.stride.length&&(Array.isArray(z.data)||ye(z.data))}var J=function(z){return Object.keys(z).map(function(fe){return z[fe]})},ge={shape:ro,flatten:wi};function We(z,fe,De){for(var Ot=0;Ot<fe;++Ot)De[Ot]=z[Ot]}function Tt(z,fe,De,Ot){for(var rr=0,Pt=0;Pt<fe;++Pt)for(var Yt=z[Pt],sr=0;sr<De;++sr)Ot[rr++]=Yt[sr]}function Mr(z,fe,De,Ot,rr,Pt){for(var Yt=Pt,sr=0;sr<fe;++sr)for(var dr=z[sr],mr=0;mr<De;++mr)for(var Sr=dr[mr],Tr=0;Tr<Ot;++Tr)rr[Yt++]=Sr[Tr]}function Mn(z,fe,De,Ot,rr){for(var Pt=1,Yt=De+1;Yt<fe.length;++Yt)Pt*=fe[Yt];var sr=fe[De];if(fe.length-De==4){var dr=fe[De+1],mr=fe[De+2],Sr=fe[De+3];for(Yt=0;Yt<sr;++Yt)Mr(z[Yt],dr,mr,Sr,Ot,rr),rr+=Pt}else for(Yt=0;Yt<sr;++Yt)Mn(z[Yt],fe,De+1,Ot,rr),rr+=Pt}function wi(z,fe,De,Ot){var rr=1;if(fe.length)for(var Pt=0;Pt<fe.length;++Pt)rr*=fe[Pt];else rr=0;var Yt=Ot||Ct.allocType(De,rr);switch(fe.length){case 0:break;case 1:We(z,fe[0],Yt);break;case 2:Tt(z,fe[0],fe[1],Yt);break;case 3:Mr(z,fe[0],fe[1],fe[2],Yt,0);break;default:Mn(z,fe,0,Yt,0)}return Yt}function ro(z){for(var fe=[],De=z;De.length;De=De[0])fe.push(De.length);return fe}var Oa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ba=5120,Wo=5122,hs=5124,uo=5121,To=5123,ds=5125,As=5126,Rs=5126,eu={int8:Ba,int16:Wo,int32:hs,uint8:uo,uint16:To,uint32:ds,float:As,float32:Rs},vs=35048,ha=35040,ya={dynamic:vs,stream:ha,static:35044},rs=ge.flatten,nf=ge.shape,Ml=35044,Zs=35040,ec=5121,Hu=5126,js=[];js[5120]=1,js[5122]=2,js[5124]=4,js[5121]=1,js[5123]=2,js[5125]=4,js[5126]=4;function ul(z){return Oa[Object.prototype.toString.call(z)]|0}function _(z,fe){for(var De=0;De<fe.length;++De)z[De]=fe[De]}function M(z,fe,De,Ot,rr,Pt,Yt){for(var sr=0,dr=0;dr<De;++dr)for(var mr=0;mr<Ot;++mr)z[sr++]=fe[rr*dr+Pt*mr+Yt]}function B(z,fe,De,Ot){var rr=0,Pt={};function Yt(nt){this.id=rr++,this.buffer=z.createBuffer(),this.type=nt,this.usage=Ml,this.byteLength=0,this.dimension=1,this.dtype=ec,this.persistentData=null,De.profile&&(this.stats={size:0})}Yt.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)},Yt.prototype.destroy=function(){Zr(this)};var sr=[];function dr(nt,Ut){var gr=sr.pop();return gr||(gr=new Yt(nt)),gr.bind(),Tr(gr,Ut,Zs,0,1,!1),gr}function mr(nt){sr.push(nt)}function Sr(nt,Ut,gr){nt.byteLength=Ut.byteLength,z.bufferData(nt.type,Ut,gr)}function Tr(nt,Ut,gr,Fr,or,Pr){var Yr;if(nt.usage=gr,Array.isArray(Ut)){if(nt.dtype=Fr||Hu,Ut.length>0){var Nn;if(Array.isArray(Ut[0])){Yr=nf(Ut);for(var qt=1,Qt=1;Qt<Yr.length;++Qt)qt*=Yr[Qt];nt.dimension=qt,Nn=rs(Ut,Yr,nt.dtype),Sr(nt,Nn,gr),Pr?nt.persistentData=Nn:Ct.freeType(Nn)}else if(typeof Ut[0]=="number"){nt.dimension=or;var hn=Ct.allocType(nt.dtype,Ut.length);_(hn,Ut),Sr(nt,hn,gr),Pr?nt.persistentData=hn:Ct.freeType(hn)}else ye(Ut[0])?(nt.dimension=Ut[0].length,nt.dtype=Fr||ul(Ut[0])||Hu,Nn=rs(Ut,[Ut.length,Ut[0].length],nt.dtype),Sr(nt,Nn,gr),Pr?nt.persistentData=Nn:Ct.freeType(Nn)):he.raise("invalid buffer data")}}else if(ye(Ut))nt.dtype=Fr||ul(Ut),nt.dimension=or,Sr(nt,Ut,gr),Pr&&(nt.persistentData=new Uint8Array(new Uint8Array(Ut.buffer)));else if(ps(Ut)){Yr=Ut.shape;var Wr=Ut.stride,br=Ut.offset,Xr=0,qr=0,yi=0,Jn=0;Yr.length===1?(Xr=Yr[0],qr=1,yi=Wr[0],Jn=0):Yr.length===2?(Xr=Yr[0],qr=Yr[1],yi=Wr[0],Jn=Wr[1]):he.raise("invalid shape"),nt.dtype=Fr||ul(Ut.data)||Hu,nt.dimension=qr;var jr=Ct.allocType(nt.dtype,Xr*qr);M(jr,Ut.data,Xr,qr,yi,Jn,br),Sr(nt,jr,gr),Pr?nt.persistentData=jr:Ct.freeType(jr)}else Ut instanceof ArrayBuffer?(nt.dtype=ec,nt.dimension=or,Sr(nt,Ut,gr),Pr&&(nt.persistentData=new Uint8Array(new Uint8Array(Ut)))):he.raise("invalid buffer data")}function Zr(nt){fe.bufferCount--,Ot(nt);var Ut=nt.buffer;he(Ut,"buffer must not be deleted already"),z.deleteBuffer(Ut),nt.buffer=null,delete Pt[nt.id]}function vr(nt,Ut,gr,Fr){fe.bufferCount++;var or=new Yt(Ut);Pt[or.id]=or;function Pr(qt){var Qt=Ml,hn=null,Wr=0,br=0,Xr=1;return Array.isArray(qt)||ye(qt)||ps(qt)||qt instanceof ArrayBuffer?hn=qt:typeof qt=="number"?Wr=qt|0:qt&&(he.type(qt,"object","buffer arguments must be an object, a number or an array"),"data"in qt&&(he(hn===null||Array.isArray(hn)||ye(hn)||ps(hn),"invalid data for buffer"),hn=qt.data),"usage"in qt&&(he.parameter(qt.usage,ya,"invalid buffer usage"),Qt=ya[qt.usage]),"type"in qt&&(he.parameter(qt.type,eu,"invalid buffer type"),br=eu[qt.type]),"dimension"in qt&&(he.type(qt.dimension,"number","invalid dimension"),Xr=qt.dimension|0),"length"in qt&&(he.nni(Wr,"buffer length must be a nonnegative integer"),Wr=qt.length|0)),or.bind(),hn?Tr(or,hn,Qt,br,Xr,Fr):(Wr&&z.bufferData(or.type,Wr,Qt),or.dtype=br||ec,or.usage=Qt,or.dimension=Xr,or.byteLength=Wr),De.profile&&(or.stats.size=or.byteLength*js[or.dtype]),Pr}function Yr(qt,Qt){he(Qt+qt.byteLength<=or.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+qt.byteLength+" starting from offset "+Qt+" to a buffer of size "+or.byteLength),z.bufferSubData(or.type,Qt,qt)}function Nn(qt,Qt){var hn=(Qt||0)|0,Wr;if(or.bind(),ye(qt)||qt instanceof ArrayBuffer)Yr(qt,hn);else if(Array.isArray(qt)){if(qt.length>0)if(typeof qt[0]=="number"){var br=Ct.allocType(or.dtype,qt.length);_(br,qt),Yr(br,hn),Ct.freeType(br)}else if(Array.isArray(qt[0])||ye(qt[0])){Wr=nf(qt);var Xr=rs(qt,Wr,or.dtype);Yr(Xr,hn),Ct.freeType(Xr)}else he.raise("invalid buffer data")}else if(ps(qt)){Wr=qt.shape;var qr=qt.stride,yi=0,Jn=0,jr=0,Jr=0;Wr.length===1?(yi=Wr[0],Jn=1,jr=qr[0],Jr=0):Wr.length===2?(yi=Wr[0],Jn=Wr[1],jr=qr[0],Jr=qr[1]):he.raise("invalid shape");var Kn=Array.isArray(qt.data)?or.dtype:ul(qt.data),si=Ct.allocType(Kn,yi*Jn);M(si,qt.data,yi,Jn,jr,Jr,qt.offset),Yr(si,hn),Ct.freeType(si)}else he.raise("invalid data for buffer subdata");return Pr}return gr||Pr(nt),Pr._reglType="buffer",Pr._buffer=or,Pr.subdata=Nn,De.profile&&(Pr.stats=or.stats),Pr.destroy=function(){Zr(or)},Pr}function Cr(){J(Pt).forEach(function(nt){nt.buffer=z.createBuffer(),z.bindBuffer(nt.type,nt.buffer),z.bufferData(nt.type,nt.persistentData||nt.byteLength,nt.usage)})}return De.profile&&(fe.getTotalBufferSize=function(){var nt=0;return Object.keys(Pt).forEach(function(Ut){nt+=Pt[Ut].stats.size}),nt}),{create:vr,createStream:dr,destroyStream:mr,clear:function(){J(Pt).forEach(Zr),sr.forEach(Zr)},getBuffer:function(nt){return nt&&nt._buffer instanceof Yt?nt._buffer:null},restore:Cr,_initBuffer:Tr}}var R=0,X=0,me=1,Ge=1,ot=4,st=4,tr={points:R,point:X,lines:me,line:Ge,triangles:ot,triangle:st,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ar=0,Tn=1,ti=4,Rn=5120,ji=5121,ua=5122,Ea=5123,zi=5124,ms=5125,tu=34963,Wu=35040,af=35044;function ll(z,fe,De,Ot){var rr={},Pt=0,Yt={uint8:ji,uint16:Ea};fe.oes_element_index_uint&&(Yt.uint32=ms);function sr(Cr){this.id=Pt++,rr[this.id]=this,this.buffer=Cr,this.primType=ti,this.vertCount=0,this.type=0}sr.prototype.bind=function(){this.buffer.bind()};var dr=[];function mr(Cr){var nt=dr.pop();return nt||(nt=new sr(De.create(null,tu,!0,!1)._buffer)),Tr(nt,Cr,Wu,-1,-1,0,0),nt}function Sr(Cr){dr.push(Cr)}function Tr(Cr,nt,Ut,gr,Fr,or,Pr){Cr.buffer.bind();var Yr;if(nt){var Nn=Pr;!Pr&&(!ye(nt)||ps(nt)&&!ye(nt.data))&&(Nn=fe.oes_element_index_uint?ms:Ea),De._initBuffer(Cr.buffer,nt,Ut,Nn,3)}else z.bufferData(tu,or,Ut),Cr.buffer.dtype=Yr||ji,Cr.buffer.usage=Ut,Cr.buffer.dimension=3,Cr.buffer.byteLength=or;if(Yr=Pr,!Pr){switch(Cr.buffer.dtype){case ji:case Rn:Yr=ji;break;case Ea:case ua:Yr=Ea;break;case ms:case zi:Yr=ms;break;default:he.raise("unsupported type for element array")}Cr.buffer.dtype=Yr}Cr.type=Yr,he(Yr!==ms||!!fe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var qt=Fr;qt<0&&(qt=Cr.buffer.byteLength,Yr===Ea?qt>>=1:Yr===ms&&(qt>>=2)),Cr.vertCount=qt;var Qt=gr;if(gr<0){Qt=ti;var hn=Cr.buffer.dimension;hn===1&&(Qt=ar),hn===2&&(Qt=Tn),hn===3&&(Qt=ti)}Cr.primType=Qt}function Zr(Cr){Ot.elementsCount--,he(Cr.buffer!==null,"must not double destroy elements"),delete rr[Cr.id],Cr.buffer.destroy(),Cr.buffer=null}function vr(Cr,nt){var Ut=De.create(null,tu,!0),gr=new sr(Ut._buffer);Ot.elementsCount++;function Fr(or){if(!or)Ut(),gr.primType=ti,gr.vertCount=0,gr.type=ji;else if(typeof or=="number")Ut(or),gr.primType=ti,gr.vertCount=or|0,gr.type=ji;else{var Pr=null,Yr=af,Nn=-1,qt=-1,Qt=0,hn=0;Array.isArray(or)||ye(or)||ps(or)?Pr=or:(he.type(or,"object","invalid arguments for elements"),"data"in or&&(Pr=or.data,he(Array.isArray(Pr)||ye(Pr)||ps(Pr),"invalid data for element buffer")),"usage"in or&&(he.parameter(or.usage,ya,"invalid element buffer usage"),Yr=ya[or.usage]),"primitive"in or&&(he.parameter(or.primitive,tr,"invalid element buffer primitive"),Nn=tr[or.primitive]),"count"in or&&(he(typeof or.count=="number"&&or.count>=0,"invalid vertex count for elements"),qt=or.count|0),"type"in or&&(he.parameter(or.type,Yt,"invalid buffer type"),hn=Yt[or.type]),"length"in or?Qt=or.length|0:(Qt=qt,hn===Ea||hn===ua?Qt*=2:(hn===ms||hn===zi)&&(Qt*=4))),Tr(gr,Pr,Yr,Nn,qt,Qt,hn)}return Fr}return Fr(Cr),Fr._reglType="elements",Fr._elements=gr,Fr.subdata=function(or,Pr){return Ut.subdata(or,Pr),Fr},Fr.destroy=function(){Zr(gr)},Fr}return{create:vr,createStream:mr,destroyStream:Sr,getElements:function(Cr){return typeof Cr=="function"&&Cr._elements instanceof sr?Cr._elements:null},clear:function(){J(rr).forEach(Zr)}}}var Mc=new Float32Array(1),Su=new Uint32Array(Mc.buffer),Cu=5123;function Au(z){for(var fe=Ct.allocType(Cu,z.length),De=0;De<z.length;++De)if(isNaN(z[De]))fe[De]=65535;else if(z[De]===Infinity)fe[De]=31744;else if(z[De]===-Infinity)fe[De]=64512;else{Mc[0]=z[De];var Ot=Su[0],rr=Ot>>>31<<15,Pt=(Ot<<1>>>24)-127,Yt=Ot>>13&(1<<10)-1;if(Pt<-24)fe[De]=rr;else if(Pt<-14){var sr=-14-Pt;fe[De]=rr+(Yt+(1<<10)>>sr)}else Pt>15?fe[De]=rr+31744:fe[De]=rr+(Pt+15<<10)+Yt}return fe}function lo(z){return Array.isArray(z)||ye(z)}var Zf=function(z){return!(z&z-1)&&!!z},jf=34467,$o=3553,Pc=34067,wu=34069,ru=6408,of=6406,Pl=6407,Oi=6409,Il=6410,Mp=32854,cl=32855,Ic=36194,Vf=32819,Pp=32820,Gf=33635,Oc=34042,tc=6402,rc=34041,Ol=35904,fl=35906,Rl=36193,Xu=33776,Vs=33777,sf=33778,uf=33779,Hf=35986,nu=35987,nc=34798,Rc=35840,lf=35841,kl=35842,oh=35843,cf=36196,Ll=5121,ff=5123,pf=5125,Dl=5126,kc=10242,Ip=10243,Op=10497,ic=33071,Rp=33648,Fl=10240,Yi=10241,ac=9728,oa=9729,Tu=9984,Vi=9985,Ma=9986,gs=9987,Lc=33170,Yu=4352,Na=4353,oc=4354,Bl=34046,qu=3317,Dc=37440,Mu=37441,vo=37443,Nl=37444,sc=33984,mo=[Tu,Ma,Vi,gs],pn=[0,Oi,Il,Pl,ru],co={};co[Oi]=co[of]=co[tc]=1,co[rc]=co[Il]=2,co[Pl]=co[Ol]=3,co[ru]=co[fl]=4;function Ku(z){return"[object "+z+"]"}var Ra=Ku("HTMLCanvasElement"),Gs=Ku("OffscreenCanvas"),ws=Ku("CanvasRenderingContext2D"),hf=Ku("ImageBitmap"),Ur=Ku("HTMLImageElement"),uc=Ku("HTMLVideoElement"),df=Object.keys(Oa).concat([Ra,Gs,ws,hf,Ur,uc]),pl=[];pl[Ll]=1,pl[Dl]=4,pl[Rl]=2,pl[ff]=2,pl[pf]=4;var Sa=[];Sa[Mp]=2,Sa[cl]=2,Sa[Ic]=2,Sa[rc]=4,Sa[Xu]=.5,Sa[Vs]=.5,Sa[sf]=1,Sa[uf]=1,Sa[Hf]=.5,Sa[nu]=1,Sa[nc]=1,Sa[Rc]=.5,Sa[lf]=.25,Sa[kl]=.5,Sa[oh]=.25,Sa[cf]=.5;function ys(z){return Array.isArray(z)&&(z.length===0||typeof z[0]=="number")}function vf(z){if(!Array.isArray(z))return!1;var fe=z.length;return!(fe===0||!lo(z[0]))}function Pu(z){return Object.prototype.toString.call(z)}function ks(z){return Pu(z)===Ra}function Iu(z){return Pu(z)===Gs}function Wf(z){return Pu(z)===ws}function hl(z){return Pu(z)===hf}function Xf(z){return Pu(z)===Ur}function mf(z){return Pu(z)===uc}function iu(z){var fe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(fe&&z&&z.getContext)}function Ts(z){var fe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(fe&&z&&"src"in z&&"crossOrigin"in z)}function Si(z){if(!z)return!1;if(iu(z)||Ts(z))return!0;var fe=Pu(z);return df.indexOf(fe)>=0?!0:ys(z)||vf(z)||ps(z)}function Ou(z){return Oa[Object.prototype.toString.call(z)]|0}function au(z,fe){var De=fe.length;switch(z.type){case Ll:case ff:case pf:case Dl:var Ot=Ct.allocType(z.type,De);Ot.set(fe),z.data=Ot;break;case Rl:z.data=Au(fe);break;default:he.raise("unsupported texture type, must specify a typed array")}}function Xo(z,fe){return Ct.allocType(z.type===Rl?Dl:z.type,fe)}function dl(z,fe){z.type===Rl?(z.data=Au(fe),Ct.freeType(fe)):z.data=fe}function ns(z,fe,De,Ot,rr,Pt){for(var Yt=z.width,sr=z.height,dr=z.channels,mr=Yt*sr*dr,Sr=Xo(z,mr),Tr=0,Zr=0;Zr<sr;++Zr)for(var vr=0;vr<Yt;++vr)for(var Cr=0;Cr<dr;++Cr)Sr[Tr++]=fe[De*vr+Ot*Zr+rr*Cr+Pt];dl(z,Sr)}function Hs(z,fe,De,Ot,rr,Pt){var Yt;if(typeof Sa[z]!="undefined"?Yt=Sa[z]:Yt=co[z]*pl[fe],Pt&&(Yt*=6),rr){for(var sr=0,dr=De;dr>=1;)sr+=Yt*dr*dr,dr/=2;return sr}else return Yt*De*Ot}function _s(z,fe,De,Ot,rr,Pt,Yt){var sr={"don't care":Yu,"dont care":Yu,nice:oc,fast:Na},dr={repeat:Op,clamp:ic,mirror:Rp},mr={nearest:ac,linear:oa},Sr=m({mipmap:gs,"nearest mipmap nearest":Tu,"linear mipmap nearest":Vi,"nearest mipmap linear":Ma,"linear mipmap linear":gs},mr),Tr={none:0,browser:Nl},Zr={uint8:Ll,rgba4:Vf,rgb565:Gf,"rgb5 a1":Pp},vr={alpha:of,luminance:Oi,"luminance alpha":Il,rgb:Pl,rgba:ru,rgba4:Mp,"rgb5 a1":cl,rgb565:Ic},Cr={};fe.ext_srgb&&(vr.srgb=Ol,vr.srgba=fl),fe.oes_texture_float&&(Zr.float32=Zr.float=Dl),fe.oes_texture_half_float&&(Zr.float16=Zr["half float"]=Rl),fe.webgl_depth_texture&&(m(vr,{depth:tc,"depth stencil":rc}),m(Zr,{uint16:ff,uint32:pf,"depth stencil":Oc})),fe.webgl_compressed_texture_s3tc&&m(Cr,{"rgb s3tc dxt1":Xu,"rgba s3tc dxt1":Vs,"rgba s3tc dxt3":sf,"rgba s3tc dxt5":uf}),fe.webgl_compressed_texture_atc&&m(Cr,{"rgb atc":Hf,"rgba atc explicit alpha":nu,"rgba atc interpolated alpha":nc}),fe.webgl_compressed_texture_pvrtc&&m(Cr,{"rgb pvrtc 4bppv1":Rc,"rgb pvrtc 2bppv1":lf,"rgba pvrtc 4bppv1":kl,"rgba pvrtc 2bppv1":oh}),fe.webgl_compressed_texture_etc1&&(Cr["rgb etc1"]=cf);var nt=Array.prototype.slice.call(z.getParameter(jf)||new Uint32Array(0));Object.keys(Cr).forEach(function(we){var Dt=Cr[we];nt.indexOf(Dt)>=0&&(vr[we]=Dt)});var Ut=Object.keys(vr);De.textureFormats=Ut;var gr=[];Object.keys(vr).forEach(function(we){var Dt=vr[we];gr[Dt]=we});var Fr=[];Object.keys(Zr).forEach(function(we){var Dt=Zr[we];Fr[Dt]=we});var or=[];Object.keys(mr).forEach(function(we){var Dt=mr[we];or[Dt]=we});var Pr=[];Object.keys(Sr).forEach(function(we){var Dt=Sr[we];Pr[Dt]=we});var Yr=[];Object.keys(dr).forEach(function(we){var Dt=dr[we];Yr[Dt]=we});var Nn=Ut.reduce(function(we,Dt){var gt=vr[Dt];return gt===Oi||gt===of||gt===Oi||gt===Il||gt===tc||gt===rc||fe.ext_srgb&&(gt===Ol||gt===fl)?we[gt]=gt:gt===cl||Dt.indexOf("rgba")>=0?we[gt]=ru:we[gt]=Pl,we},{});function qt(){this.internalformat=ru,this.format=ru,this.type=Ll,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Nl,this.width=0,this.height=0,this.channels=0}function Qt(we,Dt){we.internalformat=Dt.internalformat,we.format=Dt.format,we.type=Dt.type,we.compressed=Dt.compressed,we.premultiplyAlpha=Dt.premultiplyAlpha,we.flipY=Dt.flipY,we.unpackAlignment=Dt.unpackAlignment,we.colorSpace=Dt.colorSpace,we.width=Dt.width,we.height=Dt.height,we.channels=Dt.channels}function hn(we,Dt){if(!(typeof Dt!="object"||!Dt)){if("premultiplyAlpha"in Dt&&(he.type(Dt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=Dt.premultiplyAlpha),"flipY"in Dt&&(he.type(Dt.flipY,"boolean","invalid texture flip"),we.flipY=Dt.flipY),"alignment"in Dt&&(he.oneOf(Dt.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=Dt.alignment),"colorSpace"in Dt&&(he.parameter(Dt.colorSpace,Tr,"invalid colorSpace"),we.colorSpace=Tr[Dt.colorSpace]),"type"in Dt){var gt=Dt.type;he(fe.oes_texture_float||!(gt==="float"||gt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),he(fe.oes_texture_half_float||!(gt==="half float"||gt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),he(fe.webgl_depth_texture||!(gt==="uint16"||gt==="uint32"||gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(gt,Zr,"invalid texture type"),we.type=Zr[gt]}var dn=we.width,Ui=we.height,xe=we.channels,ie=!1;"shape"in Dt?(he(Array.isArray(Dt.shape)&&Dt.shape.length>=2,"shape must be an array"),dn=Dt.shape[0],Ui=Dt.shape[1],Dt.shape.length===3&&(xe=Dt.shape[2],he(xe>0&&xe<=4,"invalid number of channels"),ie=!0),he(dn>=0&&dn<=De.maxTextureSize,"invalid width"),he(Ui>=0&&Ui<=De.maxTextureSize,"invalid height")):("radius"in Dt&&(dn=Ui=Dt.radius,he(dn>=0&&dn<=De.maxTextureSize,"invalid radius")),"width"in Dt&&(dn=Dt.width,he(dn>=0&&dn<=De.maxTextureSize,"invalid width")),"height"in Dt&&(Ui=Dt.height,he(Ui>=0&&Ui<=De.maxTextureSize,"invalid height")),"channels"in Dt&&(xe=Dt.channels,he(xe>0&&xe<=4,"invalid number of channels"),ie=!0)),we.width=dn|0,we.height=Ui|0,we.channels=xe|0;var Ze=!1;if("format"in Dt){var it=Dt.format;he(fe.webgl_depth_texture||!(it==="depth"||it==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(it,vr,"invalid texture format");var wt=we.internalformat=vr[it];we.format=Nn[wt],it in Zr&&("type"in Dt||(we.type=Zr[it])),it in Cr&&(we.compressed=!0),Ze=!0}!ie&&Ze?we.channels=co[we.format]:ie&&!Ze?we.channels!==pn[we.format]&&(we.format=we.internalformat=pn[we.channels]):Ze&&ie&&he(we.channels===co[we.format],"number of channels inconsistent with specified format")}}function Wr(we){z.pixelStorei(Dc,we.flipY),z.pixelStorei(Mu,we.premultiplyAlpha),z.pixelStorei(vo,we.colorSpace),z.pixelStorei(qu,we.unpackAlignment)}function br(){qt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Xr(we,Dt){var gt=null;if(Si(Dt)?gt=Dt:Dt&&(he.type(Dt,"object","invalid pixel data type"),hn(we,Dt),"x"in Dt&&(we.xOffset=Dt.x|0),"y"in Dt&&(we.yOffset=Dt.y|0),Si(Dt.data)&&(gt=Dt.data)),he(!we.compressed||gt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Dt.copy){he(!gt,"can not specify copy and data field for the same texture");var dn=rr.viewportWidth,Ui=rr.viewportHeight;we.width=we.width||dn-we.xOffset,we.height=we.height||Ui-we.yOffset,we.needsCopy=!0,he(we.xOffset>=0&&we.xOffset<dn&&we.yOffset>=0&&we.yOffset<Ui&&we.width>0&&we.width<=dn&&we.height>0&&we.height<=Ui,"copy texture read out of bounds")}else if(!gt)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(ye(gt))we.channels=we.channels||4,we.data=gt,!("type"in Dt)&&we.type===Ll&&(we.type=Ou(gt));else if(ys(gt))we.channels=we.channels||4,au(we,gt),we.alignment=1,we.needsFree=!0;else if(ps(gt)){var xe=gt.data;!Array.isArray(xe)&&we.type===Ll&&(we.type=Ou(xe));var ie=gt.shape,Ze=gt.stride,it,wt,Xe,Le,Je,ve;ie.length===3?(Xe=ie[2],ve=Ze[2]):(he(ie.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Xe=1,ve=1),it=ie[0],wt=ie[1],Le=Ze[0],Je=Ze[1],we.alignment=1,we.width=it,we.height=wt,we.channels=Xe,we.format=we.internalformat=pn[Xe],we.needsFree=!0,ns(we,xe,Le,Je,ve,gt.offset)}else if(iu(gt)||ks(gt)||Iu(gt)||Wf(gt))iu(gt)||ks(gt)||Iu(gt)?we.element=gt:we.element=gt.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(hl(gt))we.element=gt,we.width=gt.width,we.height=gt.height,we.channels=4;else if(Xf(gt))we.element=gt,we.width=gt.naturalWidth,we.height=gt.naturalHeight,we.channels=4;else if(Ts(gt))we.element=gt,we.width=gt.width,we.height=gt.height,we.channels=4;else if(mf(gt))we.element=gt,we.width=gt.videoWidth,we.height=gt.videoHeight,we.channels=4;else if(vf(gt)){var ze=we.width||gt[0].length,Se=we.height||gt.length,at=we.channels;lo(gt[0][0])?at=at||gt[0][0].length:at=at||1;for(var yt=ge.shape(gt),lr=1,Br=0;Br<yt.length;++Br)lr*=yt[Br];var Nr=Xo(we,lr);ge.flatten(gt,yt,"",Nr),dl(we,Nr),we.alignment=1,we.width=ze,we.height=Se,we.channels=at,we.format=we.internalformat=pn[at],we.needsFree=!0}we.type===Dl?he(De.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===Rl&&he(De.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function qr(we,Dt,gt){var dn=we.element,Ui=we.data,xe=we.internalformat,ie=we.format,Ze=we.type,it=we.width,wt=we.height;Wr(we),dn?z.texImage2D(Dt,gt,ie,ie,Ze,dn):we.compressed?z.compressedTexImage2D(Dt,gt,xe,it,wt,0,Ui):we.needsCopy?(Ot(),z.copyTexImage2D(Dt,gt,ie,we.xOffset,we.yOffset,it,wt,0)):z.texImage2D(Dt,gt,ie,it,wt,0,ie,Ze,Ui||null)}function yi(we,Dt,gt,dn,Ui){var xe=we.element,ie=we.data,Ze=we.internalformat,it=we.format,wt=we.type,Xe=we.width,Le=we.height;Wr(we),xe?z.texSubImage2D(Dt,Ui,gt,dn,it,wt,xe):we.compressed?z.compressedTexSubImage2D(Dt,Ui,gt,dn,Ze,Xe,Le,ie):we.needsCopy?(Ot(),z.copyTexSubImage2D(Dt,Ui,gt,dn,we.xOffset,we.yOffset,Xe,Le)):z.texSubImage2D(Dt,Ui,gt,dn,Xe,Le,it,wt,ie)}var Jn=[];function jr(){return Jn.pop()||new br}function Jr(we){we.needsFree&&Ct.freeType(we.data),br.call(we),Jn.push(we)}function Kn(){qt.call(this),this.genMipmaps=!1,this.mipmapHint=Yu,this.mipmask=0,this.images=Array(16)}function si(we,Dt,gt){var dn=we.images[0]=jr();we.mipmask=1,dn.width=we.width=Dt,dn.height=we.height=gt,dn.channels=we.channels=4}function Fi(we,Dt){var gt=null;if(Si(Dt))gt=we.images[0]=jr(),Qt(gt,we),Xr(gt,Dt),we.mipmask=1;else if(hn(we,Dt),Array.isArray(Dt.mipmap))for(var dn=Dt.mipmap,Ui=0;Ui<dn.length;++Ui)gt=we.images[Ui]=jr(),Qt(gt,we),gt.width>>=Ui,gt.height>>=Ui,Xr(gt,dn[Ui]),we.mipmask|=1<<Ui;else gt=we.images[0]=jr(),Qt(gt,we),Xr(gt,Dt),we.mipmask=1;Qt(we,we.images[0]),we.compressed&&(we.internalformat===Xu||we.internalformat===Vs||we.internalformat===sf||we.internalformat===uf)&&he(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function qa(we,Dt){for(var gt=we.images,dn=0;dn<gt.length;++dn){if(!gt[dn])return;qr(gt[dn],Dt,dn)}}var io=[];function Ri(){var we=io.pop()||new Kn;qt.call(we),we.mipmask=0;for(var Dt=0;Dt<16;++Dt)we.images[Dt]=null;return we}function Yo(we){for(var Dt=we.images,gt=0;gt<Dt.length;++gt)Dt[gt]&&Jr(Dt[gt]),Dt[gt]=null;io.push(we)}function za(){this.minFilter=ac,this.magFilter=ac,this.wrapS=ic,this.wrapT=ic,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Yu}function qo(we,Dt){if("min"in Dt){var gt=Dt.min;he.parameter(gt,Sr),we.minFilter=Sr[gt],mo.indexOf(we.minFilter)>=0&&!("faces"in Dt)&&(we.genMipmaps=!0)}if("mag"in Dt){var dn=Dt.mag;he.parameter(dn,mr),we.magFilter=mr[dn]}var Ui=we.wrapS,xe=we.wrapT;if("wrap"in Dt){var ie=Dt.wrap;typeof ie=="string"?(he.parameter(ie,dr),Ui=xe=dr[ie]):Array.isArray(ie)&&(he.parameter(ie[0],dr),he.parameter(ie[1],dr),Ui=dr[ie[0]],xe=dr[ie[1]])}else{if("wrapS"in Dt){var Ze=Dt.wrapS;he.parameter(Ze,dr),Ui=dr[Ze]}if("wrapT"in Dt){var it=Dt.wrapT;he.parameter(it,dr),xe=dr[it]}}if(we.wrapS=Ui,we.wrapT=xe,"anisotropic"in Dt){var wt=Dt.anisotropic;he(typeof wt=="number"&&wt>=1&&wt<=De.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=Dt.anisotropic}if("mipmap"in Dt){var Xe=!1;switch(typeof Dt.mipmap){case"string":he.parameter(Dt.mipmap,sr,"invalid mipmap hint"),we.mipmapHint=sr[Dt.mipmap],we.genMipmaps=!0,Xe=!0;break;case"boolean":Xe=we.genMipmaps=Dt.mipmap;break;case"object":he(Array.isArray(Dt.mipmap),"invalid mipmap type"),we.genMipmaps=!1,Xe=!0;break;default:he.raise("invalid mipmap type")}Xe&&!("min"in Dt)&&(we.minFilter=Tu)}}function Co(we,Dt){z.texParameteri(Dt,Yi,we.minFilter),z.texParameteri(Dt,Fl,we.magFilter),z.texParameteri(Dt,kc,we.wrapS),z.texParameteri(Dt,Ip,we.wrapT),fe.ext_texture_filter_anisotropic&&z.texParameteri(Dt,Bl,we.anisotropic),we.genMipmaps&&(z.hint(Lc,we.mipmapHint),z.generateMipmap(Dt))}var Uo=0,Zo={},ss=De.maxTextureUnits,ao=Array(ss).map(function(){return null});function hi(we){qt.call(this),this.mipmask=0,this.internalformat=ru,this.id=Uo++,this.refCount=1,this.target=we,this.texture=z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new za,Yt.profile&&(this.stats={size:0})}function Po(we){z.activeTexture(sc),z.bindTexture(we.target,we.texture)}function Xi(){var we=ao[0];we?z.bindTexture(we.target,we.texture):z.bindTexture($o,null)}function Qo(we){var Dt=we.texture;he(Dt,"must not double destroy texture");var gt=we.unit,dn=we.target;gt>=0&&(z.activeTexture(sc+gt),z.bindTexture(dn,null),ao[gt]=null),z.deleteTexture(Dt),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Zo[we.id],Pt.textureCount--}m(hi.prototype,{bind:function(){var we=this;we.bindCount+=1;var Dt=we.unit;if(Dt<0){for(var gt=0;gt<ss;++gt){var dn=ao[gt];if(dn){if(dn.bindCount>0)continue;dn.unit=-1}ao[gt]=we,Dt=gt;break}Dt>=ss&&he.raise("insufficient number of texture units"),Yt.profile&&Pt.maxTextureUnits<Dt+1&&(Pt.maxTextureUnits=Dt+1),we.unit=Dt,z.activeTexture(sc+Dt),z.bindTexture(we.target,we.texture)}return Dt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Qo(this)}});function ei(we,Dt){var gt=new hi($o);Zo[gt.id]=gt,Pt.textureCount++;function dn(ie,Ze){var it=gt.texInfo;za.call(it);var wt=Ri();return typeof ie=="number"?typeof Ze=="number"?si(wt,ie|0,Ze|0):si(wt,ie|0,ie|0):ie?(he.type(ie,"object","invalid arguments to regl.texture"),qo(it,ie),Fi(wt,ie)):si(wt,1,1),it.genMipmaps&&(wt.mipmask=(wt.width<<1)-1),gt.mipmask=wt.mipmask,Qt(gt,wt),he.texture2D(it,wt,De),gt.internalformat=wt.internalformat,dn.width=wt.width,dn.height=wt.height,Po(gt),qa(wt,$o),Co(it,$o),Xi(),Yo(wt),Yt.profile&&(gt.stats.size=Hs(gt.internalformat,gt.type,wt.width,wt.height,it.genMipmaps,!1)),dn.format=gr[gt.internalformat],dn.type=Fr[gt.type],dn.mag=or[it.magFilter],dn.min=Pr[it.minFilter],dn.wrapS=Yr[it.wrapS],dn.wrapT=Yr[it.wrapT],dn}function Ui(ie,Ze,it,wt){he(!!ie,"must specify image data");var Xe=Ze|0,Le=it|0,Je=wt|0,ve=jr();return Qt(ve,gt),ve.width=0,ve.height=0,Xr(ve,ie),ve.width=ve.width||(gt.width>>Je)-Xe,ve.height=ve.height||(gt.height>>Je)-Le,he(gt.type===ve.type&&gt.format===ve.format&&gt.internalformat===ve.internalformat,"incompatible format for texture.subimage"),he(Xe>=0&&Le>=0&&Xe+ve.width<=gt.width&&Le+ve.height<=gt.height,"texture.subimage write out of bounds"),he(gt.mipmask&1<<Je,"missing mipmap data"),he(ve.data||ve.element||ve.needsCopy,"missing image data"),Po(gt),yi(ve,$o,Xe,Le,Je),Xi(),Jr(ve),dn}function xe(ie,Ze){var it=ie|0,wt=Ze|0||it;if(it===gt.width&&wt===gt.height)return dn;dn.width=gt.width=it,dn.height=gt.height=wt,Po(gt);for(var Xe=0;gt.mipmask>>Xe;++Xe){var Le=it>>Xe,Je=wt>>Xe;if(!Le||!Je)break;z.texImage2D($o,Xe,gt.format,Le,Je,0,gt.format,gt.type,null)}return Xi(),Yt.profile&&(gt.stats.size=Hs(gt.internalformat,gt.type,it,wt,!1,!1)),dn}return dn(we,Dt),dn.subimage=Ui,dn.resize=xe,dn._reglType="texture2d",dn._texture=gt,Yt.profile&&(dn.stats=gt.stats),dn.destroy=function(){gt.decRef()},dn}function ki(we,Dt,gt,dn,Ui,xe){var ie=new hi(Pc);Zo[ie.id]=ie,Pt.cubeCount++;var Ze=new Array(6);function it(Le,Je,ve,ze,Se,at){var yt,lr=ie.texInfo;for(za.call(lr),yt=0;yt<6;++yt)Ze[yt]=Ri();if(typeof Le=="number"||!Le){var Br=Le|0||1;for(yt=0;yt<6;++yt)si(Ze[yt],Br,Br)}else if(typeof Le=="object")if(Je)Fi(Ze[0],Le),Fi(Ze[1],Je),Fi(Ze[2],ve),Fi(Ze[3],ze),Fi(Ze[4],Se),Fi(Ze[5],at);else if(qo(lr,Le),hn(ie,Le),"faces"in Le){var Nr=Le.faces;for(he(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),yt=0;yt<6;++yt)he(typeof Nr[yt]=="object"&&!!Nr[yt],"invalid input for cube map face"),Qt(Ze[yt],ie),Fi(Ze[yt],Nr[yt])}else for(yt=0;yt<6;++yt)Fi(Ze[yt],Le);else he.raise("invalid arguments to cube map");for(Qt(ie,Ze[0]),he.optional(function(){De.npotTextureCube||he(Zf(ie.width)&&Zf(ie.height),"your browser does not support non power or two texture dimensions")}),lr.genMipmaps?ie.mipmask=(Ze[0].width<<1)-1:ie.mipmask=Ze[0].mipmask,he.textureCube(ie,lr,Ze,De),ie.internalformat=Ze[0].internalformat,it.width=Ze[0].width,it.height=Ze[0].height,Po(ie),yt=0;yt<6;++yt)qa(Ze[yt],wu+yt);for(Co(lr,Pc),Xi(),Yt.profile&&(ie.stats.size=Hs(ie.internalformat,ie.type,it.width,it.height,lr.genMipmaps,!0)),it.format=gr[ie.internalformat],it.type=Fr[ie.type],it.mag=or[lr.magFilter],it.min=Pr[lr.minFilter],it.wrapS=Yr[lr.wrapS],it.wrapT=Yr[lr.wrapT],yt=0;yt<6;++yt)Yo(Ze[yt]);return it}function wt(Le,Je,ve,ze,Se){he(!!Je,"must specify image data"),he(typeof Le=="number"&&Le===(Le|0)&&Le>=0&&Le<6,"invalid face");var at=ve|0,yt=ze|0,lr=Se|0,Br=jr();return Qt(Br,ie),Br.width=0,Br.height=0,Xr(Br,Je),Br.width=Br.width||(ie.width>>lr)-at,Br.height=Br.height||(ie.height>>lr)-yt,he(ie.type===Br.type&&ie.format===Br.format&&ie.internalformat===Br.internalformat,"incompatible format for texture.subimage"),he(at>=0&&yt>=0&&at+Br.width<=ie.width&&yt+Br.height<=ie.height,"texture.subimage write out of bounds"),he(ie.mipmask&1<<lr,"missing mipmap data"),he(Br.data||Br.element||Br.needsCopy,"missing image data"),Po(ie),yi(Br,wu+Le,at,yt,lr),Xi(),Jr(Br),it}function Xe(Le){var Je=Le|0;if(Je!==ie.width){it.width=ie.width=Je,it.height=ie.height=Je,Po(ie);for(var ve=0;ve<6;++ve)for(var ze=0;ie.mipmask>>ze;++ze)z.texImage2D(wu+ve,ze,ie.format,Je>>ze,Je>>ze,0,ie.format,ie.type,null);return Xi(),Yt.profile&&(ie.stats.size=Hs(ie.internalformat,ie.type,it.width,it.height,!1,!0)),it}}return it(we,Dt,gt,dn,Ui,xe),it.subimage=wt,it.resize=Xe,it._reglType="textureCube",it._texture=ie,Yt.profile&&(it.stats=ie.stats),it.destroy=function(){ie.decRef()},it}function xn(){for(var we=0;we<ss;++we)z.activeTexture(sc+we),z.bindTexture($o,null),ao[we]=null;J(Zo).forEach(Qo),Pt.cubeCount=0,Pt.textureCount=0}Yt.profile&&(Pt.getTotalTextureSize=function(){var we=0;return Object.keys(Zo).forEach(function(Dt){we+=Zo[Dt].stats.size}),we});function Ln(){for(var we=0;we<ss;++we){var Dt=ao[we];Dt&&(Dt.bindCount=0,Dt.unit=-1,ao[we]=null)}J(Zo).forEach(function(gt){gt.texture=z.createTexture(),z.bindTexture(gt.target,gt.texture);for(var dn=0;dn<32;++dn)if((gt.mipmask&1<<dn)!=0)if(gt.target===$o)z.texImage2D($o,dn,gt.internalformat,gt.width>>dn,gt.height>>dn,0,gt.internalformat,gt.type,null);else for(var Ui=0;Ui<6;++Ui)z.texImage2D(wu+Ui,dn,gt.internalformat,gt.width>>dn,gt.height>>dn,0,gt.internalformat,gt.type,null);Co(gt.texInfo,gt.target)})}function il(){for(var we=0;we<ss;++we){var Dt=ao[we];Dt&&(Dt.bindCount=0,Dt.unit=-1,ao[we]=null),z.activeTexture(sc+we),z.bindTexture($o,null),z.bindTexture(Pc,null)}}return{create2D:ei,createCube:ki,clear:xn,getTexture:function(we){return null},restore:Ln,refresh:il}}var pu=36161,In=32854,Cn=32855,Fc=36194,is=33189,ou=36168,Bo=34041,Ru=35907,gf=34836,yf=34842,la=34843,da=[];da[In]=2,da[Cn]=2,da[Fc]=2,da[is]=2,da[ou]=1,da[Bo]=4,da[Ru]=4,da[gf]=16,da[yf]=8,da[la]=6;function kp(z,fe,De){return da[z]*fe*De}var $u=function(z,fe,De,Ot,rr){var Pt={rgba4:In,rgb565:Fc,"rgb5 a1":Cn,depth:is,stencil:ou,"depth stencil":Bo};fe.ext_srgb&&(Pt.srgba=Ru),fe.ext_color_buffer_half_float&&(Pt.rgba16f=yf,Pt.rgb16f=la),fe.webgl_color_buffer_float&&(Pt.rgba32f=gf);var Yt=[];Object.keys(Pt).forEach(function(vr){var Cr=Pt[vr];Yt[Cr]=vr});var sr=0,dr={};function mr(vr){this.id=sr++,this.refCount=1,this.renderbuffer=vr,this.format=In,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}mr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(vr){var Cr=vr.renderbuffer;he(Cr,"must not double destroy renderbuffer"),z.bindRenderbuffer(pu,null),z.deleteRenderbuffer(Cr),vr.renderbuffer=null,vr.refCount=0,delete dr[vr.id],Ot.renderbufferCount--}function Tr(vr,Cr){var nt=new mr(z.createRenderbuffer());dr[nt.id]=nt,Ot.renderbufferCount++;function Ut(Fr,or){var Pr=0,Yr=0,Nn=In;if(typeof Fr=="object"&&Fr){var qt=Fr;if("shape"in qt){var Qt=qt.shape;he(Array.isArray(Qt)&&Qt.length>=2,"invalid renderbuffer shape"),Pr=Qt[0]|0,Yr=Qt[1]|0}else"radius"in qt&&(Pr=Yr=qt.radius|0),"width"in qt&&(Pr=qt.width|0),"height"in qt&&(Yr=qt.height|0);"format"in qt&&(he.parameter(qt.format,Pt,"invalid renderbuffer format"),Nn=Pt[qt.format])}else typeof Fr=="number"?(Pr=Fr|0,typeof or=="number"?Yr=or|0:Yr=Pr):Fr?he.raise("invalid arguments to renderbuffer constructor"):Pr=Yr=1;if(he(Pr>0&&Yr>0&&Pr<=De.maxRenderbufferSize&&Yr<=De.maxRenderbufferSize,"invalid renderbuffer size"),!(Pr===nt.width&&Yr===nt.height&&Nn===nt.format))return Ut.width=nt.width=Pr,Ut.height=nt.height=Yr,nt.format=Nn,z.bindRenderbuffer(pu,nt.renderbuffer),z.renderbufferStorage(pu,Nn,Pr,Yr),he(z.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=kp(nt.format,nt.width,nt.height)),Ut.format=Yt[nt.format],Ut}function gr(Fr,or){var Pr=Fr|0,Yr=or|0||Pr;return Pr===nt.width&&Yr===nt.height||(he(Pr>0&&Yr>0&&Pr<=De.maxRenderbufferSize&&Yr<=De.maxRenderbufferSize,"invalid renderbuffer size"),Ut.width=nt.width=Pr,Ut.height=nt.height=Yr,z.bindRenderbuffer(pu,nt.renderbuffer),z.renderbufferStorage(pu,nt.format,Pr,Yr),he(z.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=kp(nt.format,nt.width,nt.height))),Ut}return Ut(vr,Cr),Ut.resize=gr,Ut._reglType="renderbuffer",Ut._renderbuffer=nt,rr.profile&&(Ut.stats=nt.stats),Ut.destroy=function(){nt.decRef()},Ut}rr.profile&&(Ot.getTotalRenderbufferSize=function(){var vr=0;return Object.keys(dr).forEach(function(Cr){vr+=dr[Cr].stats.size}),vr});function Zr(){J(dr).forEach(function(vr){vr.renderbuffer=z.createRenderbuffer(),z.bindRenderbuffer(pu,vr.renderbuffer),z.renderbufferStorage(pu,vr.format,vr.width,vr.height)}),z.bindRenderbuffer(pu,null)}return{create:Tr,clear:function(){J(dr).forEach(Sr)},restore:Zr}},hu=36160,Gi=36161,no=3553,Ws=34069,Xs=36064,vl=36096,ku=36128,zl=33306,ja=36053,su=36054,du=36055,Yf=36057,ml=36061,Qu=36193,_f=5121,gl=5126,Ms=6407,lc=6408,Bc=6402,xf=[Ms,lc],cc=[];cc[lc]=4,cc[Ms]=3;var l=[];l[_f]=1,l[gl]=4,l[Qu]=2;var f=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,U=34836,H=34842,ae=34843,se=[f,c,d,L,H,ae,U],ue={};ue[ja]="complete",ue[su]="incomplete attachment",ue[Yf]="incomplete dimensions",ue[du]="incomplete, missing attachment",ue[ml]="unsupported";function Ie(z,fe,De,Ot,rr,Pt){var Yt={cur:null,next:null,dirty:!1,setFBO:null},sr=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];fe.ext_srgb&&dr.push("srgba"),fe.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),fe.webgl_color_buffer_float&&dr.push("rgba32f");var mr=["uint8"];fe.oes_texture_half_float&&mr.push("half float","float16"),fe.oes_texture_float&&mr.push("float","float32");function Sr(br,Xr,qr){this.target=br,this.texture=Xr,this.renderbuffer=qr;var yi=0,Jn=0;Xr?(yi=Xr.width,Jn=Xr.height):qr&&(yi=qr.width,Jn=qr.height),this.width=yi,this.height=Jn}function Tr(br){br&&(br.texture&&br.texture._texture.decRef(),br.renderbuffer&&br.renderbuffer._renderbuffer.decRef())}function Zr(br,Xr,qr){if(!!br)if(br.texture){var yi=br.texture._texture,Jn=Math.max(1,yi.width),jr=Math.max(1,yi.height);he(Jn===Xr&&jr===qr,"inconsistent width/height for supplied texture"),yi.refCount+=1}else{var Jr=br.renderbuffer._renderbuffer;he(Jr.width===Xr&&Jr.height===qr,"inconsistent width/height for renderbuffer"),Jr.refCount+=1}}function vr(br,Xr){Xr&&(Xr.texture?z.framebufferTexture2D(hu,br,Xr.target,Xr.texture._texture.texture,0):z.framebufferRenderbuffer(hu,br,Gi,Xr.renderbuffer._renderbuffer.renderbuffer))}function Cr(br){var Xr=no,qr=null,yi=null,Jn=br;typeof br=="object"&&(Jn=br.data,"target"in br&&(Xr=br.target|0)),he.type(Jn,"function","invalid attachment data");var jr=Jn._reglType;return jr==="texture2d"?(qr=Jn,he(Xr===no)):jr==="textureCube"?(qr=Jn,he(Xr>=Ws&&Xr<Ws+6,"invalid cube map target")):jr==="renderbuffer"?(yi=Jn,Xr=Gi):he.raise("invalid regl object for attachment"),new Sr(Xr,qr,yi)}function nt(br,Xr,qr,yi,Jn){if(qr){var jr=Ot.create2D({width:br,height:Xr,format:yi,type:Jn});return jr._texture.refCount=0,new Sr(no,jr,null)}else{var Jr=rr.create({width:br,height:Xr,format:yi});return Jr._renderbuffer.refCount=0,new Sr(Gi,null,Jr)}}function Ut(br){return br&&(br.texture||br.renderbuffer)}function gr(br,Xr,qr){br&&(br.texture?br.texture.resize(Xr,qr):br.renderbuffer&&br.renderbuffer.resize(Xr,qr),br.width=Xr,br.height=qr)}var Fr=0,or={};function Pr(){this.id=Fr++,or[this.id]=this,this.framebuffer=z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Yr(br){br.colorAttachments.forEach(Tr),Tr(br.depthAttachment),Tr(br.stencilAttachment),Tr(br.depthStencilAttachment)}function Nn(br){var Xr=br.framebuffer;he(Xr,"must not double destroy framebuffer"),z.deleteFramebuffer(Xr),br.framebuffer=null,Pt.framebufferCount--,delete or[br.id]}function qt(br){var Xr;z.bindFramebuffer(hu,br.framebuffer);var qr=br.colorAttachments;for(Xr=0;Xr<qr.length;++Xr)vr(Xs+Xr,qr[Xr]);for(Xr=qr.length;Xr<De.maxColorAttachments;++Xr)z.framebufferTexture2D(hu,Xs+Xr,no,null,0);z.framebufferTexture2D(hu,zl,no,null,0),z.framebufferTexture2D(hu,vl,no,null,0),z.framebufferTexture2D(hu,ku,no,null,0),vr(vl,br.depthAttachment),vr(ku,br.stencilAttachment),vr(zl,br.depthStencilAttachment);var yi=z.checkFramebufferStatus(hu);!z.isContextLost()&&yi!==ja&&he.raise("framebuffer configuration not supported, status = "+ue[yi]),z.bindFramebuffer(hu,Yt.next?Yt.next.framebuffer:null),Yt.cur=Yt.next,z.getError()}function Qt(br,Xr){var qr=new Pr;Pt.framebufferCount++;function yi(jr,Jr){var Kn;he(Yt.next!==qr,"can not update framebuffer which is currently in use");var si=0,Fi=0,qa=!0,io=!0,Ri=null,Yo=!0,za="rgba",qo="uint8",Co=1,Uo=null,Zo=null,ss=null,ao=!1;if(typeof jr=="number")si=jr|0,Fi=Jr|0||si;else if(!jr)si=Fi=1;else{he.type(jr,"object","invalid arguments for framebuffer");var hi=jr;if("shape"in hi){var Po=hi.shape;he(Array.isArray(Po)&&Po.length>=2,"invalid shape for framebuffer"),si=Po[0],Fi=Po[1]}else"radius"in hi&&(si=Fi=hi.radius),"width"in hi&&(si=hi.width),"height"in hi&&(Fi=hi.height);("color"in hi||"colors"in hi)&&(Ri=hi.color||hi.colors,Array.isArray(Ri)&&he(Ri.length===1||fe.webgl_draw_buffers,"multiple render targets not supported")),Ri||("colorCount"in hi&&(Co=hi.colorCount|0,he(Co>0,"invalid color buffer count")),"colorTexture"in hi&&(Yo=!!hi.colorTexture,za="rgba4"),"colorType"in hi&&(qo=hi.colorType,Yo?(he(fe.oes_texture_float||!(qo==="float"||qo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),he(fe.oes_texture_half_float||!(qo==="half float"||qo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):qo==="half float"||qo==="float16"?(he(fe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),za="rgba16f"):(qo==="float"||qo==="float32")&&(he(fe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),za="rgba32f"),he.oneOf(qo,mr,"invalid color type")),"colorFormat"in hi&&(za=hi.colorFormat,sr.indexOf(za)>=0?Yo=!0:dr.indexOf(za)>=0?Yo=!1:he.optional(function(){Yo?he.oneOf(hi.colorFormat,sr,"invalid color format for texture"):he.oneOf(hi.colorFormat,dr,"invalid color format for renderbuffer")}))),("depthTexture"in hi||"depthStencilTexture"in hi)&&(ao=!!(hi.depthTexture||hi.depthStencilTexture),he(!ao||fe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in hi&&(typeof hi.depth=="boolean"?qa=hi.depth:(Uo=hi.depth,io=!1)),"stencil"in hi&&(typeof hi.stencil=="boolean"?io=hi.stencil:(Zo=hi.stencil,qa=!1)),"depthStencil"in hi&&(typeof hi.depthStencil=="boolean"?qa=io=hi.depthStencil:(ss=hi.depthStencil,qa=!1,io=!1))}var Xi=null,Qo=null,ei=null,ki=null;if(Array.isArray(Ri))Xi=Ri.map(Cr);else if(Ri)Xi=[Cr(Ri)];else for(Xi=new Array(Co),Kn=0;Kn<Co;++Kn)Xi[Kn]=nt(si,Fi,Yo,za,qo);he(fe.webgl_draw_buffers||Xi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),he(Xi.length<=De.maxColorAttachments,"too many color attachments, not supported"),si=si||Xi[0].width,Fi=Fi||Xi[0].height,Uo?Qo=Cr(Uo):qa&&!io&&(Qo=nt(si,Fi,ao,"depth","uint32")),Zo?ei=Cr(Zo):io&&!qa&&(ei=nt(si,Fi,!1,"stencil","uint8")),ss?ki=Cr(ss):!Uo&&!Zo&&io&&qa&&(ki=nt(si,Fi,ao,"depth stencil","depth stencil")),he(!!Uo+!!Zo+!!ss<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var xn=null;for(Kn=0;Kn<Xi.length;++Kn)if(Zr(Xi[Kn],si,Fi),he(!Xi[Kn]||Xi[Kn].texture&&xf.indexOf(Xi[Kn].texture._texture.format)>=0||Xi[Kn].renderbuffer&&se.indexOf(Xi[Kn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Kn+" is invalid"),Xi[Kn]&&Xi[Kn].texture){var Ln=cc[Xi[Kn].texture._texture.format]*l[Xi[Kn].texture._texture.type];xn===null?xn=Ln:he(xn===Ln,"all color attachments much have the same number of bits per pixel.")}return Zr(Qo,si,Fi),he(!Qo||Qo.texture&&Qo.texture._texture.format===Bc||Qo.renderbuffer&&Qo.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Zr(ei,si,Fi),he(!ei||ei.renderbuffer&&ei.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Zr(ki,si,Fi),he(!ki||ki.texture&&ki.texture._texture.format===P||ki.renderbuffer&&ki.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),Yr(qr),qr.width=si,qr.height=Fi,qr.colorAttachments=Xi,qr.depthAttachment=Qo,qr.stencilAttachment=ei,qr.depthStencilAttachment=ki,yi.color=Xi.map(Ut),yi.depth=Ut(Qo),yi.stencil=Ut(ei),yi.depthStencil=Ut(ki),yi.width=qr.width,yi.height=qr.height,qt(qr),yi}function Jn(jr,Jr){he(Yt.next!==qr,"can not resize a framebuffer which is currently in use");var Kn=Math.max(jr|0,1),si=Math.max(Jr|0||Kn,1);if(Kn===qr.width&&si===qr.height)return yi;for(var Fi=qr.colorAttachments,qa=0;qa<Fi.length;++qa)gr(Fi[qa],Kn,si);return gr(qr.depthAttachment,Kn,si),gr(qr.stencilAttachment,Kn,si),gr(qr.depthStencilAttachment,Kn,si),qr.width=yi.width=Kn,qr.height=yi.height=si,qt(qr),yi}return yi(br,Xr),m(yi,{resize:Jn,_reglType:"framebuffer",_framebuffer:qr,destroy:function(){Nn(qr),Yr(qr)},use:function(jr){Yt.setFBO({framebuffer:yi},jr)}})}function hn(br){var Xr=Array(6);function qr(Jn){var jr;he(Xr.indexOf(Yt.next)<0,"can not update framebuffer which is currently in use");var Jr={color:null},Kn=0,si=null,Fi="rgba",qa="uint8",io=1;if(typeof Jn=="number")Kn=Jn|0;else if(!Jn)Kn=1;else{he.type(Jn,"object","invalid arguments for framebuffer");var Ri=Jn;if("shape"in Ri){var Yo=Ri.shape;he(Array.isArray(Yo)&&Yo.length>=2,"invalid shape for framebuffer"),he(Yo[0]===Yo[1],"cube framebuffer must be square"),Kn=Yo[0]}else"radius"in Ri&&(Kn=Ri.radius|0),"width"in Ri?(Kn=Ri.width|0,"height"in Ri&&he(Ri.height===Kn,"must be square")):"height"in Ri&&(Kn=Ri.height|0);("color"in Ri||"colors"in Ri)&&(si=Ri.color||Ri.colors,Array.isArray(si)&&he(si.length===1||fe.webgl_draw_buffers,"multiple render targets not supported")),si||("colorCount"in Ri&&(io=Ri.colorCount|0,he(io>0,"invalid color buffer count")),"colorType"in Ri&&(he.oneOf(Ri.colorType,mr,"invalid color type"),qa=Ri.colorType),"colorFormat"in Ri&&(Fi=Ri.colorFormat,he.oneOf(Ri.colorFormat,sr,"invalid color format for texture"))),"depth"in Ri&&(Jr.depth=Ri.depth),"stencil"in Ri&&(Jr.stencil=Ri.stencil),"depthStencil"in Ri&&(Jr.depthStencil=Ri.depthStencil)}var za;if(si)if(Array.isArray(si))for(za=[],jr=0;jr<si.length;++jr)za[jr]=si[jr];else za=[si];else{za=Array(io);var qo={radius:Kn,format:Fi,type:qa};for(jr=0;jr<io;++jr)za[jr]=Ot.createCube(qo)}for(Jr.color=Array(za.length),jr=0;jr<za.length;++jr){var Co=za[jr];he(typeof Co=="function"&&Co._reglType==="textureCube","invalid cube map"),Kn=Kn||Co.width,he(Co.width===Kn&&Co.height===Kn,"invalid cube map shape"),Jr.color[jr]={target:Ws,data:za[jr]}}for(jr=0;jr<6;++jr){for(var Uo=0;Uo<za.length;++Uo)Jr.color[Uo].target=Ws+jr;jr>0&&(Jr.depth=Xr[0].depth,Jr.stencil=Xr[0].stencil,Jr.depthStencil=Xr[0].depthStencil),Xr[jr]?Xr[jr](Jr):Xr[jr]=Qt(Jr)}return m(qr,{width:Kn,height:Kn,color:za})}function yi(Jn){var jr,Jr=Jn|0;if(he(Jr>0&&Jr<=De.maxCubeMapSize,"invalid radius for cube fbo"),Jr===qr.width)return qr;var Kn=qr.color;for(jr=0;jr<Kn.length;++jr)Kn[jr].resize(Jr);for(jr=0;jr<6;++jr)Xr[jr].resize(Jr);return qr.width=qr.height=Jr,qr}return qr(br),m(qr,{faces:Xr,resize:yi,_reglType:"framebufferCube",destroy:function(){Xr.forEach(function(Jn){Jn.destroy()})}})}function Wr(){Yt.cur=null,Yt.next=null,Yt.dirty=!0,J(or).forEach(function(br){br.framebuffer=z.createFramebuffer(),qt(br)})}return m(Yt,{getFramebuffer:function(br){if(typeof br=="function"&&br._reglType==="framebuffer"){var Xr=br._framebuffer;if(Xr instanceof Pr)return Xr}return null},create:Qt,createCube:hn,clear:function(){J(or).forEach(Nn)},restore:Wr})}var Ee=5126,Fe=34962,Ae=34963,Ue=["attributes","elements","offset","count","primitive","instances"];function Ye(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ee,this.offset=0,this.stride=0,this.divisor=0}function vt(z,fe,De,Ot,rr,Pt,Yt){for(var sr=De.maxAttributes,dr=new Array(sr),mr=0;mr<sr;++mr)dr[mr]=new Ye;var Sr=0,Tr={},Zr={Record:Ye,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:Cr()?Yr:function(){},createVAO:Nn,getVAO:Ut,destroyBuffer:vr,setVAO:Cr()?gr:Fr,clear:Cr()?or:function(){}};function vr(qt){for(var Qt=0;Qt<dr.length;++Qt){var hn=dr[Qt];hn.buffer===qt&&(z.disableVertexAttribArray(Qt),hn.buffer=null)}}function Cr(){return fe.oes_vertex_array_object}function nt(){return fe.angle_instanced_arrays}function Ut(qt){return typeof qt=="function"&&qt._vao?qt._vao:null}function gr(qt){if(qt!==Zr.currentVAO){var Qt=Cr();qt?Qt.bindVertexArrayOES(qt.vao):Qt.bindVertexArrayOES(null),Zr.currentVAO=qt}}function Fr(qt){if(qt!==Zr.currentVAO){if(qt)qt.bindAttrs();else{for(var Qt=nt(),hn=0;hn<dr.length;++hn){var Wr=dr[hn];Wr.buffer?(z.enableVertexAttribArray(hn),Wr.buffer.bind(),z.vertexAttribPointer(hn,Wr.size,Wr.type,Wr.normalized,Wr.stride,Wr.offfset),Qt&&Wr.divisor&&Qt.vertexAttribDivisorANGLE(hn,Wr.divisor)):(z.disableVertexAttribArray(hn),z.vertexAttrib4f(hn,Wr.x,Wr.y,Wr.z,Wr.w))}Yt.elements?z.bindBuffer(Ae,Yt.elements.buffer.buffer):z.bindBuffer(Ae,null)}Zr.currentVAO=qt}}function or(){J(Tr).forEach(function(qt){qt.destroy()})}function Pr(){this.id=++Sr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var qt=Cr();qt?this.vao=qt.createVertexArrayOES():this.vao=null,Tr[this.id]=this,this.buffers=[]}Pr.prototype.bindAttrs=function(){for(var qt=nt(),Qt=this.attributes,hn=0;hn<Qt.length;++hn){var Wr=Qt[hn];Wr.buffer?(z.enableVertexAttribArray(hn),z.bindBuffer(Fe,Wr.buffer.buffer),z.vertexAttribPointer(hn,Wr.size,Wr.type,Wr.normalized,Wr.stride,Wr.offset),qt&&Wr.divisor&&qt.vertexAttribDivisorANGLE(hn,Wr.divisor)):(z.disableVertexAttribArray(hn),z.vertexAttrib4f(hn,Wr.x,Wr.y,Wr.z,Wr.w))}for(var br=Qt.length;br<sr;++br)z.disableVertexAttribArray(br);var Xr=Pt.getElements(this.elements);Xr?z.bindBuffer(Ae,Xr.buffer.buffer):z.bindBuffer(Ae,null)},Pr.prototype.refresh=function(){var qt=Cr();qt&&(qt.bindVertexArrayOES(this.vao),this.bindAttrs(),Zr.currentVAO=null,qt.bindVertexArrayOES(null))},Pr.prototype.destroy=function(){if(this.vao){var qt=Cr();this===Zr.currentVAO&&(Zr.currentVAO=null,qt.bindVertexArrayOES(null)),qt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Tr[this.id]&&(delete Tr[this.id],Ot.vaoCount-=1)};function Yr(){var qt=Cr();qt&&J(Tr).forEach(function(Qt){Qt.refresh()})}function Nn(qt){var Qt=new Pr;Ot.vaoCount+=1;function hn(Wr){var br;if(Array.isArray(Wr))br=Wr,Qt.elements&&Qt.ownsElements&&Qt.elements.destroy(),Qt.elements=null,Qt.ownsElements=!1,Qt.offset=0,Qt.count=0,Qt.instances=-1,Qt.primitive=4;else{if(he(typeof Wr=="object","invalid arguments for create vao"),he("attributes"in Wr,"must specify attributes for vao"),Wr.elements){var Xr=Wr.elements;Qt.ownsElements?typeof Xr=="function"&&Xr._reglType==="elements"?(Qt.elements.destroy(),Qt.ownsElements=!1):(Qt.elements(Xr),Qt.ownsElements=!1):Pt.getElements(Wr.elements)?(Qt.elements=Wr.elements,Qt.ownsElements=!1):(Qt.elements=Pt.create(Wr.elements),Qt.ownsElements=!0)}else Qt.elements=null,Qt.ownsElements=!1;br=Wr.attributes,Qt.offset=0,Qt.count=-1,Qt.instances=-1,Qt.primitive=4,Qt.elements&&(Qt.count=Qt.elements._elements.vertCount,Qt.primitive=Qt.elements._elements.primType),"offset"in Wr&&(Qt.offset=Wr.offset|0),"count"in Wr&&(Qt.count=Wr.count|0),"instances"in Wr&&(Qt.instances=Wr.instances|0),"primitive"in Wr&&(he(Wr.primitive in tr,"bad primitive type: "+Wr.primitive),Qt.primitive=tr[Wr.primitive]),he.optional(function(){for(var qa=Object.keys(Wr),io=0;io<qa.length;++io)he(Ue.indexOf(qa[io])>=0,'invalid option for vao: "'+qa[io]+'" valid options are '+Ue)}),he(Array.isArray(br),"attributes must be an array")}he(br.length<sr,"too many attributes"),he(br.length>0,"must specify at least one attribute");var qr={},yi=Qt.attributes;yi.length=br.length;for(var Jn=0;Jn<br.length;++Jn){var jr=br[Jn],Jr=yi[Jn]=new Ye,Kn=jr.data||jr;if(Array.isArray(Kn)||ye(Kn)||ps(Kn)){var si;Qt.buffers[Jn]&&(si=Qt.buffers[Jn],ye(Kn)&&si._buffer.byteLength>=Kn.byteLength?si.subdata(Kn):(si.destroy(),Qt.buffers[Jn]=null)),Qt.buffers[Jn]||(si=Qt.buffers[Jn]=rr.create(jr,Fe,!1,!0)),Jr.buffer=rr.getBuffer(si),Jr.size=Jr.buffer.dimension|0,Jr.normalized=!1,Jr.type=Jr.buffer.dtype,Jr.offset=0,Jr.stride=0,Jr.divisor=0,Jr.state=1,qr[Jn]=1}else rr.getBuffer(jr)?(Jr.buffer=rr.getBuffer(jr),Jr.size=Jr.buffer.dimension|0,Jr.normalized=!1,Jr.type=Jr.buffer.dtype,Jr.offset=0,Jr.stride=0,Jr.divisor=0,Jr.state=1):rr.getBuffer(jr.buffer)?(Jr.buffer=rr.getBuffer(jr.buffer),Jr.size=(+jr.size||Jr.buffer.dimension)|0,Jr.normalized=!!jr.normalized||!1,"type"in jr?(he.parameter(jr.type,eu,"invalid buffer type"),Jr.type=eu[jr.type]):Jr.type=Jr.buffer.dtype,Jr.offset=(jr.offset||0)|0,Jr.stride=(jr.stride||0)|0,Jr.divisor=(jr.divisor||0)|0,Jr.state=1,he(Jr.size>=1&&Jr.size<=4,"size must be between 1 and 4"),he(Jr.offset>=0,"invalid offset"),he(Jr.stride>=0&&Jr.stride<=255,"stride must be between 0 and 255"),he(Jr.divisor>=0,"divisor must be positive"),he(!Jr.divisor||!!fe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in jr?(he(Jn>0,"first attribute must not be a constant"),Jr.x=+jr.x||0,Jr.y=+jr.y||0,Jr.z=+jr.z||0,Jr.w=+jr.w||0,Jr.state=2):he(!1,"invalid attribute spec for location "+Jn)}for(var Fi=0;Fi<Qt.buffers.length;++Fi)!qr[Fi]&&Qt.buffers[Fi]&&(Qt.buffers[Fi].destroy(),Qt.buffers[Fi]=null);return Qt.refresh(),hn}return hn.destroy=function(){for(var Wr=0;Wr<Qt.buffers.length;++Wr)Qt.buffers[Wr]&&Qt.buffers[Wr].destroy();Qt.buffers.length=0,Qt.ownsElements&&(Qt.elements.destroy(),Qt.elements=null,Qt.ownsElements=!1),Qt.destroy()},hn._vao=Qt,hn._reglType="vao",hn(qt)}return Zr}var Vt=35632,zt=35633,Ht=35718,fr=35721;function xr(z,fe,De,Ot){var rr={},Pt={};function Yt(nt,Ut,gr,Fr){this.name=nt,this.id=Ut,this.location=gr,this.info=Fr}function sr(nt,Ut){for(var gr=0;gr<nt.length;++gr)if(nt[gr].id===Ut.id){nt[gr].location=Ut.location;return}nt.push(Ut)}function dr(nt,Ut,gr){var Fr=nt===Vt?rr:Pt,or=Fr[Ut];if(!or){var Pr=fe.str(Ut);or=z.createShader(nt),z.shaderSource(or,Pr),z.compileShader(or),he.shaderError(z,or,Pr,nt,gr),Fr[Ut]=or}return or}var mr={},Sr=[],Tr=0;function Zr(nt,Ut){this.id=Tr++,this.fragId=nt,this.vertId=Ut,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ot.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function vr(nt,Ut,gr){var Fr,or,Pr=dr(Vt,nt.fragId),Yr=dr(zt,nt.vertId),Nn=nt.program=z.createProgram();if(z.attachShader(Nn,Pr),z.attachShader(Nn,Yr),gr)for(Fr=0;Fr<gr.length;++Fr){var qt=gr[Fr];z.bindAttribLocation(Nn,qt[0],qt[1])}z.linkProgram(Nn),he.linkError(z,Nn,fe.str(nt.fragId),fe.str(nt.vertId),Ut);var Qt=z.getProgramParameter(Nn,Ht);Ot.profile&&(nt.stats.uniformsCount=Qt);var hn=nt.uniforms;for(Fr=0;Fr<Qt;++Fr)if(or=z.getActiveUniform(Nn,Fr),or)if(or.size>1)for(var Wr=0;Wr<or.size;++Wr){var br=or.name.replace("[0]","["+Wr+"]");sr(hn,new Yt(br,fe.id(br),z.getUniformLocation(Nn,br),or))}else sr(hn,new Yt(or.name,fe.id(or.name),z.getUniformLocation(Nn,or.name),or));var Xr=z.getProgramParameter(Nn,fr);Ot.profile&&(nt.stats.attributesCount=Xr);var qr=nt.attributes;for(Fr=0;Fr<Xr;++Fr)or=z.getActiveAttrib(Nn,Fr),or&&sr(qr,new Yt(or.name,fe.id(or.name),z.getAttribLocation(Nn,or.name),or))}Ot.profile&&(De.getMaxUniformsCount=function(){var nt=0;return Sr.forEach(function(Ut){Ut.stats.uniformsCount>nt&&(nt=Ut.stats.uniformsCount)}),nt},De.getMaxAttributesCount=function(){var nt=0;return Sr.forEach(function(Ut){Ut.stats.attributesCount>nt&&(nt=Ut.stats.attributesCount)}),nt});function Cr(){rr={},Pt={};for(var nt=0;nt<Sr.length;++nt)vr(Sr[nt],null,Sr[nt].attributes.map(function(Ut){return[Ut.location,Ut.name]}))}return{clear:function(){var nt=z.deleteShader.bind(z);J(rr).forEach(nt),rr={},J(Pt).forEach(nt),Pt={},Sr.forEach(function(Ut){z.deleteProgram(Ut.program)}),Sr.length=0,mr={},De.shaderCount=0},program:function(nt,Ut,gr,Fr){he.command(nt>=0,"missing vertex shader",gr),he.command(Ut>=0,"missing fragment shader",gr);var or=mr[Ut];or||(or=mr[Ut]={});var Pr=or[nt];if(Pr&&(Pr.refCount++,!Fr))return Pr;var Yr=new Zr(Ut,nt);return De.shaderCount++,vr(Yr,gr,Fr),Pr||(or[nt]=Yr),Sr.push(Yr),m(Yr,{destroy:function(){if(Yr.refCount--,Yr.refCount<=0){z.deleteProgram(Yr.program);var Nn=Sr.indexOf(Yr);Sr.splice(Nn,1),De.shaderCount--}or[Yr.vertId].refCount<=0&&(z.deleteShader(Pt[Yr.vertId]),delete Pt[Yr.vertId],delete mr[Yr.fragId][Yr.vertId]),Object.keys(mr[Yr.fragId]).length||(z.deleteShader(rr[Yr.fragId]),delete rr[Yr.fragId],delete mr[Yr.fragId])}})},restore:Cr,shader:dr,frag:-1,vert:-1}}var Or=6408,an=5121,Un=3333,On=5126;function Bn(z,fe,De,Ot,rr,Pt,Yt){function sr(Sr){var Tr;fe.next===null?(he(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Tr=an):(he(fe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Tr=fe.next.colorAttachments[0].texture._texture.type,he.optional(function(){Pt.oes_texture_float?(he(Tr===an||Tr===On,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Tr===On&&he(Yt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):he(Tr===an,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Zr=0,vr=0,Cr=Ot.framebufferWidth,nt=Ot.framebufferHeight,Ut=null;ye(Sr)?Ut=Sr:Sr&&(he.type(Sr,"object","invalid arguments to regl.read()"),Zr=Sr.x|0,vr=Sr.y|0,he(Zr>=0&&Zr<Ot.framebufferWidth,"invalid x offset for regl.read"),he(vr>=0&&vr<Ot.framebufferHeight,"invalid y offset for regl.read"),Cr=(Sr.width||Ot.framebufferWidth-Zr)|0,nt=(Sr.height||Ot.framebufferHeight-vr)|0,Ut=Sr.data||null),Ut&&(Tr===an?he(Ut instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Tr===On&&he(Ut instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),he(Cr>0&&Cr+Zr<=Ot.framebufferWidth,"invalid width for read pixels"),he(nt>0&&nt+vr<=Ot.framebufferHeight,"invalid height for read pixels"),De();var gr=Cr*nt*4;return Ut||(Tr===an?Ut=new Uint8Array(gr):Tr===On&&(Ut=Ut||new Float32Array(gr))),he.isTypedArray(Ut,"data buffer for regl.read() must be a typedarray"),he(Ut.byteLength>=gr,"data buffer for regl.read() too small"),z.pixelStorei(Un,4),z.readPixels(Zr,vr,Cr,nt,Or,Tr,Ut),Ut}function dr(Sr){var Tr;return fe.setFBO({framebuffer:Sr.framebuffer},function(){Tr=sr(Sr)}),Tr}function mr(Sr){return!Sr||!("framebuffer"in Sr)?sr(Sr):dr(Sr)}return mr}function Ti(z){return Array.prototype.slice.call(z)}function tn(z){return Ti(z).join("")}function ri(){var z=0,fe=[],De=[];function Ot(Tr){for(var Zr=0;Zr<De.length;++Zr)if(De[Zr]===Tr)return fe[Zr];var vr="g"+z++;return fe.push(vr),De.push(Tr),vr}function rr(){var Tr=[];function Zr(){Tr.push.apply(Tr,Ti(arguments))}var vr=[];function Cr(){var nt="v"+z++;return vr.push(nt),arguments.length>0&&(Tr.push(nt,"="),Tr.push.apply(Tr,Ti(arguments)),Tr.push(";")),nt}return m(Zr,{def:Cr,toString:function(){return tn([vr.length>0?"var "+vr.join(",")+";":"",tn(Tr)])}})}function Pt(){var Tr=rr(),Zr=rr(),vr=Tr.toString,Cr=Zr.toString;function nt(Ut,gr){Zr(Ut,gr,"=",Tr.def(Ut,gr),";")}return m(function(){Tr.apply(Tr,Ti(arguments))},{def:Tr.def,entry:Tr,exit:Zr,save:nt,set:function(Ut,gr,Fr){nt(Ut,gr),Tr(Ut,gr,"=",Fr,";")},toString:function(){return vr()+Cr()}})}function Yt(){var Tr=tn(arguments),Zr=Pt(),vr=Pt(),Cr=Zr.toString,nt=vr.toString;return m(Zr,{then:function(){return Zr.apply(Zr,Ti(arguments)),this},else:function(){return vr.apply(vr,Ti(arguments)),this},toString:function(){var Ut=nt();return Ut&&(Ut="else{"+Ut+"}"),tn(["if(",Tr,"){",Cr(),"}",Ut])}})}var sr=rr(),dr={};function mr(Tr,Zr){var vr=[];function Cr(){var or="a"+vr.length;return vr.push(or),or}Zr=Zr||0;for(var nt=0;nt<Zr;++nt)Cr();var Ut=Pt(),gr=Ut.toString,Fr=dr[Tr]=m(Ut,{arg:Cr,toString:function(){return tn(["function(",vr.join(),"){",gr(),"}"])}});return Fr}function Sr(){var Tr=['"use strict";',sr,"return {"];Object.keys(dr).forEach(function(nt){Tr.push('"',nt,'":',dr[nt].toString(),",")}),Tr.push("}");var Zr=tn(Tr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Cr=vr?Pe.Function.apply(null,fe.concat(Zr)):Function.apply(null,fe.concat(Zr));return Cr.apply(null,De)}return{global:sr,link:Ot,block:rr,proc:mr,scope:Pt,cond:Yt,compile:Sr}}var ni="xyzw".split(""),Yn=5121,Vn=1,ci=2,Wn=0,Gn=1,bo=2,Va=3,ka=4,Mo=5,Ya=6,fo="dither",Ps="blend.enable",as="blend.color",Lu="blend.equation",os="blend.func",Ls="depth.enable",go="depth.func",fc="depth.range",Ul="depth.mask",vu="colorMask",yl="cull.enable",Zl="cull.face",Ys="frontFace",jl="lineWidth",mu="polygonOffset.enable",Eo="polygonOffset.offset",gu="sample.alpha",Ju="sample.enable",el="sample.coverage",na="stencil.enable",Is="stencil.mask",No="stencil.func",tl="stencil.opFront",Nc="stencil.opBack",zc="scissor.enable",bf="scissor.box",qs="viewport",Vl="profile",uu="framebuffer",rl="vert",Gl="frag",yu="elements",zo="primitive",Uc="count",qf="offset",Lp="instances",Kf="vao",pc="Width",sh="Height",hc=uu+pc,Ef=uu+sh,Dp=qs+pc,uh=qs+sh,_l="drawingBuffer",Sf=_l+pc,jh=_l+sh,Vh=[os,Lu,No,tl,Nc,el,qs,bf,Eo],Zc=34962,lh=34963,Td=35632,Md=35633,Gh=3553,ch=34067,dv=2884,Lr=3042,Pd=3024,bt=2960,Fp=2929,Hh=3089,$f=32823,Qf=32926,Cf=32928,Bp=5126,Af=35664,Du=35665,wf=35666,Jf=5124,ep=35667,Hl=35668,tp=35669,Tf=35670,rp=35671,Mf=35672,jc=35673,Ds=35674,Vc=35675,np=35676,ip=35678,ap=35680,Np=4,xl=1028,Gc=1029,Wh=2304,op=2305,Xh=32775,Yh=32776,Id=519,Fu=7680,qh=0,sp=1,Hc=32774,nl=513,fh=36160,Kh=36064,bl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Pf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Wc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Wl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},If={frag:Td,vert:Md},ph={cw:Wh,ccw:op};function Ca(z){return Array.isArray(z)||ye(z)||ps(z)}function El(z){return z.sort(function(fe,De){return fe===qs?-1:De===qs?1:fe<De?-1:1})}function va(z,fe,De,Ot){this.thisDep=z,this.contextDep=fe,this.propDep=De,this.append=Ot}function dc(z){return z&&!(z.thisDep||z.contextDep||z.propDep)}function So(z){return new va(!1,!1,!1,z)}function Ks(z,fe){var De=z.type;if(De===Wn){var Ot=z.data.length;return new va(!0,Ot>=1,Ot>=2,fe)}else if(De===ka){var rr=z.data;return new va(rr.thisDep,rr.contextDep,rr.propDep,fe)}else{if(De===Mo)return new va(!1,!1,!1,fe);if(De===Ya){for(var Pt=!1,Yt=!1,sr=!1,dr=0;dr<z.data.length;++dr){var mr=z.data[dr];if(mr.type===Gn)sr=!0;else if(mr.type===bo)Yt=!0;else if(mr.type===Va)Pt=!0;else if(mr.type===Wn){Pt=!0;var Sr=mr.data;Sr>=1&&(Yt=!0),Sr>=2&&(sr=!0)}else mr.type===ka&&(Pt=Pt||mr.data.thisDep,Yt=Yt||mr.data.contextDep,sr=sr||mr.data.propDep)}return new va(Pt,Yt,sr,fe)}else return new va(De===Va,De===bo,De===Gn,fe)}}var hh=new va(!1,!1,!1,function(){});function $h(z,fe,De,Ot,rr,Pt,Yt,sr,dr,mr,Sr,Tr,Zr,vr,Cr){var nt=mr.Record,Ut={add:32774,subtract:32778,"reverse subtract":32779};De.ext_blend_minmax&&(Ut.min=Xh,Ut.max=Yh);var gr=De.angle_instanced_arrays,Fr=De.webgl_draw_buffers,or=De.oes_vertex_array_object,Pr={dirty:!0,profile:Cr.profile},Yr={},Nn=[],qt={},Qt={};function hn(xe){return xe.replace(".","_")}function Wr(xe,ie,Ze){var it=hn(xe);Nn.push(xe),Yr[it]=Pr[it]=!!Ze,qt[it]=ie}function br(xe,ie,Ze){var it=hn(xe);Nn.push(xe),Array.isArray(Ze)?(Pr[it]=Ze.slice(),Yr[it]=Ze.slice()):Pr[it]=Yr[it]=Ze,Qt[it]=ie}Wr(fo,Pd),Wr(Ps,Lr),br(as,"blendColor",[0,0,0,0]),br(Lu,"blendEquationSeparate",[Hc,Hc]),br(os,"blendFuncSeparate",[sp,qh,sp,qh]),Wr(Ls,Fp,!0),br(go,"depthFunc",nl),br(fc,"depthRange",[0,1]),br(Ul,"depthMask",!0),br(vu,vu,[!0,!0,!0,!0]),Wr(yl,dv),br(Zl,"cullFace",Gc),br(Ys,Ys,op),br(jl,jl,1),Wr(mu,$f),br(Eo,"polygonOffset",[0,0]),Wr(gu,Qf),Wr(Ju,Cf),br(el,"sampleCoverage",[1,!1]),Wr(na,bt),br(Is,"stencilMask",-1),br(No,"stencilFunc",[Id,0,-1]),br(tl,"stencilOpSeparate",[xl,Fu,Fu,Fu]),br(Nc,"stencilOpSeparate",[Gc,Fu,Fu,Fu]),Wr(zc,Hh),br(bf,"scissor",[0,0,z.drawingBufferWidth,z.drawingBufferHeight]),br(qs,qs,[0,0,z.drawingBufferWidth,z.drawingBufferHeight]);var Xr={gl:z,context:Zr,strings:fe,next:Yr,current:Pr,draw:Tr,elements:Pt,buffer:rr,shader:Sr,attributes:mr.state,vao:mr,uniforms:dr,framebuffer:sr,extensions:De,timer:vr,isBufferArgs:Ca},qr={primTypes:tr,compareFuncs:Wc,blendFuncs:bl,blendEquations:Ut,stencilOps:Wl,glTypes:eu,orientationType:ph};he.optional(function(){Xr.isArrayLike=lo}),Fr&&(qr.backBuffer=[Gc],qr.drawBuffer=Ve(Ot.maxDrawbuffers,function(xe){return xe===0?[0]:Ve(xe,function(ie){return Kh+ie})}));var yi=0;function Jn(){var xe=ri(),ie=xe.link,Ze=xe.global;xe.id=yi++,xe.batchId="0";var it=ie(Xr),wt=xe.shared={props:"a0"};Object.keys(Xr).forEach(function(ze){wt[ze]=Ze.def(it,".",ze)}),he.optional(function(){xe.CHECK=ie(he),xe.commandStr=he.guessCommand(),xe.command=ie(xe.commandStr),xe.assert=function(ze,Se,at){ze("if(!(",Se,"))",this.CHECK,".commandRaise(",ie(at),",",this.command,");")},qr.invalidBlendCombinations=Pf});var Xe=xe.next={},Le=xe.current={};Object.keys(Qt).forEach(function(ze){Array.isArray(Pr[ze])&&(Xe[ze]=Ze.def(wt.next,".",ze),Le[ze]=Ze.def(wt.current,".",ze))});var Je=xe.constants={};Object.keys(qr).forEach(function(ze){Je[ze]=Ze.def(JSON.stringify(qr[ze]))}),xe.invoke=function(ze,Se){switch(Se.type){case Wn:var at=["this",wt.context,wt.props,xe.batchId];return ze.def(ie(Se.data),".call(",at.slice(0,Math.max(Se.data.length+1,4)),")");case Gn:return ze.def(wt.props,Se.data);case bo:return ze.def(wt.context,Se.data);case Va:return ze.def("this",Se.data);case ka:return Se.data.append(xe,ze),Se.data.ref;case Mo:return Se.data.toString();case Ya:return Se.data.map(function(yt){return xe.invoke(ze,yt)})}},xe.attribCache={};var ve={};return xe.scopeAttrib=function(ze){var Se=fe.id(ze);if(Se in ve)return ve[Se];var at=mr.scope[Se];at||(at=mr.scope[Se]=new nt);var yt=ve[Se]=ie(at);return yt},xe}function jr(xe){var ie=xe.static,Ze=xe.dynamic,it;if(Vl in ie){var wt=!!ie[Vl];it=So(function(Le,Je){return wt}),it.enable=wt}else if(Vl in Ze){var Xe=Ze[Vl];it=Ks(Xe,function(Le,Je){return Le.invoke(Je,Xe)})}return it}function Jr(xe,ie){var Ze=xe.static,it=xe.dynamic;if(uu in Ze){var wt=Ze[uu];return wt?(wt=sr.getFramebuffer(wt),he.command(wt,"invalid framebuffer object"),So(function(Le,Je){var ve=Le.link(wt),ze=Le.shared;Je.set(ze.framebuffer,".next",ve);var Se=ze.context;return Je.set(Se,"."+hc,ve+".width"),Je.set(Se,"."+Ef,ve+".height"),ve})):So(function(Le,Je){var ve=Le.shared;Je.set(ve.framebuffer,".next","null");var ze=ve.context;return Je.set(ze,"."+hc,ze+"."+Sf),Je.set(ze,"."+Ef,ze+"."+jh),"null"})}else if(uu in it){var Xe=it[uu];return Ks(Xe,function(Le,Je){var ve=Le.invoke(Je,Xe),ze=Le.shared,Se=ze.framebuffer,at=Je.def(Se,".getFramebuffer(",ve,")");he.optional(function(){Le.assert(Je,"!"+ve+"||"+at,"invalid framebuffer object")}),Je.set(Se,".next",at);var yt=ze.context;return Je.set(yt,"."+hc,at+"?"+at+".width:"+yt+"."+Sf),Je.set(yt,"."+Ef,at+"?"+at+".height:"+yt+"."+jh),at})}else return null}function Kn(xe,ie,Ze){var it=xe.static,wt=xe.dynamic;function Xe(ve){if(ve in it){var ze=it[ve];he.commandType(ze,"object","invalid "+ve,Ze.commandStr);var Se=!0,at=ze.x|0,yt=ze.y|0,lr,Br;return"width"in ze?(lr=ze.width|0,he.command(lr>=0,"invalid "+ve,Ze.commandStr)):Se=!1,"height"in ze?(Br=ze.height|0,he.command(Br>=0,"invalid "+ve,Ze.commandStr)):Se=!1,new va(!Se&&ie&&ie.thisDep,!Se&&ie&&ie.contextDep,!Se&&ie&&ie.propDep,function(kr,An){var on=kr.shared.context,bn=lr;"width"in ze||(bn=An.def(on,".",hc,"-",at));var fn=Br;return"height"in ze||(fn=An.def(on,".",Ef,"-",yt)),[at,yt,bn,fn]})}else if(ve in wt){var Nr=wt[ve],en=Ks(Nr,function(kr,An){var on=kr.invoke(An,Nr);he.optional(function(){kr.assert(An,on+"&&typeof "+on+'==="object"',"invalid "+ve)});var bn=kr.shared.context,fn=An.def(on,".x|0"),vn=An.def(on,".y|0"),$n=An.def('"width" in ',on,"?",on,".width|0:","(",bn,".",hc,"-",fn,")"),ba=An.def('"height" in ',on,"?",on,".height|0:","(",bn,".",Ef,"-",vn,")");return he.optional(function(){kr.assert(An,$n+">=0&&"+ba+">=0","invalid "+ve)}),[fn,vn,$n,ba]});return ie&&(en.thisDep=en.thisDep||ie.thisDep,en.contextDep=en.contextDep||ie.contextDep,en.propDep=en.propDep||ie.propDep),en}else return ie?new va(ie.thisDep,ie.contextDep,ie.propDep,function(kr,An){var on=kr.shared.context;return[0,0,An.def(on,".",hc),An.def(on,".",Ef)]}):null}var Le=Xe(qs);if(Le){var Je=Le;Le=new va(Le.thisDep,Le.contextDep,Le.propDep,function(ve,ze){var Se=Je.append(ve,ze),at=ve.shared.context;return ze.set(at,"."+Dp,Se[2]),ze.set(at,"."+uh,Se[3]),Se})}return{viewport:Le,scissor_box:Xe(bf)}}function si(xe,ie){var Ze=xe.static,it=typeof Ze[Gl]=="string"&&typeof Ze[rl]=="string";if(it){if(Object.keys(ie.dynamic).length>0)return null;var wt=ie.static,Xe=Object.keys(wt);if(Xe.length>0&&typeof wt[Xe[0]]=="number"){for(var Le=[],Je=0;Je<Xe.length;++Je)he(typeof wt[Xe[Je]]=="number","must specify all vertex attribute locations when using vaos"),Le.push([wt[Xe[Je]]|0,Xe[Je]]);return Le}}return null}function Fi(xe,ie,Ze){var it=xe.static,wt=xe.dynamic;function Xe(Se){if(Se in it){var at=fe.id(it[Se]);he.optional(function(){Sr.shader(If[Se],at,he.guessCommand())});var yt=So(function(){return at});return yt.id=at,yt}else if(Se in wt){var lr=wt[Se];return Ks(lr,function(Br,Nr){var en=Br.invoke(Nr,lr),kr=Nr.def(Br.shared.strings,".id(",en,")");return he.optional(function(){Nr(Br.shared.shader,".shader(",If[Se],",",kr,",",Br.command,");")}),kr})}return null}var Le=Xe(Gl),Je=Xe(rl),ve=null,ze;return dc(Le)&&dc(Je)?(ve=Sr.program(Je.id,Le.id,null,Ze),ze=So(function(Se,at){return Se.link(ve)})):ze=new va(Le&&Le.thisDep||Je&&Je.thisDep,Le&&Le.contextDep||Je&&Je.contextDep,Le&&Le.propDep||Je&&Je.propDep,function(Se,at){var yt=Se.shared.shader,lr;Le?lr=Le.append(Se,at):lr=at.def(yt,".",Gl);var Br;Je?Br=Je.append(Se,at):Br=at.def(yt,".",rl);var Nr=yt+".program("+Br+","+lr;return he.optional(function(){Nr+=","+Se.command}),at.def(Nr+")")}),{frag:Le,vert:Je,progVar:ze,program:ve}}function qa(xe,ie){var Ze=xe.static,it=xe.dynamic,wt={},Xe=!1;function Le(){if(Kf in Ze){var An=Ze[Kf];return An!==null&&mr.getVAO(An)===null&&(An=mr.createVAO(An)),Xe=!0,wt.vao=An,So(function(bn){var fn=mr.getVAO(An);return fn?bn.link(fn):"null"})}else if(Kf in it){Xe=!0;var on=it[Kf];return Ks(on,function(bn,fn){var vn=bn.invoke(fn,on);return fn.def(bn.shared.vao+".getVAO("+vn+")")})}return null}var Je=Le(),ve=!1;function ze(){if(yu in Ze){var An=Ze[yu];if(wt.elements=An,Ca(An)){var on=wt.elements=Pt.create(An,!0);An=Pt.getElements(on),ve=!0}else An&&(An=Pt.getElements(An),ve=!0,he.command(An,"invalid elements",ie.commandStr));var bn=So(function(vn,$n){if(An){var ba=vn.link(An);return vn.ELEMENTS=ba,ba}return vn.ELEMENTS=null,null});return bn.value=An,bn}else if(yu in it){ve=!0;var fn=it[yu];return Ks(fn,function(vn,$n){var ba=vn.shared,us=ba.isBufferArgs,Ua=ba.elements,ma=vn.invoke($n,fn),Yl=$n.def("null"),Fs=$n.def(us,"(",ma,")"),Sl=vn.cond(Fs).then(Yl,"=",Ua,".createStream(",ma,");").else(Yl,"=",Ua,".getElements(",ma,");");return he.optional(function(){vn.assert(Sl.else,"!"+ma+"||"+Yl,"invalid elements")}),$n.entry(Sl),$n.exit(vn.cond(Fs).then(Ua,".destroyStream(",Yl,");")),vn.ELEMENTS=Yl,Yl})}else if(Xe)return new va(Je.thisDep,Je.contextDep,Je.propDep,function(vn,$n){return $n.def(vn.shared.vao+".currentVAO?"+vn.shared.elements+".getElements("+vn.shared.vao+".currentVAO.elements):null")});return null}var Se=ze();function at(){if(zo in Ze){var An=Ze[zo];return wt.primitive=An,he.commandParameter(An,tr,"invalid primitve",ie.commandStr),So(function(bn,fn){return tr[An]})}else if(zo in it){var on=it[zo];return Ks(on,function(bn,fn){var vn=bn.constants.primTypes,$n=bn.invoke(fn,on);return he.optional(function(){bn.assert(fn,$n+" in "+vn,"invalid primitive, must be one of "+Object.keys(tr))}),fn.def(vn,"[",$n,"]")})}else{if(ve)return dc(Se)?Se.value?So(function(bn,fn){return fn.def(bn.ELEMENTS,".primType")}):So(function(){return Np}):new va(Se.thisDep,Se.contextDep,Se.propDep,function(bn,fn){var vn=bn.ELEMENTS;return fn.def(vn,"?",vn,".primType:",Np)});if(Xe)return new va(Je.thisDep,Je.contextDep,Je.propDep,function(bn,fn){return fn.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+Np)})}return null}function yt(An,on){if(An in Ze){var bn=Ze[An]|0;return on?wt.offset=bn:wt.instances=bn,he.command(!on||bn>=0,"invalid "+An,ie.commandStr),So(function(vn,$n){return on&&(vn.OFFSET=bn),bn})}else if(An in it){var fn=it[An];return Ks(fn,function(vn,$n){var ba=vn.invoke($n,fn);return on&&(vn.OFFSET=ba,he.optional(function(){vn.assert($n,ba+">=0","invalid "+An)})),ba})}else if(on){if(ve)return So(function(vn,$n){return vn.OFFSET=0,0});if(Xe)return new va(Je.thisDep,Je.contextDep,Je.propDep,function(vn,$n){return $n.def(vn.shared.vao+".currentVAO?"+vn.shared.vao+".currentVAO.offset:0")})}else if(Xe)return new va(Je.thisDep,Je.contextDep,Je.propDep,function(vn,$n){return $n.def(vn.shared.vao+".currentVAO?"+vn.shared.vao+".currentVAO.instances:-1")});return null}var lr=yt(qf,!0);function Br(){if(Uc in Ze){var An=Ze[Uc]|0;return wt.count=An,he.command(typeof An=="number"&&An>=0,"invalid vertex count",ie.commandStr),So(function(){return An})}else if(Uc in it){var on=it[Uc];return Ks(on,function($n,ba){var us=$n.invoke(ba,on);return he.optional(function(){$n.assert(ba,"typeof "+us+'==="number"&&'+us+">=0&&"+us+"===("+us+"|0)","invalid vertex count")}),us})}else if(ve)if(dc(Se)){if(Se)return lr?new va(lr.thisDep,lr.contextDep,lr.propDep,function($n,ba){var us=ba.def($n.ELEMENTS,".vertCount-",$n.OFFSET);return he.optional(function(){$n.assert(ba,us+">=0","invalid vertex offset/element buffer too small")}),us}):So(function($n,ba){return ba.def($n.ELEMENTS,".vertCount")});var bn=So(function(){return-1});return he.optional(function(){bn.MISSING=!0}),bn}else{var fn=new va(Se.thisDep||lr.thisDep,Se.contextDep||lr.contextDep,Se.propDep||lr.propDep,function($n,ba){var us=$n.ELEMENTS;return $n.OFFSET?ba.def(us,"?",us,".vertCount-",$n.OFFSET,":-1"):ba.def(us,"?",us,".vertCount:-1")});return he.optional(function(){fn.DYNAMIC=!0}),fn}else if(Xe){var vn=new va(Je.thisDep,Je.contextDep,Je.propDep,function($n,ba){return ba.def($n.shared.vao,".currentVAO?",$n.shared.vao,".currentVAO.count:-1")});return vn}return null}var Nr=at(),en=Br(),kr=yt(Lp,!1);return{elements:Se,primitive:Nr,count:en,instances:kr,offset:lr,vao:Je,vaoActive:Xe,elementsActive:ve,static:wt}}function io(xe,ie){var Ze=xe.static,it=xe.dynamic,wt={};return Nn.forEach(function(Xe){var Le=hn(Xe);function Je(ve,ze){if(Xe in Ze){var Se=ve(Ze[Xe]);wt[Le]=So(function(){return Se})}else if(Xe in it){var at=it[Xe];wt[Le]=Ks(at,function(yt,lr){return ze(yt,lr,yt.invoke(lr,at))})}}switch(Xe){case yl:case Ps:case fo:case na:case Ls:case zc:case mu:case gu:case Ju:case Ul:return Je(function(ve){return he.commandType(ve,"boolean",Xe,ie.commandStr),ve},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,"typeof "+Se+'==="boolean"',"invalid flag "+Xe,ve.commandStr)}),Se});case go:return Je(function(ve){return he.commandParameter(ve,Wc,"invalid "+Xe,ie.commandStr),Wc[ve]},function(ve,ze,Se){var at=ve.constants.compareFuncs;return he.optional(function(){ve.assert(ze,Se+" in "+at,"invalid "+Xe+", must be one of "+Object.keys(Wc))}),ze.def(at,"[",Se,"]")});case fc:return Je(function(ve){return he.command(lo(ve)&&ve.length===2&&typeof ve[0]=="number"&&typeof ve[1]=="number"&&ve[0]<=ve[1],"depth range is 2d array",ie.commandStr),ve},function(ve,ze,Se){he.optional(function(){ve.assert(ze,ve.shared.isArrayLike+"("+Se+")&&"+Se+".length===2&&typeof "+Se+'[0]==="number"&&typeof '+Se+'[1]==="number"&&'+Se+"[0]<="+Se+"[1]","depth range must be a 2d array")});var at=ze.def("+",Se,"[0]"),yt=ze.def("+",Se,"[1]");return[at,yt]});case os:return Je(function(ve){he.commandType(ve,"object","blend.func",ie.commandStr);var ze="srcRGB"in ve?ve.srcRGB:ve.src,Se="srcAlpha"in ve?ve.srcAlpha:ve.src,at="dstRGB"in ve?ve.dstRGB:ve.dst,yt="dstAlpha"in ve?ve.dstAlpha:ve.dst;return he.commandParameter(ze,bl,Le+".srcRGB",ie.commandStr),he.commandParameter(Se,bl,Le+".srcAlpha",ie.commandStr),he.commandParameter(at,bl,Le+".dstRGB",ie.commandStr),he.commandParameter(yt,bl,Le+".dstAlpha",ie.commandStr),he.command(Pf.indexOf(ze+", "+at)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ze+", "+at+")",ie.commandStr),[bl[ze],bl[at],bl[Se],bl[yt]]},function(ve,ze,Se){var at=ve.constants.blendFuncs;he.optional(function(){ve.assert(ze,Se+"&&typeof "+Se+'==="object"',"invalid blend func, must be an object")});function yt(on,bn){var fn=ze.def('"',on,bn,'" in ',Se,"?",Se,".",on,bn,":",Se,".",on);return he.optional(function(){ve.assert(ze,fn+" in "+at,"invalid "+Xe+"."+on+bn+", must be one of "+Object.keys(bl))}),fn}var lr=yt("src","RGB"),Br=yt("dst","RGB");he.optional(function(){var on=ve.constants.invalidBlendCombinations;ve.assert(ze,on+".indexOf("+lr+'+", "+'+Br+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nr=ze.def(at,"[",lr,"]"),en=ze.def(at,"[",yt("src","Alpha"),"]"),kr=ze.def(at,"[",Br,"]"),An=ze.def(at,"[",yt("dst","Alpha"),"]");return[Nr,kr,en,An]});case Lu:return Je(function(ve){if(typeof ve=="string")return he.commandParameter(ve,Ut,"invalid "+Xe,ie.commandStr),[Ut[ve],Ut[ve]];if(typeof ve=="object")return he.commandParameter(ve.rgb,Ut,Xe+".rgb",ie.commandStr),he.commandParameter(ve.alpha,Ut,Xe+".alpha",ie.commandStr),[Ut[ve.rgb],Ut[ve.alpha]];he.commandRaise("invalid blend.equation",ie.commandStr)},function(ve,ze,Se){var at=ve.constants.blendEquations,yt=ze.def(),lr=ze.def(),Br=ve.cond("typeof ",Se,'==="string"');return he.optional(function(){function Nr(en,kr,An){ve.assert(en,An+" in "+at,"invalid "+kr+", must be one of "+Object.keys(Ut))}Nr(Br.then,Xe,Se),ve.assert(Br.else,Se+"&&typeof "+Se+'==="object"',"invalid "+Xe),Nr(Br.else,Xe+".rgb",Se+".rgb"),Nr(Br.else,Xe+".alpha",Se+".alpha")}),Br.then(yt,"=",lr,"=",at,"[",Se,"];"),Br.else(yt,"=",at,"[",Se,".rgb];",lr,"=",at,"[",Se,".alpha];"),ze(Br),[yt,lr]});case as:return Je(function(ve){return he.command(lo(ve)&&ve.length===4,"blend.color must be a 4d array",ie.commandStr),Ve(4,function(ze){return+ve[ze]})},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,ve.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","blend.color must be a 4d array")}),Ve(4,function(at){return ze.def("+",Se,"[",at,"]")})});case Is:return Je(function(ve){return he.commandType(ve,"number",Le,ie.commandStr),ve|0},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,"typeof "+Se+'==="number"',"invalid stencil.mask")}),ze.def(Se,"|0")});case No:return Je(function(ve){he.commandType(ve,"object",Le,ie.commandStr);var ze=ve.cmp||"keep",Se=ve.ref||0,at="mask"in ve?ve.mask:-1;return he.commandParameter(ze,Wc,Xe+".cmp",ie.commandStr),he.commandType(Se,"number",Xe+".ref",ie.commandStr),he.commandType(at,"number",Xe+".mask",ie.commandStr),[Wc[ze],Se,at]},function(ve,ze,Se){var at=ve.constants.compareFuncs;he.optional(function(){function Nr(){ve.assert(ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nr(Se+"&&typeof ",Se,'==="object"'),Nr('!("cmp" in ',Se,")||(",Se,".cmp in ",at,")")});var yt=ze.def('"cmp" in ',Se,"?",at,"[",Se,".cmp]",":",Fu),lr=ze.def(Se,".ref|0"),Br=ze.def('"mask" in ',Se,"?",Se,".mask|0:-1");return[yt,lr,Br]});case tl:case Nc:return Je(function(ve){he.commandType(ve,"object",Le,ie.commandStr);var ze=ve.fail||"keep",Se=ve.zfail||"keep",at=ve.zpass||"keep";return he.commandParameter(ze,Wl,Xe+".fail",ie.commandStr),he.commandParameter(Se,Wl,Xe+".zfail",ie.commandStr),he.commandParameter(at,Wl,Xe+".zpass",ie.commandStr),[Xe===Nc?Gc:xl,Wl[ze],Wl[Se],Wl[at]]},function(ve,ze,Se){var at=ve.constants.stencilOps;he.optional(function(){ve.assert(ze,Se+"&&typeof "+Se+'==="object"',"invalid "+Xe)});function yt(lr){return he.optional(function(){ve.assert(ze,'!("'+lr+'" in '+Se+")||("+Se+"."+lr+" in "+at+")","invalid "+Xe+"."+lr+", must be one of "+Object.keys(Wl))}),ze.def('"',lr,'" in ',Se,"?",at,"[",Se,".",lr,"]:",Fu)}return[Xe===Nc?Gc:xl,yt("fail"),yt("zfail"),yt("zpass")]});case Eo:return Je(function(ve){he.commandType(ve,"object",Le,ie.commandStr);var ze=ve.factor|0,Se=ve.units|0;return he.commandType(ze,"number",Le+".factor",ie.commandStr),he.commandType(Se,"number",Le+".units",ie.commandStr),[ze,Se]},function(ve,ze,Se){he.optional(function(){ve.assert(ze,Se+"&&typeof "+Se+'==="object"',"invalid "+Xe)});var at=ze.def(Se,".factor|0"),yt=ze.def(Se,".units|0");return[at,yt]});case Zl:return Je(function(ve){var ze=0;return ve==="front"?ze=xl:ve==="back"&&(ze=Gc),he.command(!!ze,Le,ie.commandStr),ze},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,Se+'==="front"||'+Se+'==="back"',"invalid cull.face")}),ze.def(Se,'==="front"?',xl,":",Gc)});case jl:return Je(function(ve){return he.command(typeof ve=="number"&&ve>=Ot.lineWidthDims[0]&&ve<=Ot.lineWidthDims[1],"invalid line width, must be a positive number between "+Ot.lineWidthDims[0]+" and "+Ot.lineWidthDims[1],ie.commandStr),ve},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,"typeof "+Se+'==="number"&&'+Se+">="+Ot.lineWidthDims[0]+"&&"+Se+"<="+Ot.lineWidthDims[1],"invalid line width")}),Se});case Ys:return Je(function(ve){return he.commandParameter(ve,ph,Le,ie.commandStr),ph[ve]},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,Se+'==="cw"||'+Se+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ze.def(Se+'==="cw"?'+Wh+":"+op)});case vu:return Je(function(ve){return he.command(lo(ve)&&ve.length===4,"color.mask must be length 4 array",ie.commandStr),ve.map(function(ze){return!!ze})},function(ve,ze,Se){return he.optional(function(){ve.assert(ze,ve.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","invalid color.mask")}),Ve(4,function(at){return"!!"+Se+"["+at+"]"})});case el:return Je(function(ve){he.command(typeof ve=="object"&&ve,Le,ie.commandStr);var ze="value"in ve?ve.value:1,Se=!!ve.invert;return he.command(typeof ze=="number"&&ze>=0&&ze<=1,"sample.coverage.value must be a number between 0 and 1",ie.commandStr),[ze,Se]},function(ve,ze,Se){he.optional(function(){ve.assert(ze,Se+"&&typeof "+Se+'==="object"',"invalid sample.coverage")});var at=ze.def('"value" in ',Se,"?+",Se,".value:1"),yt=ze.def("!!",Se,".invert");return[at,yt]})}}),wt}function Ri(xe,ie){var Ze=xe.static,it=xe.dynamic,wt={};return Object.keys(Ze).forEach(function(Xe){var Le=Ze[Xe],Je;if(typeof Le=="number"||typeof Le=="boolean")Je=So(function(){return Le});else if(typeof Le=="function"){var ve=Le._reglType;ve==="texture2d"||ve==="textureCube"?Je=So(function(ze){return ze.link(Le)}):ve==="framebuffer"||ve==="framebufferCube"?(he.command(Le.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Xe+'"',ie.commandStr),Je=So(function(ze){return ze.link(Le.color[0])})):he.commandRaise('invalid data for uniform "'+Xe+'"',ie.commandStr)}else lo(Le)?Je=So(function(ze){var Se=ze.global.def("[",Ve(Le.length,function(at){return he.command(typeof Le[at]=="number"||typeof Le[at]=="boolean","invalid uniform "+Xe,ze.commandStr),Le[at]}),"]");return Se}):he.commandRaise('invalid or missing data for uniform "'+Xe+'"',ie.commandStr);Je.value=Le,wt[Xe]=Je}),Object.keys(it).forEach(function(Xe){var Le=it[Xe];wt[Xe]=Ks(Le,function(Je,ve){return Je.invoke(ve,Le)})}),wt}function Yo(xe,ie){var Ze=xe.static,it=xe.dynamic,wt={};return Object.keys(Ze).forEach(function(Xe){var Le=Ze[Xe],Je=fe.id(Xe),ve=new nt;if(Ca(Le))ve.state=Vn,ve.buffer=rr.getBuffer(rr.create(Le,Zc,!1,!0)),ve.type=0;else{var ze=rr.getBuffer(Le);if(ze)ve.state=Vn,ve.buffer=ze,ve.type=0;else if(he.command(typeof Le=="object"&&Le,"invalid data for attribute "+Xe,ie.commandStr),"constant"in Le){var Se=Le.constant;ve.buffer="null",ve.state=ci,typeof Se=="number"?ve.x=Se:(he.command(lo(Se)&&Se.length>0&&Se.length<=4,"invalid constant for attribute "+Xe,ie.commandStr),ni.forEach(function(kr,An){An<Se.length&&(ve[kr]=Se[An])}))}else{Ca(Le.buffer)?ze=rr.getBuffer(rr.create(Le.buffer,Zc,!1,!0)):ze=rr.getBuffer(Le.buffer),he.command(!!ze,'missing buffer for attribute "'+Xe+'"',ie.commandStr);var at=Le.offset|0;he.command(at>=0,'invalid offset for attribute "'+Xe+'"',ie.commandStr);var yt=Le.stride|0;he.command(yt>=0&&yt<256,'invalid stride for attribute "'+Xe+'", must be integer betweeen [0, 255]',ie.commandStr);var lr=Le.size|0;he.command(!("size"in Le)||lr>0&&lr<=4,'invalid size for attribute "'+Xe+'", must be 1,2,3,4',ie.commandStr);var Br=!!Le.normalized,Nr=0;"type"in Le&&(he.commandParameter(Le.type,eu,"invalid type for attribute "+Xe,ie.commandStr),Nr=eu[Le.type]);var en=Le.divisor|0;he.optional(function(){"divisor"in Le&&(he.command(en===0||gr,'cannot specify divisor for attribute "'+Xe+'", instancing not supported',ie.commandStr),he.command(en>=0,'invalid divisor for attribute "'+Xe+'"',ie.commandStr));var kr=ie.commandStr,An=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Le).forEach(function(on){he.command(An.indexOf(on)>=0,'unknown parameter "'+on+'" for attribute pointer "'+Xe+'" (valid parameters are '+An+")",kr)})}),ve.buffer=ze,ve.state=Vn,ve.size=lr,ve.normalized=Br,ve.type=Nr||ze.dtype,ve.offset=at,ve.stride=yt,ve.divisor=en}}wt[Xe]=So(function(kr,An){var on=kr.attribCache;if(Je in on)return on[Je];var bn={isStream:!1};return Object.keys(ve).forEach(function(fn){bn[fn]=ve[fn]}),ve.buffer&&(bn.buffer=kr.link(ve.buffer),bn.type=bn.type||bn.buffer+".dtype"),on[Je]=bn,bn})}),Object.keys(it).forEach(function(Xe){var Le=it[Xe];function Je(ve,ze){var Se=ve.invoke(ze,Le),at=ve.shared,yt=ve.constants,lr=at.isBufferArgs,Br=at.buffer;he.optional(function(){ve.assert(ze,Se+"&&(typeof "+Se+'==="object"||typeof '+Se+'==="function")&&('+lr+"("+Se+")||"+Br+".getBuffer("+Se+")||"+Br+".getBuffer("+Se+".buffer)||"+lr+"("+Se+'.buffer)||("constant" in '+Se+"&&(typeof "+Se+'.constant==="number"||'+at.isArrayLike+"("+Se+".constant))))",'invalid dynamic attribute "'+Xe+'"')});var Nr={isStream:ze.def(!1)},en=new nt;en.state=Vn,Object.keys(en).forEach(function(bn){Nr[bn]=ze.def(""+en[bn])});var kr=Nr.buffer,An=Nr.type;ze("if(",lr,"(",Se,")){",Nr.isStream,"=true;",kr,"=",Br,".createStream(",Zc,",",Se,");",An,"=",kr,".dtype;","}else{",kr,"=",Br,".getBuffer(",Se,");","if(",kr,"){",An,"=",kr,".dtype;",'}else if("constant" in ',Se,"){",Nr.state,"=",ci,";","if(typeof "+Se+'.constant === "number"){',Nr[ni[0]],"=",Se,".constant;",ni.slice(1).map(function(bn){return Nr[bn]}).join("="),"=0;","}else{",ni.map(function(bn,fn){return Nr[bn]+"="+Se+".constant.length>"+fn+"?"+Se+".constant["+fn+"]:0;"}).join(""),"}}else{","if(",lr,"(",Se,".buffer)){",kr,"=",Br,".createStream(",Zc,",",Se,".buffer);","}else{",kr,"=",Br,".getBuffer(",Se,".buffer);","}",An,'="type" in ',Se,"?",yt.glTypes,"[",Se,".type]:",kr,".dtype;",Nr.normalized,"=!!",Se,".normalized;");function on(bn){ze(Nr[bn],"=",Se,".",bn,"|0;")}return on("size"),on("offset"),on("stride"),on("divisor"),ze("}}"),ze.exit("if(",Nr.isStream,"){",Br,".destroyStream(",kr,");","}"),Nr}wt[Xe]=Ks(Le,Je)}),wt}function za(xe){var ie=xe.static,Ze=xe.dynamic,it={};return Object.keys(ie).forEach(function(wt){var Xe=ie[wt];it[wt]=So(function(Le,Je){return typeof Xe=="number"||typeof Xe=="boolean"?""+Xe:Le.link(Xe)})}),Object.keys(Ze).forEach(function(wt){var Xe=Ze[wt];it[wt]=Ks(Xe,function(Le,Je){return Le.invoke(Je,Xe)})}),it}function qo(xe,ie,Ze,it,wt){var Xe=xe.static,Le=xe.dynamic;he.optional(function(){var on=[uu,rl,Gl,yu,zo,qf,Uc,Lp,Vl,Kf].concat(Nn);function bn(fn){Object.keys(fn).forEach(function(vn){he.command(on.indexOf(vn)>=0,'unknown parameter "'+vn+'"',wt.commandStr)})}bn(Xe),bn(Le)});var Je=si(xe,ie),ve=Jr(xe,wt),ze=Kn(xe,ve,wt),Se=qa(xe,wt),at=io(xe,wt),yt=Fi(xe,wt,Je);function lr(on){var bn=ze[on];bn&&(at[on]=bn)}lr(qs),lr(hn(bf));var Br=Object.keys(at).length>0,Nr={framebuffer:ve,draw:Se,shader:yt,state:at,dirty:Br,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nr.profile=jr(xe,wt),Nr.uniforms=Ri(Ze,wt),Nr.drawVAO=Nr.scopeVAO=Se.vao,!Nr.drawVAO&&yt.program&&!Je&&De.angle_instanced_arrays&&Se.static.elements){var en=!0,kr=yt.program.attributes.map(function(on){var bn=ie.static[on];return en=en&&!!bn,bn});if(en&&kr.length>0){var An=mr.getVAO(mr.createVAO({attributes:kr,elements:Se.static.elements}));Nr.drawVAO=new va(null,null,null,function(on,bn){return on.link(An)}),Nr.useVAO=!0}}return Je?Nr.useVAO=!0:Nr.attributes=Yo(ie,wt),Nr.context=za(it,wt),Nr}function Co(xe,ie,Ze){var it=xe.shared,wt=it.context,Xe=xe.scope();Object.keys(Ze).forEach(function(Le){ie.save(wt,"."+Le);var Je=Ze[Le],ve=Je.append(xe,ie);Array.isArray(ve)?Xe(wt,".",Le,"=[",ve.join(),"];"):Xe(wt,".",Le,"=",ve,";")}),ie(Xe)}function Uo(xe,ie,Ze,it){var wt=xe.shared,Xe=wt.gl,Le=wt.framebuffer,Je;Fr&&(Je=ie.def(wt.extensions,".webgl_draw_buffers"));var ve=xe.constants,ze=ve.drawBuffer,Se=ve.backBuffer,at;Ze?at=Ze.append(xe,ie):at=ie.def(Le,".next"),it||ie("if(",at,"!==",Le,".cur){"),ie("if(",at,"){",Xe,".bindFramebuffer(",fh,",",at,".framebuffer);"),Fr&&ie(Je,".drawBuffersWEBGL(",ze,"[",at,".colorAttachments.length]);"),ie("}else{",Xe,".bindFramebuffer(",fh,",null);"),Fr&&ie(Je,".drawBuffersWEBGL(",Se,");"),ie("}",Le,".cur=",at,";"),it||ie("}")}function Zo(xe,ie,Ze){var it=xe.shared,wt=it.gl,Xe=xe.current,Le=xe.next,Je=it.current,ve=it.next,ze=xe.cond(Je,".dirty");Nn.forEach(function(Se){var at=hn(Se);if(!(at in Ze.state)){var yt,lr;if(at in Le){yt=Le[at],lr=Xe[at];var Br=Ve(Pr[at].length,function(en){return ze.def(yt,"[",en,"]")});ze(xe.cond(Br.map(function(en,kr){return en+"!=="+lr+"["+kr+"]"}).join("||")).then(wt,".",Qt[at],"(",Br,");",Br.map(function(en,kr){return lr+"["+kr+"]="+en}).join(";"),";"))}else{yt=ze.def(ve,".",at);var Nr=xe.cond(yt,"!==",Je,".",at);ze(Nr),at in qt?Nr(xe.cond(yt).then(wt,".enable(",qt[at],");").else(wt,".disable(",qt[at],");"),Je,".",at,"=",yt,";"):Nr(wt,".",Qt[at],"(",yt,");",Je,".",at,"=",yt,";")}}}),Object.keys(Ze.state).length===0&&ze(Je,".dirty=false;"),ie(ze)}function ss(xe,ie,Ze,it){var wt=xe.shared,Xe=xe.current,Le=wt.current,Je=wt.gl;El(Object.keys(Ze)).forEach(function(ve){var ze=Ze[ve];if(!(it&&!it(ze))){var Se=ze.append(xe,ie);if(qt[ve]){var at=qt[ve];dc(ze)?Se?ie(Je,".enable(",at,");"):ie(Je,".disable(",at,");"):ie(xe.cond(Se).then(Je,".enable(",at,");").else(Je,".disable(",at,");")),ie(Le,".",ve,"=",Se,";")}else if(lo(Se)){var yt=Xe[ve];ie(Je,".",Qt[ve],"(",Se,");",Se.map(function(lr,Br){return yt+"["+Br+"]="+lr}).join(";"),";")}else ie(Je,".",Qt[ve],"(",Se,");",Le,".",ve,"=",Se,";")}})}function ao(xe,ie){gr&&(xe.instancing=ie.def(xe.shared.extensions,".angle_instanced_arrays"))}function hi(xe,ie,Ze,it,wt){var Xe=xe.shared,Le=xe.stats,Je=Xe.current,ve=Xe.timer,ze=Ze.profile;function Se(){var on=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return on||typeof performance=="undefined"?"Date.now()":"performance.now()"}var at,yt;function lr(on){at=ie.def(),on(at,"=",Se(),";"),typeof wt=="string"?on(Le,".count+=",wt,";"):on(Le,".count++;"),vr&&(it?(yt=ie.def(),on(yt,"=",ve,".getNumPendingQueries();")):on(ve,".beginQuery(",Le,");"))}function Br(on){on(Le,".cpuTime+=",Se(),"-",at,";"),vr&&(it?on(ve,".pushScopeStats(",yt,",",ve,".getNumPendingQueries(),",Le,");"):on(ve,".endQuery();"))}function Nr(on){var bn=ie.def(Je,".profile");ie(Je,".profile=",on,";"),ie.exit(Je,".profile=",bn,";")}var en;if(ze){if(dc(ze)){ze.enable?(lr(ie),Br(ie.exit),Nr("true")):Nr("false");return}en=ze.append(xe,ie),Nr(en)}else en=ie.def(Je,".profile");var kr=xe.block();lr(kr),ie("if(",en,"){",kr,"}");var An=xe.block();Br(An),ie.exit("if(",en,"){",An,"}")}function Po(xe,ie,Ze,it,wt){var Xe=xe.shared;function Le(ve){switch(ve){case Af:case ep:case rp:return 2;case Du:case Hl:case Mf:return 3;case wf:case tp:case jc:return 4;default:return 1}}function Je(ve,ze,Se){var at=Xe.gl,yt=ie.def(ve,".location"),lr=ie.def(Xe.attributes,"[",yt,"]"),Br=Se.state,Nr=Se.buffer,en=[Se.x,Se.y,Se.z,Se.w],kr=["buffer","normalized","offset","stride"];function An(){ie("if(!",lr,".buffer){",at,".enableVertexAttribArray(",yt,");}");var bn=Se.type,fn;if(Se.size?fn=ie.def(Se.size,"||",ze):fn=ze,ie("if(",lr,".type!==",bn,"||",lr,".size!==",fn,"||",kr.map(function($n){return lr+"."+$n+"!=="+Se[$n]}).join("||"),"){",at,".bindBuffer(",Zc,",",Nr,".buffer);",at,".vertexAttribPointer(",[yt,fn,bn,Se.normalized,Se.stride,Se.offset],");",lr,".type=",bn,";",lr,".size=",fn,";",kr.map(function($n){return lr+"."+$n+"="+Se[$n]+";"}).join(""),"}"),gr){var vn=Se.divisor;ie("if(",lr,".divisor!==",vn,"){",xe.instancing,".vertexAttribDivisorANGLE(",[yt,vn],");",lr,".divisor=",vn,";}")}}function on(){ie("if(",lr,".buffer){",at,".disableVertexAttribArray(",yt,");",lr,".buffer=null;","}if(",ni.map(function(bn,fn){return lr+"."+bn+"!=="+en[fn]}).join("||"),"){",at,".vertexAttrib4f(",yt,",",en,");",ni.map(function(bn,fn){return lr+"."+bn+"="+en[fn]+";"}).join(""),"}")}Br===Vn?An():Br===ci?on():(ie("if(",Br,"===",Vn,"){"),An(),ie("}else{"),on(),ie("}"))}it.forEach(function(ve){var ze=ve.name,Se=Ze.attributes[ze],at;if(Se){if(!wt(Se))return;at=Se.append(xe,ie)}else{if(!wt(hh))return;var yt=xe.scopeAttrib(ze);he.optional(function(){xe.assert(ie,yt+".state","missing attribute "+ze)}),at={},Object.keys(new nt).forEach(function(lr){at[lr]=ie.def(yt,".",lr)})}Je(xe.link(ve),Le(ve.info.type),at)})}function Xi(xe,ie,Ze,it,wt,Xe){for(var Le=xe.shared,Je=Le.gl,ve,ze=0;ze<it.length;++ze){var Se=it[ze],at=Se.name,yt=Se.info.type,lr=Ze.uniforms[at],Br=xe.link(Se),Nr=Br+".location",en;if(lr){if(!wt(lr))continue;if(dc(lr)){var kr=lr.value;if(he.command(kr!==null&&typeof kr!="undefined",'missing uniform "'+at+'"',xe.commandStr),yt===ip||yt===ap){he.command(typeof kr=="function"&&(yt===ip&&(kr._reglType==="texture2d"||kr._reglType==="framebuffer")||yt===ap&&(kr._reglType==="textureCube"||kr._reglType==="framebufferCube")),"invalid texture for uniform "+at,xe.commandStr);var An=xe.link(kr._texture||kr.color[0]._texture);ie(Je,".uniform1i(",Nr,",",An+".bind());"),ie.exit(An,".unbind();")}else if(yt===Ds||yt===Vc||yt===np){he.optional(function(){he.command(lo(kr),"invalid matrix for uniform "+at,xe.commandStr),he.command(yt===Ds&&kr.length===4||yt===Vc&&kr.length===9||yt===np&&kr.length===16,"invalid length for matrix uniform "+at,xe.commandStr)});var on=xe.global.def("new Float32Array(["+Array.prototype.slice.call(kr)+"])"),bn=2;yt===Vc?bn=3:yt===np&&(bn=4),ie(Je,".uniformMatrix",bn,"fv(",Nr,",false,",on,");")}else{switch(yt){case Bp:he.commandType(kr,"number","uniform "+at,xe.commandStr),ve="1f";break;case Af:he.command(lo(kr)&&kr.length===2,"uniform "+at,xe.commandStr),ve="2f";break;case Du:he.command(lo(kr)&&kr.length===3,"uniform "+at,xe.commandStr),ve="3f";break;case wf:he.command(lo(kr)&&kr.length===4,"uniform "+at,xe.commandStr),ve="4f";break;case Tf:he.commandType(kr,"boolean","uniform "+at,xe.commandStr),ve="1i";break;case Jf:he.commandType(kr,"number","uniform "+at,xe.commandStr),ve="1i";break;case rp:he.command(lo(kr)&&kr.length===2,"uniform "+at,xe.commandStr),ve="2i";break;case ep:he.command(lo(kr)&&kr.length===2,"uniform "+at,xe.commandStr),ve="2i";break;case Mf:he.command(lo(kr)&&kr.length===3,"uniform "+at,xe.commandStr),ve="3i";break;case Hl:he.command(lo(kr)&&kr.length===3,"uniform "+at,xe.commandStr),ve="3i";break;case jc:he.command(lo(kr)&&kr.length===4,"uniform "+at,xe.commandStr),ve="4i";break;case tp:he.command(lo(kr)&&kr.length===4,"uniform "+at,xe.commandStr),ve="4i";break}ie(Je,".uniform",ve,"(",Nr,",",lo(kr)?Array.prototype.slice.call(kr):kr,");")}continue}else en=lr.append(xe,ie)}else{if(!wt(hh))continue;en=ie.def(Le.uniforms,"[",fe.id(at),"]")}yt===ip?(he(!Array.isArray(en),"must specify a scalar prop for textures"),ie("if(",en,"&&",en,'._reglType==="framebuffer"){',en,"=",en,".color[0];","}")):yt===ap&&(he(!Array.isArray(en),"must specify a scalar prop for cube maps"),ie("if(",en,"&&",en,'._reglType==="framebufferCube"){',en,"=",en,".color[0];","}")),he.optional(function(){function Fs(zu,Yc){xe.assert(ie,zu,'bad data or missing for uniform "'+at+'".  '+Yc)}function Sl(zu){he(!Array.isArray(en),"must not specify an array type for uniform"),Fs("typeof "+en+'==="'+zu+'"',"invalid type, expected "+zu)}function Nu(zu,Yc){Array.isArray(en)?he(en.length===zu,"must have length "+zu):Fs(Le.isArrayLike+"("+en+")&&"+en+".length==="+zu,"invalid vector, should have length "+zu,xe.commandStr)}function Qh(zu){he(!Array.isArray(en),"must not specify a value type"),Fs("typeof "+en+'==="function"&&'+en+'._reglType==="texture'+(zu===Gh?"2d":"Cube")+'"',"invalid texture type",xe.commandStr)}switch(yt){case Jf:Sl("number");break;case ep:Nu(2,"number");break;case Hl:Nu(3,"number");break;case tp:Nu(4,"number");break;case Bp:Sl("number");break;case Af:Nu(2,"number");break;case Du:Nu(3,"number");break;case wf:Nu(4,"number");break;case Tf:Sl("boolean");break;case rp:Nu(2,"boolean");break;case Mf:Nu(3,"boolean");break;case jc:Nu(4,"boolean");break;case Ds:Nu(4,"number");break;case Vc:Nu(9,"number");break;case np:Nu(16,"number");break;case ip:Qh(Gh);break;case ap:Qh(ch);break}});var fn=1;switch(yt){case ip:case ap:var vn=ie.def(en,"._texture");ie(Je,".uniform1i(",Nr,",",vn,".bind());"),ie.exit(vn,".unbind();");continue;case Jf:case Tf:ve="1i";break;case ep:case rp:ve="2i",fn=2;break;case Hl:case Mf:ve="3i",fn=3;break;case tp:case jc:ve="4i",fn=4;break;case Bp:ve="1f";break;case Af:ve="2f",fn=2;break;case Du:ve="3f",fn=3;break;case wf:ve="4f",fn=4;break;case Ds:ve="Matrix2fv";break;case Vc:ve="Matrix3fv";break;case np:ve="Matrix4fv";break}if(ve.charAt(0)==="M"){ie(Je,".uniform",ve,"(",Nr,",");var $n=Math.pow(yt-Ds+2,2),ba=xe.global.def("new Float32Array(",$n,")");Array.isArray(en)?ie("false,(",Ve($n,function(Fs){return ba+"["+Fs+"]="+en[Fs]}),",",ba,")"):ie("false,(Array.isArray(",en,")||",en," instanceof Float32Array)?",en,":(",Ve($n,function(Fs){return ba+"["+Fs+"]="+en+"["+Fs+"]"}),",",ba,")"),ie(");")}else if(fn>1){for(var us=[],Ua=[],ma=0;ma<fn;++ma)Array.isArray(en)?Ua.push(en[ma]):Ua.push(ie.def(en+"["+ma+"]")),Xe&&us.push(ie.def());Xe&&ie("if(!",xe.batchId,"||",us.map(function(Fs,Sl){return Fs+"!=="+Ua[Sl]}).join("||"),"){",us.map(function(Fs,Sl){return Fs+"="+Ua[Sl]+";"}).join("")),ie(Je,".uniform",ve,"(",Nr,",",Ua.join(","),");"),Xe&&ie("}")}else{if(he(!Array.isArray(en),"uniform value must not be an array"),Xe){var Yl=ie.def();ie("if(!",xe.batchId,"||",Yl,"!==",en,"){",Yl,"=",en,";")}ie(Je,".uniform",ve,"(",Nr,",",en,");"),Xe&&ie("}")}}}function Qo(xe,ie,Ze,it){var wt=xe.shared,Xe=wt.gl,Le=wt.draw,Je=it.draw;function ve(){var fn=Je.elements,vn,$n=ie;return fn?((fn.contextDep&&it.contextDynamic||fn.propDep)&&($n=Ze),vn=fn.append(xe,$n),Je.elementsActive&&$n("if("+vn+")"+Xe+".bindBuffer("+lh+","+vn+".buffer.buffer);")):(vn=$n.def(),$n(vn,"=",Le,".",yu,";","if(",vn,"){",Xe,".bindBuffer(",lh,",",vn,".buffer.buffer);}","else if(",wt.vao,".currentVAO){",vn,"=",xe.shared.elements+".getElements("+wt.vao,".currentVAO.elements);",or?"":"if("+vn+")"+Xe+".bindBuffer("+lh+","+vn+".buffer.buffer);","}")),vn}function ze(){var fn=Je.count,vn,$n=ie;return fn?((fn.contextDep&&it.contextDynamic||fn.propDep)&&($n=Ze),vn=fn.append(xe,$n),he.optional(function(){fn.MISSING&&xe.assert(ie,"false","missing vertex count"),fn.DYNAMIC&&xe.assert($n,vn+">=0","missing vertex count")})):(vn=$n.def(Le,".",Uc),he.optional(function(){xe.assert($n,vn+">=0","missing vertex count")})),vn}var Se=ve();function at(fn){var vn=Je[fn];return vn?vn.contextDep&&it.contextDynamic||vn.propDep?vn.append(xe,Ze):vn.append(xe,ie):ie.def(Le,".",fn)}var yt=at(zo),lr=at(qf),Br=ze();if(typeof Br=="number"){if(Br===0)return}else Ze("if(",Br,"){"),Ze.exit("}");var Nr,en;gr&&(Nr=at(Lp),en=xe.instancing);var kr=Se+".type",An=Je.elements&&dc(Je.elements)&&!Je.vaoActive;function on(){function fn(){Ze(en,".drawElementsInstancedANGLE(",[yt,Br,kr,lr+"<<(("+kr+"-"+Yn+")>>1)",Nr],");")}function vn(){Ze(en,".drawArraysInstancedANGLE(",[yt,lr,Br,Nr],");")}Se&&Se!=="null"?An?fn():(Ze("if(",Se,"){"),fn(),Ze("}else{"),vn(),Ze("}")):vn()}function bn(){function fn(){Ze(Xe+".drawElements("+[yt,Br,kr,lr+"<<(("+kr+"-"+Yn+")>>1)"]+");")}function vn(){Ze(Xe+".drawArrays("+[yt,lr,Br]+");")}Se&&Se!=="null"?An?fn():(Ze("if(",Se,"){"),fn(),Ze("}else{"),vn(),Ze("}")):vn()}gr&&(typeof Nr!="number"||Nr>=0)?typeof Nr=="string"?(Ze("if(",Nr,">0){"),on(),Ze("}else if(",Nr,"<0){"),bn(),Ze("}")):on():bn()}function ei(xe,ie,Ze,it,wt){var Xe=Jn(),Le=Xe.proc("body",wt);return he.optional(function(){Xe.commandStr=ie.commandStr,Xe.command=Xe.link(ie.commandStr)}),gr&&(Xe.instancing=Le.def(Xe.shared.extensions,".angle_instanced_arrays")),xe(Xe,Le,Ze,it),Xe.compile().body}function ki(xe,ie,Ze,it){ao(xe,ie),Ze.useVAO?Ze.drawVAO?ie(xe.shared.vao,".setVAO(",Ze.drawVAO.append(xe,ie),");"):ie(xe.shared.vao,".setVAO(",xe.shared.vao,".targetVAO);"):(ie(xe.shared.vao,".setVAO(null);"),Po(xe,ie,Ze,it.attributes,function(){return!0})),Xi(xe,ie,Ze,it.uniforms,function(){return!0},!1),Qo(xe,ie,ie,Ze)}function xn(xe,ie){var Ze=xe.proc("draw",1);ao(xe,Ze),Co(xe,Ze,ie.context),Uo(xe,Ze,ie.framebuffer),Zo(xe,Ze,ie),ss(xe,Ze,ie.state),hi(xe,Ze,ie,!1,!0);var it=ie.shader.progVar.append(xe,Ze);if(Ze(xe.shared.gl,".useProgram(",it,".program);"),ie.shader.program)ki(xe,Ze,ie,ie.shader.program);else{Ze(xe.shared.vao,".setVAO(null);");var wt=xe.global.def("{}"),Xe=Ze.def(it,".id"),Le=Ze.def(wt,"[",Xe,"]");Ze(xe.cond(Le).then(Le,".call(this,a0);").else(Le,"=",wt,"[",Xe,"]=",xe.link(function(Je){return ei(ki,xe,ie,Je,1)}),"(",it,");",Le,".call(this,a0);"))}Object.keys(ie.state).length>0&&Ze(xe.shared.current,".dirty=true;"),xe.shared.vao&&Ze(xe.shared.vao,".setVAO(null);")}function Ln(xe,ie,Ze,it){xe.batchId="a1",ao(xe,ie);function wt(){return!0}Po(xe,ie,Ze,it.attributes,wt),Xi(xe,ie,Ze,it.uniforms,wt,!1),Qo(xe,ie,ie,Ze)}function il(xe,ie,Ze,it){ao(xe,ie);var wt=Ze.contextDep,Xe=ie.def(),Le="a0",Je="a1",ve=ie.def();xe.shared.props=ve,xe.batchId=Xe;var ze=xe.scope(),Se=xe.scope();ie(ze.entry,"for(",Xe,"=0;",Xe,"<",Je,";++",Xe,"){",ve,"=",Le,"[",Xe,"];",Se,"}",ze.exit);function at(kr){return kr.contextDep&&wt||kr.propDep}function yt(kr){return!at(kr)}if(Ze.needsContext&&Co(xe,Se,Ze.context),Ze.needsFramebuffer&&Uo(xe,Se,Ze.framebuffer),ss(xe,Se,Ze.state,at),Ze.profile&&at(Ze.profile)&&hi(xe,Se,Ze,!1,!0),it)Ze.useVAO?Ze.drawVAO?at(Ze.drawVAO)?Se(xe.shared.vao,".setVAO(",Ze.drawVAO.append(xe,Se),");"):ze(xe.shared.vao,".setVAO(",Ze.drawVAO.append(xe,ze),");"):ze(xe.shared.vao,".setVAO(",xe.shared.vao,".targetVAO);"):(ze(xe.shared.vao,".setVAO(null);"),Po(xe,ze,Ze,it.attributes,yt),Po(xe,Se,Ze,it.attributes,at)),Xi(xe,ze,Ze,it.uniforms,yt,!1),Xi(xe,Se,Ze,it.uniforms,at,!0),Qo(xe,ze,Se,Ze);else{var lr=xe.global.def("{}"),Br=Ze.shader.progVar.append(xe,Se),Nr=Se.def(Br,".id"),en=Se.def(lr,"[",Nr,"]");Se(xe.shared.gl,".useProgram(",Br,".program);","if(!",en,"){",en,"=",lr,"[",Nr,"]=",xe.link(function(kr){return ei(Ln,xe,Ze,kr,2)}),"(",Br,");}",en,".call(this,a0[",Xe,"],",Xe,");")}}function we(xe,ie){var Ze=xe.proc("batch",2);xe.batchId="0",ao(xe,Ze);var it=!1,wt=!0;Object.keys(ie.context).forEach(function(lr){it=it||ie.context[lr].propDep}),it||(Co(xe,Ze,ie.context),wt=!1);var Xe=ie.framebuffer,Le=!1;Xe?(Xe.propDep?it=Le=!0:Xe.contextDep&&it&&(Le=!0),Le||Uo(xe,Ze,Xe)):Uo(xe,Ze,null),ie.state.viewport&&ie.state.viewport.propDep&&(it=!0);function Je(lr){return lr.contextDep&&it||lr.propDep}Zo(xe,Ze,ie),ss(xe,Ze,ie.state,function(lr){return!Je(lr)}),(!ie.profile||!Je(ie.profile))&&hi(xe,Ze,ie,!1,"a1"),ie.contextDep=it,ie.needsContext=wt,ie.needsFramebuffer=Le;var ve=ie.shader.progVar;if(ve.contextDep&&it||ve.propDep)il(xe,Ze,ie,null);else{var ze=ve.append(xe,Ze);if(Ze(xe.shared.gl,".useProgram(",ze,".program);"),ie.shader.program)il(xe,Ze,ie,ie.shader.program);else{Ze(xe.shared.vao,".setVAO(null);");var Se=xe.global.def("{}"),at=Ze.def(ze,".id"),yt=Ze.def(Se,"[",at,"]");Ze(xe.cond(yt).then(yt,".call(this,a0,a1);").else(yt,"=",Se,"[",at,"]=",xe.link(function(lr){return ei(il,xe,ie,lr,2)}),"(",ze,");",yt,".call(this,a0,a1);"))}}Object.keys(ie.state).length>0&&Ze(xe.shared.current,".dirty=true;"),xe.shared.vao&&Ze(xe.shared.vao,".setVAO(null);")}function Dt(xe,ie){var Ze=xe.proc("scope",3);xe.batchId="a2";var it=xe.shared,wt=it.current;Co(xe,Ze,ie.context),ie.framebuffer&&ie.framebuffer.append(xe,Ze),El(Object.keys(ie.state)).forEach(function(Le){var Je=ie.state[Le],ve=Je.append(xe,Ze);lo(ve)?ve.forEach(function(ze,Se){Ze.set(xe.next[Le],"["+Se+"]",ze)}):Ze.set(it.next,"."+Le,ve)}),hi(xe,Ze,ie,!0,!0),[yu,qf,Uc,Lp,zo].forEach(function(Le){var Je=ie.draw[Le];!Je||Ze.set(it.draw,"."+Le,""+Je.append(xe,Ze))}),Object.keys(ie.uniforms).forEach(function(Le){var Je=ie.uniforms[Le].append(xe,Ze);Array.isArray(Je)&&(Je="["+Je.join()+"]"),Ze.set(it.uniforms,"["+fe.id(Le)+"]",Je)}),Object.keys(ie.attributes).forEach(function(Le){var Je=ie.attributes[Le].append(xe,Ze),ve=xe.scopeAttrib(Le);Object.keys(new nt).forEach(function(ze){Ze.set(ve,"."+ze,Je[ze])})}),ie.scopeVAO&&Ze.set(it.vao,".targetVAO",ie.scopeVAO.append(xe,Ze));function Xe(Le){var Je=ie.shader[Le];Je&&Ze.set(it.shader,"."+Le,Je.append(xe,Ze))}Xe(rl),Xe(Gl),Object.keys(ie.state).length>0&&(Ze(wt,".dirty=true;"),Ze.exit(wt,".dirty=true;")),Ze("a1(",xe.shared.context,",a0,",xe.batchId,");")}function gt(xe){if(!(typeof xe!="object"||lo(xe))){for(var ie=Object.keys(xe),Ze=0;Ze<ie.length;++Ze)if(En.isDynamic(xe[ie[Ze]]))return!0;return!1}}function dn(xe,ie,Ze){var it=ie.static[Ze];if(!it||!gt(it))return;var wt=xe.global,Xe=Object.keys(it),Le=!1,Je=!1,ve=!1,ze=xe.global.def("{}");Xe.forEach(function(at){var yt=it[at];if(En.isDynamic(yt)){typeof yt=="function"&&(yt=it[at]=En.unbox(yt));var lr=Ks(yt,null);Le=Le||lr.thisDep,ve=ve||lr.propDep,Je=Je||lr.contextDep}else{switch(wt(ze,".",at,"="),typeof yt){case"number":wt(yt);break;case"string":wt('"',yt,'"');break;case"object":Array.isArray(yt)&&wt("[",yt.join(),"]");break;default:wt(xe.link(yt));break}wt(";")}});function Se(at,yt){Xe.forEach(function(lr){var Br=it[lr];if(!!En.isDynamic(Br)){var Nr=at.invoke(yt,Br);yt(ze,".",lr,"=",Nr,";")}})}ie.dynamic[Ze]=new En.DynamicVariable(ka,{thisDep:Le,contextDep:Je,propDep:ve,ref:ze,append:Se}),delete ie.static[Ze]}function Ui(xe,ie,Ze,it,wt){var Xe=Jn();Xe.stats=Xe.link(wt),Object.keys(ie.static).forEach(function(Je){dn(Xe,ie,Je)}),Vh.forEach(function(Je){dn(Xe,xe,Je)});var Le=qo(xe,ie,Ze,it,Xe);return xn(Xe,Le),Dt(Xe,Le),we(Xe,Le),m(Xe.compile(),{destroy:function(){Le.shader.program.destroy()}})}return{next:Yr,current:Pr,procs:function(){var xe=Jn(),ie=xe.proc("poll"),Ze=xe.proc("refresh"),it=xe.block();ie(it),Ze(it);var wt=xe.shared,Xe=wt.gl,Le=wt.next,Je=wt.current;it(Je,".dirty=false;"),Uo(xe,ie),Uo(xe,Ze,null,!0);var ve;gr&&(ve=xe.link(gr)),De.oes_vertex_array_object&&Ze(xe.link(De.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ze=0;ze<Ot.maxAttributes;++ze){var Se=Ze.def(wt.attributes,"[",ze,"]"),at=xe.cond(Se,".buffer");at.then(Xe,".enableVertexAttribArray(",ze,");",Xe,".bindBuffer(",Zc,",",Se,".buffer.buffer);",Xe,".vertexAttribPointer(",ze,",",Se,".size,",Se,".type,",Se,".normalized,",Se,".stride,",Se,".offset);").else(Xe,".disableVertexAttribArray(",ze,");",Xe,".vertexAttrib4f(",ze,",",Se,".x,",Se,".y,",Se,".z,",Se,".w);",Se,".buffer=null;"),Ze(at),gr&&Ze(ve,".vertexAttribDivisorANGLE(",ze,",",Se,".divisor);")}return Ze(xe.shared.vao,".currentVAO=null;",xe.shared.vao,".setVAO(",xe.shared.vao,".targetVAO);"),Object.keys(qt).forEach(function(yt){var lr=qt[yt],Br=it.def(Le,".",yt),Nr=xe.block();Nr("if(",Br,"){",Xe,".enable(",lr,")}else{",Xe,".disable(",lr,")}",Je,".",yt,"=",Br,";"),Ze(Nr),ie("if(",Br,"!==",Je,".",yt,"){",Nr,"}")}),Object.keys(Qt).forEach(function(yt){var lr=Qt[yt],Br=Pr[yt],Nr,en,kr=xe.block();if(kr(Xe,".",lr,"("),lo(Br)){var An=Br.length;Nr=xe.global.def(Le,".",yt),en=xe.global.def(Je,".",yt),kr(Ve(An,function(on){return Nr+"["+on+"]"}),");",Ve(An,function(on){return en+"["+on+"]="+Nr+"["+on+"];"}).join("")),ie("if(",Ve(An,function(on){return Nr+"["+on+"]!=="+en+"["+on+"]"}).join("||"),"){",kr,"}")}else Nr=it.def(Le,".",yt),en=it.def(Je,".",yt),kr(Nr,");",Je,".",yt,"=",Nr,";"),ie("if(",Nr,"!==",en,"){",kr,"}");Ze(kr)}),xe.compile()}(),compile:Ui}}function zp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Od=34918,Rd=34919,Bu=35007,up=function(z,fe){if(!fe.ext_disjoint_timer_query)return null;var De=[];function Ot(){return De.pop()||fe.ext_disjoint_timer_query.createQueryEXT()}function rr(gr){De.push(gr)}var Pt=[];function Yt(gr){var Fr=Ot();fe.ext_disjoint_timer_query.beginQueryEXT(Bu,Fr),Pt.push(Fr),vr(Pt.length-1,Pt.length,gr)}function sr(){fe.ext_disjoint_timer_query.endQueryEXT(Bu)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var mr=[];function Sr(){return mr.pop()||new dr}function Tr(gr){mr.push(gr)}var Zr=[];function vr(gr,Fr,or){var Pr=Sr();Pr.startQueryIndex=gr,Pr.endQueryIndex=Fr,Pr.sum=0,Pr.stats=or,Zr.push(Pr)}var Cr=[],nt=[];function Ut(){var gr,Fr,or=Pt.length;if(or!==0){nt.length=Math.max(nt.length,or+1),Cr.length=Math.max(Cr.length,or+1),Cr[0]=0,nt[0]=0;var Pr=0;for(gr=0,Fr=0;Fr<Pt.length;++Fr){var Yr=Pt[Fr];fe.ext_disjoint_timer_query.getQueryObjectEXT(Yr,Rd)?(Pr+=fe.ext_disjoint_timer_query.getQueryObjectEXT(Yr,Od),rr(Yr)):Pt[gr++]=Yr,Cr[Fr+1]=Pr,nt[Fr+1]=gr}for(Pt.length=gr,gr=0,Fr=0;Fr<Zr.length;++Fr){var Nn=Zr[Fr],qt=Nn.startQueryIndex,Qt=Nn.endQueryIndex;Nn.sum+=Cr[Qt]-Cr[qt];var hn=nt[qt],Wr=nt[Qt];Wr===hn?(Nn.stats.gpuTime+=Nn.sum/1e6,Tr(Nn)):(Nn.startQueryIndex=hn,Nn.endQueryIndex=Wr,Zr[gr++]=Nn)}Zr.length=gr}}return{beginQuery:Yt,endQuery:sr,pushScopeStats:vr,update:Ut,getNumPendingQueries:function(){return Pt.length},clear:function(){De.push.apply(De,Pt);for(var gr=0;gr<De.length;gr++)fe.ext_disjoint_timer_query.deleteQueryEXT(De[gr]);Pt.length=0,De.length=0},restore:function(){Pt.length=0,De.length=0}}},lp=16384,cp=256,fp=1024,Up=34962,Xc="webglcontextlost",Aa="webglcontextrestored",dh=1,Xl=2,Of=3;function vh(z,fe){for(var De=0;De<z.length;++De)if(z[De]===fe)return De;return-1}function kd(z){var fe=de(z);if(!fe)return null;var De=fe.gl,Ot=De.getContextAttributes(),rr=De.isContextLost(),Pt=Me(De,fe);if(!Pt)return null;var Yt=fs(),sr=zp(),dr=Pt.extensions,mr=up(De,dr),Sr=to(),Tr=De.drawingBufferWidth,Zr=De.drawingBufferHeight,vr={tick:0,time:0,viewportWidth:Tr,viewportHeight:Zr,framebufferWidth:Tr,framebufferHeight:Zr,drawingBufferWidth:Tr,drawingBufferHeight:Zr,pixelRatio:fe.pixelRatio},Cr={},nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ut=Tl(De,dr),gr=B(De,sr,fe,Pr),Fr=ll(De,dr,gr,sr),or=vt(De,dr,Ut,sr,gr,Fr,nt);function Pr(ei){return or.destroyBuffer(ei)}var Yr=xr(De,Yt,sr,fe),Nn=_s(De,dr,Ut,function(){hn.procs.poll()},vr,sr,fe),qt=$u(De,dr,Ut,sr,fe),Qt=Ie(De,dr,Ut,Nn,qt,sr),hn=$h(De,Yt,dr,Ut,gr,Fr,Nn,Qt,Cr,or,Yr,nt,vr,mr,fe),Wr=Bn(De,Qt,hn.procs.poll,vr,Ot,dr,Ut),br=hn.next,Xr=De.canvas,qr=[],yi=[],Jn=[],jr=[fe.onDestroy],Jr=null;function Kn(){if(qr.length===0){mr&&mr.update(),Jr=null;return}Jr=Ii.next(Kn),ao();for(var ei=qr.length-1;ei>=0;--ei){var ki=qr[ei];ki&&ki(vr,null,0)}De.flush(),mr&&mr.update()}function si(){!Jr&&qr.length>0&&(Jr=Ii.next(Kn))}function Fi(){Jr&&(Ii.cancel(Kn),Jr=null)}function qa(ei){ei.preventDefault(),rr=!0,Fi(),yi.forEach(function(ki){ki()})}function io(ei){De.getError(),rr=!1,Pt.restore(),Yr.restore(),gr.restore(),Nn.restore(),qt.restore(),Qt.restore(),or.restore(),mr&&mr.restore(),hn.procs.refresh(),si(),Jn.forEach(function(ki){ki()})}var Ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ri&&Xr&&(Xr.addEventListener(Xc,qa,!1),Xr.addEventListener(Aa,io,!1));function Yo(){qr.length=0,Fi(),!Ri&&Xr&&(Xr.removeEventListener(Xc,qa),Xr.removeEventListener(Aa,io)),Yr.clear(),Qt.clear(),qt.clear(),or.clear(),Nn.clear(),Fr.clear(),gr.clear(),mr&&mr.clear(),jr.forEach(function(ei){ei()})}function za(ei){he(!!ei,"invalid args to regl({...})"),he.type(ei,"object","invalid args to regl({...})");function ki(Xe){var Le=m({},Xe);delete Le.uniforms,delete Le.attributes,delete Le.context,delete Le.vao,"stencil"in Le&&Le.stencil.op&&(Le.stencil.opBack=Le.stencil.opFront=Le.stencil.op,delete Le.stencil.op);function Je(ve){if(ve in Le){var ze=Le[ve];delete Le[ve],Object.keys(ze).forEach(function(Se){Le[ve+"."+Se]=ze[Se]})}}return Je("blend"),Je("depth"),Je("cull"),Je("stencil"),Je("polygonOffset"),Je("scissor"),Je("sample"),"vao"in Xe&&(Le.vao=Xe.vao),Le}function xn(Xe,Le){var Je={},ve={};return Object.keys(Xe).forEach(function(ze){var Se=Xe[ze];if(En.isDynamic(Se)){ve[ze]=En.unbox(Se,ze);return}else if(Le&&Array.isArray(Se)){for(var at=0;at<Se.length;++at)if(En.isDynamic(Se[at])){ve[ze]=En.unbox(Se,ze);return}}Je[ze]=Se}),{dynamic:ve,static:Je}}var Ln=xn(ei.context||{},!0),il=xn(ei.uniforms||{},!0),we=xn(ei.attributes||{},!1),Dt=xn(ki(ei),!1),gt={gpuTime:0,cpuTime:0,count:0},dn=hn.compile(Dt,we,il,Ln,gt),Ui=dn.draw,xe=dn.batch,ie=dn.scope,Ze=[];function it(Xe){for(;Ze.length<Xe;)Ze.push(null);return Ze}function wt(Xe,Le){var Je;if(rr&&he.raise("context lost"),typeof Xe=="function")return ie.call(this,null,Xe,0);if(typeof Le=="function")if(typeof Xe=="number")for(Je=0;Je<Xe;++Je)ie.call(this,null,Le,Je);else if(Array.isArray(Xe))for(Je=0;Je<Xe.length;++Je)ie.call(this,Xe[Je],Le,Je);else return ie.call(this,Xe,Le,0);else if(typeof Xe=="number"){if(Xe>0)return xe.call(this,it(Xe|0),Xe|0)}else if(Array.isArray(Xe)){if(Xe.length)return xe.call(this,Xe,Xe.length)}else return Ui.call(this,Xe)}return m(wt,{stats:gt,destroy:function(){dn.destroy()}})}var qo=Qt.setFBO=za({framebuffer:En.define.call(null,dh,"framebuffer")});function Co(ei,ki){var xn=0;hn.procs.poll();var Ln=ki.color;Ln&&(De.clearColor(+Ln[0]||0,+Ln[1]||0,+Ln[2]||0,+Ln[3]||0),xn|=lp),"depth"in ki&&(De.clearDepth(+ki.depth),xn|=cp),"stencil"in ki&&(De.clearStencil(ki.stencil|0),xn|=fp),he(!!xn,"called regl.clear with no buffer specified"),De.clear(xn)}function Uo(ei){if(he(typeof ei=="object"&&ei,"regl.clear() takes an object as input"),"framebuffer"in ei)if(ei.framebuffer&&ei.framebuffer_reglType==="framebufferCube")for(var ki=0;ki<6;++ki)qo(m({framebuffer:ei.framebuffer.faces[ki]},ei),Co);else qo(ei,Co);else Co(null,ei)}function Zo(ei){he.type(ei,"function","regl.frame() callback must be a function"),qr.push(ei);function ki(){var xn=vh(qr,ei);he(xn>=0,"cannot cancel a frame twice");function Ln(){var il=vh(qr,Ln);qr[il]=qr[qr.length-1],qr.length-=1,qr.length<=0&&Fi()}qr[xn]=Ln}return si(),{cancel:ki}}function ss(){var ei=br.viewport,ki=br.scissor_box;ei[0]=ei[1]=ki[0]=ki[1]=0,vr.viewportWidth=vr.framebufferWidth=vr.drawingBufferWidth=ei[2]=ki[2]=De.drawingBufferWidth,vr.viewportHeight=vr.framebufferHeight=vr.drawingBufferHeight=ei[3]=ki[3]=De.drawingBufferHeight}function ao(){vr.tick+=1,vr.time=Po(),ss(),hn.procs.poll()}function hi(){Nn.refresh(),ss(),hn.procs.refresh(),mr&&mr.update()}function Po(){return(to()-Sr)/1e3}hi();function Xi(ei,ki){he.type(ki,"function","listener callback must be a function");var xn;switch(ei){case"frame":return Zo(ki);case"lost":xn=yi;break;case"restore":xn=Jn;break;case"destroy":xn=jr;break;default:he.raise("invalid event, must be one of frame,lost,restore,destroy")}return xn.push(ki),{cancel:function(){for(var Ln=0;Ln<xn.length;++Ln)if(xn[Ln]===ki){xn[Ln]=xn[xn.length-1],xn.pop();return}}}}var Qo=m(za,{clear:Uo,prop:En.define.bind(null,dh),context:En.define.bind(null,Xl),this:En.define.bind(null,Of),draw:za({}),buffer:function(ei){return gr.create(ei,Up,!1,!1)},elements:function(ei){return Fr.create(ei,!1)},texture:Nn.create2D,cube:Nn.createCube,renderbuffer:qt.create,framebuffer:Qt.create,framebufferCube:Qt.createCube,vao:or.createVAO,attributes:Ot,frame:Zo,on:Xi,limits:Ut,hasExtension:function(ei){return Ut.extensions.indexOf(ei.toLowerCase())>=0},read:Wr,destroy:Yo,_gl:De,_refresh:hi,poll:function(){ao(),mr&&mr.update()},now:Po,stats:sr});return fe.onDone(null,Qo),Qo}return kd})},49029:function(Ar){var ne=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Q(Pe){return Pe.match(ne)||[]}Ar.exports=Q},29750:function(Ar){function ne(Q,Pe,ye){return Q===Q&&(ye!==void 0&&(Q=Q<=ye?Q:ye),Pe!==void 0&&(Q=Q>=Pe?Q:Pe)),Q}Ar.exports=ne},18674:function(Ar){function ne(Q){return function(Pe){return Q==null?void 0:Q[Pe]}}Ar.exports=ne},98805:function(Ar,ne,Q){var Pe=Q(40180),ye=Q(62689),m=Q(83140),Oe=Q(79833);function W(pe){return function(ce){ce=Oe(ce);var Be=ye(ce)?m(ce):void 0,_e=Be?Be[0]:ce.charAt(0),tt=Be?Pe(Be,1).join(""):ce.slice(1);return _e[pe]()+tt}}Ar.exports=W},35393:function(Ar,ne,Q){var Pe=Q(62663),ye=Q(53816),m=Q(58748),Oe="['\u2019]",W=RegExp(Oe,"g");function pe(ce){return function(Be){return Pe(m(ye(Be).replace(W,"")),ce,"")}}Ar.exports=pe},69389:function(Ar,ne,Q){var Pe=Q(18674),ye={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=Pe(ye);Ar.exports=m},93157:function(Ar){var ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Q(Pe){return ne.test(Pe)}Ar.exports=Q},2757:function(Ar){var ne="\\ud800-\\udfff",Q="\\u0300-\\u036f",Pe="\\ufe20-\\ufe2f",ye="\\u20d0-\\u20ff",m=Q+Pe+ye,Oe="\\u2700-\\u27bf",W="a-z\\xdf-\\xf6\\xf8-\\xff",pe="\\xac\\xb1\\xd7\\xf7",ce="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Be="\\u2000-\\u206f",_e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tt="A-Z\\xc0-\\xd6\\xd8-\\xde",pt="\\ufe0e\\ufe0f",Et=pe+ce+Be+_e,Jt="['\u2019]",ur="["+Et+"]",kt="["+m+"]",er="\\d+",jt="["+Oe+"]",ct="["+W+"]",dt="[^"+ne+Et+er+Oe+W+tt+"]",ir="\\ud83c[\\udffb-\\udfff]",Y="(?:"+kt+"|"+ir+")",Wt="[^"+ne+"]",ut="(?:\\ud83c[\\udde6-\\uddff]){2}",qe="[\\ud800-\\udbff][\\udc00-\\udfff]",St="["+tt+"]",Qe="\\u200d",Xt="(?:"+ct+"|"+dt+")",wr="(?:"+St+"|"+dt+")",Gr="(?:"+Jt+"(?:d|ll|m|re|s|t|ve))?",Qr="(?:"+Jt+"(?:D|LL|M|RE|S|T|VE))?",A=Y+"?",Ce="["+pt+"]?",ke="(?:"+Qe+"(?:"+[Wt,ut,qe].join("|")+")"+Ce+A+")*",xt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ht="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ft=Ce+A+ke,Gt="(?:"+[jt,ut,qe].join("|")+")"+Ft,Er=RegExp([St+"?"+ct+"+"+Gr+"(?="+[ur,St,"$"].join("|")+")",wr+"+"+Qr+"(?="+[ur,St+Xt,"$"].join("|")+")",St+"?"+Xt+"+"+Gr,St+"+"+Qr,ht,xt,er,Gt].join("|"),"g");function Qn(gn){return gn.match(Er)||[]}Ar.exports=Qn},68929:function(Ar,ne,Q){var Pe=Q(48403),ye=Q(35393),m=ye(function(Oe,W,pe){return W=W.toLowerCase(),Oe+(pe?Pe(W):W)});Ar.exports=m},48403:function(Ar,ne,Q){var Pe=Q(79833),ye=Q(11700);function m(Oe){return ye(Pe(Oe).toLowerCase())}Ar.exports=m},74691:function(Ar,ne,Q){var Pe=Q(29750),ye=Q(14841);function m(Oe,W,pe){return pe===void 0&&(pe=W,W=void 0),pe!==void 0&&(pe=ye(pe),pe=pe===pe?pe:0),W!==void 0&&(W=ye(W),W=W===W?W:0),Pe(ye(Oe),W,pe)}Ar.exports=m},53816:function(Ar,ne,Q){var Pe=Q(69389),ye=Q(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Oe="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",ce=Oe+W+pe,Be="["+ce+"]",_e=RegExp(Be,"g");function tt(pt){return pt=ye(pt),pt&&pt.replace(m,Pe).replace(_e,"")}Ar.exports=tt},14293:function(Ar){function ne(Q){return Q==null}Ar.exports=ne},81763:function(Ar,ne,Q){var Pe=Q(44239),ye=Q(37005),m="[object Number]";function Oe(W){return typeof W=="number"||ye(W)&&Pe(W)==m}Ar.exports=Oe},30236:function(Ar,ne,Q){var Pe=Q(42980),ye=Q(21463),m=ye(function(Oe,W,pe,ce){Pe(Oe,W,pe,ce)});Ar.exports=m},44908:function(Ar,ne,Q){var Pe=Q(45652);function ye(m){return m&&m.length?Pe(m):[]}Ar.exports=ye},11700:function(Ar,ne,Q){var Pe=Q(98805),ye=Pe("toUpperCase");Ar.exports=ye},58748:function(Ar,ne,Q){var Pe=Q(49029),ye=Q(93157),m=Q(79833),Oe=Q(2757);function W(pe,ce,Be){return pe=m(pe),ce=Be?void 0:ce,ce===void 0?ye(pe)?Oe(pe):Pe(pe):pe.match(ce)||[]}Ar.exports=W},6158:function(Ar){(function(ne,Q){Ar.exports=Q()})(this,function(){"use strict";var ne,Q,Pe;function ye(m,Oe){if(!ne)ne=Oe;else if(!Q)Q=Oe;else{var W="var sharedChunk = {}; ("+ne+")(sharedChunk); ("+Q+")(sharedChunk);",pe={};ne(pe),Pe=Oe(pe),typeof window!="undefined"&&(Pe.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return ye(["exports"],function(m){"use strict";function Oe(t,o){return t(o={exports:{}},o.exports),o.exports}var W=pe;function pe(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}pe.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},pe.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},pe.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},pe.prototype.solveCurveX=function(t,o){var u,h,g,b,S;for(o===void 0&&(o=1e-6),g=t,S=0;S<8;S++){if(b=this.sampleCurveX(g)-t,Math.abs(b)<o)return g;var I=this.sampleCurveDerivativeX(g);if(Math.abs(I)<1e-6)break;g-=b/I}if((g=t)<(u=0))return u;if(g>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(g),Math.abs(b-t)<o)return g;t>b?u=g:h=g,g=.5*(h-u)+u}return g},pe.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var ce=Be;function Be(t,o){this.x=t,this.y=o}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),g=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(t){return t instanceof Be?t:Array.isArray(t)?new Be(t[0],t[1]):t};var _e=typeof self!="undefined"?self:{},tt=Math.pow(2,53)-1;function pt(t,o,u,h){var g=new W(t,o,u,h);return function(b){return g.solve(b)}}var Et=pt(.25,.1,.25,1);function Jt(t,o,u){return Math.min(u,Math.max(o,t))}function ur(t,o,u){var h=u-o,g=((t-o)%h+h)%h+o;return g===o?u:g}function kt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,g=o;h<g.length;h+=1){var b=g[h];for(var S in b)t[S]=b[S]}return t}var er=1;function jt(){return er++}function ct(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ir(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Wt(t,o,u){var h={};for(var g in t)h[g]=o.call(u||this,t[g],g,t);return h}function ut(t,o,u){var h={};for(var g in t)o.call(u||this,t[g],g,t)&&(h[g]=t[g]);return h}function qe(t){return Array.isArray(t)?t.map(qe):typeof t=="object"&&t?Wt(t,qe):t}var St={};function Qe(t){St[t]||(typeof console!="undefined"&&console.warn(t),St[t]=!0)}function Xt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function wr(t){for(var o=0,u=0,h=t.length,g=h-1,b=void 0,S=void 0;u<h;g=u++)o+=((S=t[g]).x-(b=t[u]).x)*(b.y+S.y);return o}function Gr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Qr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,g,b,S){var I=b||S;return o[g]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Ce(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function ke(t){try{var o=_e[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var xt,ht,Ft,Gt,Er=_e.performance&&_e.performance.now?_e.performance.now.bind(_e.performance):Date.now.bind(Date),Qn=_e.requestAnimationFrame||_e.mozRequestAnimationFrame||_e.webkitRequestAnimationFrame||_e.msRequestAnimationFrame,gn=_e.cancelAnimationFrame||_e.mozCancelAnimationFrame||_e.webkitCancelAnimationFrame||_e.msCancelAnimationFrame,di={now:Er,frame:function(t){var o=Qn(t);return{cancel:function(){return gn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=_e.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return xt||(xt=_e.document.createElement("a")),xt.href=t,xt.href},hardwareConcurrency:_e.navigator&&_e.navigator.hardwareConcurrency||4,get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(ht==null&&(ht=_e.matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)}},Hn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ai={supported:!1,testSupport:function(t){!vi&&Gt&&(Xn?mi(t):Ft=t)}},vi=!1,Xn=!1;function mi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Gt),t.isContextLost())return;ai.supported=!0}catch(u){}t.deleteTexture(o),vi=!0}_e.document&&((Gt=_e.document.createElement("img")).onload=function(){Ft&&mi(Ft),Ft=null,Xn=!0},Gt.onerror=function(){vi=!0,Ft=null},Gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var fa="01",Wi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Li(t){return t.indexOf("mapbox:")===0}Wi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",fa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Wi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Wi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Wi.prototype.normalizeStyleURL=function(t,o){if(!Li(t))return t;var u=Ia(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Wi.prototype.normalizeGlyphsURL=function(t,o){if(!Li(t))return t;var u=Ia(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Wi.prototype.normalizeSourceURL=function(t,o){if(!Li(t))return t;var u=Ia(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Wi.prototype.normalizeSpriteURL=function(t,o,u,h){var g=Ia(t);return Li(t)?(g.path="/styles/v1"+g.path+"/sprite"+o+u,this._makeAPIURL(g,this._customAccessToken||h)):(g.path+=""+o+u,_a(g))},Wi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Li(t))return t;var u=Ia(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(di.devicePixelRatio>=2||o===512?"@2x":"")+(ai.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(g){for(var b=0,S=g;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||Hn.ACCESS_TOKEN;return Hn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Wi.prototype.canonicalizeTileURL=function(t,o){var u=Ia(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var g=u.params;return o&&(g=g.filter(function(b){return!b.match(/^access_token=/)})),g.length&&(h+="?"+g.join("&")),h},Wi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Li(o),h=[],g=0,b=t.tiles||[];g<b.length;g+=1){var S=b[g];pa(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Wi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Ia(Hn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Hn.REQUIRE_ACCESS_TOKEN)return _a(t);if(!(o=o||Hn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),_a(t)};var Qi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function pa(t){return Qi.test(t)}var Lo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ia(t){var o=t.match(Lo);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function _a(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Ni(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var aa=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};aa.prototype.getStorageKey=function(t){var o,u=Ni(Hn.ACCESS_TOKEN);return o=u&&u.u?_e.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,g){return String.fromCharCode(Number("0x"+g))})):Hn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},aa.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=_e.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var g=_e.localStorage.getItem(u);g&&(this.anonId=g)}catch(b){Qe("Unable to read from LocalStorage")}},aa.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{_e.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){Qe("Unable to write to LocalStorage")}},aa.prototype.processRequests=function(t){},aa.prototype.postEvent=function(t,o,u,h){var g=this;if(Hn.EVENTS_URL){var b=Ia(Hn.EVENTS_URL);b.params.push("access_token="+(h||Hn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:fa,userId:this.anonId},I=o?kt(S,o):S,D={url:_a(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=xa(D,function(N){g.pendingRequest=null,u(N),g.saveEventData(),g.processRequests(h)})}},aa.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Ji,Ss,he=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,g,b){this.skuToken=g,(Hn.EVENTS_URL&&b||Hn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Li(S)||pa(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),b=g.id,S=g.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=ct()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(h.success[b]=!0)},u))}},o}(aa),oi=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Hn.EVENTS_URL&&Hn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(g){return Li(g)||pa(g)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Ni(Hn.ACCESS_TOKEN),b=g?g.u:Hn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=ct(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),N=new Date(I),Z=(I-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||D.getDate()!==N.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(j){j||(h.eventData.lastSuccess=I,h.eventData.tokenU=b)},u)}},o}(aa)),xo=oi.postTurnstileEvent.bind(oi),Js=new he,Nt=Js.postMapLoadEvent.bind(Js),$t=500,Ir=50;function nn(){_e.caches&&!Ji&&(Ji=_e.caches.open("mapbox-tiles"))}function wn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var zn,xi=1/0;function fi(){return zn==null&&(zn=_e.OffscreenCanvas&&new _e.OffscreenCanvas(1,1).getContext("2d")&&typeof _e.createImageBitmap=="function"),zn}var En={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(En);var Ii=function(t){function o(u,h,g){h===401&&pa(g)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=g,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Pi=Gr()?function(){return self.worker&&self.worker.referrer}:function(){return(_e.location.protocol==="blob:"?_e.parent:_e).location.href},to,fs,Go=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Pi())&&!/^\w+:/.test(u))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(h,g){var b,S=new _e.AbortController,I=new _e.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Pi(),signal:S.signal}),D=!1,N=!1,Z=(b=I.url).indexOf("sku=")>0&&pa(b);h.type==="json"&&I.headers.set("Accept","application/json");var j=function(re,Te,O){if(!N){if(re&&re.message!=="SecurityError"&&Qe(re),Te&&O)return $(Te);var He=Date.now();_e.fetch(I).then(function(Ne){if(Ne.ok){var rt=Z?Ne.clone():null;return $(Ne,rt,He)}return g(new Ii(Ne.statusText,Ne.status,h.url))}).catch(function(Ne){Ne.code!==20&&g(new Error(Ne.message))})}},$=function(re,Te,O){(h.type==="arrayBuffer"?re.arrayBuffer():h.type==="json"?re.json():re.text()).then(function(He){N||(Te&&O&&function(Ne,rt,mt){if(nn(),Ji){var Bt={status:rt.status,statusText:rt.statusText,headers:new _e.Headers};rt.headers.forEach(function(nr,yr){return Bt.headers.set(yr,nr)});var Zt=Qr(rt.headers.get("Cache-Control")||"");Zt["no-store"]||(Zt["max-age"]&&Bt.headers.set("Expires",new Date(mt+1e3*Zt["max-age"]).toUTCString()),new Date(Bt.headers.get("Expires")).getTime()-mt<42e4||function(nr,yr){if(Ss===void 0)try{new Response(new ReadableStream),Ss=!0}catch(Vr){Ss=!1}Ss?yr(nr.body):nr.blob().then(yr)}(rt,function(nr){var yr=new _e.Response(nr,Bt);nn(),Ji&&Ji.then(function(Vr){return Vr.put(wn(Ne.url),yr)}).catch(function(Vr){return Qe(Vr.message)})}))}}(I,Te,O),D=!0,g(null,He,re.headers.get("Cache-Control"),re.headers.get("Expires")))}).catch(function(He){N||g(new Error(He.message))})};return Z?function(re,Te){if(nn(),!Ji)return Te(null);var O=wn(re.url);Ji.then(function(He){He.match(O).then(function(Ne){var rt=function(mt){if(!mt)return!1;var Bt=new Date(mt.headers.get("Expires")||0),Zt=Qr(mt.headers.get("Cache-Control")||"");return Bt>Date.now()&&!Zt["no-cache"]}(Ne);He.delete(O),rt&&He.put(O,Ne.clone()),Te(null,Ne,rt)}).catch(Te)}).catch(Te)}(I,j):j(null,null),{cancel:function(){N=!0,D||S.abort()}}}(t,o);if(Gr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,g){var b=new _e.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){g(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(h.type==="json")try{I=JSON.parse(b.response)}catch(D){return g(D)}g(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else g(new Ii(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},Da=function(t,o){return Go(kt(t,{type:"arrayBuffer"}),o)},xa=function(t,o){return Go(kt(t,{method:"POST"}),o)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";to=[],fs=0;var q=function(t,o){if(ai.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),fs>=Hn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return to.push(u),u}fs++;var h=!1,g=function(){if(!h)for(h=!0,fs--;to.length&&fs<Hn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=to.shift();S.cancelled||(S.cancel=q(S.requestParameters,S.callback).cancel)}},b=Da(t,function(S,I,D,N){g(),S?o(S):I&&(fi()?function(Z,j){var $=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});_e.createImageBitmap($).then(function(re){j(null,re)}).catch(function(re){j(new Error("Could not load image because of "+re.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(Z,j,$,re){var Te=new _e.Image,O=_e.URL;Te.onload=function(){j(null,Te),O.revokeObjectURL(Te.src),Te.onload=null,_e.requestAnimationFrame(function(){Te.src=G})},Te.onerror=function(){return j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var He=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});Te.cacheControl=$,Te.expires=re,Te.src=Z.byteLength?O.createObjectURL(He):G}(I,o,D,N))});return{cancel:function(){b.cancel(),g()}}};function te(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function de(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Me=function(t,o){o===void 0&&(o={}),kt(this,o),this.type=t},Ve=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",kt({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Me),$e=function(){};$e.prototype.on=function(t,o){return this._listeners=this._listeners||{},te(t,o,this._listeners),this},$e.prototype.off=function(t,o){return de(t,o,this._listeners),de(t,o,this._oneTimeListeners),this},$e.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},te(t,o,this._oneTimeListeners),this},$e.prototype.fire=function(t,o){typeof t=="string"&&(t=new Me(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,g=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<g.length;h+=1)g[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];de(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(kt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof Ve&&console.error(t.error);return this},$e.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},$e.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Re=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function lt(t){var o=t.value;return o?[new Re(t.key,o,"constants have been deprecated as of v8")]:[]}function cr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,g=o;h<g.length;h+=1){var b=g[h];for(var S in b)t[S]=b[S]}return t}function Rt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Lt(t){if(Array.isArray(t))return t.map(Lt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Lt(t[u]);return o}return Rt(t)}var pr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),_n=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var g=h[u];this.bindings[g[0]]=g[1]}};_n.prototype.concat=function(t){return new _n(this,t)},_n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},_n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var un={kind:"null"},Ct={kind:"number"},Kr={kind:"string"},Dr={kind:"boolean"},Hr={kind:"color"},pi={kind:"object"},$r={kind:"value"},yn={kind:"collator"},Zi={kind:"formatted"},li={kind:"resolvedImage"};function Ci(t,o){return{kind:"array",itemType:t,N:o}}function gi(t){if(t.kind==="array"){var o=gi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ft=[un,Ct,Kr,Dr,Hr,Zi,pi,Ci($r),li];function Mt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Mt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=ft;u<h.length;u+=1)if(!Mt(h[u],o))return null}}return"Expected "+gi(t)+" but found "+gi(o)+" instead."}function wa(t,o){return o.some(function(u){return u.kind===t.kind})}function Ei(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ai=Oe(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(I){return(I=Math.round(I))<0?0:I>255?255:I}function g(I){return h(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function S(I,D,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?I+(D-I)*N*6:2*N<1?D:3*N<2?I+(D-I)*(2/3-N)*6:I}try{o.parseCSSColor=function(I){var D,N=I.replace(/ /g,"").toLowerCase();if(N in u)return u[N].slice();if(N[0]==="#")return N.length===4?(D=parseInt(N.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:N.length===7&&(D=parseInt(N.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var Z=N.indexOf("("),j=N.indexOf(")");if(Z!==-1&&j+1===N.length){var $=N.substr(0,Z),re=N.substr(Z+1,j-(Z+1)).split(","),Te=1;switch($){case"rgba":if(re.length!==4)return null;Te=b(re.pop());case"rgb":return re.length!==3?null:[g(re[0]),g(re[1]),g(re[2]),Te];case"hsla":if(re.length!==4)return null;Te=b(re.pop());case"hsl":if(re.length!==3)return null;var O=(parseFloat(re[0])%360+360)%360/360,He=b(re[1]),Ne=b(re[2]),rt=Ne<=.5?Ne*(He+1):Ne+He-Ne*He,mt=2*Ne-rt;return[h(255*S(mt,rt,O+1/3)),h(255*S(mt,rt,O)),h(255*S(mt,rt,O-1/3)),Te];default:return null}}return null}}catch(I){}}).parseCSSColor,Di=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Di.parse=function(t){if(t){if(t instanceof Di)return t;if(typeof t=="string"){var o=Ai(t);if(o)return new Di(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Di.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Di.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1);var Rr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Rr.prototype.compare=function(t,o){return this.collator.compare(t,o)},Rr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var cn=function(t,o,u,h,g){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=g},_t=function(t){this.sections=t};_t.fromString=function(t){return new _t([new cn(t,null,null,null,null)])},_t.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},_t.factory=function(t){return t instanceof _t?t:_t.fromString(t)},_t.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},_t.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var g={};h.fontStack&&(g["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(g["font-scale"]=h.scale),h.textColor&&(g["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(g)}}return t};var ea=function(t){this.name=t.name,this.available=t.available};function le(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Di||t instanceof Rr||t instanceof _t||t instanceof ea)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!Ko(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Ko(t[h]))return!1;return!0}return!1}function Ki(t){if(t===null)return un;if(typeof t=="string")return Kr;if(typeof t=="boolean")return Dr;if(typeof t=="number")return Ct;if(t instanceof Di)return Hr;if(t instanceof Rr)return yn;if(t instanceof _t)return Zi;if(t instanceof ea)return li;if(Array.isArray(t)){for(var o,u=t.length,h=0,g=t;h<g.length;h+=1){var b=Ki(g[h]);if(o){if(o===b)continue;o=$r;break}o=b}return Ci(o||$r,u)}return pi}function fu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Di||t instanceof _t||t instanceof ea?t.toString():JSON.stringify(t)}ea.prototype.toString=function(){return this.name},ea.fromString=function(t){return t?new ea({name:t,available:!1}):null},ea.prototype.serialize=function(){return["image",this.name]};var Fa=function(t,o){this.type=t,this.value=o};Fa.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return o.error("invalid value");var u=t[1],h=Ki(u),g=o.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Fa(h,u)},Fa.prototype.evaluate=function(){return this.value},Fa.prototype.eachChild=function(){},Fa.prototype.outputDefined=function(){return!0},Fa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Di?["rgba"].concat(this.value.toArray()):this.value instanceof _t?this.value.serialize():this.value};var Ta=function(t){this.name="ExpressionEvaluationError",this.message=t};Ta.prototype.toJSON=function(){return this.message};var Ha={string:Kr,number:Ct,boolean:Dr,object:pi},ta=function(t,o){this.type=t,this.args=o};ta.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,g=t[0];if(g==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in Ha)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ha[I],h++}else b=$r;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Ci(b,S)}else u=Ha[g];for(var D=[];h<t.length;h++){var N=o.parse(t[h],h,$r);if(!N)return null;D.push(N)}return new ta(u,D)},ta.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Mt(this.type,Ki(u)))return u;if(o===this.args.length-1)throw new Ta("Expected value to be of type "+gi(this.type)+", but found "+gi(Ki(u))+" instead.")}return null},ta.prototype.eachChild=function(t){this.args.forEach(t)},ta.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ta.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(g){return g.serialize()}))};var wo=function(t){this.type=Zi,this.sections=t};wo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],g=!1,b=1;b<=t.length-1;++b){var S=t[b];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,Ct)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Ci(Kr))))return null;var N=null;if(S["text-color"]&&!(N=o.parse(S["text-color"],1,Hr)))return null;var Z=h[h.length-1];Z.scale=I,Z.font=D,Z.textColor=N}else{var j=o.parse(t[b],1,$r);if(!j)return null;var $=j.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:j,scale:null,font:null,textColor:null})}}return new wo(h)},wo.prototype.evaluate=function(t){return new _t(this.sections.map(function(o){var u=o.content.evaluate(t);return Ki(u)===li?new cn("",u,null,null,null):new cn(fu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},wo.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},wo.prototype.outputDefined=function(){return!1},wo.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var g={};h.scale&&(g["font-scale"]=h.scale.serialize()),h.font&&(g["text-font"]=h.font.serialize()),h.textColor&&(g["text-color"]=h.textColor.serialize()),t.push(g)}return t};var Ho=function(t){this.type=li,this.input=t};Ho.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Kr);return u?new Ho(u):o.error("No image name provided.")},Ho.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=ea.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Ho.prototype.eachChild=function(t){t(this.input)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){return["image",this.input.serialize()]};var Eu={"to-boolean":Dr,"to-color":Hr,"to-number":Ct,"to-string":Kr},ho=function(t,o){this.type=t,this.args=o};ho.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=Eu[u],g=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,$r);if(!S)return null;g.push(S)}return new ho(h,g)},ho.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,g=this.args;h<g.length;h+=1){if(u=null,(o=g[h].evaluate(t))instanceof Di)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":le(o[0],o[1],o[2],o[3])))return new Di(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ta(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,D=this.args;I<D.length;I+=1){if((S=D[I].evaluate(t))===null)return 0;var N=Number(S);if(!isNaN(N))return N}throw new Ta("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?_t.fromString(fu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ea.fromString(fu(this.args[0].evaluate(t))):fu(this.args[0].evaluate(t))},ho.prototype.eachChild=function(t){this.args.forEach(t)},ho.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ho.prototype.serialize=function(){if(this.type.kind==="formatted")return new wo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ho(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Do=["Unknown","Point","LineString","Polygon"],ra=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ra.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ra.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null},ra.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ra.prototype.canonicalID=function(){return this.canonical},ra.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ra.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Di.parse(t)),o};var Wa=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};Wa.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Wa.prototype.eachChild=function(t){this.args.forEach(t)},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Wa.parse=function(t,o){var u,h=t[0],g=Wa.definitions[h];if(!g)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,I=S.filter(function(Zn){var ln=Zn[0];return!Array.isArray(ln)||ln.length===t.length-1}),D=null,N=0,Z=I;N<Z.length;N+=1){var j=Z[N],$=j[0],re=j[1];D=new Rs(o.registry,o.path,null,o.scope);for(var Te=[],O=!1,He=1;He<t.length;He++){var Ne=t[He],rt=Array.isArray($)?$[He-1]:$.type,mt=D.parse(Ne,1+Te.length,rt);if(!mt){O=!0;break}Te.push(mt)}if(!O)if(Array.isArray($)&&$.length!==Te.length)D.error("Expected "+$.length+" arguments, but found "+Te.length+" instead.");else{for(var Bt=0;Bt<Te.length;Bt++){var Zt=Array.isArray($)?$[Bt]:$.type,nr=Te[Bt];D.concat(Bt+1).checkSubtype(Zt,nr.type)}if(D.errors.length===0)return new Wa(h,b,re,Te)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var yr=(I.length?I:S).map(function(Zn){var ln;return ln=Zn[0],Array.isArray(ln)?"("+ln.map(gi).join(", ")+")":"("+gi(ln.type)+"...)"}).join(" | "),Vr=[],Dn=1;Dn<t.length;Dn++){var sn=o.parse(t[Dn],1+Vr.length);if(!sn)return null;Vr.push(gi(sn.type))}o.error("Expected arguments of type "+yr+", but found ("+Vr.join(", ")+") instead.")}return null},Wa.register=function(t,o){for(var u in Wa.definitions=o,o)t[u]=Wa};var Fo=function(t,o,u){this.type=yn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Xa(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Cs(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Tl(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(u*g*8192),Math.round(h*g*8192)]}function ps(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function J(t,o){for(var u,h,g,b,S,I,D,N=!1,Z=0,j=o.length;Z<j;Z++)for(var $=o[Z],re=0,Te=$.length;re<Te-1;re++){if((b=(u=t)[0]-(h=$[re])[0])*(D=u[1]-(g=$[re+1])[1])-(I=u[0]-g[0])*(S=u[1]-h[1])==0&&b*I<=0&&S*D<=0)return!1;ps(t,$[re],$[re+1])&&(N=!N)}return N}function ge(t,o){for(var u=0;u<o.length;u++)if(J(t,o[u]))return!0;return!1}function We(t,o,u,h){var g=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-g*(t[1]-u[1]),I=(o[0]-u[0])*b-g*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Tt(t,o,u){for(var h=0,g=u;h<g.length;h+=1)for(var b=g[h],S=0;S<b.length-1;++S)if((j=[(Z=b[S+1])[0]-(N=b[S])[0],Z[1]-N[1]])[0]*($=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-j[1]*$[0]!=0&&We(I,D,N,Z)&&We(N,Z,I,D))return!0;var I,D,N,Z,j,$;return!1}function Mr(t,o){for(var u=0;u<t.length;++u)if(!J(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(Tt(t[h],t[h+1],o))return!1;return!0}function Mn(t,o){for(var u=0;u<o.length;u++)if(Mr(t,o[u]))return!0;return!1}function wi(t,o,u){for(var h=[],g=0;g<t.length;g++){for(var b=[],S=0;S<t[g].length;S++){var I=Tl(t[g][S],u);Xa(o,I),b.push(I)}h.push(b)}return h}function ro(t,o,u){for(var h=[],g=0;g<t.length;g++){var b=wi(t[g],o,u);h.push(b)}return h}function Oa(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var g=.5*h,b=t[0]-u[0]>g?-h:u[0]-t[0]>g?h:0;b===0&&(b=t[0]-u[2]>g?-h:u[2]-t[0]>g?h:0),t[0]+=b}Xa(o,t)}function Ba(t,o,u,h){for(var g=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],I=0,D=t;I<D.length;I+=1)for(var N=0,Z=D[I];N<Z.length;N+=1){var j=Z[N],$=[j.x+b[0],j.y+b[1]];Oa($,o,u,g),S.push($)}return S}function Wo(t,o,u,h){for(var g,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],I=[],D=0,N=t;D<N.length;D+=1){for(var Z=[],j=0,$=N[D];j<$.length;j+=1){var re=$[j],Te=[re.x+S[0],re.y+S[1]];Xa(o,Te),Z.push(Te)}I.push(Z)}if(o[2]-o[0]<=b/2){(g=o)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var O=0,He=I;O<He.length;O+=1)for(var Ne=0,rt=He[O];Ne<rt.length;Ne+=1)Oa(rt[Ne],o,u,b)}return I}Fo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Dr);if(!h)return null;var g=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Dr);if(!g)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,Kr))?null:new Fo(h,g,b)},Fo.prototype.evaluate=function(t){return new Rr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Fo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var hs=function(t,o){this.type=Dr,this.geojson=t,this.geometries=o};function uo(t){if(t instanceof Wa&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof hs)return!1;var o=!0;return t.eachChild(function(u){o&&!uo(u)&&(o=!1)}),o}function To(t){if(t instanceof Wa&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!To(u)&&(o=!1)}),o}function ds(t,o){if(t instanceof Wa&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!ds(h,o)&&(u=!1)}),u}hs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var g=u.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new hs(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new hs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new hs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},hs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=wi(u.coordinates,g,b),I=Ba(o.geometry(),h,g,b);if(!Cs(h,g))return!1;for(var D=0,N=I;D<N.length;D+=1)if(!J(N[D],S))return!1}if(u.type==="MultiPolygon"){var Z=ro(u.coordinates,g,b),j=Ba(o.geometry(),h,g,b);if(!Cs(h,g))return!1;for(var $=0,re=j;$<re.length;$+=1)if(!ge(re[$],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=wi(u.coordinates,g,b),I=Wo(o.geometry(),h,g,b);if(!Cs(h,g))return!1;for(var D=0,N=I;D<N.length;D+=1)if(!Mr(N[D],S))return!1}if(u.type==="MultiPolygon"){var Z=ro(u.coordinates,g,b),j=Wo(o.geometry(),h,g,b);if(!Cs(h,g))return!1;for(var $=0,re=j;$<re.length;$+=1)if(!Mn(re[$],Z))return!1}return!0}(t,this.geometries)}return!1},hs.prototype.eachChild=function(){},hs.prototype.outputDefined=function(){return!0},hs.prototype.serialize=function(){return["within",this.geojson]};var As=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};As.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new As(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},As.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},As.prototype.eachChild=function(){},As.prototype.outputDefined=function(){return!1},As.prototype.serialize=function(){return["var",this.name]};var Rs=function(t,o,u,h,g){o===void 0&&(o=[]),h===void 0&&(h=new _n),g===void 0&&(g=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=g,this.expectedType=u};function eu(t,o){for(var u,h=t.length-1,g=0,b=h,S=0;g<=b;)if((u=t[S=Math.floor((g+b)/2)])<=o){if(S===h||o<t[S+1])return S;g=S+1}else{if(!(u>o))throw new Ta("Input is not a number.");b=S-1}return 0}Rs.prototype.parse=function(t,o,u,h,g){return g===void 0&&(g={}),o?this.concat(o,u,h)._parse(t,g):this._parse(t,g)},Rs.prototype._parse=function(t,o){function u(N,Z,j){return j==="assert"?new ta(Z,[N]):j==="coerce"?new ho(Z,[N]):N}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[h];if(g){var b=g.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof Fa)&&b.type.kind!=="resolvedImage"&&function N(Z){if(Z instanceof As)return N(Z.boundExpression);if(Z instanceof Wa&&Z.name==="error"||Z instanceof Fo||Z instanceof hs)return!1;var j=Z instanceof ho||Z instanceof ta,$=!0;return Z.eachChild(function(re){$=j?$&&N(re):$&&re instanceof Fa}),!!$&&uo(Z)&&ds(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new ra;try{b=new Fa(b.type,b.evaluate(D))}catch(N){return this.error(N.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Rs.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,g=u?this.scope.concat(u):this.scope;return new Rs(this.registry,h,o||null,g,this.errors)},Rs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(g){return"["+g+"]"}).join("");this.errors.push(new pr(h,t))},Rs.prototype.checkSubtype=function(t,o){var u=Mt(t,o);return u&&this.error(u),u};var vs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,g=u;h<g.length;h+=1){var b=g[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ha(t,o,u){return t*(1-u)+o*u}vs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Ct);if(!u)return null;var h=[],g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],D=b,N=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var Z=o.parse(I,N,g);if(!Z)return null;g=g||Z.type,h.push([S,Z])}return new vs(g,u,h)},vs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var g=o.length;return h>=o[g-1]?u[g-1].evaluate(t):u[eu(o,h)].evaluate(t)},vs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},vs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},vs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var ya=Object.freeze({__proto__:null,number:ha,color:function(t,o,u){return new Di(ha(t.r,o.r,u),ha(t.g,o.g,u),ha(t.b,o.b,u),ha(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,g){return ha(h,o[g],u)})}}),rs=6/29*3*(6/29),nf=Math.PI/180,Ml=180/Math.PI;function Zs(t){return t>.008856451679035631?Math.pow(t,1/3):t/rs+4/29}function ec(t){return t>6/29?t*t*t:rs*(t-4/29)}function Hu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function js(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ul(t){var o=js(t.r),u=js(t.g),h=js(t.b),g=Zs((.4124564*o+.3575761*u+.1804375*h)/.95047),b=Zs((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(g-b),b:200*(b-Zs((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*ec(o),u=.95047*ec(u),h=1.08883*ec(h),new Di(Hu(3.2404542*u-1.5371385*o-.4985314*h),Hu(-.969266*u+1.8760108*o+.041556*h),Hu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function M(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var B={forward:ul,reverse:_,interpolate:function(t,o,u){return{l:ha(t.l,o.l,u),a:ha(t.a,o.a,u),b:ha(t.b,o.b,u),alpha:ha(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=ul(t),u=o.l,h=o.a,g=o.b,b=Math.atan2(g,h)*Ml;return{h:b<0?b+360:b,c:Math.sqrt(h*h+g*g),l:u,alpha:t.a}},reverse:function(t){var o=t.h*nf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ha(t.c,o.c,u),l:ha(t.l,o.l,u),alpha:ha(t.alpha,o.alpha,u)}}},X=Object.freeze({__proto__:null,lab:B,hcl:R}),me=function(t,o,u,h,g){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=g;b<S.length;b+=1){var I=S[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function Ge(t,o,u,h){var g=h-u,b=t-u;return g===0?0:o===1?b/g:(Math.pow(o,b)-1)/(Math.pow(o,g)-1)}me.interpolationFactor=function(t,o,u,h){var g=0;if(t.name==="exponential")g=Ge(o,t.base,u,h);else if(t.name==="linear")g=Ge(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;g=new W(b[0],b[1],b[2],b[3]).solve(Ge(o,1,u,h))}return g},me.parse=function(t,o){var u=t[0],h=t[1],g=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var I=h.slice(1);if(I.length!==4||I.some(function(He){return typeof He!="number"||He<0||He>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(g=o.parse(g,2,Ct)))return null;var D=[],N=null;u==="interpolate-hcl"||u==="interpolate-lab"?N=Hr:o.expectedType&&o.expectedType.kind!=="value"&&(N=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var j=b[Z],$=b[Z+1],re=Z+3,Te=Z+4;if(typeof j!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(D.length&&D[D.length-1][0]>=j)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);var O=o.parse($,Te,N);if(!O)return null;N=N||O.type,D.push([j,O])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new me(N,u,h,g,D):o.error("Type "+gi(N)+" is not interpolatable.")},me.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var g=o.length;if(h>=o[g-1])return u[g-1].evaluate(t);var b=eu(o,h),S=me.interpolationFactor(this.interpolation,h,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?ya[this.type.kind.toLowerCase()](I,D,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(I),R.forward(D),S)):B.reverse(B.interpolate(B.forward(I),B.forward(D),S))},me.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},me.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},me.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ot=function(t,o){this.type=t,this.args=o};ot.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var g=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+g.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,g.push(I)}var D=h&&g.some(function(N){return Mt(h,N.type)});return new ot(D?$r:u,g)},ot.prototype.evaluate=function(t){for(var o,u=null,h=0,g=0,b=this.args;g<b.length&&(h++,(u=b[g].evaluate(t))&&u instanceof ea&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);g+=1);return u},ot.prototype.eachChild=function(t){this.args.forEach(t)},ot.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ot.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var st=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};st.prototype.evaluate=function(t){return this.result.evaluate(t)},st.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},st.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var g=t[h];if(typeof g!="string")return o.error("Expected string, but found "+typeof g+" instead.",h);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([g,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new st(u,S):null},st.prototype.outputDefined=function(){return this.result.outputDefined()},st.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var tr=function(t,o,u){this.type=t,this.index=o,this.input=u};tr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Ct),h=o.parse(t[2],2,Ci(o.expectedType||$r));return u&&h?new tr(h.type.itemType,u,h):null},tr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ta("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ta("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ta("Array index must be an integer, but found "+o+" instead.");return u[o]},tr.prototype.eachChild=function(t){t(this.index),t(this.input)},tr.prototype.outputDefined=function(){return!1},tr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ar=function(t,o){this.type=Dr,this.needle=t,this.haystack=o};ar.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,$r),h=o.parse(t[2],2,$r);return u&&h?wa(u.type,[Dr,Kr,Ct,un,$r])?new ar(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(u.type)+" instead"):null},ar.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ei(o,["boolean","string","number","null"]))throw new Ta("Expected first argument to be of type boolean, string, number or null, but found "+gi(Ki(o))+" instead.");if(!Ei(u,["string","array"]))throw new Ta("Expected second argument to be of type array or string, but found "+gi(Ki(u))+" instead.");return u.indexOf(o)>=0},ar.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ar.prototype.outputDefined=function(){return!0},ar.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Tn=function(t,o,u){this.type=Ct,this.needle=t,this.haystack=o,this.fromIndex=u};Tn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,$r),h=o.parse(t[2],2,$r);if(!u||!h)return null;if(!wa(u.type,[Dr,Kr,Ct,un,$r]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,Ct);return g?new Tn(u,h,g):null}return new Tn(u,h)},Tn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ei(o,["boolean","string","number","null"]))throw new Ta("Expected first argument to be of type boolean, string, number or null, but found "+gi(Ki(o))+" instead.");if(!Ei(u,["string","array"]))throw new Ta("Expected second argument to be of type array or string, but found "+gi(Ki(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Tn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ti=function(t,o,u,h,g,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=g,this.otherwise=b};ti.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var g={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],D=t[S+1];Array.isArray(I)||(I=[I]);var N=o.concat(S);if(I.length===0)return N.error("Expected at least one branch label.");for(var Z=0,j=I;Z<j.length;Z+=1){var $=j[Z];if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,Ki($)))return null}else u=Ki($);if(g[String($)]!==void 0)return N.error("Branch labels must be unique.");g[String($)]=b.length}var re=o.parse(D,S,h);if(!re)return null;h=h||re.type,b.push(re)}var Te=o.parse(t[1],1,$r);if(!Te)return null;var O=o.parse(t[t.length-1],t.length-1,h);return O?Te.type.kind!=="value"&&o.concat(1).checkSubtype(u,Te.type)?null:new ti(u,h,Te,g,b,O):null},ti.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(Ki(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ti.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ti.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ti.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},g=0,b=Object.keys(this.cases).sort();g<b.length;g+=1){var S=b[g];(j=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[j][1].push(S)}for(var I=function(re){return t.inputType.kind==="number"?Number(re):re},D=0,N=u;D<N.length;D+=1){var Z=N[D],j=Z[0],$=Z[1];o.push($.length===1?I($[0]):$.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Rn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Rn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],g=1;g<t.length-1;g+=2){var b=o.parse(t[g],g,Dr);if(!b)return null;var S=o.parse(t[g+1],g+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new Rn(u,h,I):null},Rn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],g=h[1];if(h[0].evaluate(t))return g.evaluate(t)}return this.otherwise.evaluate(t)},Rn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],g=h[1];t(h[0]),t(g)}t(this.otherwise)},Rn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Rn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var ji=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function ua(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ea(t,o,u,h){return h.compare(o,u)===0}function zi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function g(b,S,I){this.type=Dr,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return g.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],D=S.parse(b[1],1,$r);if(!D)return null;if(!ua(I,D.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+gi(D.type)+"'.");var N=S.parse(b[2],2,$r);if(!N)return null;if(!ua(I,N.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+gi(N.type)+"'.");if(D.type.kind!==N.type.kind&&D.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot compare types '"+gi(D.type)+"' and '"+gi(N.type)+"'.");h&&(D.type.kind==="value"&&N.type.kind!=="value"?D=new ta(N.type,[D]):D.type.kind!=="value"&&N.type.kind==="value"&&(N=new ta(D.type,[N])));var Z=null;if(b.length===4){if(D.type.kind!=="string"&&N.type.kind!=="string"&&D.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,yn)))return null}return new g(D,N,Z)},g.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var D=Ki(S),N=Ki(I);if(D.kind!==N.kind||D.kind!=="string"&&D.kind!=="number")throw new Ta('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+N.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=Ki(S),j=Ki(I);if(Z.kind!=="string"||j.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},g.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},g}()}ji.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,$r),h=o.parse(t[2],2,Ct);if(!u||!h)return null;if(!wa(u.type,[Ci($r),Kr,$r]))return o.error("Expected first argument to be of type array or string, but found "+gi(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,Ct);return g?new ji(u.type,u,h,g):null}return new ji(u.type,u,h)},ji.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ei(o,["string","array"]))throw new Ta("Expected first argument to be of type array or string, but found "+gi(Ki(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},ji.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},ji.prototype.outputDefined=function(){return!1},ji.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ms=zi("==",function(t,o,u){return o===u},Ea),tu=zi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!Ea(0,o,u,h)}),Wu=zi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),af=zi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),ll=zi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Mc=zi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Su=function(t,o,u,h,g){this.type=Kr,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=g};Su.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Ct);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var g=null;if(h.locale&&!(g=o.parse(h.locale,1,Kr)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,Kr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Ct)))return null;var I=null;return h["max-fraction-digits"]&&!(I=o.parse(h["max-fraction-digits"],1,Ct))?null:new Su(u,g,b,S,I)},Su.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Su.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Su.prototype.outputDefined=function(){return!1},Su.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Cu=function(t){this.type=Ct,this.input=t};Cu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+gi(u.type)+" instead."):new Cu(u):null},Cu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ta("Expected value to be of type string or array, but found "+gi(Ki(o))+" instead.")},Cu.prototype.eachChild=function(t){t(this.input)},Cu.prototype.outputDefined=function(){return!1},Cu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Au={"==":ms,"!=":tu,">":af,"<":Wu,">=":Mc,"<=":ll,array:ta,at:tr,boolean:ta,case:Rn,coalesce:ot,collator:Fo,format:wo,image:Ho,in:ar,"index-of":Tn,interpolate:me,"interpolate-hcl":me,"interpolate-lab":me,length:Cu,let:st,literal:Fa,match:ti,number:ta,"number-format":Su,object:ta,slice:ji,step:vs,string:ta,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:As,within:hs};function lo(t,o){var u=o[0],h=o[1],g=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),g=g.evaluate(t);var S=b?b.evaluate(t):1,I=le(u,h,g,S);if(I)throw new Ta(I);return new Di(u/255*S,h/255*S,g/255*S,S)}function Zf(t,o){return t in o}function jf(t,o){var u=o[t];return u===void 0?null:u}function $o(t){return{type:t}}function Pc(t){return{result:"success",value:t}}function wu(t){return{result:"error",value:t}}function ru(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function of(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Pl(t){return!!t.expression&&t.expression.interpolated}function Oi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Il(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Mp(t){return t}function cl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Ic(t,o,u,h,g){return cl(typeof u===g?h[u]:void 0,t.default,o.default)}function Vf(t,o,u){if(Oi(u)!=="number")return cl(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var g=eu(t.stops.map(function(b){return b[0]}),u);return t.stops[g][1]}function Pp(t,o,u){var h=t.base!==void 0?t.base:1;if(Oi(u)!=="number")return cl(t.default,o.default);var g=t.stops.length;if(g===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[g-1][0])return t.stops[g-1][1];var b=eu(t.stops.map(function(j){return j[0]}),u),S=function(j,$,re,Te){var O=Te-re,He=j-re;return O===0?0:$===1?He/O:(Math.pow($,He)-1)/(Math.pow($,O)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],N=ya[o.type]||Mp;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=X[t.colorSpace];N=function(j,$){return Z.reverse(Z.interpolate(Z.forward(j),Z.forward($),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var j=[],$=arguments.length;$--;)j[$]=arguments[$];var re=I.evaluate.apply(void 0,j),Te=D.evaluate.apply(void 0,j);if(re!==void 0&&Te!==void 0)return N(re,Te,S)}}:N(I,D,S)}function Gf(t,o,u){return o.type==="color"?u=Di.parse(u):o.type==="formatted"?u=_t.fromString(u.toString()):o.type==="resolvedImage"?u=ea.fromString(u.toString()):Oi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),cl(u,t.default,o.default)}Wa.register(Au,{error:[{kind:"error"},[Kr],function(t,o){throw new Ta(o[0].evaluate(t))}],typeof:[Kr,[$r],function(t,o){return gi(Ki(o[0].evaluate(t)))}],"to-rgba":[Ci(Ct,4),[Hr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Hr,[Ct,Ct,Ct],lo],rgba:[Hr,[Ct,Ct,Ct,Ct],lo],has:{type:Dr,overloads:[[[Kr],function(t,o){return Zf(o[0].evaluate(t),t.properties())}],[[Kr,pi],function(t,o){var u=o[1];return Zf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:$r,overloads:[[[Kr],function(t,o){return jf(o[0].evaluate(t),t.properties())}],[[Kr,pi],function(t,o){var u=o[1];return jf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[$r,[Kr],function(t,o){return jf(o[0].evaluate(t),t.featureState||{})}],properties:[pi,[],function(t){return t.properties()}],"geometry-type":[Kr,[],function(t){return t.geometryType()}],id:[$r,[],function(t){return t.id()}],zoom:[Ct,[],function(t){return t.globals.zoom}],"heatmap-density":[Ct,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ct,[],function(t){return t.globals.lineProgress||0}],accumulated:[$r,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Ct,$o(Ct),function(t,o){for(var u=0,h=0,g=o;h<g.length;h+=1)u+=g[h].evaluate(t);return u}],"*":[Ct,$o(Ct),function(t,o){for(var u=1,h=0,g=o;h<g.length;h+=1)u*=g[h].evaluate(t);return u}],"-":{type:Ct,overloads:[[[Ct,Ct],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Ct],function(t,o){return-o[0].evaluate(t)}]]},"/":[Ct,[Ct,Ct],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Ct,[Ct,Ct],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Ct,[],function(){return Math.LN2}],pi:[Ct,[],function(){return Math.PI}],e:[Ct,[],function(){return Math.E}],"^":[Ct,[Ct,Ct],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Ct,[Ct],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Ct,[Ct],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Ct,[Ct],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Ct,[Ct],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Ct,[Ct],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Ct,[Ct],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Ct,[Ct],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Ct,[Ct],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Ct,[Ct],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Ct,[Ct],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Ct,$o(Ct),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Ct,$o(Ct),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Ct,[Ct],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Ct,[Ct],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Ct,[Ct],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Ct,[Ct],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Dr,[Kr,$r],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Dr,[$r],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Dr,[Kr],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Dr,[Kr,$r],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],b=h.value;return typeof g==typeof b&&g<b}],"filter-id-<":[Dr,[$r],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h<g}],"filter->":[Dr,[Kr,$r],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],b=h.value;return typeof g==typeof b&&g>b}],"filter-id->":[Dr,[$r],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h>g}],"filter-<=":[Dr,[Kr,$r],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],b=h.value;return typeof g==typeof b&&g<=b}],"filter-id-<=":[Dr,[$r],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h<=g}],"filter->=":[Dr,[Kr,$r],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],b=h.value;return typeof g==typeof b&&g>=b}],"filter-id->=":[Dr,[$r],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h>=g}],"filter-has":[Dr,[$r],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Dr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Dr,[Ci(Kr)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Dr,[Ci($r)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Dr,[Kr,Ci($r)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Dr,[Kr,Ci($r)],function(t,o){var u=o[0],h=o[1];return function(g,b,S,I){for(;S<=I;){var D=S+I>>1;if(b[D]===g)return!0;b[D]>g?I=D-1:S=D+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Dr,overloads:[[[Dr,Dr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[$o(Dr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Dr,overloads:[[[Dr,Dr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[$o(Dr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Dr,[Dr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Dr,[Kr],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[Kr,[Kr],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[Kr,[Kr],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[Kr,$o($r),function(t,o){return o.map(function(u){return fu(u.evaluate(t))}).join("")}],"resolved-locale":[Kr,[yn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Oc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new ra,this._defaultValue=o?function(u){return u.type==="color"&&Il(u.default)?new Di(0,0,0,0):u.type==="color"?Di.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function tc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Au}function rc(t,o){var u=new Rs(Au,[],o?function(g){var b={color:Hr,string:Kr,number:Ct,enum:Kr,boolean:Dr,formatted:Zi,resolvedImage:li};return g.type==="array"?Ci(b[g.value]||$r,g.length):b[g.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Pc(new Oc(h,o)):wu(u.errors)}Oc.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,g,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Oc.prototype.evaluate=function(t,o,u,h,g,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ta("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var Ol=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!To(o.expression)};Ol.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,g,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,g,b)},Ol.prototype.evaluate=function(t,o,u,h,g,b){return this._styleExpression.evaluate(t,o,u,h,g,b)};var fl=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!To(o.expression),this.interpolationType=h};function Rl(t,o){if((t=rc(t,o)).result==="error")return t;var u=t.value.expression,h=uo(u);if(!h&&!ru(o))return wu([new pr("","data expressions not supported")]);var g=ds(u,["zoom"]);if(!g&&!of(o))return wu([new pr("","zoom expressions not supported")]);var b=function S(I){var D=null;if(I instanceof st)D=S(I.result);else if(I instanceof ot)for(var N=0,Z=I.args;N<Z.length&&!(D=S(Z[N]));N+=1);else(I instanceof vs||I instanceof me)&&I.input instanceof Wa&&I.input.name==="zoom"&&(D=I);return D instanceof pr||I.eachChild(function(j){var $=S(j);$ instanceof pr?D=$:!D&&$?D=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&$&&D!==$&&(D=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||g?b instanceof pr?wu([b]):b instanceof me&&!Pl(o)?wu([new pr("",'"interpolate" expressions cannot be used with this property')]):Pc(b?new fl(h?"camera":"composite",t.value,b.labels,b instanceof me?b.interpolation:void 0):new Ol(h?"constant":"source",t.value)):wu([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}fl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,g,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,g,b)},fl.prototype.evaluate=function(t,o,u,h,g,b){return this._styleExpression.evaluate(t,o,u,h,g,b)},fl.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?me.interpolationFactor(this.interpolationType,t,o,u):0};var Xu=function(t,o){this._parameters=t,this._specification=o,cr(this,function u(h,g){var b,S,I,D=g.type==="color",N=h.stops&&typeof h.stops[0][0]=="object",Z=N||!(N||h.property!==void 0),j=h.type||(Pl(g)?"exponential":"interval");if(D&&((h=cr({},h)).stops&&(h.stops=h.stops.map(function(sn){return[sn[0],Di.parse(sn[1])]})),h.default=Di.parse(h.default?h.default:g.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!X[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(j==="exponential")b=Pp;else if(j==="interval")b=Vf;else if(j==="categorical"){b=Ic,S=Object.create(null);for(var $=0,re=h.stops;$<re.length;$+=1){var Te=re[$];S[Te[0]]=Te[1]}I=typeof h.stops[0][0]}else{if(j!=="identity")throw new Error('Unknown function type "'+j+'"');b=Gf}if(N){for(var O={},He=[],Ne=0;Ne<h.stops.length;Ne++){var rt=h.stops[Ne],mt=rt[0].zoom;O[mt]===void 0&&(O[mt]={zoom:mt,type:h.type,property:h.property,default:h.default,stops:[]},He.push(mt)),O[mt].stops.push([rt[0].value,rt[1]])}for(var Bt=[],Zt=0,nr=He;Zt<nr.length;Zt+=1){var yr=nr[Zt];Bt.push([O[yr].zoom,u(O[yr],g)])}var Vr={name:"linear"};return{kind:"composite",interpolationType:Vr,interpolationFactor:me.interpolationFactor.bind(void 0,Vr),zoomStops:Bt.map(function(sn){return sn[0]}),evaluate:function(sn,Zn){var ln=sn.zoom;return Pp({stops:Bt,base:h.base},g,ln).evaluate(ln,Zn)}}}if(Z){var Dn=j==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:me.interpolationFactor.bind(void 0,Dn),zoomStops:h.stops.map(function(sn){return sn[0]}),evaluate:function(sn){return b(h,g,sn.zoom,S,I)}}}return{kind:"source",evaluate:function(sn,Zn){var ln=Zn&&Zn.properties?Zn.properties[h.property]:void 0;return ln===void 0?cl(h.default,g.default):b(h,g,ln,S,I)}}}(this._parameters,this._specification))};function Vs(t){var o=t.key,u=t.value,h=t.valueSpec||{},g=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],D=Oi(u);if(D!=="object")return[new Re(o,u,"object expected, "+D+" found")];for(var N in u){var Z=N.split(".")[0],j=h[Z]||h["*"],$=void 0;if(g[Z])$=g[Z];else if(h[Z])$=Vi;else if(g["*"])$=g["*"];else{if(!h["*"]){I.push(new Re(o,u[N],'unknown property "'+N+'"'));continue}$=Vi}I=I.concat($({key:(o&&o+".")+N,value:u[N],valueSpec:j,style:b,styleSpec:S,object:u,objectKey:N},u))}for(var re in h)g[re]||h[re].required&&h[re].default===void 0&&u[re]===void 0&&I.push(new Re(o,u,'missing required property "'+re+'"'));return I}function sf(t){var o=t.value,u=t.valueSpec,h=t.style,g=t.styleSpec,b=t.key,S=t.arrayElementValidator||Vi;if(Oi(o)!=="array")return[new Re(b,o,"array expected, "+Oi(o)+" found")];if(u.length&&o.length!==u.length)return[new Re(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Re(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};g.$version<7&&(I.function=u.function),Oi(u.value)==="object"&&(I=u.value);for(var D=[],N=0;N<o.length;N++)D=D.concat(S({array:o,arrayIndex:N,value:o[N],valueSpec:I,style:h,styleSpec:g,key:b+"["+N+"]"}));return D}function uf(t){var o=t.key,u=t.value,h=t.valueSpec,g=Oi(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new Re(o,u,"number expected, "+g+" found")]:"minimum"in h&&u<h.minimum?[new Re(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Re(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Hf(t){var o,u,h,g=t.valueSpec,b=Rt(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,D=!I,N=Oi(t.value.stops)==="array"&&Oi(t.value.stops[0])==="array"&&Oi(t.value.stops[0][0])==="object",Z=Vs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(re){if(b==="identity")return[new Re(re.key,re.value,'identity function may not have a "stops" property')];var Te=[],O=re.value;return Te=Te.concat(sf({key:re.key,value:O,valueSpec:re.valueSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:j})),Oi(O)==="array"&&O.length===0&&Te.push(new Re(re.key,O,"array must have at least one stop")),Te},default:function(re){return Vi({key:re.key,value:re.value,valueSpec:g,style:re.style,styleSpec:re.styleSpec})}}});return b==="identity"&&I&&Z.push(new Re(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new Re(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Pl(t.valueSpec)&&Z.push(new Re(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!ru(t.valueSpec)?Z.push(new Re(t.key,t.value,"property functions not supported")):I&&!of(t.valueSpec)&&Z.push(new Re(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!N||t.value.property!==void 0||Z.push(new Re(t.key,t.value,'"property" property is required')),Z;function j(re){var Te=[],O=re.value,He=re.key;if(Oi(O)!=="array")return[new Re(He,O,"array expected, "+Oi(O)+" found")];if(O.length!==2)return[new Re(He,O,"array length 2 expected, length "+O.length+" found")];if(N){if(Oi(O[0])!=="object")return[new Re(He,O,"object expected, "+Oi(O[0])+" found")];if(O[0].zoom===void 0)return[new Re(He,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Re(He,O,"object stop key must have value")];if(h&&h>Rt(O[0].zoom))return[new Re(He,O[0].zoom,"stop zoom values must appear in ascending order")];Rt(O[0].zoom)!==h&&(h=Rt(O[0].zoom),u=void 0,S={}),Te=Te.concat(Vs({key:He+"[0]",value:O[0],valueSpec:{zoom:{}},style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:uf,value:$}}))}else Te=Te.concat($({key:He+"[0]",value:O[0],valueSpec:{},style:re.style,styleSpec:re.styleSpec},O));return tc(Lt(O[1]))?Te.concat([new Re(He+"[1]",O[1],"expressions are not allowed in function stops.")]):Te.concat(Vi({key:He+"[1]",value:O[1],valueSpec:g,style:re.style,styleSpec:re.styleSpec}))}function $(re,Te){var O=Oi(re.value),He=Rt(re.value),Ne=re.value!==null?re.value:Te;if(o){if(O!==o)return[new Re(re.key,Ne,O+" stop domain type must match previous stop domain type "+o)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Re(re.key,Ne,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&b!=="categorical"){var rt="number expected, "+O+" found";return ru(g)&&b===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(re.key,Ne,rt)]}return b!=="categorical"||O!=="number"||isFinite(He)&&Math.floor(He)===He?b!=="categorical"&&O==="number"&&u!==void 0&&He<u?[new Re(re.key,Ne,"stop domain values must appear in ascending order")]:(u=He,b==="categorical"&&He in S?[new Re(re.key,Ne,"stop domain values must be unique")]:(S[He]=!0,[])):[new Re(re.key,Ne,"integer expected, found "+He)]}}function nu(t){var o=(t.expressionContext==="property"?Rl:rc)(Lt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new Re(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Re(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!To(u))return[new Re(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!To(u))return[new Re(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ds(u,["zoom","feature-state"]))return[new Re(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!uo(u))return[new Re(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nc(t){var o=t.key,u=t.value,h=t.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Rt(u))===-1&&g.push(new Re(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Rt(u))===-1&&g.push(new Re(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),g}function Rc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Rc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Xu.deserialize=function(t){return new Xu(t._parameters,t._specification)},Xu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var lf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Rc(t)||(t=cf(t));var o=rc(t,lf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,g){return o.value.evaluate(u,h,{},g)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var g=1;g<h.length;g++)if(u(h[g]))return!0;return!1}(t)}}function oh(t,o){return t<o?-1:t>o?1:0}function cf(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Ll(t[1],t[2],"=="):u==="!="?Dl(Ll(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Ll(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(cf))):u==="all"?["all"].concat(t.slice(1).map(cf)):u==="none"?["all"].concat(t.slice(1).map(cf).map(Dl)):u==="in"?ff(t[1],t.slice(2)):u==="!in"?Dl(ff(t[1],t.slice(2))):u==="has"?pf(t[1]):u==="!has"?Dl(pf(t[1])):u!=="within"||t}function Ll(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function ff(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(oh)]]:["filter-in-small",t,["literal",o]]}}function pf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Dl(t){return["!",t]}function kc(t){return Rc(Lt(t.value))?nu(cr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,g=u.key;if(Oi(h)!=="array")return[new Re(g,h,"array expected, "+Oi(h)+" found")];var b,S=u.styleSpec,I=[];if(h.length<1)return[new Re(g,h,"filter array must have at least 1 element")];switch(I=I.concat(nc({key:g+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Rt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Rt(h[1])==="$type"&&I.push(new Re(g,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&I.push(new Re(g,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Oi(h[1]))!=="string"&&I.push(new Re(g+"[1]",h[1],"string expected, "+b+" found"));for(var D=2;D<h.length;D++)b=Oi(h[D]),Rt(h[1])==="$type"?I=I.concat(nc({key:g+"["+D+"]",value:h[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new Re(g+"["+D+"]",h[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var N=1;N<h.length;N++)I=I.concat(o({key:g+"["+N+"]",value:h[N],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Oi(h[1]),h.length!==2?I.push(new Re(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new Re(g+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Oi(h[1]),h.length!==2?I.push(new Re(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new Re(g+"[1]",h[1],"object expected, "+b+" found"))}return I}(t)}function Ip(t,o){var u=t.key,h=t.style,g=t.styleSpec,b=t.value,S=t.objectKey,I=g[o+"_"+t.layerType];if(!I)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return Vi({key:u,value:b,valueSpec:g.transition,style:h,styleSpec:g});var N,Z=t.valueSpec||I[S];if(!Z)return[new Re(u,b,'unknown property "'+S+'"')];if(Oi(b)==="string"&&ru(Z)&&!Z.tokens&&(N=/^{([^}]+)}$/.exec(b)))return[new Re(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var j=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&j.push(new Re(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Il(Lt(b))&&Rt(b.type)==="identity"&&j.push(new Re(u,b,'"text-font" does not support identity functions'))),j.concat(Vi({key:t.key,value:b,valueSpec:Z,style:h,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:S}))}function Op(t){return Ip(t,"paint")}function ic(t){return Ip(t,"layout")}function Rp(t){var o=[],u=t.value,h=t.key,g=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Re(h,u,'either "type" or "ref" is required'));var S,I=Rt(u.type),D=Rt(u.ref);if(u.id)for(var N=Rt(u.id),Z=0;Z<t.arrayIndex;Z++){var j=g.layers[Z];Rt(j.id)===N&&o.push(new Re(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+j.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Te){Te in u&&o.push(new Re(h,u[Te],'"'+Te+'" is prohibited for ref layers'))}),g.layers.forEach(function(Te){Rt(Te.id)===D&&(S=Te)}),S?S.ref?o.push(new Re(h,u.ref,"ref cannot reference another ref layer")):I=Rt(S.type):o.push(new Re(h,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var $=g.sources&&g.sources[u.source],re=$&&Rt($.type);$?re==="vector"&&I==="raster"?o.push(new Re(h,u.source,'layer "'+u.id+'" requires a raster source')):re==="raster"&&I!=="raster"?o.push(new Re(h,u.source,'layer "'+u.id+'" requires a vector source')):re!=="vector"||u["source-layer"]?re==="raster-dem"&&I!=="hillshade"?o.push(new Re(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||re==="geojson"&&$.lineMetrics||o.push(new Re(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Re(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Re(h,u.source,'source "'+u.source+'" not found'))}else o.push(new Re(h,u,'missing required property "source"'));return o=o.concat(Vs({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Vi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:kc,layout:function(Te){return Vs({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(O){return ic(cr({layerType:I},O))}}})},paint:function(Te){return Vs({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(O){return Op(cr({layerType:I},O))}}})}}}))}function Fl(t){var o=t.value,u=t.key,h=Oi(o);return h!=="string"?[new Re(u,o,"string expected, "+h+" found")]:[]}var Yi={promoteId:function(t){var o=t.key,u=t.value;if(Oi(u)==="string")return Fl({key:o,value:u});var h=[];for(var g in u)h.push.apply(h,Fl({key:o+"."+g,value:u[g]}));return h}};function ac(t){var o=t.value,u=t.key,h=t.styleSpec,g=t.style;if(!o.type)return[new Re(u,o,'"type" is required')];var b,S=Rt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Vs({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Yi});case"geojson":if(b=Vs({key:u,value:o,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:Yi}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],N=D[0],Z=typeof N=="string"?[N,["accumulated"],["get",I]]:N;b.push.apply(b,nu({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,nu({key:u+"."+I+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return Vs({key:u,value:o,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return Vs({key:u,value:o,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new Re(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:h})}}function oa(t){var o=t.value,u=t.styleSpec,h=u.light,g=t.style,b=[],S=Oi(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Re("light",o,"object expected, "+S+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&h[D[1]]&&h[D[1]].transition?Vi({key:I,value:o[I],valueSpec:u.transition,style:g,styleSpec:u}):h[I]?Vi({key:I,value:o[I],valueSpec:h[I],style:g,styleSpec:u}):[new Re(I,o[I],'unknown property "'+I+'"')])}return b}var Tu={"*":function(){return[]},array:sf,boolean:function(t){var o=t.value,u=t.key,h=Oi(o);return h!=="boolean"?[new Re(u,o,"boolean expected, "+h+" found")]:[]},number:uf,color:function(t){var o=t.key,u=t.value,h=Oi(u);return h!=="string"?[new Re(o,u,"color expected, "+h+" found")]:Ai(u)===null?[new Re(o,u,'color expected, "'+u+'" found')]:[]},constants:lt,enum:nc,filter:kc,function:Hf,layer:Rp,object:Vs,source:ac,light:oa,string:Fl,formatted:function(t){return Fl(t).length===0?[]:nu(t)},resolvedImage:function(t){return Fl(t).length===0?[]:nu(t)}};function Vi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Il(Rt(o))?Hf(t):u.expression&&tc(Lt(o))?nu(t):u.type&&Tu[u.type]?Tu[u.type](t):Vs(cr({},t,{valueSpec:u.type?h[u.type]:u}))}function Ma(t){var o=t.value,u=t.key,h=Fl(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new Re(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new Re(u,o,'"glyphs" url must include a "{range}" token'))),h}function gs(t,o){o===void 0&&(o=oe);var u=[];return u=u.concat(Vi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(u=u.concat(lt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Lc(u)}function Lc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function Yu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Lc(t.apply(this,o))}}gs.source=Yu(ac),gs.light=Yu(oa),gs.layer=Yu(Rp),gs.filter=Yu(kc),gs.paintProperty=Yu(Op),gs.layoutProperty=Yu(ic);var Na=gs,oc=Na.light,Bl=Na.paintProperty,qu=Na.layoutProperty;function Dc(t,o){var u=!1;if(o&&o.length)for(var h=0,g=o;h<g.length;h+=1)t.fire(new Ve(new Error(g[h].message))),u=!0;return u}var Mu=vo;function vo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(o=g[1])+2*(u=g[2]);for(var b=0;b<this.d*this.d;b++){var S=g[3+b],I=g[3+b+1];h.push(S===I?null:g.subarray(S,I))}var D=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],D),this.bboxes=g.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var N=0;N<this.d*this.d;N++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}vo.prototype.insert=function(t,o,u,h,g){this._forEachCell(o,u,h,g,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g)},vo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vo.prototype._insertCell=function(t,o,u,h,g,b){this.cells[g].push(b)},vo.prototype.query=function(t,o,u,h,g){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!g)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,h,this._queryCell,I,{},g),I},vo.prototype._queryCell=function(t,o,u,h,g,b,S,I){var D=this.cells[g];if(D!==null)for(var N=this.keys,Z=this.bboxes,j=0;j<D.length;j++){var $=D[j];if(S[$]===void 0){var re=4*$;(I?I(Z[re+0],Z[re+1],Z[re+2],Z[re+3]):t<=Z[re+2]&&o<=Z[re+3]&&u>=Z[re+0]&&h>=Z[re+1])?(S[$]=!0,b.push(N[$])):S[$]=!1}}},vo.prototype._forEachCell=function(t,o,u,h,g,b,S,I){for(var D=this._convertToCellCoord(t),N=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),j=this._convertToCellCoord(h),$=D;$<=Z;$++)for(var re=N;re<=j;re++){var Te=this.d*re+$;if((!I||I(this._convertFromCellCoord($),this._convertFromCellCoord(re),this._convertFromCellCoord($+1),this._convertFromCellCoord(re+1)))&&g.call(this,t,o,u,h,Te,b,S,I))return}},vo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},vo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},vo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var g=new Int32Array(o+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];g[3+S]=b,g.set(I,b),b+=I.length}return g[3+t.length]=b,g.set(this.keys,b),g[3+t.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer};var Nl=_e.ImageData,sc=_e.ImageBitmap,mo={};function pn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),mo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var co in pn("Object",Object),Mu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Mu.deserialize=function(t){return new Mu(t.buffer)},pn("Grid",Mu),pn("Color",Di),pn("Error",Error),pn("ResolvedImage",ea),pn("StylePropertyFunction",Xu),pn("StyleExpression",Oc,{omit:["_evaluator"]}),pn("ZoomDependentExpression",fl),pn("ZoomConstantExpression",Ol),pn("CompoundExpression",Wa,{omit:["_evaluate"]}),Au)Au[co]._classRegistryKey||pn("Expression_"+co,Au[co]);function Ku(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Ra(t){return sc&&t instanceof sc}function Gs(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ku(t)||Ra(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Nl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],g=0,b=t;g<b.length;g+=1)h.push(Gs(b[g],o));return h}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var N in t)if(t.hasOwnProperty(N)&&!(mo[I].omit.indexOf(N)>=0)){var Z=t[N];D[N]=mo[I].shallow.indexOf(N)>=0?Z:Gs(Z,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function ws(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ku(t)||Ra(t)||ArrayBuffer.isView(t)||t instanceof Nl)return t;if(Array.isArray(t))return t.map(ws);if(typeof t=="object"){var o=t.$name||"Object",u=mo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),g=0,b=Object.keys(t);g<b.length;g+=1){var S=b[g];if(S!=="$name"){var I=t[S];h[S]=mo[o].shallow.indexOf(S)>=0?I:ws(I)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var hf=function(){this.first=!0};hf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Ur={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function uc(t){for(var o=0,u=t;o<u.length;o+=1)if(df(u[o].charCodeAt(0)))return!0;return!1}function df(t){return!(t!==746&&t!==747&&(t<4352||!(Ur["Bopomofo Extended"](t)||Ur.Bopomofo(t)||Ur["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ur["CJK Compatibility Ideographs"](t)||Ur["CJK Compatibility"](t)||Ur["CJK Radicals Supplement"](t)||Ur["CJK Strokes"](t)||!(!Ur["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Ur["CJK Unified Ideographs Extension A"](t)||Ur["CJK Unified Ideographs"](t)||Ur["Enclosed CJK Letters and Months"](t)||Ur["Hangul Compatibility Jamo"](t)||Ur["Hangul Jamo Extended-A"](t)||Ur["Hangul Jamo Extended-B"](t)||Ur["Hangul Jamo"](t)||Ur["Hangul Syllables"](t)||Ur.Hiragana(t)||Ur["Ideographic Description Characters"](t)||Ur.Kanbun(t)||Ur["Kangxi Radicals"](t)||Ur["Katakana Phonetic Extensions"](t)||Ur.Katakana(t)&&t!==12540||!(!Ur["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ur["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ur["Unified Canadian Aboriginal Syllabics"](t)||Ur["Unified Canadian Aboriginal Syllabics Extended"](t)||Ur["Vertical Forms"](t)||Ur["Yijing Hexagram Symbols"](t)||Ur["Yi Syllables"](t)||Ur["Yi Radicals"](t))))}function pl(t){return!(df(t)||function(o){return!!(Ur["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Ur["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Ur["Letterlike Symbols"](o)||Ur["Number Forms"](o)||Ur["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Ur["Control Pictures"](o)&&o!==9251||Ur["Optical Character Recognition"](o)||Ur["Enclosed Alphanumerics"](o)||Ur["Geometric Shapes"](o)||Ur["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Ur["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ur["CJK Symbols and Punctuation"](o)||Ur.Katakana(o)||Ur["Private Use Area"](o)||Ur["CJK Compatibility Forms"](o)||Ur["Small Form Variants"](o)||Ur["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Sa(t){return t>=1424&&t<=2303||Ur["Arabic Presentation Forms-A"](t)||Ur["Arabic Presentation Forms-B"](t)}function ys(t,o){return!(!o&&Sa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ur.Khmer(t))}function vf(t){for(var o=0,u=t;o<u.length;o+=1)if(Sa(u[o].charCodeAt(0)))return!0;return!1}var Pu=null,ks="unavailable",Iu=null,Wf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ks="error"),Pu&&Pu(t)};function hl(){Xf.fire(new Me("pluginStateChange",{pluginStatus:ks,pluginURL:Iu}))}var Xf=new $e,mf=function(){return ks},iu=function(){if(ks!=="deferred"||!Iu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ks="loading",hl(),Iu&&Da({url:Iu},function(t){t?Wf(t):(ks="loaded",hl())})},Ts={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ks==="loaded"||Ts.applyArabicShaping!=null},isLoading:function(){return ks==="loading"},setState:function(t){ks=t.pluginStatus,Iu=t.pluginURL},isParsed:function(){return Ts.applyArabicShaping!=null&&Ts.processBidirectionalText!=null&&Ts.processStyledBidirectionalText!=null},getPluginURL:function(){return Iu}},Si=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hf,this.transition={})};Si.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,g=o;h<g.length;h+=1)if(!ys(g[h].charCodeAt(0),u))return!1;return!0}(t,Ts.isLoaded())},Si.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Si.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Ou=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Il(u))return new Xu(u,h);if(tc(u)){var g=Rl(u,h);if(g.result==="error")throw new Error(g.value.map(function(S){return S.key+": "+S.message}).join(", "));return g.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Di.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Ou.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ou.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var au=function(t){this.property=t,this.value=new Ou(t,void 0)};au.prototype.transitioned=function(t,o){return new dl(this.property,this.value,o,kt({},t.transition,this.transition),t.now)},au.prototype.untransitioned=function(){return new dl(this.property,this.value,null,{},0)};var Xo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Xo.prototype.getValue=function(t){return qe(this._values[t].value.value)},Xo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].value=new Ou(this._values[t].property,o===null?void 0:qe(o))},Xo.prototype.getTransition=function(t){return qe(this._values[t].transition)},Xo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].transition=qe(o)||void 0},Xo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],g=this.getValue(h);g!==void 0&&(t[h]=g);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},Xo.prototype.transitioned=function(t,o){for(var u=new ns(this._properties),h=0,g=Object.keys(this._values);h<g.length;h+=1){var b=g[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Xo.prototype.untransitioned=function(){for(var t=new ns(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var dl=function(t,o,u,h,g){this.property=t,this.value=o,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};dl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,g=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),g,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,N=D*I;return 4*(I<.5?N:3*(I-D)+N-.75)}(S))}return g};var ns=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};ns.prototype.possiblyEvaluate=function(t,o,u){for(var h=new pu(this._properties),g=0,b=Object.keys(this._values);g<b.length;g+=1){var S=b[g];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},ns.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Hs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Hs.prototype.getValue=function(t){return qe(this._values[t].value)},Hs.prototype.setValue=function(t,o){this._values[t]=new Ou(this._values[t].property,o===null?void 0:qe(o))},Hs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],g=this.getValue(h);g!==void 0&&(t[h]=g)}return t},Hs.prototype.possiblyEvaluate=function(t,o,u){for(var h=new pu(this._properties),g=0,b=Object.keys(this._values);g<b.length;g+=1){var S=b[g];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var _s=function(t,o,u){this.property=t,this.value=o,this.parameters=u};_s.prototype.isConstant=function(){return this.value.kind==="constant"},_s.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},_s.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var pu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};pu.prototype.get=function(t){return this._values[t]};var In=function(t){this.specification=t};In.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},In.prototype.interpolate=function(t,o,u){var h=ya[this.specification.type];return h?h(t,o,u):t};var Cn=function(t,o){this.specification=t,this.overrides=o};Cn.prototype.possiblyEvaluate=function(t,o,u,h){return new _s(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},Cn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new _s(this,{kind:"constant",value:void 0},t.parameters);var h=ya[this.specification.type];return h?new _s(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},Cn.prototype.evaluate=function(t,o,u,h,g,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,g,b)};var Fc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,g,b){if(u.value===void 0)return new _s(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},g,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(I,I,I,h);return new _s(this,{kind:"constant",value:D},h)}if(u.expression.kind==="camera"){var N=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new _s(this,{kind:"constant",value:N},h)}return new _s(this,u.expression,h)},o.prototype.evaluate=function(u,h,g,b,S,I){if(u.kind==="source"){var D=u.evaluate(h,g,b,S,I);return this._calculate(D,D,D,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},g,b),u.evaluate({zoom:Math.floor(h.zoom)},g,b),u.evaluate({zoom:Math.floor(h.zoom)+1},g,b),h):u.value},o.prototype._calculate=function(u,h,g,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:g,to:h}},o.prototype.interpolate=function(u){return u},o}(Cn),is=function(t){this.specification=t};is.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var g=t.expression.evaluate(o,null,{},u,h);return this._calculate(g,g,g,o)}return this._calculate(t.expression.evaluate(new Si(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Si(Math.floor(o.zoom),o)),t.expression.evaluate(new Si(Math.floor(o.zoom+1),o)),o)}},is.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},is.prototype.interpolate=function(t){return t};var ou=function(t){this.specification=t};ou.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},ou.prototype.interpolate=function(){return!1};var Bo=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new Ou(u,void 0),g=this.defaultTransitionablePropertyValues[o]=new au(u);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};pn("DataDrivenProperty",Cn),pn("DataConstantProperty",In),pn("CrossFadedDataDrivenProperty",Fc),pn("CrossFadedProperty",is),pn("ColorRampProperty",ou);var Ru=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Hs(h.layout)),h.paint)){for(var g in this._transitionablePaint=new Xo(h.paint),u.paint)this.setPaintProperty(g,u.paint[g],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pu(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,g){g===void 0&&(g={}),h!=null&&this._validate(qu,"layers."+this.id+".layout."+u,u,h,g)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,g){if(g===void 0&&(g={}),h!=null&&this._validate(Bl,"layers."+this.id+".paint."+u,u,h,g))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var N=this._transitionablePaint._values[u].value;return N.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,D,N)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,g){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ut(u,function(h,g){return!(h===void 0||g==="layout"&&!Object.keys(h).length||g==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,g,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Dc(this,u.call(Na,{key:h,layerType:this.type,objectKey:g,value:b,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof _s&&ru(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}($e),gf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},yf=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},la=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function da(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(g){var b=gf[g.type].BYTES_PER_ELEMENT,S=u=kp(u,Math.max(o,b)),I=g.components||1;return h=Math.max(h,b),u+=b*I,{name:g.name,type:g.type,components:I,offset:S}}),size:kp(u,Math.max(h,o)),alignment:o}}function kp(t,o){return Math.ceil(t/o)*o}la.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},la.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},la.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},la.prototype.clear=function(){this.length=0},la.prototype.resize=function(t){this.reserve(t),this.length=t},la.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},la.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var $u=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var g=this.length;return this.resize(g+1),this.emplace(g,u,h)},o.prototype.emplace=function(u,h,g){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=g,u},o}(la);$u.prototype.bytesPerElement=4,pn("StructArrayLayout2i4",$u);var hu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,g,b)},o.prototype.emplace=function(u,h,g,b,S){var I=4*u;return this.int16[I+0]=h,this.int16[I+1]=g,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(la);hu.prototype.bytesPerElement=8,pn("StructArrayLayout4i8",hu);var Gi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,g,b,S,I)},o.prototype.emplace=function(u,h,g,b,S,I,D){var N=6*u;return this.int16[N+0]=h,this.int16[N+1]=g,this.int16[N+2]=b,this.int16[N+3]=S,this.int16[N+4]=I,this.int16[N+5]=D,u},o}(la);Gi.prototype.bytesPerElement=12,pn("StructArrayLayout2i4i12",Gi);var no=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,g,b,S,I)},o.prototype.emplace=function(u,h,g,b,S,I,D){var N=4*u,Z=8*u;return this.int16[N+0]=h,this.int16[N+1]=g,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=I,this.uint8[Z+7]=D,u},o}(la);no.prototype.bytesPerElement=8,pn("StructArrayLayout2i4ub8",no);var Ws=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var g=this.length;return this.resize(g+1),this.emplace(g,u,h)},o.prototype.emplace=function(u,h,g){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=g,u},o}(la);Ws.prototype.bytesPerElement=8,pn("StructArrayLayout2f8",Ws);var Xs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I,D,N,Z,j){var $=this.length;return this.resize($+1),this.emplace($,u,h,g,b,S,I,D,N,Z,j)},o.prototype.emplace=function(u,h,g,b,S,I,D,N,Z,j,$){var re=10*u;return this.uint16[re+0]=h,this.uint16[re+1]=g,this.uint16[re+2]=b,this.uint16[re+3]=S,this.uint16[re+4]=I,this.uint16[re+5]=D,this.uint16[re+6]=N,this.uint16[re+7]=Z,this.uint16[re+8]=j,this.uint16[re+9]=$,u},o}(la);Xs.prototype.bytesPerElement=20,pn("StructArrayLayout10ui20",Xs);var vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I,D,N,Z,j,$,re){var Te=this.length;return this.resize(Te+1),this.emplace(Te,u,h,g,b,S,I,D,N,Z,j,$,re)},o.prototype.emplace=function(u,h,g,b,S,I,D,N,Z,j,$,re,Te){var O=12*u;return this.int16[O+0]=h,this.int16[O+1]=g,this.int16[O+2]=b,this.int16[O+3]=S,this.uint16[O+4]=I,this.uint16[O+5]=D,this.uint16[O+6]=N,this.uint16[O+7]=Z,this.int16[O+8]=j,this.int16[O+9]=$,this.int16[O+10]=re,this.int16[O+11]=Te,u},o}(la);vl.prototype.bytesPerElement=24,pn("StructArrayLayout4i4ui4i24",vl);var ku=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,g)},o.prototype.emplace=function(u,h,g,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=g,this.float32[S+2]=b,u},o}(la);ku.prototype.bytesPerElement=12,pn("StructArrayLayout3f12",ku);var zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(la);zl.prototype.bytesPerElement=4,pn("StructArrayLayout1ul4",zl);var ja=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I,D,N,Z){var j=this.length;return this.resize(j+1),this.emplace(j,u,h,g,b,S,I,D,N,Z)},o.prototype.emplace=function(u,h,g,b,S,I,D,N,Z,j){var $=10*u,re=5*u;return this.int16[$+0]=h,this.int16[$+1]=g,this.int16[$+2]=b,this.int16[$+3]=S,this.int16[$+4]=I,this.int16[$+5]=D,this.uint32[re+3]=N,this.uint16[$+8]=Z,this.uint16[$+9]=j,u},o}(la);ja.prototype.bytesPerElement=20,pn("StructArrayLayout6i1ul2ui20",ja);var su=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,g,b,S,I)},o.prototype.emplace=function(u,h,g,b,S,I,D){var N=6*u;return this.int16[N+0]=h,this.int16[N+1]=g,this.int16[N+2]=b,this.int16[N+3]=S,this.int16[N+4]=I,this.int16[N+5]=D,u},o}(la);su.prototype.bytesPerElement=12,pn("StructArrayLayout2i2i2i12",su);var du=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,h,g,b,S)},o.prototype.emplace=function(u,h,g,b,S,I){var D=4*u,N=8*u;return this.float32[D+0]=h,this.float32[D+1]=g,this.float32[D+2]=b,this.int16[N+6]=S,this.int16[N+7]=I,u},o}(la);du.prototype.bytesPerElement=16,pn("StructArrayLayout2f1f2i16",du);var Yf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,g,b)},o.prototype.emplace=function(u,h,g,b,S){var I=12*u,D=3*u;return this.uint8[I+0]=h,this.uint8[I+1]=g,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(la);Yf.prototype.bytesPerElement=12,pn("StructArrayLayout2ub2f12",Yf);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,g)},o.prototype.emplace=function(u,h,g,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=g,this.uint16[S+2]=b,u},o}(la);ml.prototype.bytesPerElement=6,pn("StructArrayLayout3ui6",ml);var Qu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I,D,N,Z,j,$,re,Te,O,He,Ne,rt){var mt=this.length;return this.resize(mt+1),this.emplace(mt,u,h,g,b,S,I,D,N,Z,j,$,re,Te,O,He,Ne,rt)},o.prototype.emplace=function(u,h,g,b,S,I,D,N,Z,j,$,re,Te,O,He,Ne,rt,mt){var Bt=24*u,Zt=12*u,nr=48*u;return this.int16[Bt+0]=h,this.int16[Bt+1]=g,this.uint16[Bt+2]=b,this.uint16[Bt+3]=S,this.uint32[Zt+2]=I,this.uint32[Zt+3]=D,this.uint32[Zt+4]=N,this.uint16[Bt+10]=Z,this.uint16[Bt+11]=j,this.uint16[Bt+12]=$,this.float32[Zt+7]=re,this.float32[Zt+8]=Te,this.uint8[nr+36]=O,this.uint8[nr+37]=He,this.uint8[nr+38]=Ne,this.uint32[Zt+10]=rt,this.int16[Bt+22]=mt,u},o}(la);Qu.prototype.bytesPerElement=48,pn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qu);var _f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b,S,I,D,N,Z,j,$,re,Te,O,He,Ne,rt,mt,Bt,Zt,nr,yr,Vr,Dn,sn,Zn,ln,Mi){var qn=this.length;return this.resize(qn+1),this.emplace(qn,u,h,g,b,S,I,D,N,Z,j,$,re,Te,O,He,Ne,rt,mt,Bt,Zt,nr,yr,Vr,Dn,sn,Zn,ln,Mi)},o.prototype.emplace=function(u,h,g,b,S,I,D,N,Z,j,$,re,Te,O,He,Ne,rt,mt,Bt,Zt,nr,yr,Vr,Dn,sn,Zn,ln,Mi,qn){var Pn=34*u,Bi=17*u;return this.int16[Pn+0]=h,this.int16[Pn+1]=g,this.int16[Pn+2]=b,this.int16[Pn+3]=S,this.int16[Pn+4]=I,this.int16[Pn+5]=D,this.int16[Pn+6]=N,this.int16[Pn+7]=Z,this.uint16[Pn+8]=j,this.uint16[Pn+9]=$,this.uint16[Pn+10]=re,this.uint16[Pn+11]=Te,this.uint16[Pn+12]=O,this.uint16[Pn+13]=He,this.uint16[Pn+14]=Ne,this.uint16[Pn+15]=rt,this.uint16[Pn+16]=mt,this.uint16[Pn+17]=Bt,this.uint16[Pn+18]=Zt,this.uint16[Pn+19]=nr,this.uint16[Pn+20]=yr,this.uint16[Pn+21]=Vr,this.uint16[Pn+22]=Dn,this.uint32[Bi+12]=sn,this.float32[Bi+13]=Zn,this.float32[Bi+14]=ln,this.float32[Bi+15]=Mi,this.float32[Bi+16]=qn,u},o}(la);_f.prototype.bytesPerElement=68,pn("StructArrayLayout8i15ui1ul4f68",_f);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(la);gl.prototype.bytesPerElement=4,pn("StructArrayLayout1f4",gl);var Ms=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,g)},o.prototype.emplace=function(u,h,g,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=g,this.int16[S+2]=b,u},o}(la);Ms.prototype.bytesPerElement=6,pn("StructArrayLayout3i6",Ms);var lc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,g)},o.prototype.emplace=function(u,h,g,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=g,this.uint16[S+3]=b,u},o}(la);lc.prototype.bytesPerElement=8,pn("StructArrayLayout1ul2ui8",lc);var Bc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var g=this.length;return this.resize(g+1),this.emplace(g,u,h)},o.prototype.emplace=function(u,h,g){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=g,u},o}(la);Bc.prototype.bytesPerElement=4,pn("StructArrayLayout2ui4",Bc);var xf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(la);xf.prototype.bytesPerElement=2,pn("StructArrayLayout1ui2",xf);var cc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,g,b)},o.prototype.emplace=function(u,h,g,b,S){var I=4*u;return this.float32[I+0]=h,this.float32[I+1]=g,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(la);cc.prototype.bytesPerElement=16,pn("StructArrayLayout4f16",cc);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ce(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(yf);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(ja);pn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(yf);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Qu);pn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(yf);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(_f);pn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(gl);pn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Ms);pn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(yf);U.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(lc);pn("FeatureIndexArray",H);var ae=da([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(t){t===void 0&&(t=[]),this.segments=t};function ue(t,o){return 256*(t=Jt(Math.floor(t),0,255))+Jt(Math.floor(o),0,255)}se.prototype.prepareSegment=function(t,o,u,h){var g=this.segments[this.segments.length-1];return t>se.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!g||g.vertexLength+t>se.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},se.simpleSegment=function(t,o,u,h){return new se([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pn("SegmentVector",se);var Ie=da([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ee=Oe(function(t){t.exports=function(o,u){var h,g,b,S,I,D,N,Z;for(g=o.length-(h=3&o.length),b=u,I=3432918353,D=461845907,Z=0;Z<g;)N=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=N=(65535&(N=(N=(65535&N)*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,h){case 3:N^=(255&o.charCodeAt(Z+2))<<16;case 2:N^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=N=(65535&(N=(N=(65535&(N^=255&o.charCodeAt(Z)))*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Fe=Oe(function(t){t.exports=function(o,u){for(var h,g=o.length,b=u^g,S=0;g>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ae=Ee,Ue=Fe;Ae.murmur3=Ee,Ae.murmur2=Ue;var Ye=function(){this.ids=[],this.positions=[],this.indexed=!1};Ye.prototype.add=function(t,o,u,h){this.ids.push(Vt(t)),this.positions.push(o,u,h)},Ye.prototype.getPositions=function(t){for(var o=Vt(t),u=0,h=this.ids.length-1;u<h;){var g=u+h>>1;this.ids[g]>=o?h=g:u=g+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},Ye.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function g(b,S,I,D){for(;I<D;){for(var N=b[I+D>>1],Z=I-1,j=D+1;;){do Z++;while(b[Z]<N);do j--;while(b[j]>N);if(Z>=j)break;zt(b,Z,j),zt(S,3*Z,3*j),zt(S,3*Z+1,3*j+1),zt(S,3*Z+2,3*j+2)}j-I<D-j?(g(b,S,I,j),I=j+1):(g(b,S,j+1,D),D=j)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},Ye.deserialize=function(t){var o=new Ye;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var vt=Math.pow(2,53)-1;function Vt(t){var o=+t;return!isNaN(o)&&o<=vt?o:Ae(String(t))}function zt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}pn("FeaturePositionMap",Ye);var Ht=function(t,o){this.gl=t.gl,this.location=o},fr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Ht),xr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Ht),Or=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Ht),an=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Ht),Un=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Ht),On=function(t){function o(u,h){t.call(this,u,h),this.current=Di.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Ht),Bn=new Float32Array(16),Ti=function(t){function o(u,h){t.call(this,u,h),this.current=Bn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Ht);function tn(t){return[ue(255*t.r,255*t.g),ue(255*t.b,255*t.a)]}var ri=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};ri.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ri.prototype.getBinding=function(t,o,u){return this.type==="color"?new On(t,o):new xr(t,o)};var ni=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ni.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},ni.prototype.setUniform=function(t,o,u,h){var g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)},ni.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Un(t,o):new xr(t,o)};var Yn=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(g){return{name:"a_"+g,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Yn.prototype.populatePaintArray=function(t,o,u,h,g){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Si(0),o,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},Yn.prototype.updatePaintArray=function(t,o,u,h){var g=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,g)},Yn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=tn(u),g=t;g<o;g++)this.paintVertexArray.emplace(g,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Yn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Yn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Vn=function(t,o,u,h,g,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Vn.prototype.populatePaintArray=function(t,o,u,h,g){var b=this.expression.evaluate(new Si(this.zoom),o,{},h,[],g),S=this.expression.evaluate(new Si(this.zoom+1),o,{},h,[],g),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},Vn.prototype.updatePaintArray=function(t,o,u,h){var g=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,g,b)},Vn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var g=tn(u),b=tn(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,g[0],g[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Vn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Vn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Vn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=Jt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Vn.prototype.getBinding=function(t,o,u){return new xr(t,o)};var ci=function(t,o,u,h,g,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};ci.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},ci.prototype.updatePaintArray=function(t,o,u,h,g){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],g)},ci.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var g=h[u.min],b=h[u.mid],S=h[u.max];if(g&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],b.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},ci.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ie.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ie.members,this.expression.isStateDependent))},ci.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Wn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var g in t.paint._values)if(u(g)){var b=t.paint.get(g);if(b instanceof _s&&ru(b.property.specification)){var S=bo(g,t.type),I=b.value,D=b.property.specification.type,N=b.property.useIntegerZoom,Z=b.property.specification["property-type"],j=Z==="cross-faded"||Z==="cross-faded-data-driven";if(I.kind==="constant")this.binders[g]=j?new ni(I.value,S):new ri(I.value,S,D),h.push("/u_"+g);else if(I.kind==="source"||j){var $=Va(g,D,"source");this.binders[g]=j?new ci(I,D,N,o,$,t.id):new Yn(I,S,D,$),h.push("/a_"+g)}else{var re=Va(g,D,"composite");this.binders[g]=new Vn(I,S,D,N,o,re),h.push("/z_"+g)}}}this.cacheKey=h.sort().join("")};Wn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Yn||o instanceof Vn?o.maxValue:0},Wn.prototype.populatePaintArrays=function(t,o,u,h,g){for(var b in this.binders){var S=this.binders[b];(S instanceof Yn||S instanceof Vn||S instanceof ci)&&S.populatePaintArray(t,o,u,h,g)}},Wn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof ni&&h.setConstantPatternPositions(t,o)}},Wn.prototype.updatePaintArrays=function(t,o,u,h,g){var b=!1;for(var S in t)for(var I=0,D=o.getPositions(S);I<D.length;I+=1){var N=D[I],Z=u.feature(N.index);for(var j in this.binders){var $=this.binders[j];if(($ instanceof Yn||$ instanceof Vn||$ instanceof ci)&&$.expression.isStateDependent===!0){var re=h.paint.get(j);$.expression=re.value,$.updatePaintArray(N.start,N.end,Z,t[S],g),b=!0}}}return b},Wn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ri||u instanceof ni)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Wn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Yn||u instanceof Vn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof ci)for(var g=0;g<Ie.members.length;g++)t.push(Ie.members[g].name)}return t},Wn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ri||u instanceof ni||u instanceof Vn)for(var h=0,g=u.uniformNames;h<g.length;h+=1)t.push(g[h])}return t},Wn.prototype.getPaintVertexBuffers=function(){return this._buffers},Wn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var g=this.binders[h];if(g instanceof ri||g instanceof ni||g instanceof Vn)for(var b=0,S=g.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var D=g.getBinding(t,o[I],I);u.push({name:I,property:h,binding:D})}}}return u},Wn.prototype.setUniforms=function(t,o,u,h){for(var g=0,b=o;g<b.length;g+=1){var S=b[g],I=S.name,D=S.property;this.binders[D].setUniform(S.binding,h,u.get(D),I)}},Wn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof ci){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Yn||u instanceof Vn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Wn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Yn||u instanceof Vn||u instanceof ci)&&u.upload(t)}this.updatePaintBuffers()},Wn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Yn||o instanceof Vn||o instanceof ci)&&o.destroy()}};var Gn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,g=t;h<g.length;h+=1){var b=g[h];this.programConfigurations[b.id]=new Wn(b,o,u)}this.needsUpload=!1,this._featureMap=new Ye,this._bufferOffset=0};function bo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Va(t,o,u){var h={color:{source:Ws,composite:cc},number:{source:gl,composite:Ws}},g=function(b){return{"line-pattern":{source:Xs,composite:Xs},"fill-pattern":{source:Xs,composite:Xs},"fill-extrusion-pattern":{source:Xs,composite:Xs}}[b]}(t);return g&&g[u]||h[o][u]}Gn.prototype.populatePaintArrays=function(t,o,u,h,g,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,g,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Gn.prototype.updatePaintArrays=function(t,o,u,h){for(var g=0,b=u;g<b.length;g+=1){var S=b[g];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Gn.prototype.get=function(t){return this.programConfigurations[t]},Gn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Gn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},pn("ConstantBinder",ri),pn("CrossFadedConstantBinder",ni),pn("SourceExpressionBinder",Yn),pn("CrossFadedCompositeBinder",ci),pn("CompositeExpressionBinder",Vn),pn("ProgramConfiguration",Wn,{omit:["_buffers"]}),pn("ProgramConfigurationSet",Gn);var ka=Math.pow(2,14)-1,Mo=-ka-1;function Ya(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var g=u[h],b=0;b<g.length;b++){var S=g[b],I=Math.round(S.x*o),D=Math.round(S.y*o);S.x=Jt(I,Mo,ka),S.y=Jt(D,Mo,ka),(I<S.x||I>S.x+1||D<S.y||D>S.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function fo(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Ya(t):[]}}function Ps(t,o,u,h,g){t.emplaceBack(2*o+(h+1)/2,2*u+(g+1)/2)}var as=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new $u,this.indexArray=new ml,this.segments=new se,this.programConfigurations=new Gn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Lu(t,o){for(var u=0;u<t.length;u++)if(Ys(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(Ys(t,o[h]))return!0;return!!fc(t,o)}function os(t,o,u){return!!Ys(t,o)||!!vu(o,t,u)}function Ls(t,o){if(t.length===1)return Zl(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],g=0;g<h.length;g++)if(Ys(t,h[g]))return!0;for(var b=0;b<t.length;b++)if(Zl(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(fc(t,o[S]))return!0;return!1}function go(t,o,u){if(t.length>1){if(fc(t,o))return!0;for(var h=0;h<o.length;h++)if(vu(o[h],t,u))return!0}for(var g=0;g<t.length;g++)if(vu(t[g],o,u))return!0;return!1}function fc(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],g=t[u+1],b=0;b<o.length-1;b++)if(Ul(h,g,o[b],o[b+1]))return!0;return!1}function Ul(t,o,u,h){return Xt(t,u,h)!==Xt(o,u,h)&&Xt(t,o,u)!==Xt(t,o,h)}function vu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var g=1;g<o.length;g++)if(yl(t,o[g-1],o[g])<h)return!0;return!1}function yl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var g=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(g<0?o:g>1?u:u.sub(o)._mult(g)._add(o))}function Zl(t,o){for(var u,h,g,b=!1,S=0;S<t.length;S++)for(var I=0,D=(u=t[S]).length-1;I<u.length;D=I++)(h=u[I]).y>o.y!=(g=u[D]).y>o.y&&o.x<(g.x-h.x)*(o.y-h.y)/(g.y-h.y)+h.x&&(b=!b);return b}function Ys(t,o){for(var u=!1,h=0,g=t.length-1;h<t.length;g=h++){var b=t[h],S=t[g];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function jl(t,o,u){var h=u[0],g=u[2];if(t.x<h.x&&o.x<h.x||t.x>g.x&&o.x>g.x||t.y<h.y&&o.y<h.y||t.y>g.y&&o.y>g.y)return!1;var b=Xt(t,o,u[0]);return b!==Xt(t,o,u[1])||b!==Xt(t,o,u[2])||b!==Xt(t,o,u[3])}function mu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function gu(t,o,u,h,g){if(!o[0]&&!o[1])return t;var b=ce.convert(o)._mult(g);u==="viewport"&&b._rotate(-h);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}as.prototype.populate=function(t,o,u){var h=this.layers[0],g=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var D=I[S],N=D.feature,Z=D.id,j=D.index,$=D.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,Te=fo(N,re);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),Te,u)){var O=b?b.evaluate(Te,{},u):void 0,He={id:Z,properties:N.properties,type:N.type,sourceLayerIndex:$,index:j,geometry:re?Te.geometry:Ya(N),patterns:{},sortKey:O};g.push(He)}}b&&g.sort(function(Vr,Dn){return Vr.sortKey-Dn.sortKey});for(var Ne=0,rt=g;Ne<rt.length;Ne+=1){var mt=rt[Ne],Bt=mt.geometry,Zt=mt.index,nr=mt.sourceLayerIndex,yr=t[Zt].feature;this.addFeature(mt,Bt,Zt,u),o.featureIndex.insert(yr,Bt,Zt,nr,this.index)}},as.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},as.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},as.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},as.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ae),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},as.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},as.prototype.addFeature=function(t,o,u,h){for(var g=0,b=o;g<b.length;g+=1)for(var S=0,I=b[g];S<I.length;S+=1){var D=I[S],N=D.x,Z=D.y;if(!(N<0||N>=8192||Z<0||Z>=8192)){var j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),$=j.vertexLength;Ps(this.layoutVertexArray,N,Z,-1,-1),Ps(this.layoutVertexArray,N,Z,1,-1),Ps(this.layoutVertexArray,N,Z,1,1),Ps(this.layoutVertexArray,N,Z,-1,1),this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+3,$+2),j.vertexLength+=4,j.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},pn("CircleBucket",as,{omit:["layers"]});var Ju=new Bo({"circle-sort-key":new Cn(oe.layout_circle["circle-sort-key"])}),el={paint:new Bo({"circle-radius":new Cn(oe.paint_circle["circle-radius"]),"circle-color":new Cn(oe.paint_circle["circle-color"]),"circle-blur":new Cn(oe.paint_circle["circle-blur"]),"circle-opacity":new Cn(oe.paint_circle["circle-opacity"]),"circle-translate":new In(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new In(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(oe.paint_circle["circle-stroke-opacity"])}),layout:Ju},na=typeof Float32Array!="undefined"?Float32Array:Array;function Is(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function No(t,o,u){var h=o[0],g=o[1],b=o[2],S=o[3],I=o[4],D=o[5],N=o[6],Z=o[7],j=o[8],$=o[9],re=o[10],Te=o[11],O=o[12],He=o[13],Ne=o[14],rt=o[15],mt=u[0],Bt=u[1],Zt=u[2],nr=u[3];return t[0]=mt*h+Bt*I+Zt*j+nr*O,t[1]=mt*g+Bt*D+Zt*$+nr*He,t[2]=mt*b+Bt*N+Zt*re+nr*Ne,t[3]=mt*S+Bt*Z+Zt*Te+nr*rt,t[4]=(mt=u[4])*h+(Bt=u[5])*I+(Zt=u[6])*j+(nr=u[7])*O,t[5]=mt*g+Bt*D+Zt*$+nr*He,t[6]=mt*b+Bt*N+Zt*re+nr*Ne,t[7]=mt*S+Bt*Z+Zt*Te+nr*rt,t[8]=(mt=u[8])*h+(Bt=u[9])*I+(Zt=u[10])*j+(nr=u[11])*O,t[9]=mt*g+Bt*D+Zt*$+nr*He,t[10]=mt*b+Bt*N+Zt*re+nr*Ne,t[11]=mt*S+Bt*Z+Zt*Te+nr*rt,t[12]=(mt=u[12])*h+(Bt=u[13])*I+(Zt=u[14])*j+(nr=u[15])*O,t[13]=mt*g+Bt*D+Zt*$+nr*He,t[14]=mt*b+Bt*N+Zt*re+nr*Ne,t[15]=mt*S+Bt*Z+Zt*Te+nr*rt,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var tl,Nc=No;function zc(t,o,u){var h=o[0],g=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*g+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*g+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*g+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*g+u[11]*b+u[15]*S,t}tl=new na(3),na!=Float32Array&&(tl[0]=0,tl[1]=0,tl[2]=0),function(){var t=new na(4);na!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var bf=(function(){var t=new na(2);na!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,el)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new as(u)},o.prototype.queryRadius=function(u){var h=u;return mu("circle-radius",this,h)+mu("circle-stroke-width",this,h)+Eo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,g,b,S,I,D,N){for(var Z=gu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),j=this.paint.get("circle-radius").evaluate(h,g)+this.paint.get("circle-stroke-width").evaluate(h,g),$=this.paint.get("circle-pitch-alignment")==="map",re=$?Z:function(yr,Vr){return yr.map(function(Dn){return qs(Dn,Vr)})}(Z,N),Te=$?j*D:j,O=0,He=b;O<He.length;O+=1)for(var Ne=0,rt=He[O];Ne<rt.length;Ne+=1){var mt=rt[Ne],Bt=$?mt:qs(mt,N),Zt=Te,nr=zc([],[mt.x,mt.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Zt*=nr[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Zt*=I.cameraToCenterDistance/nr[3]),os(re,Bt,Zt))return!0}return!1},o}(Ru));function qs(t,o){var u=zc([],[t.x,t.y,0,1],o);return new ce(u[0]/u[3],u[1]/u[3])}var Vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(as);function uu(t,o,u,h){var g=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==g*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(g*b*u);return t.width=g,t.height=b,t.data=h,t}function rl(t,o,u){var h=o.width,g=o.height;if(h!==t.width||g!==t.height){var b=uu({},{width:h,height:g},u);Gl(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,g)},u),t.width=h,t.height=g,t.data=b.data}}function Gl(t,o,u,h,g,b){if(g.width===0||g.height===0)return o;if(g.width>t.width||g.height>t.height||u.x>t.width-g.width||u.y>t.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||h.x>o.width-g.width||h.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,D=0;D<g.height;D++)for(var N=((u.y+D)*t.width+u.x)*b,Z=((h.y+D)*o.width+h.x)*b,j=0;j<g.width*b;j++)I[Z+j]=S[N+j];return o}pn("HeatmapBucket",Vl,{omit:["layers"]});var yu=function(t,o){uu(this,t,1,o)};yu.prototype.resize=function(t){rl(this,t,1)},yu.prototype.clone=function(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))},yu.copy=function(t,o,u,h,g){Gl(t,o,u,h,g,1)};var zo=function(t,o){uu(this,t,4,o)};zo.prototype.resize=function(t){rl(this,t,4)},zo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},zo.prototype.clone=function(){return new zo({width:this.width,height:this.height},new Uint8Array(this.data))},zo.copy=function(t,o,u,h,g){Gl(t,o,u,h,g,4)},pn("AlphaImage",yu),pn("RGBAImage",zo);var Uc={paint:new Bo({"heatmap-radius":new Cn(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ou(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(oe.paint_heatmap["heatmap-opacity"])})};function qf(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,g=t.image||new zo({width:u,height:h}),b=function(Te,O,He){o[t.evaluationKey]=He;var Ne=t.expression.evaluate(o);g.data[Te+O+0]=Math.floor(255*Ne.r/Ne.a),g.data[Te+O+1]=Math.floor(255*Ne.g/Ne.a),g.data[Te+O+2]=Math.floor(255*Ne.b/Ne.a),g.data[Te+O+3]=Math.floor(255*Ne.a)};if(t.clips)for(var S=0,I=0;S<h;++S,I+=4*u)for(var D=0,N=0;D<u;D++,N+=4){var Z=D/(u-1),j=t.clips[S];b(I,N,j.start*(1-Z)+j.end*Z)}else for(var $=0,re=0;$<u;$++,re+=4)b(0,re,$/(u-1));return g}var Lp=function(t){function o(u){t.call(this,u,Uc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Vl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=qf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Ru),Kf={paint:new Bo({"hillshade-illumination-direction":new In(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new In(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(oe.paint_hillshade["hillshade-accent-color"])})},pc=function(t){function o(u){t.call(this,u,Kf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Ru),sh=da([{name:"a_pos",components:2,type:"Int16"}],4).members,hc=Dp,Ef=Dp;function Dp(t,o,u){u=u||2;var h,g,b,S,I,D,N,Z=o&&o.length,j=Z?o[0]*u:t.length,$=uh(t,0,j,u,!0),re=[];if(!$||$.next===$.prev)return re;if(Z&&($=function(O,He,Ne,rt){var mt,Bt,Zt,nr=[];for(mt=0,Bt=He.length;mt<Bt;mt++)(Zt=uh(O,He[mt]*rt,mt<Bt-1?He[mt+1]*rt:O.length,rt,!1))===Zt.next&&(Zt.steiner=!0),nr.push(dv(Zt));for(nr.sort(Td),mt=0;mt<nr.length;mt++)Md(nr[mt],Ne),Ne=_l(Ne,Ne.next);return Ne}(t,o,$,u)),t.length>80*u){h=b=t[0],g=S=t[1];for(var Te=u;Te<j;Te+=u)(I=t[Te])<h&&(h=I),(D=t[Te+1])<g&&(g=D),I>b&&(b=I),D>S&&(S=D);N=(N=Math.max(b-h,S-g))!==0?1/N:0}return Sf($,re,u,h,g,N),re}function uh(t,o,u,h,g){var b,S;if(g===Jf(t,o,u,h)>0)for(b=o;b<u;b+=h)S=Af(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=Af(b,t[b],t[b+1],S);return S&&Fp(S,S.next)&&(Du(S),S=S.next),S}function _l(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!Fp(h,h.next)&&bt(h.prev,h,h.next)!==0)h=h.next;else{if(Du(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function Sf(t,o,u,h,g,b,S){if(t){!S&&b&&function(Z,j,$,re){var Te=Z;do Te.z===null&&(Te.z=ch(Te.x,Te.y,j,$,re)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==Z);Te.prevZ.nextZ=null,Te.prevZ=null,function(O){var He,Ne,rt,mt,Bt,Zt,nr,yr,Vr=1;do{for(Ne=O,O=null,Bt=null,Zt=0;Ne;){for(Zt++,rt=Ne,nr=0,He=0;He<Vr&&(nr++,rt=rt.nextZ);He++);for(yr=Vr;nr>0||yr>0&&rt;)nr!==0&&(yr===0||!rt||Ne.z<=rt.z)?(mt=Ne,Ne=Ne.nextZ,nr--):(mt=rt,rt=rt.nextZ,yr--),Bt?Bt.nextZ=mt:O=mt,mt.prevZ=Bt,Bt=mt;Ne=rt}Bt.nextZ=null,Vr*=2}while(Zt>1)}(Te)}(t,h,g,b);for(var I,D,N=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?Vh(t,h,g,b):jh(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),Du(t),t=D.next,N=D.next;else if((t=D)===N){S?S===1?Sf(t=Zc(_l(t),o,u),o,u,h,g,b,2):S===2&&lh(t,o,u,h,g,b):Sf(_l(t),o,u,h,g,b,1);break}}}function jh(t){var o=t.prev,u=t,h=t.next;if(bt(o,u,h)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(Lr(o.x,o.y,u.x,u.y,h.x,h.y,g.x,g.y)&&bt(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Vh(t,o,u,h){var g=t.prev,b=t,S=t.next;if(bt(g,b,S)>=0)return!1;for(var I=g.x>b.x?g.x>S.x?g.x:S.x:b.x>S.x?b.x:S.x,D=g.y>b.y?g.y>S.y?g.y:S.y:b.y>S.y?b.y:S.y,N=ch(g.x<b.x?g.x<S.x?g.x:S.x:b.x<S.x?b.x:S.x,g.y<b.y?g.y<S.y?g.y:S.y:b.y<S.y?b.y:S.y,o,u,h),Z=ch(I,D,o,u,h),j=t.prevZ,$=t.nextZ;j&&j.z>=N&&$&&$.z<=Z;){if(j!==t.prev&&j!==t.next&&Lr(g.x,g.y,b.x,b.y,S.x,S.y,j.x,j.y)&&bt(j.prev,j,j.next)>=0||(j=j.prevZ,$!==t.prev&&$!==t.next&&Lr(g.x,g.y,b.x,b.y,S.x,S.y,$.x,$.y)&&bt($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;j&&j.z>=N;){if(j!==t.prev&&j!==t.next&&Lr(g.x,g.y,b.x,b.y,S.x,S.y,j.x,j.y)&&bt(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;$&&$.z<=Z;){if($!==t.prev&&$!==t.next&&Lr(g.x,g.y,b.x,b.y,S.x,S.y,$.x,$.y)&&bt($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function Zc(t,o,u){var h=t;do{var g=h.prev,b=h.next.next;!Fp(g,b)&&Hh(g,h,h.next,b)&&Cf(g,b)&&Cf(b,g)&&(o.push(g.i/u),o.push(h.i/u),o.push(b.i/u),Du(h),Du(h.next),h=t=b),h=h.next}while(h!==t);return _l(h)}function lh(t,o,u,h,g,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Pd(S,I)){var D=Bp(S,I);return S=_l(S,S.next),D=_l(D,D.next),Sf(S,o,u,h,g,b),void Sf(D,o,u,h,g,b)}I=I.next}S=S.next}while(S!==t)}function Td(t,o){return t.x-o.x}function Md(t,o){if(o=function(h,g){var b,S=g,I=h.x,D=h.y,N=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var Z=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=I&&Z>N){if(N=Z,Z===I){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==g);if(!b)return null;if(I===N)return b;var j,$=b,re=b.x,Te=b.y,O=1/0;S=b;do I>=S.x&&S.x>=re&&I!==S.x&&Lr(D<Te?I:N,D,re,Te,D<Te?N:I,D,S.x,S.y)&&(j=Math.abs(D-S.y)/(I-S.x),Cf(S,h)&&(j<O||j===O&&(S.x>b.x||S.x===b.x&&Gh(b,S)))&&(b=S,O=j)),S=S.next;while(S!==$);return b}(t,o)){var u=Bp(o,t);_l(o,o.next),_l(u,u.next)}}function Gh(t,o){return bt(t.prev,t,o.prev)<0&&bt(o.next,t,t.next)<0}function ch(t,o,u,h,g){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*g)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*g)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function dv(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Lr(t,o,u,h,g,b,S,I){return(g-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(h-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(g-S)*(h-I)>=0}function Pd(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==h.i&&g.next.i!==h.i&&Hh(g,g.next,u,h))return!0;g=g.next}while(g!==u);return!1}(t,o)&&(Cf(t,o)&&Cf(o,t)&&function(u,h){var g=u,b=!1,S=(u.x+h.x)/2,I=(u.y+h.y)/2;do g.y>I!=g.next.y>I&&g.next.y!==g.y&&S<(g.next.x-g.x)*(I-g.y)/(g.next.y-g.y)+g.x&&(b=!b),g=g.next;while(g!==u);return b}(t,o)&&(bt(t.prev,t,o.prev)||bt(t,o.prev,o))||Fp(t,o)&&bt(t.prev,t,t.next)>0&&bt(o.prev,o,o.next)>0)}function bt(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Fp(t,o){return t.x===o.x&&t.y===o.y}function Hh(t,o,u,h){var g=Qf(bt(t,o,u)),b=Qf(bt(t,o,h)),S=Qf(bt(u,h,t)),I=Qf(bt(u,h,o));return g!==b&&S!==I||!(g!==0||!$f(t,u,o))||!(b!==0||!$f(t,h,o))||!(S!==0||!$f(u,t,h))||!(I!==0||!$f(u,o,h))}function $f(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Qf(t){return t>0?1:t<0?-1:0}function Cf(t,o){return bt(t.prev,t,t.next)<0?bt(t,o,t.next)>=0&&bt(t,t.prev,o)>=0:bt(t,o,t.prev)<0||bt(t,t.next,o)<0}function Bp(t,o){var u=new wf(t.i,t.x,t.y),h=new wf(o.i,o.x,o.y),g=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=g,g.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function Af(t,o,u,h){var g=new wf(t,o,u);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Du(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function wf(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jf(t,o,u,h){for(var g=0,b=o,S=u-h;b<u;b+=h)g+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return g}function ep(t,o,u,h,g){(function b(S,I,D,N,Z){for(;N>D;){if(N-D>600){var j=N-D+1,$=I-D+1,re=Math.log(j),Te=.5*Math.exp(2*re/3),O=.5*Math.sqrt(re*Te*(j-Te)/j)*($-j/2<0?-1:1);b(S,I,Math.max(D,Math.floor(I-$*Te/j+O)),Math.min(N,Math.floor(I+(j-$)*Te/j+O)),Z)}var He=S[I],Ne=D,rt=N;for(Hl(S,D,I),Z(S[N],He)>0&&Hl(S,D,N);Ne<rt;){for(Hl(S,Ne,rt),Ne++,rt--;Z(S[Ne],He)<0;)Ne++;for(;Z(S[rt],He)>0;)rt--}Z(S[D],He)===0?Hl(S,D,rt):Hl(S,++rt,N),rt<=I&&(D=rt+1),I<=rt&&(N=rt-1)}})(t,o,u||0,h||t.length-1,g||tp)}function Hl(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function tp(t,o){return t<o?-1:t>o?1:0}function Tf(t,o){var u=t.length;if(u<=1)return[t];for(var h,g,b=[],S=0;S<u;S++){var I=wr(t[S]);I!==0&&(t[S].area=Math.abs(I),g===void 0&&(g=I<0),g===I<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(ep(b[D],o,1,b[D].length-1,rp),b[D]=b[D].slice(0,o));return b}function rp(t,o){return o.area-t.area}function Mf(t,o,u){for(var h=u.patternDependencies,g=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(g=!0);var D=I.constantOr(null);D&&(g=!0,h[D.to]=!0,h[D.from]=!0)}return g}function jc(t,o,u,h,g){for(var b=g.patternDependencies,S=0,I=o;S<I.length;S+=1){var D=I[S],N=D.paint.get(t+"-pattern").value;if(N.kind!=="constant"){var Z=N.evaluate({zoom:h-1},u,{},g.availableImages),j=N.evaluate({zoom:h},u,{},g.availableImages),$=N.evaluate({zoom:h+1},u,{},g.availableImages);j=j&&j.name?j.name:j,$=$&&$.name?$.name:$,b[Z=Z&&Z.name?Z.name:Z]=!0,b[j]=!0,b[$]=!0,u.patterns[D.id]={min:Z,mid:j,max:$}}}return u}Dp.deviation=function(t,o,u,h){var g=o&&o.length,b=Math.abs(Jf(t,0,g?o[0]*u:t.length,u));if(g)for(var S=0,I=o.length;S<I;S++)b-=Math.abs(Jf(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<h.length;S+=3){var N=h[S]*u,Z=h[S+1]*u,j=h[S+2]*u;D+=Math.abs((t[N]-t[j])*(t[Z+1]-t[N+1])-(t[N]-t[Z])*(t[j+1]-t[N+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Dp.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,g=0;g<t.length;g++){for(var b=0;b<t[g].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[g][b][S]);g>0&&u.holes.push(h+=t[g-1].length)}return u},hc.default=Ef;var Ds=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $u,this.indexArray=new ml,this.indexArray2=new Bc,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Ds.prototype.populate=function(t,o,u){this.hasPattern=Mf("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),g=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,N=I.id,Z=I.index,j=I.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,re=fo(D,$);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),re,u)){var Te=h?h.evaluate(re,{},u,o.availableImages):void 0,O={id:N,properties:D.properties,type:D.type,sourceLayerIndex:j,index:Z,geometry:$?re.geometry:Ya(D),patterns:{},sortKey:Te};g.push(O)}}h&&g.sort(function(yr,Vr){return yr.sortKey-Vr.sortKey});for(var He=0,Ne=g;He<Ne.length;He+=1){var rt=Ne[He],mt=rt.geometry,Bt=rt.index,Zt=rt.sourceLayerIndex;if(this.hasPattern){var nr=jc("fill",this.layers,rt,this.zoom,o);this.patternFeatures.push(nr)}else this.addFeature(rt,mt,Bt,u,{});o.featureIndex.insert(t[Bt].feature,mt,Bt,Zt,this.index)}},Ds.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Ds.prototype.addFeatures=function(t,o,u){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var b=g[h];this.addFeature(b,b.geometry,b.index,o,u)}},Ds.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ds.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ds.prototype.addFeature=function(t,o,u,h,g){for(var b=0,S=Tf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,N=0,Z=I;N<Z.length;N+=1)D+=Z[N].length;for(var j=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),$=j.vertexLength,re=[],Te=[],O=0,He=I;O<He.length;O+=1){var Ne=He[O];if(Ne.length!==0){Ne!==I[0]&&Te.push(re.length/2);var rt=this.segments2.prepareSegment(Ne.length,this.layoutVertexArray,this.indexArray2),mt=rt.vertexLength;this.layoutVertexArray.emplaceBack(Ne[0].x,Ne[0].y),this.indexArray2.emplaceBack(mt+Ne.length-1,mt),re.push(Ne[0].x),re.push(Ne[0].y);for(var Bt=1;Bt<Ne.length;Bt++)this.layoutVertexArray.emplaceBack(Ne[Bt].x,Ne[Bt].y),this.indexArray2.emplaceBack(mt+Bt-1,mt+Bt),re.push(Ne[Bt].x),re.push(Ne[Bt].y);rt.vertexLength+=Ne.length,rt.primitiveLength+=Ne.length}}for(var Zt=hc(re,Te),nr=0;nr<Zt.length;nr+=3)this.indexArray.emplaceBack($+Zt[nr],$+Zt[nr+1],$+Zt[nr+2]);j.vertexLength+=D,j.primitiveLength+=Zt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,h)},pn("FillBucket",Ds,{omit:["layers","patternFeatures"]});var Vc=new Bo({"fill-sort-key":new Cn(oe.layout_fill["fill-sort-key"])}),np={paint:new Bo({"fill-antialias":new In(oe.paint_fill["fill-antialias"]),"fill-opacity":new Cn(oe.paint_fill["fill-opacity"]),"fill-color":new Cn(oe.paint_fill["fill-color"]),"fill-outline-color":new Cn(oe.paint_fill["fill-outline-color"]),"fill-translate":new In(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new In(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fc(oe.paint_fill["fill-pattern"])}),layout:Vc},ip=function(t){function o(u){t.call(this,u,np)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Ds(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,g,b,S,I,D){return Ls(gu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(Ru),ap=da([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Np=xl;function xl(t,o,u,h,g){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=g,t.readFields(Gc,this,o)}function Gc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,g){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=g._keys[h.readVarint()],I=g._values[h.readVarint()];g.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Wh(t){for(var o,u,h=0,g=0,b=t.length,S=b-1;g<b;S=g++)h+=((u=t[S]).x-(o=t[g]).x)*(o.y+u.y);return h}xl.types=["Unknown","Point","LineString","Polygon"],xl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,g=0,b=0,S=0,I=[];t.pos<u;){if(g<=0){var D=t.readVarint();h=7&D,g=D>>3}if(g--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&I.push(o),o=[]),o.push(new ce(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&I.push(o),I},xl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,g=0,b=0,S=1/0,I=-1/0,D=1/0,N=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(g+=t.readSVarint())<S&&(S=g),g>I&&(I=g),(b+=t.readSVarint())<D&&(D=b),b>N&&(N=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,I,N]},xl.prototype.toGeoJSON=function(t,o,u){var h,g,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,D=this.loadGeometry(),N=xl.types[this.type];function Z(re){for(var Te=0;Te<re.length;Te++){var O=re[Te];re[Te]=[360*(O.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(h=0;h<D.length;h++)j[h]=D[h][0];Z(D=j);break;case 2:for(h=0;h<D.length;h++)Z(D[h]);break;case 3:for(D=function(re){var Te=re.length;if(Te<=1)return[re];for(var O,He,Ne=[],rt=0;rt<Te;rt++){var mt=Wh(re[rt]);mt!==0&&(He===void 0&&(He=mt<0),He===mt<0?(O&&Ne.push(O),O=[re[rt]]):O.push(re[rt]))}return O&&Ne.push(O),Ne}(D),h=0;h<D.length;h++)for(g=0;g<D[h].length;g++)Z(D[h][g])}D.length===1?D=D[0]:N="Multi"+N;var $={type:"Feature",geometry:{type:N,coordinates:D},properties:this.properties};return"id"in this&&($.id=this.id),$};var op=Xh;function Xh(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Yh,this,o),this.length=this._features.length}function Yh(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var g=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;g=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return g}(u))}function Id(t,o,u){if(t===3){var h=new op(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}Xh.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Np(this._pbf,o,this.extent,this._keys,this._values)};var Fu={VectorTile:function(t,o){this.layers=t.readFields(Id,{},o)},VectorTileFeature:Np,VectorTileLayer:op},qh=Fu.VectorTileFeature.types,sp=Math.pow(2,13);function Hc(t,o,u,h,g,b,S,I){t.emplaceBack(o,u,2*Math.floor(h*sp)+S,g*sp*2,b*sp*2,Math.round(I))}var nl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Gi,this.indexArray=new ml,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function fh(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}nl.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=Mf("fill-extrusion",this.layers,o);for(var h=0,g=t;h<g.length;h+=1){var b=g[h],S=b.feature,I=b.id,D=b.index,N=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,j=fo(S,Z);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),j,u)){var $={id:I,sourceLayerIndex:N,index:D,geometry:Z?j.geometry:Ya(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(jc("fill-extrusion",this.layers,$,this.zoom,o)):this.addFeature($,$.geometry,D,u,{}),o.featureIndex.insert(S,$.geometry,D,N,this.index,!0)}}},nl.prototype.addFeatures=function(t,o,u){for(var h=0,g=this.features;h<g.length;h+=1){var b=g[h];this.addFeature(b,b.geometry,b.index,o,u)}},nl.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},nl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},nl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},nl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ap),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},nl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},nl.prototype.addFeature=function(t,o,u,h,g){for(var b=0,S=Tf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,N=0,Z=I;N<Z.length;N+=1)D+=Z[N].length;for(var j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),$=0,re=I;$<re.length;$+=1){var Te=re[$];if(Te.length!==0&&!((Bi=Te).every(function(bi){return bi.x<0})||Bi.every(function(bi){return bi.x>8192})||Bi.every(function(bi){return bi.y<0})||Bi.every(function(bi){return bi.y>8192})))for(var O=0,He=0;He<Te.length;He++){var Ne=Te[He];if(He>=1){var rt=Te[He-1];if(!fh(Ne,rt)){j.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var mt=Ne.sub(rt)._perp()._unit(),Bt=rt.dist(Ne);O+Bt>32768&&(O=0),Hc(this.layoutVertexArray,Ne.x,Ne.y,mt.x,mt.y,0,0,O),Hc(this.layoutVertexArray,Ne.x,Ne.y,mt.x,mt.y,0,1,O),Hc(this.layoutVertexArray,rt.x,rt.y,mt.x,mt.y,0,0,O+=Bt),Hc(this.layoutVertexArray,rt.x,rt.y,mt.x,mt.y,0,1,O);var Zt=j.vertexLength;this.indexArray.emplaceBack(Zt,Zt+2,Zt+1),this.indexArray.emplaceBack(Zt+1,Zt+2,Zt+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+D>se.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),qh[t.type]==="Polygon"){for(var nr=[],yr=[],Vr=j.vertexLength,Dn=0,sn=I;Dn<sn.length;Dn+=1){var Zn=sn[Dn];if(Zn.length!==0){Zn!==I[0]&&yr.push(nr.length/2);for(var ln=0;ln<Zn.length;ln++){var Mi=Zn[ln];Hc(this.layoutVertexArray,Mi.x,Mi.y,0,0,1,1,0),nr.push(Mi.x),nr.push(Mi.y)}}}for(var qn=hc(nr,yr),Pn=0;Pn<qn.length;Pn+=3)this.indexArray.emplaceBack(Vr+qn[Pn],Vr+qn[Pn+2],Vr+qn[Pn+1]);j.primitiveLength+=qn.length/3,j.vertexLength+=D}}var Bi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,h)},pn("FillExtrusionBucket",nl,{omit:["layers","features"]});var Kh={paint:new Bo({"fill-extrusion-opacity":new In(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fc(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},bl=function(t){function o(u){t.call(this,u,Kh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new nl(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,g,b,S,I,D,N){var Z=gu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),j=this.paint.get("fill-extrusion-height").evaluate(h,g),$=this.paint.get("fill-extrusion-base").evaluate(h,g),re=function(O,He,Ne,rt){for(var mt=[],Bt=0,Zt=O;Bt<Zt.length;Bt+=1){var nr=Zt[Bt],yr=[nr.x,nr.y,0,1];zc(yr,yr,He),mt.push(new ce(yr[0]/yr[3],yr[1]/yr[3]))}return mt}(Z,N),Te=function(O,He,Ne,rt){for(var mt=[],Bt=[],Zt=rt[8]*He,nr=rt[9]*He,yr=rt[10]*He,Vr=rt[11]*He,Dn=rt[8]*Ne,sn=rt[9]*Ne,Zn=rt[10]*Ne,ln=rt[11]*Ne,Mi=0,qn=O;Mi<qn.length;Mi+=1){for(var Pn=[],Bi=[],bi=0,qi=qn[Mi];bi<qi.length;bi+=1){var jn=qi[bi],sa=jn.x,Ka=jn.y,$a=rt[0]*sa+rt[4]*Ka+rt[12],po=rt[1]*sa+rt[5]*Ka+rt[13],Qa=rt[2]*sa+rt[6]*Ka+rt[14],yo=rt[3]*sa+rt[7]*Ka+rt[15],Jo=Qa+yr,es=yo+Vr,Os=$a+Dn,cs=po+sn,ts=Qa+Zn,Io=yo+ln,oo=new ce(($a+Zt)/es,(po+nr)/es);oo.z=Jo/es,Pn.push(oo);var Hi=new ce(Os/Io,cs/Io);Hi.z=ts/Io,Bi.push(Hi)}mt.push(Pn),Bt.push(Bi)}return[mt,Bt]}(b,$,j,N);return function(O,He,Ne){var rt=1/0;Ls(Ne,He)&&(rt=Wc(Ne,He[0]));for(var mt=0;mt<He.length;mt++)for(var Bt=He[mt],Zt=O[mt],nr=0;nr<Bt.length-1;nr++){var yr=Bt[nr],Vr=[yr,Bt[nr+1],Zt[nr+1],Zt[nr],yr];Lu(Ne,Vr)&&(rt=Math.min(rt,Wc(Ne,Vr)))}return rt!==1/0&&rt}(Te[0],Te[1],re)},o}(Ru);function Pf(t,o){return t.x*o.x+t.y*o.y}function Wc(t,o){if(t.length===1){for(var u,h=0,g=o[h++];!u||g.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],I=u.sub(g),D=b.sub(g),N=S.sub(g),Z=Pf(I,I),j=Pf(I,D),$=Pf(D,D),re=Pf(N,I),Te=Pf(N,D),O=Z*$-j*j,He=($*re-j*Te)/O,Ne=(Z*Te-j*re)/O,rt=g.z*(1-He-Ne)+u.z*He+b.z*Ne;if(isFinite(rt))return rt}return 1/0}for(var mt=1/0,Bt=0,Zt=o;Bt<Zt.length;Bt+=1)mt=Math.min(mt,Zt[Bt].z);return mt}var Wl=da([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,If=da([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ph=Fu.VectorTileFeature.types,Ca=Math.cos(Math.PI/180*37.5),El=Math.pow(2,14)/.5,va=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new no,this.layoutVertexArray2=new Ws,this.indexArray=new ml,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};va.prototype.populate=function(t,o,u){this.hasPattern=Mf("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),g=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,N=I.id,Z=I.index,j=I.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,re=fo(D,$);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),re,u)){var Te=h?h.evaluate(re,{},u):void 0,O={id:N,properties:D.properties,type:D.type,sourceLayerIndex:j,index:Z,geometry:$?re.geometry:Ya(D),patterns:{},sortKey:Te};g.push(O)}}h&&g.sort(function(yr,Vr){return yr.sortKey-Vr.sortKey});for(var He=0,Ne=g;He<Ne.length;He+=1){var rt=Ne[He],mt=rt.geometry,Bt=rt.index,Zt=rt.sourceLayerIndex;if(this.hasPattern){var nr=jc("line",this.layers,rt,this.zoom,o);this.patternFeatures.push(nr)}else this.addFeature(rt,mt,Bt,u,{});o.featureIndex.insert(t[Bt].feature,mt,Bt,Zt,this.index)}},va.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},va.prototype.addFeatures=function(t,o,u){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var b=g[h];this.addFeature(b,b.geometry,b.index,o,u)}},va.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},va.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,If)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},va.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},va.prototype.addFeature=function(t,o,u,h,g){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),N=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,j=o;Z<j.length;Z+=1)this.addLine(j[Z],t,S,I,D,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,h)},va.prototype.addLine=function(t,o,u,h,g,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=ph[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var N=0;N<D-1&&t[N].equals(t[N+1]);)N++;if(!(D<(I?3:2))){u==="bevel"&&(g=1.05);var Z,j=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),re=void 0,Te=void 0,O=void 0,He=void 0;this.e1=this.e2=-1,I&&(He=t[N].sub(Z=t[D-2])._unit()._perp());for(var Ne=N;Ne<D;Ne++)if(!(Te=Ne===D-1?I?t[N+1]:void 0:t[Ne+1])||!t[Ne].equals(Te)){He&&(O=He),Z&&(re=Z),Z=t[Ne],He=Te?Te.sub(Z)._unit()._perp():O;var rt=(O=O||He).add(He);rt.x===0&&rt.y===0||rt._unit();var mt=O.x*He.x+O.y*He.y,Bt=rt.x*He.x+rt.y*He.y,Zt=Bt!==0?1/Bt:1/0,nr=2*Math.sqrt(2-2*Bt),yr=Bt<Ca&&re&&Te,Vr=O.x*He.y-O.y*He.x>0;if(yr&&Ne>N){var Dn=Z.dist(re);if(Dn>2*j){var sn=Z.sub(Z.sub(re)._mult(j/Dn)._round());this.updateDistance(re,sn),this.addCurrentVertex(sn,O,0,0,$),re=sn}}var Zn=re&&Te,ln=Zn?u:I?"butt":h;if(Zn&&ln==="round"&&(Zt<b?ln="miter":Zt<=2&&(ln="fakeround")),ln==="miter"&&Zt>g&&(ln="bevel"),ln==="bevel"&&(Zt>2&&(ln="flipbevel"),Zt<g&&(ln="miter")),re&&this.updateDistance(re,Z),ln==="miter")rt._mult(Zt),this.addCurrentVertex(Z,rt,0,0,$);else if(ln==="flipbevel"){if(Zt>100)rt=He.mult(-1);else{var Mi=Zt*O.add(He).mag()/O.sub(He).mag();rt._perp()._mult(Mi*(Vr?-1:1))}this.addCurrentVertex(Z,rt,0,0,$),this.addCurrentVertex(Z,rt.mult(-1),0,0,$)}else if(ln==="bevel"||ln==="fakeround"){var qn=-Math.sqrt(Zt*Zt-1),Pn=Vr?qn:0,Bi=Vr?0:qn;if(re&&this.addCurrentVertex(Z,O,Pn,Bi,$),ln==="fakeround")for(var bi=Math.round(180*nr/Math.PI/20),qi=1;qi<bi;qi++){var jn=qi/bi;if(jn!==.5){var sa=jn-.5;jn+=jn*sa*(jn-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*sa*sa+(.848013+mt*(.215638*mt-1.06021)))}var Ka=He.sub(O)._mult(jn)._add(O)._unit()._mult(Vr?-1:1);this.addHalfVertex(Z,Ka.x,Ka.y,!1,Vr,0,$)}Te&&this.addCurrentVertex(Z,He,-Pn,-Bi,$)}else if(ln==="butt")this.addCurrentVertex(Z,rt,0,0,$);else if(ln==="square"){var $a=re?1:-1;this.addCurrentVertex(Z,rt,$a,$a,$)}else ln==="round"&&(re&&(this.addCurrentVertex(Z,O,0,0,$),this.addCurrentVertex(Z,O,1,1,$,!0)),Te&&(this.addCurrentVertex(Z,He,-1,-1,$,!0),this.addCurrentVertex(Z,He,0,0,$)));if(yr&&Ne<D-1){var po=Z.dist(Te);if(po>2*j){var Qa=Z.add(Te.sub(Z)._mult(j/po)._round());this.updateDistance(Z,Qa),this.addCurrentVertex(Qa,He,0,0,$),Z=Qa}}}}},va.prototype.addCurrentVertex=function(t,o,u,h,g,b){b===void 0&&(b=!1);var S=o.y*h-o.x,I=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,g),this.addHalfVertex(t,S,I,b,!0,-h,g),this.distance>El/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,g,b))},va.prototype.addHalfVertex=function(t,o,u,h,g,b,S){var I=.5*(this.lineClips?this.scaledDistance*(El-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),g?this.e2=D:this.e1=D},va.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},va.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},pn("LineBucket",va,{omit:["layers","patternFeatures"]});var dc=new Bo({"line-cap":new In(oe.layout_line["line-cap"]),"line-join":new Cn(oe.layout_line["line-join"]),"line-miter-limit":new In(oe.layout_line["line-miter-limit"]),"line-round-limit":new In(oe.layout_line["line-round-limit"]),"line-sort-key":new Cn(oe.layout_line["line-sort-key"])}),So={paint:new Bo({"line-opacity":new Cn(oe.paint_line["line-opacity"]),"line-color":new Cn(oe.paint_line["line-color"]),"line-translate":new In(oe.paint_line["line-translate"]),"line-translate-anchor":new In(oe.paint_line["line-translate-anchor"]),"line-width":new Cn(oe.paint_line["line-width"]),"line-gap-width":new Cn(oe.paint_line["line-gap-width"]),"line-offset":new Cn(oe.paint_line["line-offset"]),"line-blur":new Cn(oe.paint_line["line-blur"]),"line-dasharray":new is(oe.paint_line["line-dasharray"]),"line-pattern":new Fc(oe.paint_line["line-pattern"]),"line-gradient":new ou(oe.paint_line["line-gradient"])}),layout:dc},Ks=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Si(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,g,b){return h=kt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,g,b)},o}(Cn))(So.paint.properties["line-width"].specification);Ks.useIntegerZoom=!0;var hh=function(t){function o(u){t.call(this,u,So),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof vs,this.gradientVersion=(this.gradientVersion+1)%tt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Ks.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new va(u)},o.prototype.queryRadius=function(u){var h=u,g=$h(mu("line-width",this,h),mu("line-gap-width",this,h)),b=mu("line-offset",this,h);return g/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,g,b,S,I,D){var N=gu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),Z=D/2*$h(this.paint.get("line-width").evaluate(h,g),this.paint.get("line-gap-width").evaluate(h,g)),j=this.paint.get("line-offset").evaluate(h,g);return j&&(b=function($,re){for(var Te=[],O=new ce(0,0),He=0;He<$.length;He++){for(var Ne=$[He],rt=[],mt=0;mt<Ne.length;mt++){var Bt=Ne[mt],Zt=Ne[mt+1],nr=mt===0?O:Bt.sub(Ne[mt-1])._unit()._perp(),yr=mt===Ne.length-1?O:Zt.sub(Bt)._unit()._perp(),Vr=nr._add(yr)._unit();Vr._mult(1/(Vr.x*yr.x+Vr.y*yr.y)),rt.push(Vr._mult(re)._add(Bt))}Te.push(rt)}return Te}(b,j*D)),function($,re,Te){for(var O=0;O<re.length;O++){var He=re[O];if($.length>=3){for(var Ne=0;Ne<He.length;Ne++)if(Ys($,He[Ne]))return!0}if(go($,He,Te))return!0}return!1}(N,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(Ru);function $h(t,o){return o>0?o+2*t:t}var zp=da([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Od=da([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rd=(da([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),da([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Bu=(da([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),da([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),up=da([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function lp(t,o,u){return t.sections.forEach(function(h){h.text=function(g,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?g=g.toLocaleUpperCase():I==="lowercase"&&(g=g.toLocaleLowerCase()),Ts.applyArabicShaping&&(g=Ts.applyArabicShaping(g)),g}(h.text,o,u)}),t}da([{name:"triangle",components:3,type:"Uint16"}]),da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),da([{type:"Float32",name:"offsetX"}]),da([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},fp=function(t,o,u,h,g){var b,S,I=8*g-h-1,D=(1<<I)-1,N=D>>1,Z=-7,j=u?g-1:0,$=u?-1:1,re=t[o+j];for(j+=$,b=re&(1<<-Z)-1,re>>=-Z,Z+=I;Z>0;b=256*b+t[o+j],j+=$,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=h;Z>0;S=256*S+t[o+j],j+=$,Z-=8);if(b===0)b=1-N;else{if(b===D)return S?NaN:1/0*(re?-1:1);S+=Math.pow(2,h),b-=N}return(re?-1:1)*S*Math.pow(2,b-h)},Up=function(t,o,u,h,g,b){var S,I,D,N=8*b-g-1,Z=(1<<N)-1,j=Z>>1,$=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=h?0:b-1,Te=h?1:-1,O=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+j>=1?$/D:$*Math.pow(2,1-j))*D>=2&&(S++,D/=2),S+j>=Z?(I=0,S=Z):S+j>=1?(I=(o*D-1)*Math.pow(2,g),S+=j):(I=o*Math.pow(2,j-1)*Math.pow(2,g),S=0));g>=8;t[u+re]=255&I,re+=Te,I/=256,g-=8);for(S=S<<g|I,N+=g;N>0;t[u+re]=255&S,re+=Te,S/=256,N-=8);t[u+re-Te]|=128*O},Xc=Aa;function Aa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Aa.Varint=0,Aa.Fixed64=1,Aa.Bytes=2,Aa.Fixed32=5;var dh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Xl(t){return t.type===Aa.Bytes?t.readVarint()+t.pos:t.pos+1}function Of(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function vh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var g=u.pos-1;g>=t;g--)u.buf[g+h]=u.buf[g]}function kd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function z(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function fe(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function De(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Ot(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function rr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Pt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Yt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function sr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function dr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function mr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Sr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Tr(t,o,u){t===1&&u.readMessage(Zr,o)}function Zr(t,o,u){if(t===3){var h=u.readMessage(vr,{}),g=h.width,b=h.height,S=h.left,I=h.top,D=h.advance;o.push({id:h.id,bitmap:new yu({width:g+6,height:b+6},h.bitmap),metrics:{width:g,height:b,left:S,top:I,advance:D}})}}function vr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Cr(t){for(var o=0,u=0,h=0,g=t;h<g.length;h+=1){var b=g[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(O,He){return He.h-O.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,N=0,Z=t;N<Z.length;N+=1)for(var j=Z[N],$=S.length-1;$>=0;$--){var re=S[$];if(!(j.w>re.w||j.h>re.h)){if(j.x=re.x,j.y=re.y,D=Math.max(D,j.y+j.h),I=Math.max(I,j.x+j.w),j.w===re.w&&j.h===re.h){var Te=S.pop();$<S.length&&(S[$]=Te)}else j.h===re.h?(re.x+=j.w,re.w-=j.w):j.w===re.w?(re.y+=j.h,re.h-=j.h):(S.push({x:re.x+j.w,y:re.y,w:re.w-j.w,h:j.h}),re.y+=j.h,re.h-=j.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}Aa.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),g=h>>3,b=this.pos;this.type=7&h,t(g,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=dr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*dr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*Sr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=fp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=fp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(g,b,S){var I,D,N=S.buf;if(I=(112&(D=N[S.pos++]))>>4,D<128||(I|=(127&(D=N[S.pos++]))<<3,D<128)||(I|=(127&(D=N[S.pos++]))<<10,D<128)||(I|=(127&(D=N[S.pos++]))<<17,D<128)||(I|=(127&(D=N[S.pos++]))<<24,D<128)||(I|=(1&(D=N[S.pos++]))<<31,D<128))return Of(g,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&dh?function(u,h,g){return dh.decode(u.subarray(h,g))}(this.buf,o,t):function(u,h,g){for(var b="",S=h;S<g;){var I,D,N,Z=u[S],j=null,$=Z>239?4:Z>223?3:Z>191?2:1;if(S+$>g)break;$===1?Z<128&&(j=Z):$===2?(192&(I=u[S+1]))==128&&(j=(31&Z)<<6|63&I)<=127&&(j=null):$===3?(D=u[S+2],(192&(I=u[S+1]))==128&&(192&D)==128&&((j=(15&Z)<<12|(63&I)<<6|63&D)<=2047||j>=55296&&j<=57343)&&(j=null)):$===4&&(D=u[S+2],N=u[S+3],(192&(I=u[S+1]))==128&&(192&D)==128&&(192&N)==128&&((j=(15&Z)<<18|(63&I)<<12|(63&D)<<6|63&N)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,$=1):j>65535&&(j-=65536,b+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),b+=String.fromCharCode(j),S+=$}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Aa.Bytes)return t.push(this.readVarint(o));var u=Xl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Aa.Bytes)return t.push(this.readSVarint());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Aa.Bytes)return t.push(this.readBoolean());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Aa.Bytes)return t.push(this.readFloat());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Aa.Bytes)return t.push(this.readDouble());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Aa.Bytes)return t.push(this.readFixed32());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Aa.Bytes)return t.push(this.readSFixed32());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Aa.Bytes)return t.push(this.readFixed64());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Aa.Bytes)return t.push(this.readSFixed64());var o=Xl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Aa.Varint)for(;this.buf[this.pos++]>127;);else if(o===Aa.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Aa.Fixed32)this.pos+=4;else{if(o!==Aa.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),mr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),mr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),mr(this.buf,-1&t,this.pos),mr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),mr(this.buf,-1&t,this.pos),mr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,g;if(o>=0?(h=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(g,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,g,b){for(var S,I,D=0;D<g.length;D++){if((S=g.charCodeAt(D))>55295&&S<57344){if(!I){S>56319||D+1===g.length?(h[b++]=239,h[b++]=191,h[b++]=189):I=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(h[b++]=239,h[b++]=191,h[b++]=189,I=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&vh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),Up(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Up(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&vh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Aa.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,kd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,z,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Ot,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,fe,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,De,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,rr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Pt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Yt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,sr,o)},writeBytesField:function(t,o){this.writeTag(t,Aa.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Aa.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Aa.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Aa.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Aa.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Aa.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Aa.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Aa.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Aa.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Aa.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var nt=function(t,o){var u=o.pixelRatio,h=o.version,g=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=g,this.stretchY=b,this.content=S,this.version=h},Ut={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ut.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ut.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ut.tlbr.get=function(){return this.tl.concat(this.br)},Ut.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(nt.prototype,Ut);var gr=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var g=[];this.addImages(t,u,g),this.addImages(o,h,g);var b=Cr(g),S=new zo({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],N=u[I].paddedRect;zo.copy(D.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},D.data)}for(var Z in o){var j=o[Z],$=h[Z].paddedRect,re=$.x+1,Te=$.y+1,O=j.data.width,He=j.data.height;zo.copy(j.data,S,{x:0,y:0},{x:re,y:Te},j.data),zo.copy(j.data,S,{x:0,y:He-1},{x:re,y:Te-1},{width:O,height:1}),zo.copy(j.data,S,{x:0,y:0},{x:re,y:Te+He},{width:O,height:1}),zo.copy(j.data,S,{x:O-1,y:0},{x:re-1,y:Te},{width:1,height:He}),zo.copy(j.data,S,{x:0,y:0},{x:re+O,y:Te},{width:1,height:He})}this.image=S,this.iconPositions=u,this.patternPositions=h};gr.prototype.addImages=function(t,o,u){for(var h in t){var g=t[h],b={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(b),o[h]=new nt(b,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},gr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},gr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},pn("ImagePosition",nt),pn("ImageAtlas",gr);var Fr={horizontal:1,vertical:2,horizontalOnly:3},or=function(){this.scale=1,this.fontStack="",this.imageName=null};or.forText=function(t,o){var u=new or;return u.scale=t||1,u.fontStack=o,u},or.forImage=function(t){var o=new or;return o.imageName=t,o};var Pr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Yr(t,o,u,h,g,b,S,I,D,N,Z,j,$,re,Te,O){var He,Ne=Pr.fromFeature(t,g);j===Fr.vertical&&Ne.verticalizePunctuation();var rt=Ts.processBidirectionalText,mt=Ts.processStyledBidirectionalText;if(rt&&Ne.sections.length===1){He=[];for(var Bt=0,Zt=rt(Ne.toString(),Xr(Ne,N,b,o,h,re,Te));Bt<Zt.length;Bt+=1){var nr=Zt[Bt],yr=new Pr;yr.text=nr,yr.sections=Ne.sections;for(var Vr=0;Vr<nr.length;Vr++)yr.sectionIndex.push(0);He.push(yr)}}else if(mt){He=[];for(var Dn=0,sn=mt(Ne.text,Ne.sectionIndex,Xr(Ne,N,b,o,h,re,Te));Dn<sn.length;Dn+=1){var Zn=sn[Dn],ln=new Pr;ln.text=Zn[0],ln.sectionIndex=Zn[1],ln.sections=Ne.sections,He.push(ln)}}else He=function(Pn,Bi){for(var bi=[],qi=Pn.text,jn=0,sa=0,Ka=Bi;sa<Ka.length;sa+=1){var $a=Ka[sa];bi.push(Pn.substring(jn,$a)),jn=$a}return jn<qi.length&&bi.push(Pn.substring(jn,qi.length)),bi}(Ne,Xr(Ne,N,b,o,h,re,Te));var Mi=[],qn={positionedLines:Mi,text:Ne.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(Pn,Bi,bi,qi,jn,sa,Ka,$a,po,Qa,yo,Jo){for(var es=0,Os=-17,cs=0,ts=0,Io=$a==="right"?1:$a==="left"?0:.5,oo=0,Hi=0,La=jn;Hi<La.length;Hi+=1){var ca=La[Hi];ca.trim();var $i=ca.getMaxScale(),Ns=24*($i-1),xs={positionedGlyphs:[],lineOffset:0};Pn.positionedLines[oo]=xs;var Za=xs.positionedGlyphs,Oo=0;if(ca.length()){for(var bs=0;bs<ca.length();bs++){var ia=ca.getSection(bs),Kc=ca.getSectionIndex(bs),Uu=ca.getCharCode(bs),mc=0,Ao=null,gc=null,al=null,hp=24,Rf=!(po===Fr.horizontal||!yo&&!df(Uu)||yo&&(Nn[Uu]||(_c=Uu,Ur.Arabic(_c)||Ur["Arabic Supplement"](_c)||Ur["Arabic Extended-A"](_c)||Ur["Arabic Presentation Forms-A"](_c)||Ur["Arabic Presentation Forms-B"](_c))));if(ia.imageName){var dp=qi[ia.imageName];if(!dp)continue;al=ia.imageName,Pn.iconsInText=Pn.iconsInText||!0,gc=dp.paddedRect;var yc=dp.displaySize;ia.scale=24*ia.scale/Jo,mc=Ns+(24-yc[1]*ia.scale),hp=(Ao={width:yc[0],height:yc[1],left:1,top:-3,advance:Rf?yc[1]:yc[0]}).advance;var vp=Rf?yc[0]*ia.scale-24*$i:yc[1]*ia.scale-24*$i;vp>0&&vp>Oo&&(Oo=vp)}else{var gh=bi[ia.fontStack],mp=gh&&gh[Uu];if(mp&&mp.rect)gc=mp.rect,Ao=mp.metrics;else{var jp=Bi[ia.fontStack],yh=jp&&jp[Uu];if(!yh)continue;Ao=yh.metrics}mc=24*($i-ia.scale)}Rf?(Pn.verticalizable=!0,Za.push({glyph:Uu,imageName:al,x:es,y:Os+mc,vertical:Rf,scale:ia.scale,fontStack:ia.fontStack,sectionIndex:Kc,metrics:Ao,rect:gc}),es+=hp*ia.scale+Qa):(Za.push({glyph:Uu,imageName:al,x:es,y:Os+mc,vertical:Rf,scale:ia.scale,fontStack:ia.fontStack,sectionIndex:Kc,metrics:Ao,rect:gc}),es+=Ao.advance*ia.scale+Qa)}Za.length!==0&&(cs=Math.max(es-Qa,cs),yi(Za,0,Za.length-1,Io,Oo)),es=0;var _h=sa*$i+Oo;xs.lineOffset=Math.max(Oo,Ns),Os+=_h,ts=Math.max(_h,ts),++oo}else Os+=sa,++oo}var _c,Vp=Os- -17,gp=qr(Ka),$c=gp.horizontalAlign,yp=gp.verticalAlign;(function(xh,Es,Gp,Hp,bh,Wp,Xp,Yp,Eh){var _p,Sh=(Es-Gp)*bh;_p=Wp!==Xp?-Yp*Hp- -17:(-Hp*Eh+.5)*Xp;for(var xp=0,qp=xh;xp<qp.length;xp+=1)for(var kf=0,Kp=qp[xp].positionedGlyphs;kf<Kp.length;kf+=1){var bp=Kp[kf];bp.x+=Sh,bp.y+=_p}})(Pn.positionedLines,Io,$c,yp,cs,ts,sa,Vp,jn.length),Pn.top+=-yp*Vp,Pn.bottom=Pn.top+Vp,Pn.left+=-$c*cs,Pn.right=Pn.left+cs}(qn,o,u,h,He,S,I,D,j,N,$,O),!function(Pn){for(var Bi=0,bi=Pn;Bi<bi.length;Bi+=1)if(bi[Bi].positionedGlyphs.length!==0)return!1;return!0}(Mi)&&qn}Pr.fromFeature=function(t,o){for(var u=new Pr,h=0;h<t.sections.length;h++){var g=t.sections[h];g.image?u.addImageSection(g):u.addTextSection(g,o)}return u},Pr.prototype.length=function(){return this.text.length},Pr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Pr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Pr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Pr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,g=t.charCodeAt(u-1)||null;o+=h&&pl(h)&&!cp[t[u+1]]||g&&pl(g)&&!cp[t[u-1]]||!cp[t[u]]?t[u]:cp[t[u]]}return o}(this.text)},Pr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Nn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Nn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Pr.prototype.substring=function(t,o){var u=new Pr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Pr.prototype.toString=function(){return this.text},Pr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Pr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(or.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Pr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(or.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},Pr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Nn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qt={};function Qt(t,o,u,h,g,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+g:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+g:0}function hn(t,o,u,h){var g=Math.pow(t-o,2);return h?t<o?g/2:2*g:g+Math.abs(u)*u}function Wr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function br(t,o,u,h,g,b){for(var S=null,I=hn(o,u,g,b),D=0,N=h;D<N.length;D+=1){var Z=N[D],j=hn(o-Z.x,u,g,b)+Z.badness;j<=I&&(S=Z,I=j)}return{index:t,x:o,priorBreak:S,badness:I}}function Xr(t,o,u,h,g,b,S){if(b!=="point")return[];if(!t)return[];for(var I,D=[],N=function(He,Ne,rt,mt,Bt,Zt){for(var nr=0,yr=0;yr<He.length();yr++){var Vr=He.getSection(yr);nr+=Qt(He.getCharCode(yr),Vr,mt,Bt,Ne,Zt)}return nr/Math.max(1,Math.ceil(nr/rt))}(t,o,u,h,g,S),Z=t.text.indexOf("\u200B")>=0,j=0,$=0;$<t.length();$++){var re=t.getSection($),Te=t.getCharCode($);if(Nn[Te]||(j+=Qt(Te,re,h,g,o,S)),$<t.length()-1){var O=!((I=Te)<11904||!(Ur["Bopomofo Extended"](I)||Ur.Bopomofo(I)||Ur["CJK Compatibility Forms"](I)||Ur["CJK Compatibility Ideographs"](I)||Ur["CJK Compatibility"](I)||Ur["CJK Radicals Supplement"](I)||Ur["CJK Strokes"](I)||Ur["CJK Symbols and Punctuation"](I)||Ur["CJK Unified Ideographs Extension A"](I)||Ur["CJK Unified Ideographs"](I)||Ur["Enclosed CJK Letters and Months"](I)||Ur["Halfwidth and Fullwidth Forms"](I)||Ur.Hiragana(I)||Ur["Ideographic Description Characters"](I)||Ur["Kangxi Radicals"](I)||Ur["Katakana Phonetic Extensions"](I)||Ur.Katakana(I)||Ur["Vertical Forms"](I)||Ur["Yi Radicals"](I)||Ur["Yi Syllables"](I)));(qt[Te]||O||re.imageName)&&D.push(br($+1,j,N,D,Wr(Te,t.getCharCode($+1),O&&Z),!1))}}return function He(Ne){return Ne?He(Ne.priorBreak).concat(Ne.index):[]}(br(t.length(),j,N,D,0,!0))}function qr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function yi(t,o,u,h,g){if(h||g)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,I=o;I<=u;I++)t[I].x-=S,t[I].y+=g}function Jn(t,o,u,h,g,b){var S,I=t.image;if(I.content){var D=I.content,N=I.pixelRatio||1;S=[D[0]/N,D[1]/N,I.displaySize[0]-D[2]/N,I.displaySize[1]-D[3]/N]}var Z,j,$,re,Te=o.left*b,O=o.right*b;u==="width"||u==="both"?(re=g[0]+Te-h[3],j=g[0]+O+h[1]):j=(re=g[0]+(Te+O-I.displaySize[0])/2)+I.displaySize[0];var He=o.top*b,Ne=o.bottom*b;return u==="height"||u==="both"?(Z=g[1]+He-h[0],$=g[1]+Ne+h[2]):$=(Z=g[1]+(He+Ne-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:Z,right:j,bottom:$,left:re,collisionPadding:S}}qt[10]=!0,qt[32]=!0,qt[38]=!0,qt[40]=!0,qt[41]=!0,qt[43]=!0,qt[45]=!0,qt[47]=!0,qt[173]=!0,qt[183]=!0,qt[8203]=!0,qt[8208]=!0,qt[8211]=!0,qt[8231]=!0;var jr=function(t){function o(u,h,g,b){t.call(this,u,h),this.angle=g,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ce);function Jr(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Si(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,g=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var I=h[b],D=h[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:g}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new Si(I)),maxSize:u.evaluate(new Si(D)),interpolationType:g}}function Kn(t,o,u){var h=o.uSize,g=u.lowerSize;return t.kind==="source"?g/128:t.kind==="composite"?ha(g/128,u.upperSize/128,o.uSizeT):h}function si(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var g=t.interpolationType,b=g?Jt(me.interpolationFactor(g,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ha(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}pn("Anchor",jr);var Fi=Object.freeze({__proto__:null,getSizeData:Jr,evaluateSizeForFeature:Kn,evaluateSizeForZoom:si,SIZE_PACK_FACTOR:128});function qa(t,o,u,h,g){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var D=[],N=0;I<u/2;){var Z=t[S],j=t[S+1];if(!j)return!1;var $=t[S-1].angleTo(Z)-Z.angleTo(j);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:$}),N+=$;I-D[0].distance>h;)N-=D.shift().angleDelta;if(N>g)return!1;S++,I+=Z.dist(j)}return!0}function io(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Ri(t,o,u){return t?.6*o*u:0}function Yo(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function za(t,o,u,h,g,b){for(var S=Ri(u,g,b),I=Yo(u,h)*b,D=0,N=io(t)/2,Z=0;Z<t.length-1;Z++){var j=t[Z],$=t[Z+1],re=j.dist($);if(D+re>N){var Te=(N-D)/re,O=ha(j.x,$.x,Te),He=ha(j.y,$.y,Te),Ne=new jr(O,He,$.angleTo(j),Z);return Ne._round(),!S||qa(t,Ne,I,S,o)?Ne:void 0}D+=re}}function qo(t,o,u,h,g,b,S,I,D){var N=Ri(h,b,S),Z=Yo(h,g),j=Z*S,$=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-j<o/4&&(o=j+o/4),function re(Te,O,He,Ne,rt,mt,Bt,Zt,nr){for(var yr=mt/2,Vr=io(Te),Dn=0,sn=O-He,Zn=[],ln=0;ln<Te.length-1;ln++){for(var Mi=Te[ln],qn=Te[ln+1],Pn=Mi.dist(qn),Bi=qn.angleTo(Mi);sn+He<Dn+Pn;){var bi=((sn+=He)-Dn)/Pn,qi=ha(Mi.x,qn.x,bi),jn=ha(Mi.y,qn.y,bi);if(qi>=0&&qi<nr&&jn>=0&&jn<nr&&sn-yr>=0&&sn+yr<=Vr){var sa=new jr(qi,jn,Bi,ln);sa._round(),Ne&&!qa(Te,sa,mt,Ne,rt)||Zn.push(sa)}}Dn+=Pn}return Zt||Zn.length||Bt||(Zn=re(Te,Dn/2,He,Ne,rt,mt,Bt,!0,nr)),Zn}(t,$?o/2*I%o:(Z/2+2*b)*S*I%o,o,N,u,j,$,!1,D)}function Co(t,o,u,h,g){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],D=void 0,N=0;N<I.length-1;N++){var Z=I[N],j=I[N+1];Z.x<o&&j.x<o||(Z.x<o?Z=new ce(o,Z.y+(o-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round():j.x<o&&(j=new ce(o,Z.y+(o-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round()),Z.y<u&&j.y<u||(Z.y<u?Z=new ce(Z.x+(u-Z.y)/(j.y-Z.y)*(j.x-Z.x),u)._round():j.y<u&&(j=new ce(Z.x+(u-Z.y)/(j.y-Z.y)*(j.x-Z.x),u)._round()),Z.x>=h&&j.x>=h||(Z.x>=h?Z=new ce(h,Z.y+(h-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round():j.x>=h&&(j=new ce(h,Z.y+(h-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round()),Z.y>=g&&j.y>=g||(Z.y>=g?Z=new ce(Z.x+(g-Z.y)/(j.y-Z.y)*(j.x-Z.x),g)._round():j.y>=g&&(j=new ce(Z.x+(g-Z.y)/(j.y-Z.y)*(j.x-Z.x),g)._round()),D&&Z.equals(D[D.length-1])||b.push(D=[Z]),D.push(j)))))}return b}function Uo(t,o,u,h){var g=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,N=t.right-t.left,Z=t.bottom-t.top,j=b.stretchX||[[0,I]],$=b.stretchY||[[0,D]],re=function(qi,jn){return qi+jn[1]-jn[0]},Te=j.reduce(re,0),O=$.reduce(re,0),He=I-Te,Ne=D-O,rt=0,mt=Te,Bt=0,Zt=O,nr=0,yr=He,Vr=0,Dn=Ne;if(b.content&&h){var sn=b.content;rt=Zo(j,0,sn[0]),Bt=Zo($,0,sn[1]),mt=Zo(j,sn[0],sn[2]),Zt=Zo($,sn[1],sn[3]),nr=sn[0]-rt,Vr=sn[1]-Bt,yr=sn[2]-sn[0]-mt,Dn=sn[3]-sn[1]-Zt}var Zn=function(qi,jn,sa,Ka){var $a=ao(qi.stretch-rt,mt,N,t.left),po=hi(qi.fixed-nr,yr,qi.stretch,Te),Qa=ao(jn.stretch-Bt,Zt,Z,t.top),yo=hi(jn.fixed-Vr,Dn,jn.stretch,O),Jo=ao(sa.stretch-rt,mt,N,t.left),es=hi(sa.fixed-nr,yr,sa.stretch,Te),Os=ao(Ka.stretch-Bt,Zt,Z,t.top),cs=hi(Ka.fixed-Vr,Dn,Ka.stretch,O),ts=new ce($a,Qa),Io=new ce(Jo,Qa),oo=new ce(Jo,Os),Hi=new ce($a,Os),La=new ce(po/S,yo/S),ca=new ce(es/S,cs/S),$i=o*Math.PI/180;if($i){var Ns=Math.sin($i),xs=Math.cos($i),Za=[xs,-Ns,Ns,xs];ts._matMult(Za),Io._matMult(Za),Hi._matMult(Za),oo._matMult(Za)}var Oo=qi.stretch+qi.fixed,bs=jn.stretch+jn.fixed;return{tl:ts,tr:Io,bl:Hi,br:oo,tex:{x:b.paddedRect.x+1+Oo,y:b.paddedRect.y+1+bs,w:sa.stretch+sa.fixed-Oo,h:Ka.stretch+Ka.fixed-bs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:La,pixelOffsetBR:ca,minFontScaleX:yr/S/N,minFontScaleY:Dn/S/Z,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var ln=ss(j,He,Te),Mi=ss($,Ne,O),qn=0;qn<ln.length-1;qn++)for(var Pn=ln[qn],Bi=ln[qn+1],bi=0;bi<Mi.length-1;bi++)g.push(Zn(Pn,Mi[bi],Bi,Mi[bi+1]));else g.push(Zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return g}function Zo(t,o,u){for(var h=0,g=0,b=t;g<b.length;g+=1){var S=b[g];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function ss(t,o,u){for(var h=[{fixed:-1,stretch:0}],g=0,b=t;g<b.length;g+=1){var S=b[g],I=S[0],D=S[1],N=h[h.length-1];h.push({fixed:I-N.stretch,stretch:N.stretch}),h.push({fixed:I-N.stretch,stretch:N.stretch+(D-I)})}return h.push({fixed:o+1,stretch:u}),h}function ao(t,o,u,h){return t/o*u+h}function hi(t,o,u,h){return t-o*u/h}var Po=function(t,o,u,h,g,b,S,I,D,N){if(this.boxStartIndex=t.length,D){var Z=b.top,j=b.bottom,$=b.collisionPadding;$&&(Z-=$[1],j+=$[3]);var re=j-Z;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{var Te=b.top*S-I,O=b.bottom*S+I,He=b.left*S-I,Ne=b.right*S+I,rt=b.collisionPadding;if(rt&&(He-=rt[0]*S,Te-=rt[1]*S,Ne+=rt[2]*S,O+=rt[3]*S),N){var mt=new ce(He,Te),Bt=new ce(Ne,Te),Zt=new ce(He,O),nr=new ce(Ne,O),yr=N*Math.PI/180;mt._rotate(yr),Bt._rotate(yr),Zt._rotate(yr),nr._rotate(yr),He=Math.min(mt.x,Bt.x,Zt.x,nr.x),Ne=Math.max(mt.x,Bt.x,Zt.x,nr.x),Te=Math.min(mt.y,Bt.y,Zt.y,nr.y),O=Math.max(mt.y,Bt.y,Zt.y,nr.y)}t.emplaceBack(o.x,o.y,He,Te,Ne,O,u,h,g)}this.boxEndIndex=t.length},Xi=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=Qo),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function Qo(t,o){return t<o?-1:t>o?1:0}function ei(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,g=1/0,b=-1/0,S=-1/0,I=t[0],D=0;D<I.length;D++){var N=I[D];(!D||N.x<h)&&(h=N.x),(!D||N.y<g)&&(g=N.y),(!D||N.x>b)&&(b=N.x),(!D||N.y>S)&&(S=N.y)}var Z=Math.min(b-h,S-g),j=Z/2,$=new Xi([],ki);if(Z===0)return new ce(h,g);for(var re=h;re<b;re+=Z)for(var Te=g;Te<S;Te+=Z)$.push(new xn(re+j,Te+j,j,t));for(var O=function(rt){for(var mt=0,Bt=0,Zt=0,nr=rt[0],yr=0,Vr=nr.length,Dn=Vr-1;yr<Vr;Dn=yr++){var sn=nr[yr],Zn=nr[Dn],ln=sn.x*Zn.y-Zn.x*sn.y;Bt+=(sn.x+Zn.x)*ln,Zt+=(sn.y+Zn.y)*ln,mt+=3*ln}return new xn(Bt/mt,Zt/mt,0,rt)}(t),He=$.length;$.length;){var Ne=$.pop();(Ne.d>O.d||!O.d)&&(O=Ne,u&&console.log("found best %d after %d probes",Math.round(1e4*Ne.d)/1e4,He)),Ne.max-O.d<=o||($.push(new xn(Ne.p.x-(j=Ne.h/2),Ne.p.y-j,j,t)),$.push(new xn(Ne.p.x+j,Ne.p.y-j,j,t)),$.push(new xn(Ne.p.x-j,Ne.p.y+j,j,t)),$.push(new xn(Ne.p.x+j,Ne.p.y+j,j,t)),He+=4)}return u&&(console.log("num probes: "+He),console.log("best distance: "+O.d)),O.p}function ki(t,o){return o.max-t.max}function xn(t,o,u,h){this.p=new ce(t,o),this.h=u,this.d=function(g,b){for(var S=!1,I=1/0,D=0;D<b.length;D++)for(var N=b[D],Z=0,j=N.length,$=j-1;Z<j;$=Z++){var re=N[Z],Te=N[$];re.y>g.y!=Te.y>g.y&&g.x<(Te.x-re.x)*(g.y-re.y)/(Te.y-re.y)+re.x&&(S=!S),I=Math.min(I,yl(g,re,Te))}return(S?1:-1)*Math.sqrt(I)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}Xi.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Xi.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},Xi.prototype.peek=function(){return this.data[0]},Xi.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var g=t-1>>1,b=o[g];if(u(h,b)>=0)break;o[t]=b,t=g}o[t]=h},Xi.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,g=o[t];t<h;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,g)>=0)break;o[t]=S,t=b}o[t]=g};var Ln=Number.POSITIVE_INFINITY;function il(t,o){return o[1]!==Ln?function(u,h,g){var b=0,S=0;switch(h=Math.abs(h),g=Math.abs(g),u){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var g=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=h;break;case"right":g=-h}return[g,b]}(t,o[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(t,o,u,h,g,b,S,I,D,N,Z,j,$,re,Te){var O=function(Bt,Zt,nr,yr,Vr,Dn,sn,Zn){for(var ln=yr.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,Mi=[],qn=0,Pn=Zt.positionedLines;qn<Pn.length;qn+=1)for(var Bi=Pn[qn],bi=0,qi=Bi.positionedGlyphs;bi<qi.length;bi+=1){var jn=qi[bi];if(jn.rect){var sa=jn.rect||{},Ka=4,$a=!0,po=1,Qa=0,yo=(Vr||Zn)&&jn.vertical,Jo=jn.metrics.advance*jn.scale/2;if(Zn&&Zt.verticalizable&&(Qa=Bi.lineOffset/2-(jn.imageName?-(24-jn.metrics.width*jn.scale)/2:24*(jn.scale-1))),jn.imageName){var es=sn[jn.imageName];$a=es.sdf,Ka=1/(po=es.pixelRatio)}var Os=Vr?[jn.x+Jo,jn.y]:[0,0],cs=Vr?[0,0]:[jn.x+Jo+nr[0],jn.y+nr[1]-Qa],ts=[0,0];yo&&(ts=cs,cs=[0,0]);var Io=(jn.metrics.left-Ka)*jn.scale-Jo+cs[0],oo=(-jn.metrics.top-Ka)*jn.scale+cs[1],Hi=Io+sa.w*jn.scale/po,La=oo+sa.h*jn.scale/po,ca=new ce(Io,oo),$i=new ce(Hi,oo),Ns=new ce(Io,La),xs=new ce(Hi,La);if(yo){var Za=new ce(-Jo,Jo- -17),Oo=-Math.PI/2,bs=12-Jo,ia=new ce(22-bs,-(jn.imageName?bs:0)),Kc=new(Function.prototype.bind.apply(ce,[null].concat(ts)));ca._rotateAround(Oo,Za)._add(ia)._add(Kc),$i._rotateAround(Oo,Za)._add(ia)._add(Kc),Ns._rotateAround(Oo,Za)._add(ia)._add(Kc),xs._rotateAround(Oo,Za)._add(ia)._add(Kc)}if(ln){var Uu=Math.sin(ln),mc=Math.cos(ln),Ao=[mc,-Uu,Uu,mc];ca._matMult(Ao),$i._matMult(Ao),Ns._matMult(Ao),xs._matMult(Ao)}var gc=new ce(0,0),al=new ce(0,0);Mi.push({tl:ca,tr:$i,bl:Ns,br:xs,tex:sa,writingMode:Zt.writingMode,glyphOffset:Os,sectionIndex:jn.sectionIndex,isSDF:$a,pixelOffsetTL:gc,pixelOffsetBR:al,minFontScaleX:0,minFontScaleY:0})}}return Mi}(0,u,I,g,b,S,h,t.allowVerticalPlacement),He=t.textSizeData,Ne=null;He.kind==="source"?(Ne=[128*g.layout.get("text-size").evaluate(S,{})])[0]>32640&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):He.kind==="composite"&&((Ne=[128*re.compositeTextSizes[0].evaluate(S,{},Te),128*re.compositeTextSizes[1].evaluate(S,{},Te)])[0]>32640||Ne[1]>32640)&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,O,Ne,I,b,S,N,o,D.lineStartIndex,D.lineLength,$,Te);for(var rt=0,mt=Z;rt<mt.length;rt+=1)j[mt[rt]]=t.text.placedSymbolArray.length-1;return 4*O.length}function gt(t){for(var o in t)return t[o];return null}function dn(t,o,u,h){var g=t.compareText;if(o in g){for(var b=g[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else g[o]=[];return g[o].push(h),!1}var Ui=Fu.VectorTileFeature.types,xe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ie(t,o,u,h,g,b,S,I,D,N,Z,j,$){var re=I?Math.min(32640,Math.round(I[0])):0,Te=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*g),b,S,(re<<1)+(D?1:0),Te,16*N,16*Z,256*j,256*$)}function Ze(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function it(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(vf(u[o].text))return!0;return!1}var wt=function(t){this.layoutVertexArray=new vl,this.indexArray=new ml,this.programConfigurations=t,this.segments=new se,this.dynamicLayoutVertexArray=new ku,this.opacityVertexArray=new zl,this.placedSymbolArray=new d};wt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},wt.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Od.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,xe,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},wt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},pn("SymbolBuffers",wt);var Xe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new se,this.collisionVertexArray=new Yf};Xe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Rd.members,!0)},Xe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},pn("CollisionBuffers",Xe);var Le=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Is([]),this.placementViewportMatrix=Is([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jr(this.zoom,o["text-size"]),this.iconSizeData=Jr(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Fr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Le.prototype.createArrays=function(){this.text=new wt(new Gn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new wt(new Gn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},Le.prototype.calculateGlyphDependencies=function(t,o,u,h,g){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&g){var S=cp[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Le.prototype.populate=function(t,o,u){var h=this.layers[0],g=h.layout,b=g.get("text-font"),S=g.get("text-field"),I=g.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof _t&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=g.get("symbol-sort-key");if(this.features=[],D||N){for(var j=o.iconDependencies,$=o.glyphDependencies,re=o.availableImages,Te=new Si(this.zoom),O=0,He=t;O<He.length;O+=1){var Ne=He[O],rt=Ne.feature,mt=Ne.id,Bt=Ne.index,Zt=Ne.sourceLayerIndex,nr=h._featureFilter.needGeometry,yr=fo(rt,nr);if(h._featureFilter.filter(Te,yr,u)){nr||(yr.geometry=Ya(rt));var Vr=void 0;if(D){var Dn=h.getValueAndResolveTokens("text-field",yr,u,re),sn=_t.factory(Dn);it(sn)&&(this.hasRTLText=!0),(!this.hasRTLText||mf()==="unavailable"||this.hasRTLText&&Ts.isParsed())&&(Vr=lp(sn,h,yr))}var Zn=void 0;if(N){var ln=h.getValueAndResolveTokens("icon-image",yr,u,re);Zn=ln instanceof ea?ln:ea.fromString(ln)}if(Vr||Zn){var Mi=this.sortFeaturesByKey?Z.evaluate(yr,{},u):void 0;if(this.features.push({id:mt,text:Vr,icon:Zn,index:Bt,sourceLayerIndex:Zt,geometry:yr.geometry,properties:rt.properties,type:Ui[rt.type],sortKey:Mi}),Zn&&(j[Zn.name]=!0),Vr){var qn=b.evaluate(yr,{},u).join(","),Pn=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fr.vertical)>=0;for(var Bi=0,bi=Vr.sections;Bi<bi.length;Bi+=1){var qi=bi[Bi];if(qi.image)j[qi.image.name]=!0;else{var jn=uc(Vr.toString()),sa=qi.fontStack||qn,Ka=$[sa]=$[sa]||{};this.calculateGlyphDependencies(qi.text,Ka,Pn,this.allowVerticalPlacement,jn)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function($a){var po={},Qa={},yo=[],Jo=0;function es(Za){yo.push($a[Za]),Jo++}function Os(Za,Oo,bs){var ia=Qa[Za];return delete Qa[Za],Qa[Oo]=ia,yo[ia].geometry[0].pop(),yo[ia].geometry[0]=yo[ia].geometry[0].concat(bs[0]),ia}function cs(Za,Oo,bs){var ia=po[Oo];return delete po[Oo],po[Za]=ia,yo[ia].geometry[0].shift(),yo[ia].geometry[0]=bs[0].concat(yo[ia].geometry[0]),ia}function ts(Za,Oo,bs){var ia=bs?Oo[0][Oo[0].length-1]:Oo[0][0];return Za+":"+ia.x+":"+ia.y}for(var Io=0;Io<$a.length;Io++){var oo=$a[Io],Hi=oo.geometry,La=oo.text?oo.text.toString():null;if(La){var ca=ts(La,Hi),$i=ts(La,Hi,!0);if(ca in Qa&&$i in po&&Qa[ca]!==po[$i]){var Ns=cs(ca,$i,Hi),xs=Os(ca,$i,yo[Ns].geometry);delete po[ca],delete Qa[$i],Qa[ts(La,yo[xs].geometry,!0)]=xs,yo[Ns].geometry=null}else ca in Qa?Os(ca,$i,Hi):$i in po?cs(ca,$i,Hi):(es(Io),po[ca]=Jo-1,Qa[$i]=Jo-1)}else es(Io)}return yo.filter(function(Za){return Za.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function($a,po){return $a.sortKey-po.sortKey})}},Le.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Le.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Le.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Le.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Le.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Le.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Le.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),g=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:g},I>0&&(g+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var N=b[D];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Le.prototype.addSymbols=function(t,o,u,h,g,b,S,I,D,N,Z,j){for(var $=t.indexArray,re=t.layoutVertexArray,Te=t.segments.prepareSegment(4*o.length,re,$,this.canOverlap?b.sortKey:void 0),O=this.glyphOffsetArray.length,He=Te.vertexLength,Ne=this.allowVerticalPlacement&&S===Fr.vertical?Math.PI/2:0,rt=b.text&&b.text.sections,mt=0;mt<o.length;mt++){var Bt=o[mt],Zt=Bt.tl,nr=Bt.tr,yr=Bt.bl,Vr=Bt.br,Dn=Bt.tex,sn=Bt.pixelOffsetTL,Zn=Bt.pixelOffsetBR,ln=Bt.minFontScaleX,Mi=Bt.minFontScaleY,qn=Bt.glyphOffset,Pn=Bt.isSDF,Bi=Bt.sectionIndex,bi=Te.vertexLength,qi=qn[1];ie(re,I.x,I.y,Zt.x,qi+Zt.y,Dn.x,Dn.y,u,Pn,sn.x,sn.y,ln,Mi),ie(re,I.x,I.y,nr.x,qi+nr.y,Dn.x+Dn.w,Dn.y,u,Pn,Zn.x,sn.y,ln,Mi),ie(re,I.x,I.y,yr.x,qi+yr.y,Dn.x,Dn.y+Dn.h,u,Pn,sn.x,Zn.y,ln,Mi),ie(re,I.x,I.y,Vr.x,qi+Vr.y,Dn.x+Dn.w,Dn.y+Dn.h,u,Pn,Zn.x,Zn.y,ln,Mi),Ze(t.dynamicLayoutVertexArray,I,Ne),$.emplaceBack(bi,bi+1,bi+2),$.emplaceBack(bi+1,bi+2,bi+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qn[0]),mt!==o.length-1&&Bi===o[mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(re.length,b,b.index,{},j,rt&&rt[Bi])}t.placedSymbolArray.emplaceBack(I.x,I.y,O,this.glyphOffsetArray.length-O,He,D,N,I.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},Le.prototype._addCollisionDebugVertex=function(t,o,u,h,g,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,g,Math.round(b.x),Math.round(b.y))},Le.prototype.addCollisionDebugVertices=function(t,o,u,h,g,b,S){var I=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),D=I.vertexLength,N=g.layoutVertexArray,Z=g.collisionVertexArray,j=S.anchorX,$=S.anchorY;this._addCollisionDebugVertex(N,Z,b,j,$,new ce(t,o)),this._addCollisionDebugVertex(N,Z,b,j,$,new ce(u,o)),this._addCollisionDebugVertex(N,Z,b,j,$,new ce(u,h)),this._addCollisionDebugVertex(N,Z,b,j,$,new ce(t,h)),I.vertexLength+=4;var re=g.indexArray;re.emplaceBack(D,D+1),re.emplaceBack(D+1,D+2),re.emplaceBack(D+2,D+3),re.emplaceBack(D+3,D),I.primitiveLength+=4},Le.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var g=t;g<o;g++){var b=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Le.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xe(su,Bu.members,Bc),this.iconCollisionBox=new Xe(su,Bu.members,Bc);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Le.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,g,b,S,I,D){for(var N={},Z=o;Z<u;Z++){var j=t.get(Z);N.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},N.textFeatureIndex=j.featureIndex;break}for(var $=h;$<g;$++){var re=t.get($);N.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},N.verticalTextFeatureIndex=re.featureIndex;break}for(var Te=b;Te<S;Te++){var O=t.get(Te);N.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},N.iconFeatureIndex=O.featureIndex;break}for(var He=I;He<D;He++){var Ne=t.get(He);N.verticalIconBox={x1:Ne.x1,y1:Ne.y1,x2:Ne.x2,y2:Ne.y2,anchorPointX:Ne.anchorPointX,anchorPointY:Ne.anchorPointY},N.verticalIconFeatureIndex=Ne.featureIndex;break}return N},Le.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Le.prototype.hasTextData=function(){return this.text.segments.get().length>0},Le.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Le.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Le.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Le.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Le.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,g=u.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)},Le.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],g=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);h.push(0|Math.round(o*I.anchorX+u*I.anchorY)),g.push(I.featureIndex)}return b.sort(function(D,N){return h[D]-h[N]||g[N]-g[D]}),b},Le.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Le.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var g=this.symbolInstances.get(h[u]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},pn("SymbolBucket",Le,{omit:["layers","collisionBoxArray","features","compareText"]}),Le.MAX_GLYPHS=65535,Le.addDynamicAttributes=Ze;var Je=new Bo({"symbol-placement":new In(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new In(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new In(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(oe.layout_symbol["icon-size"]),"icon-text-fit":new In(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(oe.layout_symbol["icon-image"]),"icon-rotate":new Cn(oe.layout_symbol["icon-rotate"]),"icon-padding":new In(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new In(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(oe.layout_symbol["icon-offset"]),"icon-anchor":new Cn(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(oe.layout_symbol["text-field"]),"text-font":new Cn(oe.layout_symbol["text-font"]),"text-size":new Cn(oe.layout_symbol["text-size"]),"text-max-width":new Cn(oe.layout_symbol["text-max-width"]),"text-line-height":new In(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(oe.layout_symbol["text-justify"]),"text-radial-offset":new Cn(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(oe.layout_symbol["text-anchor"]),"text-max-angle":new In(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new In(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(oe.layout_symbol["text-rotate"]),"text-padding":new In(oe.layout_symbol["text-padding"]),"text-keep-upright":new In(oe.layout_symbol["text-keep-upright"]),"text-transform":new Cn(oe.layout_symbol["text-transform"]),"text-offset":new Cn(oe.layout_symbol["text-offset"]),"text-allow-overlap":new In(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new In(oe.layout_symbol["text-ignore-placement"]),"text-optional":new In(oe.layout_symbol["text-optional"])}),ve={paint:new Bo({"icon-opacity":new Cn(oe.paint_symbol["icon-opacity"]),"icon-color":new Cn(oe.paint_symbol["icon-color"]),"icon-halo-color":new Cn(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new In(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(oe.paint_symbol["text-opacity"]),"text-color":new Cn(oe.paint_symbol["text-color"],{runtimeType:Hr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Cn(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(oe.paint_symbol["text-halo-blur"]),"text-translate":new In(oe.paint_symbol["text-translate"]),"text-translate-anchor":new In(oe.paint_symbol["text-translate-anchor"])}),layout:Je},ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:un,this.defaultValue=t};ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){return null},pn("FormatSectionOverride",ze,{omit:["defaultValue"]});var Se=function(t){function o(u){t.call(this,u,ve)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var b=[],S=0,I=g;S<I.length;S+=1){var D=I[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,g,b){var S=this.layout.get(u).evaluate(h,{},g,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||tc(I.value)||!S?S:function(D,N){return N.replace(/{([^{}]+)}/g,function(Z,j){return j in D?String(D[j]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new Le(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=ve.paint.overridableProperties;u<h.length;u+=1){var g=h[u];if(o.hasPaintOverride(this.layout,g)){var b,S=this.paint.get(g),I=new ze(S),D=new Oc(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Ol("source",D):new fl("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[g]=new _s(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,g){return!(!this.layout||h.isDataDriven()||g.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var g=u.get("text-field"),b=ve.paint.properties[h],S=!1,I=function(Z){for(var j=0,$=Z;j<$.length;j+=1)if(b.overrides&&b.overrides.hasOverride($[j]))return void(S=!0)};if(g.value.kind==="constant"&&g.value.value instanceof _t)I(g.value.value.sections);else if(g.value.kind==="source"){var D=function(Z){S||(Z instanceof Fa&&Ki(Z.value)===Zi?I(Z.value.sections):Z instanceof wo?I(Z.sections):Z.eachChild(D))},N=g.value;N._styleExpression&&D(N._styleExpression.expression)}return S},o}(Ru),at={paint:new Bo({"background-color":new In(oe.paint_background["background-color"]),"background-pattern":new is(oe.paint_background["background-pattern"]),"background-opacity":new In(oe.paint_background["background-opacity"])})},yt=function(t){function o(u){t.call(this,u,at)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ru),lr={paint:new Bo({"raster-opacity":new In(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new In(oe.paint_raster["raster-saturation"]),"raster-contrast":new In(oe.paint_raster["raster-contrast"]),"raster-resampling":new In(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new In(oe.paint_raster["raster-fade-duration"])})},Br=function(t){function o(u){t.call(this,u,lr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ru),Nr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Ru),en={circle:bf,heatmap:Lp,hillshade:pc,fill:ip,"fill-extrusion":bl,line:hh,symbol:Se,background:yt,raster:Br},kr=_e.HTMLImageElement,An=_e.HTMLCanvasElement,on=_e.HTMLVideoElement,bn=_e.ImageData,fn=_e.ImageBitmap,vn=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};vn.prototype.update=function(t,o,u){var h=t.width,g=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===g||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,g],t instanceof kr||t instanceof An||t instanceof on||t instanceof bn||fn&&t instanceof fn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,h,g,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},N=D.x,Z=D.y;t instanceof kr||t instanceof An||t instanceof on||t instanceof bn||fn&&t instanceof fn?I.texSubImage2D(I.TEXTURE_2D,0,N,Z,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,N,Z,h,g,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},vn.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},vn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},vn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var $n=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};$n.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},$n.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ba=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ir(["receive","process"],this),this.invoker=new $n(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Gr()?t:_e};function us(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}ba.prototype.send=function(t,o,u,h,g){var b=this;g===void 0&&(g=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Ce(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:Gs(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},ba.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Gr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},ba.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},ba.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(ws(o.error)):h(null,ws(o.data)))}else{var g=!1,b=Ce(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,j){g=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?Gs(Z):null,data:Gs(j,b)},b)}:function(Z){g=!0},I=null,D=ws(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var N=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,N[0],D.source)[N[1]](D,S)}else S(new Error("Could not find function "+o.type));!g&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},ba.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ua=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ua.prototype.setNorthEast=function(t){return this._ne=t instanceof ma?new ma(t.lng,t.lat):ma.convert(t),this},Ua.prototype.setSouthWest=function(t){return this._sw=t instanceof ma?new ma(t.lng,t.lat):ma.convert(t),this},Ua.prototype.extend=function(t){var o,u,h=this._sw,g=this._ne;if(t instanceof ma)o=t,u=t;else{if(!(t instanceof Ua))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ua.convert(t)):this.extend(ma.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||g?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),g.lng=Math.max(u.lng,g.lng),g.lat=Math.max(u.lat,g.lat)):(this._sw=new ma(o.lng,o.lat),this._ne=new ma(u.lng,u.lat)),this},Ua.prototype.getCenter=function(){return new ma((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ua.prototype.getSouthWest=function(){return this._sw},Ua.prototype.getNorthEast=function(){return this._ne},Ua.prototype.getNorthWest=function(){return new ma(this.getWest(),this.getNorth())},Ua.prototype.getSouthEast=function(){return new ma(this.getEast(),this.getSouth())},Ua.prototype.getWest=function(){return this._sw.lng},Ua.prototype.getSouth=function(){return this._sw.lat},Ua.prototype.getEast=function(){return this._ne.lng},Ua.prototype.getNorth=function(){return this._ne.lat},Ua.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ua.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ua.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ua.prototype.contains=function(t){var o=ma.convert(t),u=o.lng,h=o.lat,g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g},Ua.convert=function(t){return!t||t instanceof Ua?t:new Ua(t)};var ma=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ma.prototype.wrap=function(){return new ma(ur(this.lng,-180,180),this.lat)},ma.prototype.toArray=function(){return[this.lng,this.lat]},ma.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ma.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(g,1))},ma.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Ua(new ma(this.lng-u,this.lat-o),new ma(this.lng+u,this.lat+o))},ma.convert=function(t){if(t instanceof ma)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ma(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ma(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Yl=2*Math.PI*63710088e-1;function Fs(t){return Yl*Math.cos(t*Math.PI/180)}function Sl(t){return(180+t)/360}function Nu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Qh(t,o){return t/Fs(o)}function zu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Yc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};Yc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ma.convert(t);return new Yc(Sl(u.lng),Nu(u.lat),Qh(o,u.lat))},Yc.prototype.toLngLat=function(){return new ma(360*this.x-180,zu(this.y))},Yc.prototype.toAltitude=function(){return this.z*Fs(zu(this.y))},Yc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Yl*(t=zu(this.y),1/Math.cos(t*Math.PI/180));var t};var qc=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Zp(0,t,t,o,u)};qc.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},qc.prototype.url=function(t,o){var u,h,g,b,S,I=(h=this.y,g=this.z,b=us(256*(u=this.x),256*(h=Math.pow(2,g)-h-1),g),S=us(256*(u+1),256*(h+1),g),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(N,Z,j){for(var $,re="",Te=N;Te>0;Te--)re+=(Z&($=1<<Te-1)?1:0)+(j&$?2:0);return re}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},qc.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new ce(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},qc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var vv=function(t,o){this.wrap=t,this.canonical=o,this.key=Zp(t,o.z,o.z,o.x,o.y)},jo=function(t,o,u,h,g){this.overscaledZ=t,this.wrap=o,this.canonical=new qc(u,+h,+g),this.key=Zp(o,t,u,h,g)};function Zp(t,o,u,h,g){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*g+h).toString(36)+u.toString(36)+o.toString(36)}jo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},jo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new jo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},jo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Zp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Zp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},jo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},jo.prototype.children=function(t){if(this.overscaledZ>=t)return[new jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new jo(o,this.wrap,o,u,h),new jo(o,this.wrap,o,u+1,h),new jo(o,this.wrap,o,u,h+1),new jo(o,this.wrap,o,u+1,h+1)]},jo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},jo.prototype.wrapped=function(){return new jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},jo.prototype.unwrapTo=function(t){return new jo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},jo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},jo.prototype.toUnwrapped=function(){return new vv(this.wrap,this.canonical)},jo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},jo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Yc(t.x-this.wrap,t.y))},pn("CanonicalTileID",qc),pn("OverscaledTileID",jo,{omit:["posMatrix"]});var lu=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Qe('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var g=0;g<h;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(h,g)]=this.data[this._idx(h-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,h)]=this.data[this._idx(g,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};lu.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},lu.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},lu.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},lu.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},lu.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},lu.prototype.getPixels=function(){return new zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},lu.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,g=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,D=-u*this.dim,N=b;N<S;N++)for(var Z=h;Z<g;Z++)this.data[this._idx(Z,N)]=t.data[this._idx(Z+I,N+D)]},pn("DEMData",lu);var vc=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};vc.prototype.encode=function(t){return this._stringToNumber[t]},vc.prototype.decode=function(t){return this._numberToString[t]};var mh=function(t,o,u,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=g},Jh={geometry:{configurable:!0}};Jh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Jh.geometry.set=function(t){this._geometry=t},mh.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(mh.prototype,Jh);var pp=function(){this.state={},this.stateChanges={},this.deletedStates={}};pp.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},kt(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var g in this.deletedStates[t]={},this.state[t])g!==h&&(this.deletedStates[t][g]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},pp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},pp.prototype.getState=function(t,o){var u=String(o),h=kt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var g=this.deletedStates[t][o];if(g===null)return{};for(var b in g)delete h[b]}return h},pp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},pp.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var g={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),kt(this.state[h][b],this.stateChanges[h][b]),g[b]=this.state[h][b];u[h]=g}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var D in this.state[S])I[D]={},this.state[S][D]={};else for(var N in this.deletedStates[S]){if(this.deletedStates[S][N]===null)this.state[S][N]={};else for(var Z=0,j=Object.keys(this.deletedStates[S][N]);Z<j.length;Z+=1)delete this.state[S][N][j[Z]];I[N]=this.state[S][N]}u[S]=u[S]||{},kt(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var $ in t)t[$].setFeatureState(u,o)};var ql=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Mu(8192,16,0),this.grid3D=new Mu(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function Ld(t,o,u,h,g){return Wt(t,function(b,S){var I=o instanceof pu?o.get(S):null;return I&&I.evaluate?I.evaluate(u,h,g):I})}function mv(t){for(var o=1/0,u=1/0,h=-1/0,g=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),h=Math.max(h,I.x),g=Math.max(g,I.y)}return{minX:o,minY:u,maxX:h,maxY:g}}function b0(t,o){return o-t}ql.prototype.insert=function(t,o,u,h,g,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var N=o[D],Z=[1/0,1/0,-1/0,-1/0],j=0;j<N.length;j++){var $=N[j];Z[0]=Math.min(Z[0],$.x),Z[1]=Math.min(Z[1],$.y),Z[2]=Math.max(Z[2],$.x),Z[3]=Math.max(Z[3],$.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&I.insert(S,Z[0],Z[1],Z[2],Z[3])}},ql.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Fu.VectorTile(new Xc(this.rawTileData)).layers,this.sourceLayerCoder=new vc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ql.prototype.query=function(t,o,u,h){var g=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=kl(b.filter),D=t.queryGeometry,N=t.queryPadding*S,Z=mv(D),j=this.grid.query(Z.minX-N,Z.minY-N,Z.maxX+N,Z.maxY+N),$=mv(t.cameraQueryGeometry),re=this.grid3D.query($.minX-N,$.minY-N,$.maxX+N,$.maxY+N,function(Bt,Zt,nr,yr){return function(Vr,Dn,sn,Zn,ln){for(var Mi=0,qn=Vr;Mi<qn.length;Mi+=1){var Pn=qn[Mi];if(Dn<=Pn.x&&sn<=Pn.y&&Zn>=Pn.x&&ln>=Pn.y)return!0}var Bi=[new ce(Dn,sn),new ce(Dn,ln),new ce(Zn,ln),new ce(Zn,sn)];if(Vr.length>2){for(var bi=0,qi=Bi;bi<qi.length;bi+=1)if(Ys(Vr,qi[bi]))return!0}for(var jn=0;jn<Vr.length-1;jn++)if(jl(Vr[jn],Vr[jn+1],Bi))return!0;return!1}(t.cameraQueryGeometry,Bt-N,Zt-N,nr+N,yr+N)}),Te=0,O=re;Te<O.length;Te+=1)j.push(O[Te]);j.sort(b0);for(var He,Ne={},rt=function(Bt){var Zt=j[Bt];if(Zt!==He){He=Zt;var nr=g.featureIndexArray.get(Zt),yr=null;g.loadMatchingFeature(Ne,nr.bucketIndex,nr.sourceLayerIndex,nr.featureIndex,I,b.layers,b.availableImages,o,u,h,function(Vr,Dn,sn){return yr||(yr=Ya(Vr)),Dn.queryIntersectsFeature(D,Vr,sn,yr,g.z,t.transform,S,t.pixelPosMatrix)})}},mt=0;mt<j.length;mt++)rt(mt);return Ne},ql.prototype.loadMatchingFeature=function(t,o,u,h,g,b,S,I,D,N,Z){var j=this.bucketLayerIDs[o];if(!b||function(Vr,Dn){for(var sn=0;sn<Vr.length;sn++)if(Dn.indexOf(Vr[sn])>=0)return!0;return!1}(b,j)){var $=this.sourceLayerCoder.decode(u),re=this.vtLayers[$].feature(h);if(g.needGeometry){var Te=fo(re,!0);if(!g.filter(new Si(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!g.filter(new Si(this.tileID.overscaledZ),re))return;for(var O=this.getId(re,$),He=0;He<j.length;He++){var Ne=j[He];if(!(b&&b.indexOf(Ne)<0)){var rt=I[Ne];if(rt){var mt={};O!==void 0&&N&&(mt=N.getState(rt.sourceLayer||"_geojsonTileLayer",O));var Bt=kt({},D[Ne]);Bt.paint=Ld(Bt.paint,rt.paint,re,mt,S),Bt.layout=Ld(Bt.layout,rt.layout,re,mt,S);var Zt=!Z||Z(re,rt,mt);if(Zt){var nr=new mh(re,this.z,this.x,this.y,O);nr.layer=Bt;var yr=t[Ne];yr===void 0&&(yr=t[Ne]=[]),yr.push({featureIndex:h,feature:nr,intersectionZ:Zt})}}}}}},ql.prototype.lookupSymbolFeatures=function(t,o,u,h,g,b,S,I){var D={};this.loadVTLayers();for(var N=kl(g),Z=0,j=t;Z<j.length;Z+=1)this.loadMatchingFeature(D,u,h,j[Z],N,b,S,I,o);return D},ql.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,g=u[o];h<g.length;h+=1)if(t===g[h])return!0;return!1},ql.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},pn("FeatureIndex",ql,{omit:["rawTileData","sourceLayerCoder"]});var ls=function(t,o){this.tileID=t,this.uid=jt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ls.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<di.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ls.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ls.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(N,Z){var j={};if(!Z)return j;for(var $=function(){var O=Te[re],He=O.layerIds.map(function(mt){return Z.getLayer(mt)}).filter(Boolean);if(He.length!==0){O.layers=He,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map(function(mt){return He.filter(function(Bt){return Bt.id===mt})[0]}));for(var Ne=0,rt=He;Ne<rt.length;Ne+=1)j[rt[Ne].id]=O}},re=0,Te=N;re<Te.length;re+=1)$();return j}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[h];if(g instanceof Le){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Le&&S.hasRTLText){this.hasRTLText=!0,Ts.isLoading()||Ts.isLoaded()||mf()!=="deferred"||iu();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},ls.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ls.prototype.getBucket=function(t){return this.buckets[t.id]},ls.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},ls.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ls.prototype.queryRenderedFeatures=function(t,o,u,h,g,b,S,I,D,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:b,tileSize:this.tileSize,pixelPosMatrix:N,transform:I,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},ls.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),g=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[g];if(b)for(var S=kl(o&&o.filter),I=this.tileID.canonical,D=I.z,N=I.x,Z=I.y,j={z:D,x:N,y:Z},$=0;$<b.length;$++){var re=b.feature($);if(S.needGeometry){var Te=fo(re,!0);if(!S.filter(new Si(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!S.filter(new Si(this.tileID.overscaledZ),re))continue;var O=u.getId(re,g),He=new mh(re,D,N,Z,O);He.tile=j,t.push(He)}}},ls.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ls.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ls.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Qr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),g=!1;if(this.expirationTime>h)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ls.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ls.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var g=this.buckets[h],b=g.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){g.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(h);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}}},ls.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ls.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<di.now()},ls.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ls.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=di.now()+t},ls.prototype.setDependencies=function(t,o){for(var u={},h=0,g=o;h<g.length;h+=1)u[g[h]]=!0;this.dependencies[t]=u},ls.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var g=this.dependencies[h[u]];if(g){for(var b=0,S=o;b<S.length;b+=1)if(g[S[b]])return!0}}return!1};var Cl=_e.performance,Bs=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Cl.mark(this._marks.start)};Bs.prototype.finish=function(){Cl.mark(this._marks.end);var t=Cl.getEntriesByName(this._marks.measure);return t.length===0&&(Cl.measure(this._marks.measure,this._marks.start,this._marks.end),t=Cl.getEntriesByName(this._marks.measure),Cl.clearMarks(this._marks.start),Cl.clearMarks(this._marks.end),Cl.clearMeasures(this._marks.measure)),t},m.Actor=ba,m.AlphaImage=yu,m.CanonicalTileID=qc,m.CollisionBoxArray=f,m.Color=Di,m.DEMData=lu,m.DataConstantProperty=In,m.DictionaryCoder=vc,m.EXTENT=8192,m.ErrorEvent=Ve,m.EvaluationParameters=Si,m.Event=Me,m.Evented=$e,m.FeatureIndex=ql,m.FillBucket=Ds,m.FillExtrusionBucket=nl,m.ImageAtlas=gr,m.ImagePosition=nt,m.LineBucket=va,m.LngLat=ma,m.LngLatBounds=Ua,m.MercatorCoordinate=Yc,m.ONE_EM=24,m.OverscaledTileID=jo,m.Point=ce,m.Point$1=ce,m.Properties=Bo,m.Protobuf=Xc,m.RGBAImage=zo,m.RequestManager=Wi,m.RequestPerformance=Bs,m.ResourceType=En,m.SegmentVector=se,m.SourceFeatureState=pp,m.StructArrayLayout1ui2=xf,m.StructArrayLayout2f1f2i16=du,m.StructArrayLayout2i4=$u,m.StructArrayLayout3ui6=ml,m.StructArrayLayout4i8=hu,m.SymbolBucket=Le,m.Texture=vn,m.Tile=ls,m.Transitionable=Xo,m.Uniform1f=xr,m.Uniform1i=fr,m.Uniform2f=Or,m.Uniform3f=an,m.Uniform4f=Un,m.UniformColor=On,m.UniformMatrix4f=Ti,m.UnwrappedTileID=vv,m.ValidationError=Re,m.WritingMode=Fr,m.ZoomHistory=hf,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ze,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,g=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(D,N){D&&(b=D),g[I]=N,--h==0&&u(b,g)})})},m.bezier=pt,m.bindAll=ir,m.browser=di,m.cacheEntryPossiblyAdded=function(t){++xi>Ir&&(t.getActor().send("enforceCacheSizeLimit",$t),xi=0)},m.clamp=Jt,m.clearTileCache=function(t){var o=_e.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=Co,m.clone=function(t){var o=new na(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=qe,m.clone$2=function(t){var o=new na(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=up,m.config=Hn,m.create=function(){var t=new na(16);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new na(9);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new na(4);return na!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=Oe,m.createExpression=rc,m.createLayout=da,m.createStyleLayer=function(t){return t.type==="custom"?new Nr(t):new en[t.type](t)},m.cross=function(t,o,u){var h=o[0],g=o[1],b=o[2],S=u[0],I=u[1],D=u[2];return t[0]=g*D-b*I,t[1]=b*S-h*D,t[2]=h*I-g*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var g in o)if(!t(o[g],u[g]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=Et,m.emitValidationErrors=Dc,m.endsWith=Y,m.enforceCacheSizeLimit=function(t){nn(),Ji&&Ji.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},m.evaluateSizeForFeature=Kn,m.evaluateSizeForZoom=si,m.evaluateVariableOffset=il,m.evented=Xf,m.extend=kt,m.featureFilter=kl,m.filterObject=ut,m.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=qr,m.getAnchorJustification=we,m.getArrayBuffer=Da,m.getImage=q,m.getJSON=function(t,o){return Go(kt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=mf,m.getReferrer=Pi,m.getVideo=function(t,o){var u,h,g=_e.document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(var b=0;b<t.length;b++){var S=_e.document.createElement("source");u=t[b],h=void 0,(h=_e.document.createElement("a")).href=u,(h.protocol!==_e.document.location.protocol||h.host!==_e.document.location.host)&&(g.crossOrigin="Anonymous"),S.src=t[b],g.appendChild(S)}return{cancel:function(){}}},m.identity=Is,m.invert=function(t,o){var u=o[0],h=o[1],g=o[2],b=o[3],S=o[4],I=o[5],D=o[6],N=o[7],Z=o[8],j=o[9],$=o[10],re=o[11],Te=o[12],O=o[13],He=o[14],Ne=o[15],rt=u*I-h*S,mt=u*D-g*S,Bt=u*N-b*S,Zt=h*D-g*I,nr=h*N-b*I,yr=g*N-b*D,Vr=Z*O-j*Te,Dn=Z*He-$*Te,sn=Z*Ne-re*Te,Zn=j*He-$*O,ln=j*Ne-re*O,Mi=$*Ne-re*He,qn=rt*Mi-mt*ln+Bt*Zn+Zt*sn-nr*Dn+yr*Vr;return qn?(t[0]=(I*Mi-D*ln+N*Zn)*(qn=1/qn),t[1]=(g*ln-h*Mi-b*Zn)*qn,t[2]=(O*yr-He*nr+Ne*Zt)*qn,t[3]=($*nr-j*yr-re*Zt)*qn,t[4]=(D*sn-S*Mi-N*Dn)*qn,t[5]=(u*Mi-g*sn+b*Dn)*qn,t[6]=(He*Bt-Te*yr-Ne*mt)*qn,t[7]=(Z*yr-$*Bt+re*mt)*qn,t[8]=(S*ln-I*sn+N*Vr)*qn,t[9]=(h*sn-u*ln-b*Vr)*qn,t[10]=(Te*nr-O*Bt+Ne*rt)*qn,t[11]=(j*Bt-Z*nr-re*rt)*qn,t[12]=(I*Dn-S*Zn-D*Vr)*qn,t[13]=(u*Zn-h*Dn+g*Vr)*qn,t[14]=(O*mt-Te*Zt-He*rt)*qn,t[15]=(Z*Zt-j*mt+$*rt)*qn,t):null},m.isChar=Ur,m.isMapboxURL=Li,m.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},m.makeRequest=Go,m.mapObject=Wt,m.mercatorXfromLng=Sl,m.mercatorYfromLat=Nu,m.mercatorZfromAltitude=Qh,m.mul=Nc,m.multiply=No,m.mvt=Fu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],h=o[1],g=o[2],b=u*u+h*h+g*g;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=ha,m.offscreenCanvasSupported=fi,m.ortho=function(t,o,u,h,g,b,S){var I=1/(o-u),D=1/(h-g),N=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*N,t[11]=0,t[12]=(o+u)*I,t[13]=(g+h)*D,t[14]=(S+b)*N,t[15]=1,t},m.parseGlyphPBF=function(t){return new Xc(t).readFields(Tr,[])},m.pbf=Xc,m.performSymbolLayout=function(t,o,u,h,g,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,N={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,j=Z.maxZoom;N.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Si(Z.minZoom),S),D["text-size"].possiblyEvaluate(new Si(j),S)]}if(t.iconSizeData.kind==="composite"){var $=t.iconSizeData,re=$.maxZoom;N.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Si($.minZoom),S),D["icon-size"].possiblyEvaluate(new Si(re),S)]}N.layoutTextSize=D["text-size"].possiblyEvaluate(new Si(t.zoom+1),S),N.layoutIconSize=D["icon-size"].possiblyEvaluate(new Si(t.zoom+1),S),N.textMaxSize=D["text-size"].possiblyEvaluate(new Si(18));for(var Te=24*I.get("text-line-height"),O=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",He=I.get("text-keep-upright"),Ne=I.get("text-size"),rt=function(){var Zt=Bt[mt],nr=I.get("text-font").evaluate(Zt,{},S).join(","),yr=Ne.evaluate(Zt,{},S),Vr=N.layoutTextSize.evaluate(Zt,{},S),Dn=N.layoutIconSize.evaluate(Zt,{},S),sn={horizontal:{},vertical:void 0},Zn=Zt.text,ln=[0,0];if(Zn){var Mi=Zn.toString(),qn=24*I.get("text-letter-spacing").evaluate(Zt,{},S),Pn=function(Hi){for(var La=0,ca=Hi;La<ca.length;La+=1)if($i=ca[La].charCodeAt(0),Ur.Arabic($i)||Ur["Arabic Supplement"]($i)||Ur["Arabic Extended-A"]($i)||Ur["Arabic Presentation Forms-A"]($i)||Ur["Arabic Presentation Forms-B"]($i))return!1;var $i;return!0}(Mi)?qn:0,Bi=I.get("text-anchor").evaluate(Zt,{},S),bi=I.get("text-variable-anchor");if(!bi){var qi=I.get("text-radial-offset").evaluate(Zt,{},S);ln=qi?il(Bi,[24*qi,Ln]):I.get("text-offset").evaluate(Zt,{},S).map(function(Hi){return 24*Hi})}var jn=O?"center":I.get("text-justify").evaluate(Zt,{},S),sa=I.get("symbol-placement"),Ka=sa==="point"?24*I.get("text-max-width").evaluate(Zt,{},S):0,$a=function(){t.allowVerticalPlacement&&uc(Mi)&&(sn.vertical=Yr(Zn,o,u,g,nr,Ka,Te,Bi,"left",Pn,ln,Fr.vertical,!0,sa,Vr,yr))};if(!O&&bi){for(var po=jn==="auto"?bi.map(function(Hi){return we(Hi)}):[jn],Qa=!1,yo=0;yo<po.length;yo++){var Jo=po[yo];if(!sn.horizontal[Jo])if(Qa)sn.horizontal[Jo]=sn.horizontal[0];else{var es=Yr(Zn,o,u,g,nr,Ka,Te,"center",Jo,Pn,ln,Fr.horizontal,!1,sa,Vr,yr);es&&(sn.horizontal[Jo]=es,Qa=es.positionedLines.length===1)}}$a()}else{jn==="auto"&&(jn=we(Bi));var Os=Yr(Zn,o,u,g,nr,Ka,Te,Bi,jn,Pn,ln,Fr.horizontal,!1,sa,Vr,yr);Os&&(sn.horizontal[jn]=Os),$a(),uc(Mi)&&O&&He&&(sn.vertical=Yr(Zn,o,u,g,nr,Ka,Te,Bi,jn,Pn,ln,Fr.vertical,!1,sa,Vr,yr))}}var cs=void 0,ts=!1;if(Zt.icon&&Zt.icon.name){var Io=h[Zt.icon.name];Io&&(cs=function(Hi,La,ca){var $i=qr(ca),Ns=La[0]-Hi.displaySize[0]*$i.horizontalAlign,xs=La[1]-Hi.displaySize[1]*$i.verticalAlign;return{image:Hi,top:xs,bottom:xs+Hi.displaySize[1],left:Ns,right:Ns+Hi.displaySize[0]}}(g[Zt.icon.name],I.get("icon-offset").evaluate(Zt,{},S),I.get("icon-anchor").evaluate(Zt,{},S)),ts=Io.sdf,t.sdfIcons===void 0?t.sdfIcons=Io.sdf:t.sdfIcons!==Io.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Io.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var oo=gt(sn.horizontal)||sn.vertical;t.iconsInText=!!oo&&oo.iconsInText,(oo||cs)&&function(Hi,La,ca,$i,Ns,xs,Za,Oo,bs,ia,Kc){var Uu=xs.textMaxSize.evaluate(La,{});Uu===void 0&&(Uu=Za);var mc,Ao=Hi.layers[0].layout,gc=Ao.get("icon-offset").evaluate(La,{},Kc),al=gt(ca.horizontal),hp=Za/24,Rf=Hi.tilePixelRatio*hp,dp=Hi.tilePixelRatio*Uu/24,yc=Hi.tilePixelRatio*Oo,vp=Hi.tilePixelRatio*Ao.get("symbol-spacing"),gh=Ao.get("text-padding")*Hi.tilePixelRatio,mp=Ao.get("icon-padding")*Hi.tilePixelRatio,jp=Ao.get("text-max-angle")/180*Math.PI,yh=Ao.get("text-rotation-alignment")==="map"&&Ao.get("symbol-placement")!=="point",_h=Ao.get("icon-rotation-alignment")==="map"&&Ao.get("symbol-placement")!=="point",_c=Ao.get("symbol-placement"),Vp=vp/2,gp=Ao.get("icon-text-fit");$i&&gp!=="none"&&(Hi.allowVerticalPlacement&&ca.vertical&&(mc=Jn($i,ca.vertical,gp,Ao.get("icon-text-fit-padding"),gc,hp)),al&&($i=Jn($i,al,gp,Ao.get("icon-text-fit-padding"),gc,hp)));var $c=function(_v,Ch){Ch.x<0||Ch.x>=8192||Ch.y<0||Ch.y>=8192||function(Ro,Al,xv,Qc,td,$p,Ah,xc,rd,wh,nd,id,Bd,bv,Th,Ev,Sv,Cv,Av,wv,Zu,ad,Tv,bc,od){var Jc,Lf,Ep,ef,Sp,Cp=Ro.addToLineVertexArray(Al,xv),Mv=0,Pv=0,Iv=0,Nd=0,sd=-1,ud=-1,Kl={},zd=Ae(""),Ud=0,Zd=0;if(xc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ud=(Jc=xc.layout.get("text-offset").evaluate(Zu,{},bc).map(function(Qp){return 24*Qp}))[0],Zd=Jc[1]):(Ud=24*xc.layout.get("text-radial-offset").evaluate(Zu,{},bc),Zd=Ln),Ro.allowVerticalPlacement&&Qc.vertical){var jd=xc.layout.get("text-rotate").evaluate(Zu,{},bc)+90;ef=new Po(rd,Al,wh,nd,id,Qc.vertical,Bd,bv,Th,jd),Ah&&(Sp=new Po(rd,Al,wh,nd,id,Ah,Sv,Cv,Th,jd))}if(td){var Vd=xc.layout.get("icon-rotate").evaluate(Zu,{}),Gd=xc.layout.get("icon-text-fit")!=="none",Hd=Uo(td,Vd,Tv,Gd),ld=Ah?Uo(Ah,Vd,Tv,Gd):void 0;Ep=new Po(rd,Al,wh,nd,id,td,Sv,Cv,!1,Vd),Mv=4*Hd.length;var Wd=Ro.iconSizeData,Mh=null;Wd.kind==="source"?(Mh=[128*xc.layout.get("icon-size").evaluate(Zu,{})])[0]>32640&&Qe(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Wd.kind==="composite"&&((Mh=[128*ad.compositeIconSizes[0].evaluate(Zu,{},bc),128*ad.compositeIconSizes[1].evaluate(Zu,{},bc)])[0]>32640||Mh[1]>32640)&&Qe(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ro.addSymbols(Ro.icon,Hd,Mh,wv,Av,Zu,!1,Al,Cp.lineStartIndex,Cp.lineLength,-1,bc),sd=Ro.icon.placedSymbolArray.length-1,ld&&(Pv=4*ld.length,Ro.addSymbols(Ro.icon,ld,Mh,wv,Av,Zu,Fr.vertical,Al,Cp.lineStartIndex,Cp.lineLength,-1,bc),ud=Ro.icon.placedSymbolArray.length-1)}for(var Ov in Qc.horizontal){var cd=Qc.horizontal[Ov];if(!Lf){zd=Ae(cd.text);var E0=xc.layout.get("text-rotate").evaluate(Zu,{},bc);Lf=new Po(rd,Al,wh,nd,id,cd,Bd,bv,Th,E0)}var Rv=cd.positionedLines.length===1;if(Iv+=Dt(Ro,Al,cd,$p,xc,Th,Zu,Ev,Cp,Qc.vertical?Fr.horizontal:Fr.horizontalOnly,Rv?Object.keys(Qc.horizontal):[Ov],Kl,sd,ad,bc),Rv)break}Qc.vertical&&(Nd+=Dt(Ro,Al,Qc.vertical,$p,xc,Th,Zu,Ev,Cp,Fr.vertical,["vertical"],Kl,ud,ad,bc));var S0=Lf?Lf.boxStartIndex:Ro.collisionBoxArray.length,C0=Lf?Lf.boxEndIndex:Ro.collisionBoxArray.length,kv=ef?ef.boxStartIndex:Ro.collisionBoxArray.length,Lv=ef?ef.boxEndIndex:Ro.collisionBoxArray.length,Dv=Ep?Ep.boxStartIndex:Ro.collisionBoxArray.length,Xd=Ep?Ep.boxEndIndex:Ro.collisionBoxArray.length,Fv=Sp?Sp.boxStartIndex:Ro.collisionBoxArray.length,Bv=Sp?Sp.boxEndIndex:Ro.collisionBoxArray.length,ju=-1,fd=function(Qp,Yd){return Qp&&Qp.circleDiameter?Math.max(Qp.circleDiameter,Yd):Yd};ju=fd(Lf,ju),ju=fd(ef,ju),ju=fd(Ep,ju);var Ec=(ju=fd(Sp,ju))>-1?1:0;Ec&&(ju*=od/24),Ro.glyphOffsetArray.length>=Le.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zu.sortKey!==void 0&&Ro.addToSortKeyRanges(Ro.symbolInstances.length,Zu.sortKey),Ro.symbolInstances.emplaceBack(Al.x,Al.y,Kl.right>=0?Kl.right:-1,Kl.center>=0?Kl.center:-1,Kl.left>=0?Kl.left:-1,Kl.vertical||-1,sd,ud,zd,S0,C0,kv,Lv,Dv,Xd,Fv,Bv,wh,Iv,Nd,Mv,Pv,Ec,0,Bd,Ud,Zd,ju)}(Hi,Ch,_v,ca,$i,Ns,mc,Hi.layers[0],Hi.collisionBoxArray,La.index,La.sourceLayerIndex,Hi.index,Rf,gh,yh,bs,yc,mp,_h,gc,La,xs,ia,Kc,Za)};if(_c==="line")for(var yp=0,xh=Co(La.geometry,0,0,8192,8192);yp<xh.length;yp+=1)for(var Es=xh[yp],Gp=0,Hp=qo(Es,vp,jp,ca.vertical||al,$i,24,dp,Hi.overscaling,8192);Gp<Hp.length;Gp+=1){var bh=Hp[Gp];al&&dn(Hi,al.text,Vp,bh)||$c(Es,bh)}else if(_c==="line-center")for(var Wp=0,Xp=La.geometry;Wp<Xp.length;Wp+=1){var Yp=Xp[Wp];if(Yp.length>1){var Eh=za(Yp,jp,ca.vertical||al,$i,24,dp);Eh&&$c(Yp,Eh)}}else if(La.type==="Polygon")for(var _p=0,Sh=Tf(La.geometry,0);_p<Sh.length;_p+=1){var xp=Sh[_p],qp=ei(xp,16);$c(xp[0],new jr(qp.x,qp.y,0))}else if(La.type==="LineString")for(var kf=0,Kp=La.geometry;kf<Kp.length;kf+=1){var bp=Kp[kf];$c(bp,new jr(bp[0].x,bp[0].y,0))}else if(La.type==="Point")for(var ed=0,gv=La.geometry;ed<gv.length;ed+=1)for(var Dd=0,yv=gv[ed];Dd<yv.length;Dd+=1){var Fd=yv[Dd];$c([Fd],new jr(Fd.x,Fd.y,0))}}(t,Zt,sn,cs,h,N,Vr,Dn,ln,ts,S)},mt=0,Bt=t.features;mt<Bt.length;mt+=1)rt();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,h,g){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(t[10]=(g+h)*(b=1/(h-g)),t[14]=2*g*h*b):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var g=o[h];g in t&&(u[g]=t[g])}return u},m.plugin=Ts,m.polygonIntersectsPolygon=Lu,m.postMapLoadEvent=Nt,m.postTurnstileEvent=xo,m.potpack=Cr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=pn,m.registerForPluginStateChange=function(t){return t({pluginStatus:ks,pluginURL:Iu}),Xf.on("pluginStateChange",t),t},m.renderColorRamp=qf,m.rotate=function(t,o,u){var h=o[0],g=o[1],b=o[2],S=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=h*D+b*I,t[1]=g*D+S*I,t[2]=h*-I+b*D,t[3]=g*-I+S*D,t},m.rotateX=function(t,o,u){var h=Math.sin(u),g=Math.cos(u),b=o[4],S=o[5],I=o[6],D=o[7],N=o[8],Z=o[9],j=o[10],$=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*g+N*h,t[5]=S*g+Z*h,t[6]=I*g+j*h,t[7]=D*g+$*h,t[8]=N*g-b*h,t[9]=Z*g-S*h,t[10]=j*g-I*h,t[11]=$*g-D*h,t},m.rotateZ=function(t,o,u){var h=Math.sin(u),g=Math.cos(u),b=o[0],S=o[1],I=o[2],D=o[3],N=o[4],Z=o[5],j=o[6],$=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*g+N*h,t[1]=S*g+Z*h,t[2]=I*g+j*h,t[3]=D*g+$*h,t[4]=N*g-b*h,t[5]=Z*g-S*h,t[6]=j*g-I*h,t[7]=$*g-D*h,t},m.scale=function(t,o,u){var h=u[0],g=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*g,t[5]=o[5]*g,t[6]=o[6]*g,t[7]=o[7]*g,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){$t=t,Ir=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),ks==="deferred"||ks==="loading"||ks==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Iu=di.resolveURL(t),ks="deferred",Pu=o,hl(),u||iu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=oe,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=Fi,m.transformMat3=function(t,o,u){var h=o[0],g=o[1],b=o[2];return t[0]=h*u[0]+g*u[3]+b*u[6],t[1]=h*u[1]+g*u[4]+b*u[7],t[2]=h*u[2]+g*u[5]+b*u[8],t},m.transformMat4=zc,m.translate=function(t,o,u){var h,g,b,S,I,D,N,Z,j,$,re,Te,O=u[0],He=u[1],Ne=u[2];return o===t?(t[12]=o[0]*O+o[4]*He+o[8]*Ne+o[12],t[13]=o[1]*O+o[5]*He+o[9]*Ne+o[13],t[14]=o[2]*O+o[6]*He+o[10]*Ne+o[14],t[15]=o[3]*O+o[7]*He+o[11]*Ne+o[15]):(g=o[1],b=o[2],S=o[3],I=o[4],D=o[5],N=o[6],Z=o[7],j=o[8],$=o[9],re=o[10],Te=o[11],t[0]=h=o[0],t[1]=g,t[2]=b,t[3]=S,t[4]=I,t[5]=D,t[6]=N,t[7]=Z,t[8]=j,t[9]=$,t[10]=re,t[11]=Te,t[12]=h*O+I*He+j*Ne+o[12],t[13]=g*O+D*He+$*Ne+o[13],t[14]=b*O+N*He+re*Ne+o[14],t[15]=S*O+Z*He+Te*Ne+o[15]),t},m.triggerPluginCompletionEvent=Wf,m.uniqueId=jt,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=oc,m.validateStyle=Na,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=Fu,m.version="1.13.2",m.warnOnce=Qe,m.webpSupported=ai,m.window=_e,m.wrap=ur}),ye(["./shared"],function(m){"use strict";function Oe(G){var q=typeof G;if(q==="number"||q==="boolean"||q==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var te="[",de=0,Me=G;de<Me.length;de+=1)te+=Oe(Me[de])+",";return te+"]"}for(var Ve=Object.keys(G).sort(),$e="{",oe=0;oe<Ve.length;oe++)$e+=JSON.stringify(Ve[oe])+":"+Oe(G[Ve[oe]])+",";return $e+"}"}function W(G){for(var q="",te=0,de=m.refProperties;te<de.length;te+=1)q+="/"+Oe(G[de[te]]);return q}var pe=function(G){this.keyCache={},G&&this.replace(G)};pe.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},pe.prototype.update=function(G,q){for(var te=this,de=0,Me=G;de<Me.length;de+=1){var Ve=Me[de];this._layerConfigs[Ve.id]=Ve;var $e=this._layers[Ve.id]=m.createStyleLayer(Ve);$e._featureFilter=m.featureFilter($e.filter),this.keyCache[Ve.id]&&delete this.keyCache[Ve.id]}for(var oe=0,Re=q;oe<Re.length;oe+=1){var lt=Re[oe];delete this.keyCache[lt],delete this._layerConfigs[lt],delete this._layers[lt]}this.familiesBySource={};for(var cr=0,Rt=function(Dr,Hr){for(var pi={},$r=0;$r<Dr.length;$r++){var yn=Hr&&Hr[Dr[$r].id]||W(Dr[$r]);Hr&&(Hr[Dr[$r].id]=yn);var Zi=pi[yn];Zi||(Zi=pi[yn]=[]),Zi.push(Dr[$r])}var li=[];for(var Ci in pi)li.push(pi[Ci]);return li}(m.values(this._layerConfigs),this.keyCache);cr<Rt.length;cr+=1){var Lt=Rt[cr].map(function(Dr){return te._layers[Dr.id]}),pr=Lt[0];if(pr.visibility!=="none"){var _n=pr.source||"",un=this.familiesBySource[_n];un||(un=this.familiesBySource[_n]={});var Ct=pr.sourceLayer||"_geojsonTileLayer",Kr=un[Ct];Kr||(Kr=un[Ct]=[]),Kr.push(Lt)}}};var ce=function(G){var q={},te=[];for(var de in G){var Me=G[de],Ve=q[de]={};for(var $e in Me){var oe=Me[+$e];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var Re={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};te.push(Re),Ve[$e]={rect:Re,metrics:oe.metrics}}}}var lt=m.potpack(te),cr=new m.AlphaImage({width:lt.w||1,height:lt.h||1});for(var Rt in G){var Lt=G[Rt];for(var pr in Lt){var _n=Lt[+pr];if(_n&&_n.bitmap.width!==0&&_n.bitmap.height!==0){var un=q[Rt][pr].rect;m.AlphaImage.copy(_n.bitmap,cr,{x:0,y:0},{x:un.x+1,y:un.y+1},_n.bitmap)}}}this.image=cr,this.positions=q};m.register("GlyphAtlas",ce);var Be=function(G){this.tileID=new m.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function _e(G,q,te){for(var de=new m.EvaluationParameters(q),Me=0,Ve=G;Me<Ve.length;Me+=1)Ve[Me].recalculate(de,te)}function tt(G,q){var te=m.getArrayBuffer(G.request,function(de,Me,Ve,$e){de?q(de):Me&&q(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Me)),rawData:Me,cacheControl:Ve,expires:$e})});return function(){te.cancel(),q()}}Be.prototype.parse=function(G,q,te,de,Me){var Ve=this;this.status="parsing",this.data=G,this.collisionBoxArray=new m.CollisionBoxArray;var $e=new m.DictionaryCoder(Object.keys(G.layers).sort()),oe=new m.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];var Re,lt,cr,Rt,Lt={},pr={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},_n=q.familiesBySource[this.source];for(var un in _n){var Ct=G.layers[un];if(Ct){Ct.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Kr=$e.encode(un),Dr=[],Hr=0;Hr<Ct.length;Hr++){var pi=Ct.feature(Hr),$r=oe.getId(pi,un);Dr.push({feature:pi,id:$r,index:Hr,sourceLayerIndex:Kr})}for(var yn=0,Zi=_n[un];yn<Zi.length;yn+=1){var li=Zi[yn],Ci=li[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(_e(li,this.zoom,te),(Lt[Ci.id]=Ci.createBucket({index:oe.bucketLayerIDs.length,layers:li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kr,sourceID:this.source})).populate(Dr,pr,this.tileID.canonical),oe.bucketLayerIDs.push(li.map(function(Ei){return Ei.id})))}}}var gi=m.mapObject(pr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(gi).length?de.send("getGlyphs",{uid:this.uid,stacks:gi},function(Ei,Ai){Re||(Re=Ei,lt=Ai,wa.call(Ve))}):lt={};var ft=Object.keys(pr.iconDependencies);ft.length?de.send("getImages",{icons:ft,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Ai){Re||(Re=Ei,cr=Ai,wa.call(Ve))}):cr={};var Mt=Object.keys(pr.patternDependencies);function wa(){if(Re)return Me(Re);if(lt&&cr&&Rt){var Ei=new ce(lt),Ai=new m.ImageAtlas(cr,Rt);for(var Di in Lt){var Rr=Lt[Di];Rr instanceof m.SymbolBucket?(_e(Rr.layers,this.zoom,te),m.performSymbolLayout(Rr,lt,Ei.positions,cr,Ai.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Rr.hasPattern&&(Rr instanceof m.LineBucket||Rr instanceof m.FillBucket||Rr instanceof m.FillExtrusionBucket)&&(_e(Rr.layers,this.zoom,te),Rr.addFeatures(pr,this.tileID.canonical,Ai.patternPositions))}this.status="done",Me(null,{buckets:m.values(Lt).filter(function(cn){return!cn.isEmpty()}),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Ai,glyphMap:this.returnDependencies?lt:null,iconMap:this.returnDependencies?cr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}Mt.length?de.send("getImages",{icons:Mt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Ai){Re||(Re=Ei,Rt=Ai,wa.call(Ve))}):Rt={},wa.call(this)};var pt=function(G,q,te,de){this.actor=G,this.layerIndex=q,this.availableImages=te,this.loadVectorData=de||tt,this.loading={},this.loaded={}};pt.prototype.loadTile=function(G,q){var te=this,de=G.uid;this.loading||(this.loading={});var Me=!!(G&&G.request&&G.request.collectResourceTiming)&&new m.RequestPerformance(G.request),Ve=this.loading[de]=new Be(G);Ve.abort=this.loadVectorData(G,function($e,oe){if(delete te.loading[de],$e||!oe)return Ve.status="done",te.loaded[de]=Ve,q($e);var Re=oe.rawData,lt={};oe.expires&&(lt.expires=oe.expires),oe.cacheControl&&(lt.cacheControl=oe.cacheControl);var cr={};if(Me){var Rt=Me.finish();Rt&&(cr.resourceTiming=JSON.parse(JSON.stringify(Rt)))}Ve.vectorTile=oe.vectorTile,Ve.parse(oe.vectorTile,te.layerIndex,te.availableImages,te.actor,function(Lt,pr){if(Lt||!pr)return q(Lt);q(null,m.extend({rawTileData:Re.slice(0)},pr,lt,cr))}),te.loaded=te.loaded||{},te.loaded[de]=Ve})},pt.prototype.reloadTile=function(G,q){var te=this,de=this.loaded,Me=G.uid,Ve=this;if(de&&de[Me]){var $e=de[Me];$e.showCollisionBoxes=G.showCollisionBoxes;var oe=function(Re,lt){var cr=$e.reloadCallback;cr&&(delete $e.reloadCallback,$e.parse($e.vectorTile,Ve.layerIndex,te.availableImages,Ve.actor,cr)),q(Re,lt)};$e.status==="parsing"?$e.reloadCallback=oe:$e.status==="done"&&($e.vectorTile?$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}},pt.prototype.abortTile=function(G,q){var te=this.loading,de=G.uid;te&&te[de]&&te[de].abort&&(te[de].abort(),delete te[de]),q()},pt.prototype.removeTile=function(G,q){var te=this.loaded,de=G.uid;te&&te[de]&&delete te[de],q()};var Et=m.window.ImageBitmap,Jt=function(){this.loaded={}};function ur(G,q){if(G.length!==0){kt(G[0],q);for(var te=1;te<G.length;te++)kt(G[te],!q)}}function kt(G,q){for(var te=0,de=0,Me=G.length,Ve=Me-1;de<Me;Ve=de++)te+=(G[de][0]-G[Ve][0])*(G[Ve][1]+G[de][1]);te>=0!=!!q&&G.reverse()}Jt.prototype.loadTile=function(G,q){var te=G.uid,de=G.encoding,Me=G.rawImageData,Ve=Et&&Me instanceof Et?this.getImageData(Me):Me,$e=new m.DEMData(te,Ve,de);this.loaded=this.loaded||{},this.loaded[te]=$e,q(null,$e)},Jt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var q=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:q.width,height:q.height},q.data)},Jt.prototype.removeTile=function(G){var q=this.loaded,te=G.uid;q&&q[te]&&delete q[te]};var er=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,jt=function(G){this._feature=G,this.extent=m.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};jt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],q=0,te=this._feature.geometry;q<te.length;q+=1){var de=te[q];G.push([new m.Point$1(de[0],de[1])])}return G}for(var Me=[],Ve=0,$e=this._feature.geometry;Ve<$e.length;Ve+=1){for(var oe=[],Re=0,lt=$e[Ve];Re<lt.length;Re+=1){var cr=lt[Re];oe.push(new m.Point$1(cr[0],cr[1]))}Me.push(oe)}return Me},jt.prototype.toGeoJSON=function(G,q,te){return er.call(this,G,q,te)};var ct=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=G.length,this._features=G};ct.prototype.feature=function(G){return new jt(this._features[G])};var dt=m.vectorTile.VectorTileFeature,ir=Y;function Y(G,q){this.options=q||{},this.features=G,this.length=G.length}function Wt(G,q){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=q||4096}Y.prototype.feature=function(G){return new Wt(this.features[G],this.options.extent)},Wt.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var q=0;q<G.length;q++){for(var te=G[q],de=[],Me=0;Me<te.length;Me++)de.push(new m.Point$1(te[Me][0],te[Me][1]));this.geometry.push(de)}return this.geometry},Wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,q=1/0,te=-1/0,de=1/0,Me=-1/0,Ve=0;Ve<G.length;Ve++)for(var $e=G[Ve],oe=0;oe<$e.length;oe++){var Re=$e[oe];q=Math.min(q,Re.x),te=Math.max(te,Re.x),de=Math.min(de,Re.y),Me=Math.max(Me,Re.y)}return[q,de,te,Me]},Wt.prototype.toGeoJSON=dt.prototype.toGeoJSON;var ut=St,qe=ir;function St(G){var q=new m.pbf;return function(te,de){for(var Me in te.layers)de.writeMessage(3,Qe,te.layers[Me])}(G,q),q.finish()}function Qe(G,q){var te;q.writeVarintField(15,G.version||1),q.writeStringField(1,G.name||""),q.writeVarintField(5,G.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<G.length;te++)de.feature=G.feature(te),q.writeMessage(2,Xt,de);var Me=de.keys;for(te=0;te<Me.length;te++)q.writeStringField(3,Me[te]);var Ve=de.values;for(te=0;te<Ve.length;te++)q.writeMessage(4,Ce,Ve[te])}function Xt(G,q){var te=G.feature;te.id!==void 0&&q.writeVarintField(1,te.id),q.writeMessage(2,wr,G),q.writeVarintField(3,te.type),q.writeMessage(4,A,te)}function wr(G,q){var te=G.feature,de=G.keys,Me=G.values,Ve=G.keycache,$e=G.valuecache;for(var oe in te.properties){var Re=Ve[oe];Re===void 0&&(de.push(oe),Ve[oe]=Re=de.length-1),q.writeVarint(Re);var lt=te.properties[oe],cr=typeof lt;cr!=="string"&&cr!=="boolean"&&cr!=="number"&&(lt=JSON.stringify(lt));var Rt=cr+":"+lt,Lt=$e[Rt];Lt===void 0&&(Me.push(lt),$e[Rt]=Lt=Me.length-1),q.writeVarint(Lt)}}function Gr(G,q){return(q<<3)+(7&G)}function Qr(G){return G<<1^G>>31}function A(G,q){for(var te=G.loadGeometry(),de=G.type,Me=0,Ve=0,$e=te.length,oe=0;oe<$e;oe++){var Re=te[oe],lt=1;de===1&&(lt=Re.length),q.writeVarint(Gr(1,lt));for(var cr=de===3?Re.length-1:Re.length,Rt=0;Rt<cr;Rt++){Rt===1&&de!==1&&q.writeVarint(Gr(2,cr-1));var Lt=Re[Rt].x-Me,pr=Re[Rt].y-Ve;q.writeVarint(Qr(Lt)),q.writeVarint(Qr(pr)),Me+=Lt,Ve+=pr}de===3&&q.writeVarint(Gr(7,1))}}function Ce(G,q){var te=typeof G;te==="string"?q.writeStringField(1,G):te==="boolean"?q.writeBooleanField(7,G):te==="number"&&(G%1!=0?q.writeDoubleField(3,G):G<0?q.writeSVarintField(6,G):q.writeVarintField(5,G))}function ke(G,q,te,de){xt(G,te,de),xt(q,2*te,2*de),xt(q,2*te+1,2*de+1)}function xt(G,q,te){var de=G[q];G[q]=G[te],G[te]=de}function ht(G,q,te,de){var Me=G-te,Ve=q-de;return Me*Me+Ve*Ve}ut.fromVectorTileJs=St,ut.fromGeojsonVt=function(G,q){q=q||{};var te={};for(var de in G)te[de]=new ir(G[de].features,q),te[de].name=de,te[de].version=q.version,te[de].extent=q.extent;return St({layers:te})},ut.GeoJSONWrapper=qe;var Ft=function(G){return G[0]},Gt=function(G){return G[1]},Er=function(G,q,te,de,Me){q===void 0&&(q=Ft),te===void 0&&(te=Gt),de===void 0&&(de=64),Me===void 0&&(Me=Float64Array),this.nodeSize=de,this.points=G;for(var Ve=G.length<65536?Uint16Array:Uint32Array,$e=this.ids=new Ve(G.length),oe=this.coords=new Me(2*G.length),Re=0;Re<G.length;Re++)$e[Re]=Re,oe[2*Re]=q(G[Re]),oe[2*Re+1]=te(G[Re]);(function lt(cr,Rt,Lt,pr,_n,un){if(!(_n-pr<=Lt)){var Ct=pr+_n>>1;(function Kr(Dr,Hr,pi,$r,yn,Zi){for(;yn>$r;){if(yn-$r>600){var li=yn-$r+1,Ci=pi-$r+1,gi=Math.log(li),ft=.5*Math.exp(2*gi/3),Mt=.5*Math.sqrt(gi*ft*(li-ft)/li)*(Ci-li/2<0?-1:1);Kr(Dr,Hr,pi,Math.max($r,Math.floor(pi-Ci*ft/li+Mt)),Math.min(yn,Math.floor(pi+(li-Ci)*ft/li+Mt)),Zi)}var wa=Hr[2*pi+Zi],Ei=$r,Ai=yn;for(ke(Dr,Hr,$r,pi),Hr[2*yn+Zi]>wa&&ke(Dr,Hr,$r,yn);Ei<Ai;){for(ke(Dr,Hr,Ei,Ai),Ei++,Ai--;Hr[2*Ei+Zi]<wa;)Ei++;for(;Hr[2*Ai+Zi]>wa;)Ai--}Hr[2*$r+Zi]===wa?ke(Dr,Hr,$r,Ai):ke(Dr,Hr,++Ai,yn),Ai<=pi&&($r=Ai+1),pi<=Ai&&(yn=Ai-1)}})(cr,Rt,Ct,pr,_n,un%2),lt(cr,Rt,Lt,pr,Ct-1,un+1),lt(cr,Rt,Lt,Ct+1,_n,un+1)}})($e,oe,de,0,$e.length-1,0)};Er.prototype.range=function(G,q,te,de){return function(Me,Ve,$e,oe,Re,lt,cr){for(var Rt,Lt,pr=[0,Me.length-1,0],_n=[];pr.length;){var un=pr.pop(),Ct=pr.pop(),Kr=pr.pop();if(Ct-Kr<=cr)for(var Dr=Kr;Dr<=Ct;Dr++)Lt=Ve[2*Dr+1],(Rt=Ve[2*Dr])>=$e&&Rt<=Re&&Lt>=oe&&Lt<=lt&&_n.push(Me[Dr]);else{var Hr=Math.floor((Kr+Ct)/2);Lt=Ve[2*Hr+1],(Rt=Ve[2*Hr])>=$e&&Rt<=Re&&Lt>=oe&&Lt<=lt&&_n.push(Me[Hr]);var pi=(un+1)%2;(un===0?$e<=Rt:oe<=Lt)&&(pr.push(Kr),pr.push(Hr-1),pr.push(pi)),(un===0?Re>=Rt:lt>=Lt)&&(pr.push(Hr+1),pr.push(Ct),pr.push(pi))}}return _n}(this.ids,this.coords,G,q,te,de,this.nodeSize)},Er.prototype.within=function(G,q,te){return function(de,Me,Ve,$e,oe,Re){for(var lt=[0,de.length-1,0],cr=[],Rt=oe*oe;lt.length;){var Lt=lt.pop(),pr=lt.pop(),_n=lt.pop();if(pr-_n<=Re)for(var un=_n;un<=pr;un++)ht(Me[2*un],Me[2*un+1],Ve,$e)<=Rt&&cr.push(de[un]);else{var Ct=Math.floor((_n+pr)/2),Kr=Me[2*Ct],Dr=Me[2*Ct+1];ht(Kr,Dr,Ve,$e)<=Rt&&cr.push(de[Ct]);var Hr=(Lt+1)%2;(Lt===0?Ve-oe<=Kr:$e-oe<=Dr)&&(lt.push(_n),lt.push(Ct-1),lt.push(Hr)),(Lt===0?Ve+oe>=Kr:$e+oe>=Dr)&&(lt.push(Ct+1),lt.push(pr),lt.push(Hr))}}return cr}(this.ids,this.coords,G,q,te,this.nodeSize)};var Qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},gn=function(G){this.options=fa(Object.create(Qn),G),this.trees=new Array(this.options.maxZoom+1)};function di(G,q,te,de,Me){return{x:G,y:q,zoom:1/0,id:te,parentId:-1,numPoints:de,properties:Me}}function Hn(G,q){var te=G.geometry.coordinates,de=te[1];return{x:Xn(te[0]),y:mi(de),zoom:1/0,index:q,parentId:-1}}function ai(G){return{type:"Feature",id:G.id,properties:vi(G),geometry:{type:"Point",coordinates:[(de=G.x,360*(de-.5)),(q=G.y,te=(180-360*q)*Math.PI/180,360*Math.atan(Math.exp(te))/Math.PI-90)]}};var q,te,de}function vi(G){var q=G.numPoints,te=q>=1e4?Math.round(q/1e3)+"k":q>=1e3?Math.round(q/100)/10+"k":q;return fa(fa({},G.properties),{cluster:!0,cluster_id:G.id,point_count:q,point_count_abbreviated:te})}function Xn(G){return G/360+.5}function mi(G){var q=Math.sin(G*Math.PI/180),te=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return te<0?0:te>1?1:te}function fa(G,q){for(var te in q)G[te]=q[te];return G}function Wi(G){return G.x}function Li(G){return G.y}function Qi(G,q,te,de,Me,Ve){var $e=Me-te,oe=Ve-de;if($e!==0||oe!==0){var Re=((G-te)*$e+(q-de)*oe)/($e*$e+oe*oe);Re>1?(te=Me,de=Ve):Re>0&&(te+=$e*Re,de+=oe*Re)}return($e=G-te)*$e+(oe=q-de)*oe}function pa(G,q,te,de){var Me={id:G===void 0?null:G,type:q,geometry:te,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ve){var $e=Ve.geometry,oe=Ve.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Lo(Ve,$e);else if(oe==="Polygon"||oe==="MultiLineString")for(var Re=0;Re<$e.length;Re++)Lo(Ve,$e[Re]);else if(oe==="MultiPolygon")for(Re=0;Re<$e.length;Re++)for(var lt=0;lt<$e[Re].length;lt++)Lo(Ve,$e[Re][lt])}(Me),Me}function Lo(G,q){for(var te=0;te<q.length;te+=3)G.minX=Math.min(G.minX,q[te]),G.minY=Math.min(G.minY,q[te+1]),G.maxX=Math.max(G.maxX,q[te]),G.maxY=Math.max(G.maxY,q[te+1])}function Ia(G,q,te,de){if(q.geometry){var Me=q.geometry.coordinates,Ve=q.geometry.type,$e=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2),oe=[],Re=q.id;if(te.promoteId?Re=q.properties[te.promoteId]:te.generateId&&(Re=de||0),Ve==="Point")_a(Me,oe);else if(Ve==="MultiPoint")for(var lt=0;lt<Me.length;lt++)_a(Me[lt],oe);else if(Ve==="LineString")Ni(Me,oe,$e,!1);else if(Ve==="MultiLineString"){if(te.lineMetrics){for(lt=0;lt<Me.length;lt++)Ni(Me[lt],oe=[],$e,!1),G.push(pa(Re,"LineString",oe,q.properties));return}aa(Me,oe,$e,!1)}else if(Ve==="Polygon")aa(Me,oe,$e,!0);else{if(Ve!=="MultiPolygon"){if(Ve==="GeometryCollection"){for(lt=0;lt<q.geometry.geometries.length;lt++)Ia(G,{id:Re,geometry:q.geometry.geometries[lt],properties:q.properties},te,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(lt=0;lt<Me.length;lt++){var cr=[];aa(Me[lt],cr,$e,!0),oe.push(cr)}}G.push(pa(Re,Ve,oe,q.properties))}}function _a(G,q){q.push(Ji(G[0])),q.push(Ss(G[1])),q.push(0)}function Ni(G,q,te,de){for(var Me,Ve,$e=0,oe=0;oe<G.length;oe++){var Re=Ji(G[oe][0]),lt=Ss(G[oe][1]);q.push(Re),q.push(lt),q.push(0),oe>0&&($e+=de?(Me*lt-Re*Ve)/2:Math.sqrt(Math.pow(Re-Me,2)+Math.pow(lt-Ve,2))),Me=Re,Ve=lt}var cr=q.length-3;q[2]=1,function Rt(Lt,pr,_n,un){for(var Ct,Kr=un,Dr=_n-pr>>1,Hr=_n-pr,pi=Lt[pr],$r=Lt[pr+1],yn=Lt[_n],Zi=Lt[_n+1],li=pr+3;li<_n;li+=3){var Ci=Qi(Lt[li],Lt[li+1],pi,$r,yn,Zi);if(Ci>Kr)Ct=li,Kr=Ci;else if(Ci===Kr){var gi=Math.abs(li-Dr);gi<Hr&&(Ct=li,Hr=gi)}}Kr>un&&(Ct-pr>3&&Rt(Lt,pr,Ct,un),Lt[Ct+2]=Kr,_n-Ct>3&&Rt(Lt,Ct,_n,un))}(q,0,cr,te),q[cr+2]=1,q.size=Math.abs($e),q.start=0,q.end=q.size}function aa(G,q,te,de){for(var Me=0;Me<G.length;Me++){var Ve=[];Ni(G[Me],Ve,te,de),q.push(Ve)}}function Ji(G){return G/360+.5}function Ss(G){var q=Math.sin(G*Math.PI/180),te=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return te<0?0:te>1?1:te}function he(G,q,te,de,Me,Ve,$e,oe){if(de/=q,Ve>=(te/=q)&&$e<de)return G;if($e<te||Ve>=de)return null;for(var Re=[],lt=0;lt<G.length;lt++){var cr=G[lt],Rt=cr.geometry,Lt=cr.type,pr=Me===0?cr.minX:cr.minY,_n=Me===0?cr.maxX:cr.maxY;if(pr>=te&&_n<de)Re.push(cr);else if(!(_n<te||pr>=de)){var un=[];if(Lt==="Point"||Lt==="MultiPoint")oi(Rt,un,te,de,Me);else if(Lt==="LineString")xo(Rt,un,te,de,Me,!1,oe.lineMetrics);else if(Lt==="MultiLineString")Nt(Rt,un,te,de,Me,!1);else if(Lt==="Polygon")Nt(Rt,un,te,de,Me,!0);else if(Lt==="MultiPolygon")for(var Ct=0;Ct<Rt.length;Ct++){var Kr=[];Nt(Rt[Ct],Kr,te,de,Me,!0),Kr.length&&un.push(Kr)}if(un.length){if(oe.lineMetrics&&Lt==="LineString"){for(Ct=0;Ct<un.length;Ct++)Re.push(pa(cr.id,Lt,un[Ct],cr.tags));continue}Lt!=="LineString"&&Lt!=="MultiLineString"||(un.length===1?(Lt="LineString",un=un[0]):Lt="MultiLineString"),Lt!=="Point"&&Lt!=="MultiPoint"||(Lt=un.length===3?"Point":"MultiPoint"),Re.push(pa(cr.id,Lt,un,cr.tags))}}}return Re.length?Re:null}function oi(G,q,te,de,Me){for(var Ve=0;Ve<G.length;Ve+=3){var $e=G[Ve+Me];$e>=te&&$e<=de&&(q.push(G[Ve]),q.push(G[Ve+1]),q.push(G[Ve+2]))}}function xo(G,q,te,de,Me,Ve,$e){for(var oe,Re,lt=Js(G),cr=Me===0?Ir:nn,Rt=G.start,Lt=0;Lt<G.length-3;Lt+=3){var pr=G[Lt],_n=G[Lt+1],un=G[Lt+2],Ct=G[Lt+3],Kr=G[Lt+4],Dr=Me===0?pr:_n,Hr=Me===0?Ct:Kr,pi=!1;$e&&(oe=Math.sqrt(Math.pow(pr-Ct,2)+Math.pow(_n-Kr,2))),Dr<te?Hr>te&&(Re=cr(lt,pr,_n,Ct,Kr,te),$e&&(lt.start=Rt+oe*Re)):Dr>de?Hr<de&&(Re=cr(lt,pr,_n,Ct,Kr,de),$e&&(lt.start=Rt+oe*Re)):$t(lt,pr,_n,un),Hr<te&&Dr>=te&&(Re=cr(lt,pr,_n,Ct,Kr,te),pi=!0),Hr>de&&Dr<=de&&(Re=cr(lt,pr,_n,Ct,Kr,de),pi=!0),!Ve&&pi&&($e&&(lt.end=Rt+oe*Re),q.push(lt),lt=Js(G)),$e&&(Rt+=oe)}var $r=G.length-3;pr=G[$r],_n=G[$r+1],un=G[$r+2],(Dr=Me===0?pr:_n)>=te&&Dr<=de&&$t(lt,pr,_n,un),$r=lt.length-3,Ve&&$r>=3&&(lt[$r]!==lt[0]||lt[$r+1]!==lt[1])&&$t(lt,lt[0],lt[1],lt[2]),lt.length&&q.push(lt)}function Js(G){var q=[];return q.size=G.size,q.start=G.start,q.end=G.end,q}function Nt(G,q,te,de,Me,Ve){for(var $e=0;$e<G.length;$e++)xo(G[$e],q,te,de,Me,Ve,!1)}function $t(G,q,te,de){G.push(q),G.push(te),G.push(de)}function Ir(G,q,te,de,Me,Ve){var $e=(Ve-q)/(de-q);return G.push(Ve),G.push(te+(Me-te)*$e),G.push(1),$e}function nn(G,q,te,de,Me,Ve){var $e=(Ve-te)/(Me-te);return G.push(q+(de-q)*$e),G.push(Ve),G.push(1),$e}function wn(G,q){for(var te=[],de=0;de<G.length;de++){var Me,Ve=G[de],$e=Ve.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")Me=zn(Ve.geometry,q);else if($e==="MultiLineString"||$e==="Polygon"){Me=[];for(var oe=0;oe<Ve.geometry.length;oe++)Me.push(zn(Ve.geometry[oe],q))}else if($e==="MultiPolygon")for(Me=[],oe=0;oe<Ve.geometry.length;oe++){for(var Re=[],lt=0;lt<Ve.geometry[oe].length;lt++)Re.push(zn(Ve.geometry[oe][lt],q));Me.push(Re)}te.push(pa(Ve.id,$e,Me,Ve.tags))}return te}function zn(G,q){var te=[];te.size=G.size,G.start!==void 0&&(te.start=G.start,te.end=G.end);for(var de=0;de<G.length;de+=3)te.push(G[de]+q,G[de+1],G[de+2]);return te}function xi(G,q){if(G.transformed)return G;var te,de,Me,Ve=1<<G.z,$e=G.x,oe=G.y;for(te=0;te<G.features.length;te++){var Re=G.features[te],lt=Re.geometry,cr=Re.type;if(Re.geometry=[],cr===1)for(de=0;de<lt.length;de+=2)Re.geometry.push(fi(lt[de],lt[de+1],q,Ve,$e,oe));else for(de=0;de<lt.length;de++){var Rt=[];for(Me=0;Me<lt[de].length;Me+=2)Rt.push(fi(lt[de][Me],lt[de][Me+1],q,Ve,$e,oe));Re.geometry.push(Rt)}}return G.transformed=!0,G}function fi(G,q,te,de,Me,Ve){return[Math.round(te*(G*de-Me)),Math.round(te*(q*de-Ve))]}function En(G,q,te,de,Me){for(var Ve=q===Me.maxZoom?0:Me.tolerance/((1<<q)*Me.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:te,y:de,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<G.length;oe++){$e.numFeatures++,Ii($e,G[oe],Ve,Me);var Re=G[oe].minX,lt=G[oe].minY,cr=G[oe].maxX,Rt=G[oe].maxY;Re<$e.minX&&($e.minX=Re),lt<$e.minY&&($e.minY=lt),cr>$e.maxX&&($e.maxX=cr),Rt>$e.maxY&&($e.maxY=Rt)}return $e}function Ii(G,q,te,de){var Me=q.geometry,Ve=q.type,$e=[];if(Ve==="Point"||Ve==="MultiPoint")for(var oe=0;oe<Me.length;oe+=3)$e.push(Me[oe]),$e.push(Me[oe+1]),G.numPoints++,G.numSimplified++;else if(Ve==="LineString")Pi($e,Me,G,te,!1,!1);else if(Ve==="MultiLineString"||Ve==="Polygon")for(oe=0;oe<Me.length;oe++)Pi($e,Me[oe],G,te,Ve==="Polygon",oe===0);else if(Ve==="MultiPolygon")for(var Re=0;Re<Me.length;Re++){var lt=Me[Re];for(oe=0;oe<lt.length;oe++)Pi($e,lt[oe],G,te,!0,oe===0)}if($e.length){var cr=q.tags||null;if(Ve==="LineString"&&de.lineMetrics){for(var Rt in cr={},q.tags)cr[Rt]=q.tags[Rt];cr.mapbox_clip_start=Me.start/Me.size,cr.mapbox_clip_end=Me.end/Me.size}var Lt={geometry:$e,type:Ve==="Polygon"||Ve==="MultiPolygon"?3:Ve==="LineString"||Ve==="MultiLineString"?2:1,tags:cr};q.id!==null&&(Lt.id=q.id),G.features.push(Lt)}}function Pi(G,q,te,de,Me,Ve){var $e=de*de;if(de>0&&q.size<(Me?$e:de))te.numPoints+=q.length/3;else{for(var oe=[],Re=0;Re<q.length;Re+=3)(de===0||q[Re+2]>$e)&&(te.numSimplified++,oe.push(q[Re]),oe.push(q[Re+1])),te.numPoints++;Me&&function(lt,cr){for(var Rt=0,Lt=0,pr=lt.length,_n=pr-2;Lt<pr;_n=Lt,Lt+=2)Rt+=(lt[Lt]-lt[_n])*(lt[Lt+1]+lt[_n+1]);if(Rt>0===cr)for(Lt=0,pr=lt.length;Lt<pr/2;Lt+=2){var un=lt[Lt],Ct=lt[Lt+1];lt[Lt]=lt[pr-2-Lt],lt[Lt+1]=lt[pr-1-Lt],lt[pr-2-Lt]=un,lt[pr-1-Lt]=Ct}}(oe,Ve),G.push(oe)}}function to(G,q){var te=(q=this.options=function(Me,Ve){for(var $e in Ve)Me[$e]=Ve[$e];return Me}(Object.create(this.options),q)).debug;if(te&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var de=function(Me,Ve){var $e=[];if(Me.type==="FeatureCollection")for(var oe=0;oe<Me.features.length;oe++)Ia($e,Me.features[oe],Ve,oe);else Ia($e,Me.type==="Feature"?Me:{geometry:Me},Ve);return $e}(G,q);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(de=function(Me,Ve){var $e=Ve.buffer/Ve.extent,oe=Me,Re=he(Me,1,-1-$e,$e,0,-1,2,Ve),lt=he(Me,1,1-$e,2+$e,0,-1,2,Ve);return(Re||lt)&&(oe=he(Me,1,-$e,1+$e,0,-1,2,Ve)||[],Re&&(oe=wn(Re,1).concat(oe)),lt&&(oe=oe.concat(wn(lt,-1)))),oe}(de,q)).length&&this.splitTile(de,0,0,0),te&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fs(G,q,te){return 32*((1<<G)*te+q)+G}function Go(G,q){var te=G.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);var de=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!de)return q(null,null);var Me=new ct(de.features),Ve=ut(Me);Ve.byteOffset===0&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),q(null,{vectorTile:Me,rawData:Ve.buffer})}gn.prototype.load=function(G){var q=this.options,te=q.log,de=q.minZoom,Me=q.maxZoom,Ve=q.nodeSize;te&&console.time("total time");var $e="prepare "+G.length+" points";te&&console.time($e),this.points=G;for(var oe=[],Re=0;Re<G.length;Re++)G[Re].geometry&&oe.push(Hn(G[Re],Re));this.trees[Me+1]=new Er(oe,Wi,Li,Ve,Float32Array),te&&console.timeEnd($e);for(var lt=Me;lt>=de;lt--){var cr=+Date.now();oe=this._cluster(oe,lt),this.trees[lt]=new Er(oe,Wi,Li,Ve,Float32Array),te&&console.log("z%d: %d clusters in %dms",lt,oe.length,+Date.now()-cr)}return te&&console.timeEnd("total time"),this},gn.prototype.getClusters=function(G,q){var te=((G[0]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,G[1])),Me=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ve=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)te=-180,Me=180;else if(te>Me){var $e=this.getClusters([te,de,180,Ve],q),oe=this.getClusters([-180,de,Me,Ve],q);return $e.concat(oe)}for(var Re=this.trees[this._limitZoom(q)],lt=[],cr=0,Rt=Re.range(Xn(te),mi(Ve),Xn(Me),mi(de));cr<Rt.length;cr+=1){var Lt=Re.points[Rt[cr]];lt.push(Lt.numPoints?ai(Lt):this.points[Lt.index])}return lt},gn.prototype.getChildren=function(G){var q=this._getOriginId(G),te=this._getOriginZoom(G),de="No cluster with the specified id.",Me=this.trees[te];if(!Me)throw new Error(de);var Ve=Me.points[q];if(!Ve)throw new Error(de);for(var $e=this.options.radius/(this.options.extent*Math.pow(2,te-1)),oe=[],Re=0,lt=Me.within(Ve.x,Ve.y,$e);Re<lt.length;Re+=1){var cr=Me.points[lt[Re]];cr.parentId===G&&oe.push(cr.numPoints?ai(cr):this.points[cr.index])}if(oe.length===0)throw new Error(de);return oe},gn.prototype.getLeaves=function(G,q,te){var de=[];return this._appendLeaves(de,G,q=q||10,te=te||0,0),de},gn.prototype.getTile=function(G,q,te){var de=this.trees[this._limitZoom(G)],Me=Math.pow(2,G),Ve=this.options,$e=Ve.radius/Ve.extent,oe=(te-$e)/Me,Re=(te+1+$e)/Me,lt={features:[]};return this._addTileFeatures(de.range((q-$e)/Me,oe,(q+1+$e)/Me,Re),de.points,q,te,Me,lt),q===0&&this._addTileFeatures(de.range(1-$e/Me,oe,1,Re),de.points,Me,te,Me,lt),q===Me-1&&this._addTileFeatures(de.range(0,oe,$e/Me,Re),de.points,-1,te,Me,lt),lt.features.length?lt:null},gn.prototype.getClusterExpansionZoom=function(G){for(var q=this._getOriginZoom(G)-1;q<=this.options.maxZoom;){var te=this.getChildren(G);if(q++,te.length!==1)break;G=te[0].properties.cluster_id}return q},gn.prototype._appendLeaves=function(G,q,te,de,Me){for(var Ve=0,$e=this.getChildren(q);Ve<$e.length;Ve+=1){var oe=$e[Ve],Re=oe.properties;if(Re&&Re.cluster?Me+Re.point_count<=de?Me+=Re.point_count:Me=this._appendLeaves(G,Re.cluster_id,te,de,Me):Me<de?Me++:G.push(oe),G.length===te)break}return Me},gn.prototype._addTileFeatures=function(G,q,te,de,Me,Ve){for(var $e=0,oe=G;$e<oe.length;$e+=1){var Re=q[oe[$e]],lt=Re.numPoints,cr={type:1,geometry:[[Math.round(this.options.extent*(Re.x*Me-te)),Math.round(this.options.extent*(Re.y*Me-de))]],tags:lt?vi(Re):this.points[Re.index].properties},Rt=void 0;lt?Rt=Re.id:this.options.generateId?Rt=Re.index:this.points[Re.index].id&&(Rt=this.points[Re.index].id),Rt!==void 0&&(cr.id=Rt),Ve.features.push(cr)}},gn.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},gn.prototype._cluster=function(G,q){for(var te=[],de=this.options,Me=de.reduce,Ve=de.minPoints,$e=de.radius/(de.extent*Math.pow(2,q)),oe=0;oe<G.length;oe++){var Re=G[oe];if(!(Re.zoom<=q)){Re.zoom=q;for(var lt=this.trees[q+1],cr=lt.within(Re.x,Re.y,$e),Rt=Re.numPoints||1,Lt=Rt,pr=0,_n=cr;pr<_n.length;pr+=1){var un=lt.points[_n[pr]];un.zoom>q&&(Lt+=un.numPoints||1)}if(Lt>=Ve){for(var Ct=Re.x*Rt,Kr=Re.y*Rt,Dr=Me&&Rt>1?this._map(Re,!0):null,Hr=(oe<<5)+(q+1)+this.points.length,pi=0,$r=cr;pi<$r.length;pi+=1){var yn=lt.points[$r[pi]];if(!(yn.zoom<=q)){yn.zoom=q;var Zi=yn.numPoints||1;Ct+=yn.x*Zi,Kr+=yn.y*Zi,yn.parentId=Hr,Me&&(Dr||(Dr=this._map(Re,!0)),Me(Dr,this._map(yn)))}}Re.parentId=Hr,te.push(di(Ct/Lt,Kr/Lt,Hr,Lt,Dr))}else if(te.push(Re),Lt>1)for(var li=0,Ci=cr;li<Ci.length;li+=1){var gi=lt.points[Ci[li]];gi.zoom<=q||(gi.zoom=q,te.push(gi))}}}return te},gn.prototype._getOriginId=function(G){return G-this.points.length>>5},gn.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},gn.prototype._map=function(G,q){if(G.numPoints)return q?fa({},G.properties):G.properties;var te=this.points[G.index].properties,de=this.options.map(te);return q&&de===te?fa({},de):de},to.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},to.prototype.splitTile=function(G,q,te,de,Me,Ve,$e){for(var oe=[G,q,te,de],Re=this.options,lt=Re.debug;oe.length;){de=oe.pop(),te=oe.pop(),q=oe.pop(),G=oe.pop();var cr=1<<q,Rt=fs(q,te,de),Lt=this.tiles[Rt];if(!Lt&&(lt>1&&console.time("creation"),Lt=this.tiles[Rt]=En(G,q,te,de,Re),this.tileCoords.push({z:q,x:te,y:de}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,te,de,Lt.numFeatures,Lt.numPoints,Lt.numSimplified),console.timeEnd("creation"));var pr="z"+q;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(Lt.source=G,Me){if(q===Re.maxZoom||q===Me)continue;var _n=1<<Me-q;if(te!==Math.floor(Ve/_n)||de!==Math.floor($e/_n))continue}else if(q===Re.indexMaxZoom||Lt.numPoints<=Re.indexMaxPoints)continue;if(Lt.source=null,G.length!==0){lt>1&&console.time("clipping");var un,Ct,Kr,Dr,Hr,pi,$r=.5*Re.buffer/Re.extent,yn=.5-$r,Zi=.5+$r,li=1+$r;un=Ct=Kr=Dr=null,Hr=he(G,cr,te-$r,te+Zi,0,Lt.minX,Lt.maxX,Re),pi=he(G,cr,te+yn,te+li,0,Lt.minX,Lt.maxX,Re),G=null,Hr&&(un=he(Hr,cr,de-$r,de+Zi,1,Lt.minY,Lt.maxY,Re),Ct=he(Hr,cr,de+yn,de+li,1,Lt.minY,Lt.maxY,Re),Hr=null),pi&&(Kr=he(pi,cr,de-$r,de+Zi,1,Lt.minY,Lt.maxY,Re),Dr=he(pi,cr,de+yn,de+li,1,Lt.minY,Lt.maxY,Re),pi=null),lt>1&&console.timeEnd("clipping"),oe.push(un||[],q+1,2*te,2*de),oe.push(Ct||[],q+1,2*te,2*de+1),oe.push(Kr||[],q+1,2*te+1,2*de),oe.push(Dr||[],q+1,2*te+1,2*de+1)}}},to.prototype.getTile=function(G,q,te){var de=this.options,Me=de.extent,Ve=de.debug;if(G<0||G>24)return null;var $e=1<<G,oe=fs(G,q=(q%$e+$e)%$e,te);if(this.tiles[oe])return xi(this.tiles[oe],Me);Ve>1&&console.log("drilling down to z%d-%d-%d",G,q,te);for(var Re,lt=G,cr=q,Rt=te;!Re&&lt>0;)lt--,cr=Math.floor(cr/2),Rt=Math.floor(Rt/2),Re=this.tiles[fs(lt,cr,Rt)];return Re&&Re.source?(Ve>1&&console.log("found parent tile z%d-%d-%d",lt,cr,Rt),Ve>1&&console.time("drilling down"),this.splitTile(Re.source,lt,cr,Rt,G,q,te),Ve>1&&console.timeEnd("drilling down"),this.tiles[oe]?xi(this.tiles[oe],Me):null):null};var Da=function(G){function q(te,de,Me,Ve){G.call(this,te,de,Me,Go),Ve&&(this.loadGeoJSON=Ve)}return G&&(q.__proto__=G),(q.prototype=Object.create(G&&G.prototype)).constructor=q,q.prototype.loadData=function(te,de){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=de,this._pendingLoadDataParams=te,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},q.prototype._loadData=function(){var te=this;if(this._pendingCallback&&this._pendingLoadDataParams){var de=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ve=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new m.RequestPerformance(Me.request);this.loadGeoJSON(Me,function($e,oe){if($e||!oe)return de($e);if(typeof oe!="object")return de(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function Lt(pr,_n){var un,Ct=pr&&pr.type;if(Ct==="FeatureCollection")for(un=0;un<pr.features.length;un++)Lt(pr.features[un],_n);else if(Ct==="GeometryCollection")for(un=0;un<pr.geometries.length;un++)Lt(pr.geometries[un],_n);else if(Ct==="Feature")Lt(pr.geometry,_n);else if(Ct==="Polygon")ur(pr.coordinates,_n);else if(Ct==="MultiPolygon")for(un=0;un<pr.coordinates.length;un++)ur(pr.coordinates[un],_n);return pr})(oe,!0);try{if(Me.filter){var Re=m.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(function(Lt){return Lt.key+": "+Lt.message}).join(", "));var lt=oe.features.filter(function(Lt){return Re.value.evaluate({zoom:0},Lt)});oe={type:"FeatureCollection",features:lt}}te._geoJSONIndex=Me.cluster?new gn(function(Lt){var pr=Lt.superclusterOptions,_n=Lt.clusterProperties;if(!_n||!pr)return pr;for(var un={},Ct={},Kr={accumulated:null,zoom:0},Dr={properties:null},Hr=Object.keys(_n),pi=0,$r=Hr;pi<$r.length;pi+=1){var yn=$r[pi],Zi=_n[yn],li=Zi[0],Ci=m.createExpression(Zi[1]),gi=m.createExpression(typeof li=="string"?[li,["accumulated"],["get",yn]]:li);un[yn]=Ci.value,Ct[yn]=gi.value}return pr.map=function(ft){Dr.properties=ft;for(var Mt={},wa=0,Ei=Hr;wa<Ei.length;wa+=1){var Ai=Ei[wa];Mt[Ai]=un[Ai].evaluate(Kr,Dr)}return Mt},pr.reduce=function(ft,Mt){Dr.properties=Mt;for(var wa=0,Ei=Hr;wa<Ei.length;wa+=1){var Ai=Ei[wa];Kr.accumulated=ft[Ai],ft[Ai]=Ct[Ai].evaluate(Kr,Dr)}},pr}(Me)).load(oe.features):function(Lt,pr){return new to(Lt,pr)}(oe,Me.geojsonVtOptions)}catch(Lt){return de(Lt)}te.loaded={};var cr={};if(Ve){var Rt=Ve.finish();Rt&&(cr.resourceTiming={},cr.resourceTiming[Me.source]=JSON.parse(JSON.stringify(Rt)))}de(null,cr)})}},q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},q.prototype.reloadTile=function(te,de){var Me=this.loaded;return Me&&Me[te.uid]?G.prototype.reloadTile.call(this,te,de):this.loadTile(te,de)},q.prototype.loadGeoJSON=function(te,de){if(te.request)m.getJSON(te.request,de);else{if(typeof te.data!="string")return de(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."));try{return de(null,JSON.parse(te.data))}catch(Me){return de(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."))}}},q.prototype.removeSource=function(te,de){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),de()},q.prototype.getClusterExpansionZoom=function(te,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Me){de(Me)}},q.prototype.getClusterChildren=function(te,de){try{de(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Me){de(Me)}},q.prototype.getClusterLeaves=function(te,de){try{de(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Me){de(Me)}},q}(pt),xa=function(G){var q=this;this.self=G,this.actor=new m.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:pt,geojson:Da},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(te,de){if(q.workerSourceTypes[te])throw new Error('Worker source with name "'+te+'" already registered.');q.workerSourceTypes[te]=de},this.self.registerRTLTextPlugin=function(te){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=te.applyArabicShaping,m.plugin.processBidirectionalText=te.processBidirectionalText,m.plugin.processStyledBidirectionalText=te.processStyledBidirectionalText}};return xa.prototype.setReferrer=function(G,q){this.referrer=q},xa.prototype.setImages=function(G,q,te){for(var de in this.availableImages[G]=q,this.workerSources[G]){var Me=this.workerSources[G][de];for(var Ve in Me)Me[Ve].availableImages=q}te()},xa.prototype.setLayers=function(G,q,te){this.getLayerIndex(G).replace(q),te()},xa.prototype.updateLayers=function(G,q,te){this.getLayerIndex(G).update(q.layers,q.removedIds),te()},xa.prototype.loadTile=function(G,q,te){this.getWorkerSource(G,q.type,q.source).loadTile(q,te)},xa.prototype.loadDEMTile=function(G,q,te){this.getDEMWorkerSource(G,q.source).loadTile(q,te)},xa.prototype.reloadTile=function(G,q,te){this.getWorkerSource(G,q.type,q.source).reloadTile(q,te)},xa.prototype.abortTile=function(G,q,te){this.getWorkerSource(G,q.type,q.source).abortTile(q,te)},xa.prototype.removeTile=function(G,q,te){this.getWorkerSource(G,q.type,q.source).removeTile(q,te)},xa.prototype.removeDEMTile=function(G,q){this.getDEMWorkerSource(G,q.source).removeTile(q)},xa.prototype.removeSource=function(G,q,te){if(this.workerSources[G]&&this.workerSources[G][q.type]&&this.workerSources[G][q.type][q.source]){var de=this.workerSources[G][q.type][q.source];delete this.workerSources[G][q.type][q.source],de.removeSource!==void 0?de.removeSource(q,te):te()}},xa.prototype.loadWorkerSource=function(G,q,te){try{this.self.importScripts(q.url),te()}catch(de){te(de.toString())}},xa.prototype.syncRTLPluginState=function(G,q,te){try{m.plugin.setState(q);var de=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&de!=null){this.self.importScripts(de);var Me=m.plugin.isParsed();te(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+de),Me)}}catch(Ve){te(Ve.toString())}},xa.prototype.getAvailableImages=function(G){var q=this.availableImages[G];return q||(q=[]),q},xa.prototype.getLayerIndex=function(G){var q=this.layerIndexes[G];return q||(q=this.layerIndexes[G]=new pe),q},xa.prototype.getWorkerSource=function(G,q,te){var de=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][q]||(this.workerSources[G][q]={}),this.workerSources[G][q][te]||(this.workerSources[G][q][te]=new this.workerSourceTypes[q]({send:function(Me,Ve,$e){de.actor.send(Me,Ve,$e,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][q][te]},xa.prototype.getDEMWorkerSource=function(G,q){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][q]||(this.demWorkerSources[G][q]=new Jt),this.demWorkerSources[G][q]},xa.prototype.enforceCacheSizeLimit=function(G,q){m.enforceCacheSizeLimit(q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),ye(["./shared"],function(m){"use strict";var Oe=m.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,U=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(U);try{L=new Worker(H),P=!0}catch(ae){P=!1}return L&&L.terminate(),URL.revokeObjectURL(H),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(H){var ae=document.createElement("canvas"),se=Object.create(f.webGLContextAttributes);return se.failIfMajorPerformanceCaveat=H,ae.probablySupportsContext?ae.probablySupportsContext("webgl",se)||ae.probablySupportsContext("experimental-webgl",se):ae.supportsContext?ae.supportsContext("webgl",se)||ae.supportsContext("experimental-webgl",se):ae.getContext("webgl",se)||ae.getContext("experimental-webgl",se)}(P);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},pe=m.window.document&&m.window.document.documentElement.style;function ce(l){if(!pe)return l[0];for(var f=0;f<l.length;f++)if(l[f]in pe)return l[f];return l[0]}var Be,_e=ce(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){pe&&_e&&(Be=pe[_e],pe[_e]="none")},W.enableDrag=function(){pe&&_e&&(pe[_e]=Be)};var tt=ce(["transform","WebkitTransform"]);W.setTransform=function(l,f){l.style[tt]=f};var pt=!1;try{var Et=Object.defineProperty({},"passive",{get:function(){pt=!0}});m.window.addEventListener("test",Et,Et),m.window.removeEventListener("test",Et,Et)}catch(l){pt=!1}W.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&pt?d:d.capture)},W.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&pt?d:d.capture)};var Jt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Jt,!0)};function ur(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}W.suppressClick=function(){m.window.addEventListener("click",Jt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Jt,!0)},0)},W.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},W.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},W.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},W.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var kt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:P||1}),this.patterns){var H=this.patterns[U].bin,ae=H.x+1,se=H.y+1,ue=this.images[U].data,Ie=ue.width,Ee=ue.height;m.RGBAImage.copy(ue,L,{x:0,y:0},{x:ae,y:se},{width:Ie,height:Ee}),m.RGBAImage.copy(ue,L,{x:0,y:Ee-1},{x:ae,y:se-1},{width:Ie,height:1}),m.RGBAImage.copy(ue,L,{x:0,y:0},{x:ae,y:se+Ee},{width:Ie,height:1}),m.RGBAImage.copy(ue,L,{x:Ie-1,y:0},{x:ae-1,y:se},{width:1,height:Ee}),m.RGBAImage.copy(ue,L,{x:0,y:0},{x:ae+Ie,y:se},{width:1,height:Ee})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];ur(P)&&this.updateImage(w,P)}}},f}(m.Evented),er=dt,jt=dt,ct=1e20;function dt(l,f,c,d,E,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ir(l,f,c,d,E,w,P){for(var L=0;L<f;L++){for(var U=0;U<c;U++)d[U]=l[U*f+L];for(Y(d,E,w,P,c),U=0;U<c;U++)l[U*f+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<f;L++)d[L]=l[U*f+L];for(Y(d,E,w,P,f),L=0;L<f;L++)l[U*f+L]=Math.sqrt(E[L])}}function Y(l,f,c,d,E){c[0]=0,d[0]=-ct,d[1]=+ct;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+ct}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;f[w]=(w-c[P])*(w-c[P])+l[c[P]]}}dt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ct:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ct:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},er.default=jt;var Wt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Wt.prototype.setURL=function(l){this.url=l},Wt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});m.asyncAll(d,function(L,U){var H=L.stack,ae=L.id,se=c.entries[H];se||(se=c.entries[H]={glyphs:{},requests:{},ranges:{}});var ue=se.glyphs[ae];if(ue===void 0){if(ue=c._tinySDF(se,H,ae))return se.glyphs[ae]=ue,void U(null,{stack:H,id:ae,glyph:ue});var Ie=Math.floor(ae/256);if(256*Ie>65535)U(new Error("glyphs > 65535 not supported"));else if(se.ranges[Ie])U(null,{stack:H,id:ae,glyph:ue});else{var Ee=se.requests[Ie];Ee||(Ee=se.requests[Ie]=[],Wt.loadGlyphRange(H,Ie,c.url,c.requestManager,function(Fe,Ae){if(Ae){for(var Ue in Ae)c._doesCharSupportLocalGlyph(+Ue)||(se.glyphs[+Ue]=Ae[+Ue]);se.ranges[Ie]=!0}for(var Ye=0,vt=Ee;Ye<vt.length;Ye+=1)(0,vt[Ye])(Fe,Ae);delete se.requests[Ie]})),Ee.push(function(Fe,Ae){Fe?U(Fe):Ae&&U(null,{stack:H,id:ae,glyph:Ae[ae]||null})})}}else U(null,{stack:H,id:ae,glyph:ue})},function(L,U){if(L)f(L);else if(U){for(var H={},ae=0,se=U;ae<se.length;ae+=1){var ue=se[ae],Ie=ue.stack,Ee=ue.id,Fe=ue.glyph;(H[Ie]||(H[Ie]={}))[Ee]=Fe&&{id:Fe.id,bitmap:Fe.bitmap.clone(),metrics:Fe.metrics}}f(null,H)}})},Wt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Wt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),E=l.tinySDF=new Wt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Wt.loadGlyphRange=function(l,f,c,d,E){var w=256*f,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(U,H){if(U)E(U);else if(H){for(var ae={},se=0,ue=m.parseGlyphPBF(H);se<ue.length;se+=1){var Ie=ue[se];ae[Ie.id]=Ie}E(null,ae)}})},Wt.TinySDF=er;var ut=function(){this.specification=m.styleSpec.light.position};ut.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},ut.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var qe=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new ut,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),St=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Qe=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Qe.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var H=l[U];d.push({left:E=L*c,right:w=(L+=H)*c,isDash:P=!P,zeroLength:H===0})}return d},Qe.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],U=0;U<this.width;U++){U/L.right>1&&(L=l[++P]);var H=Math.abs(U-L.left),ae=Math.abs(U-L.right),se=Math.min(H,ae),ue=void 0,Ie=E/c*(d+1);if(L.isDash){var Ee=d-Math.abs(Ie);ue=Math.sqrt(se*se+Ee*Ee)}else ue=d-Math.sqrt(se*se+Ie*Ie);this.data[w+U]=Math.max(0,Math.min(255,ue+128))}},Qe.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,U=l[L],H=0;H<this.width;H++){H/U.right>1&&(U=l[++L]);var ae=Math.abs(H-U.left),se=Math.abs(H-U.right),ue=Math.min(ae,se);this.data[P+H]=Math.max(0,Math.min(255,(U.isDash?ue:-ue)+128))}},Qe.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);f?this.addRoundDash(L,P,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},Qe.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Xt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function wr(l,f,c){var d=function(E,w){if(E)return c(E);if(w){var P=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=f.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Xt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},Xt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Xt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Xt.Actor=m.Actor;var Gr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Gr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Gr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var Qr=function(l){function f(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Gr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),A=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Gr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,H=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(U,L,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ce=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,H={};return H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),H},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(A),ke=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),xt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ht=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,U=1/0,H=-1/0,ae=-1/0,se=0,ue=P;se<ue.length;se+=1){var Ie=ue[se];L=Math.min(L,Ie.x),U=Math.min(U,Ie.y),H=Math.max(H,Ie.x),ae=Math.max(ae,Ie.y)}var Ee=Math.max(H-L,ae-U),Fe=Math.max(0,Math.floor(-Math.log(Ee)/Math.LN2)),Ae=Math.pow(2,Fe);return new m.CanonicalTileID(Fe,Math.floor((L+H)/2*Ae),Math.floor((U+ae)/2*Ae))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,xt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ft=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new m.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,xt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ht),Gt=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,xt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(ht),Er={vector:Qr,raster:A,"raster-dem":Ce,geojson:ke,video:Ft,image:ht,canvas:Gt};function Qn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function gn(l,f,c,d,E,w){var P=function(Fe,Ae,Ue){if(Fe)for(var Ye=0,vt=Fe;Ye<vt.length;Ye+=1){var Vt=Ae[vt[Ye]];if(Vt&&Vt.source===Ue&&Vt.type==="fill-extrusion")return!0}else for(var zt in Ae){var Ht=Ae[zt];if(Ht.source===Ue&&Ht.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,P);U.sort(di);for(var H=[],ae=0,se=U;ae<se.length;ae+=1){var ue=se[ae];H.push({wrappedTileID:ue.tileID.wrapped().key,queryResults:ue.tile.queryRenderedFeatures(f,c,l._state,ue.queryGeometry,ue.cameraQueryGeometry,ue.scale,E,w,L,Qn(l.transform,ue.tileID))})}var Ie=function(Fe){for(var Ae={},Ue={},Ye=0,vt=Fe;Ye<vt.length;Ye+=1){var Vt=vt[Ye],zt=Vt.queryResults,Ht=Vt.wrappedTileID,fr=Ue[Ht]=Ue[Ht]||{};for(var xr in zt)for(var Or=zt[xr],an=fr[xr]=fr[xr]||{},Un=Ae[xr]=Ae[xr]||[],On=0,Bn=Or;On<Bn.length;On+=1){var Ti=Bn[On];an[Ti.featureIndex]||(an[Ti.featureIndex]=!0,Un.push(Ti))}}return Ae}(H);for(var Ee in Ie)Ie[Ee].forEach(function(Fe){var Ae=Fe.feature,Ue=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Ue});return Ie}function di(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Hn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Hn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Hn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},Hn.prototype.has=function(l){return l.wrapped().key in this.data},Hn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Hn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Hn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Hn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Hn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Hn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Hn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||f.push(w)}for(var P=0,L=f;P<L.length;P+=1){var U=L[P];this.remove(U.value.tileID,U)}};var ai=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ai.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ai.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ai.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Xn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Xn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Xn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Xn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Xn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=f.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[vi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mi.prototype.get=function(){return this.current},mi.prototype.set=function(l){},mi.prototype.getDefault=function(){return this.default},mi.prototype.setDefault=function(){this.set(this.default)};var fa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Wi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(mi),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(mi),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),pa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(mi),Lo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(mi),Ia=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(mi),_a=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(mi),Ni=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(mi),aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),Ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(mi),Ss=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(mi),he=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(mi),oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),xo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Js=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(mi),Nt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(mi),$t=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(mi),Ir=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(mi),nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(mi),wn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(mi),zn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),xi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),En=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(mi),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(mi),Pi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(mi),to=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(mi),fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(mi),Go=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),Da=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),xa=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(mi),G=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(xa),q=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(xa),te=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new G(l,E),d&&(this.depthAttachment=new q(l,E))};te.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var de=function(l,f,c){this.func=l,this.mask=f,this.range=c};de.ReadOnly=!1,de.ReadWrite=!0,de.disabled=new de(519,de.ReadOnly,[0,1]);var Me=function(l,f,c,d,E,w){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var Ve=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ve.disabled=new Ve(Ve.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ve.unblended=new Ve(Ve.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ve.alphaBlended=new Ve([1,771],m.Color.transparent,[!0,!0,!0,!0]);var $e=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};$e.disabled=new $e(!1,1029,2305),$e.backCCW=new $e(!0,1029,2305);var oe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new fa(this),this.clearDepth=new Wi(this),this.clearStencil=new Li(this),this.colorMask=new Qi(this),this.depthMask=new pa(this),this.stencilMask=new Lo(this),this.stencilFunc=new Ia(this),this.stencilOp=new _a(this),this.stencilTest=new Ni(this),this.depthRange=new aa(this),this.depthTest=new Ji(this),this.depthFunc=new Ss(this),this.blend=new he(this),this.blendFunc=new oi(this),this.blendColor=new xo(this),this.blendEquation=new Js(this),this.cullFace=new Nt(this),this.cullFaceSide=new $t(this),this.frontFace=new Ir(this),this.program=new nn(this),this.activeTexture=new wn(this),this.viewport=new zn(this),this.bindFramebuffer=new xi(this),this.bindRenderbuffer=new fi(this),this.bindTexture=new En(this),this.bindVertexBuffer=new Ii(this),this.bindElementBuffer=new Pi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new to(this),this.pixelStoreUnpack=new fs(this),this.pixelStoreUnpackPremultiplyAlpha=new Go(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};oe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},oe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},oe.prototype.createIndexBuffer=function(l,f){return new ai(this,l,f)},oe.prototype.createVertexBuffer=function(l,f,c){return new Xn(this,l,f,c)},oe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},oe.prototype.createFramebuffer=function(l,f,c){return new te(this,l,f,c)},oe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},oe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},oe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},oe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},oe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ve.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},oe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Re=function(l){function f(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,U,H){var ae=new Er[L.type](P,L,U,H);if(ae.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ae.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ae),ae}(c,d,E,this),this._tiles={},this._cache=new Hn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(lt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var U=P.tileID,H=L.tileID,ae=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),se=new m.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-H.overscaledZ||se.y-ae.y||se.x-ae.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(lt).map(function(P){return P.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(U,H){U.needsHillshadePrepare=!0;var ae=H.tileID.canonical.x-U.tileID.canonical.x,se=H.tileID.canonical.y-U.tileID.canonical.y,ue=Math.pow(2,U.tileID.canonical.z),Ie=H.tileID.key;ae===0&&se===0||Math.abs(se)>1||(Math.abs(ae)>1&&(Math.abs(ae+ue)===1?ae+=ue:Math.abs(ae-ue)===1&&(ae-=ue)),H.dem&&U.dem&&(U.dem.backfillBorder(H.dem,ae,se),U.neighboringTiles&&U.neighboringTiles[Ie]&&(U.neighboringTiles[Ie].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var H=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[H.key])&&L.hasData()&&(U=H)}for(var ae=U;ae.overscaledZ>d;)if(c[(ae=ae.scaledTo(ae.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(fr){return new m.OverscaledTileID(fr.canonical.z,fr.wrap,fr.canonical.z,fr.canonical.x,fr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(fr){return d._source.hasTile(fr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-f.maxOverzooming,this._source.minzoom),L=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(cr(this._source.type)){for(var H={},ae={},se=0,ue=Object.keys(U);se<ue.length;se+=1){var Ie=ue[se],Ee=U[Ie],Fe=this._tiles[Ie];if(Fe&&!(Fe.fadeEndTime&&Fe.fadeEndTime<=m.browser.now())){var Ae=this.findLoadedParent(Ee,P);Ae&&(this._addTile(Ae.tileID),H[Ae.tileID.key]=Ae.tileID),ae[Ie]=Ee}}for(var Ue in this._retainLoadedChildren(ae,w,L,U),H)U[Ue]||(this._coveredTiles[Ue]=!0,U[Ue]=H[Ue])}for(var Ye in U)this._tiles[Ye].clearFadeHold();for(var vt=0,Vt=m.keysDifference(this._tiles,U);vt<Vt.length;vt+=1){var zt=Vt[vt],Ht=this._tiles[zt];Ht.hasSymbolBuckets&&!Ht.holdingForFade()?Ht.setHoldDuration(this.map._fadeDuration):Ht.hasSymbolBuckets&&!Ht.symbolFadeFinished()||this._removeTile(zt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},H=0,ae=c;H<ae.length;H+=1){var se=ae[H],ue=this._addTile(se);E[se.key]=se,ue.hasData()||d<this._source.maxzoom&&(U[se.key]=se)}this._retainLoadedChildren(U,d,L,E);for(var Ie=0,Ee=c;Ie<Ee.length;Ie+=1){var Fe=Ee[Ie],Ae=this._tiles[Fe.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var Ue=Fe.children(this._source.maxzoom)[0],Ye=this.getTile(Ue);if(Ye&&Ye.hasData()){E[Ue.key]=Ue;continue}}else{var vt=Fe.children(this._source.maxzoom);if(E[vt[0].key]&&E[vt[1].key]&&E[vt[2].key]&&E[vt[3].key])continue}for(var Vt=Ae.wasRequested(),zt=Fe.overscaledZ-1;zt>=P;--zt){var Ht=Fe.scaledTo(zt);if(w[Ht.key]||(w[Ht.key]=!0,!(Ae=this.getTile(Ht))&&Vt&&(Ae=this._addTile(Ht)),Ae&&(E[Ht.key]=Ht,Vt=Ae.wasRequested(),Ae.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var U=E?L.getCameraQueryGeometry(c):c,H=c.map(function(zt){return L.pointCoordinate(zt)}),ae=U.map(function(zt){return L.pointCoordinate(zt)}),se=this.getIds(),ue=1/0,Ie=1/0,Ee=-1/0,Fe=-1/0,Ae=0,Ue=ae;Ae<Ue.length;Ae+=1){var Ye=Ue[Ae];ue=Math.min(ue,Ye.x),Ie=Math.min(Ie,Ye.y),Ee=Math.max(Ee,Ye.x),Fe=Math.max(Fe,Ye.y)}for(var vt=function(zt){var Ht=w._tiles[se[zt]];if(!Ht.holdingForFade()){var fr=Ht.tileID,xr=Math.pow(2,L.zoom-Ht.tileID.overscaledZ),Or=d*Ht.queryPadding*m.EXTENT/Ht.tileSize/xr,an=[fr.getTilePoint(new m.MercatorCoordinate(ue,Ie)),fr.getTilePoint(new m.MercatorCoordinate(Ee,Fe))];if(an[0].x-Or<m.EXTENT&&an[0].y-Or<m.EXTENT&&an[1].x+Or>=0&&an[1].y+Or>=0){var Un=H.map(function(Bn){return fr.getTilePoint(Bn)}),On=ae.map(function(Bn){return fr.getTilePoint(Bn)});P.push({tile:Ht,tileID:fr,queryGeometry:Un,cameraQueryGeometry:On,scale:xr})}}},Vt=0;Vt<se.length;Vt++)vt(Vt);return P},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(cr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},f}(m.Evented);function lt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function cr(l){return l==="raster"||l==="image"||l==="video"}function Rt(){return new m.window.Worker(cc.workerUrl)}Re.maxOverzooming=10,Re.maxUnderzooming=3;var Lt="mapboxgl_preloaded_worker_pool",pr=function(){this.active={}};pr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new Rt);return this.active[l]=!0,this.workers.slice()},pr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},pr.prototype.isPreloaded=function(){return!!this.active[Lt]},pr.prototype.numActive=function(){return Object.keys(this.active).length};var _n,un=Math.floor(m.browser.hardwareConcurrency/2);function Ct(){return _n||(_n=new pr),_n}function Kr(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Dr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Kr(l[d],f[l[d].ref]));return l}pr.workerCount=Math.max(Math.min(un,6),1);var Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function pi(l,f,c){c.push({command:Hr.addSource,args:[l,f[l]]})}function $r(l,f,c){f.push({command:Hr.removeSource,args:[l]}),c[l]=!0}function yn(l,f,c,d){$r(l,c,d),pi(l,f,c)}function Zi(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function li(l,f,c,d,E,w){var P;for(P in f=f||{},l=l||{})l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}));for(P in f)f.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}))}function Ci(l){return l.id}function gi(l,f){return l[f.id]=f,l}var ft=function(l,f){this.reset(l,f)};ft.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ft.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[f].mult(L))};var Mt=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function wa(l,f,c,d,E){var w=m.create();return f?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function Ei(l,f,c,d,E){if(f){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ai(l,f){var c=[l.x,l.y,0,1];Ta(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Di(l,f){return .5+l/f*.5}function Rr(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function cn(l,f,c,d,E,w,P,L){var U=d?l.textSizeData:l.iconSizeData,H=m.evaluateSizeForZoom(U,c.transform.zoom),ae=[256/c.width*2+1,256/c.height*2+1],se=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;se.clear();for(var ue=l.lineVertexArray,Ie=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ee=c.transform.width/c.transform.height,Fe=!1,Ae=0;Ae<Ie.length;Ae++){var Ue=Ie.get(Ae);if(Ue.hidden||Ue.writingMode===m.WritingMode.vertical&&!Fe)Fa(Ue.numGlyphs,se);else{Fe=!1;var Ye=[Ue.anchorX,Ue.anchorY,0,1];if(m.transformMat4(Ye,Ye,f),Rr(Ye,ae)){var vt=Di(c.transform.cameraToCenterDistance,Ye[3]),Vt=m.evaluateSizeForFeature(U,H,Ue),zt=P?Vt/vt:Vt*vt,Ht=new m.Point(Ue.anchorX,Ue.anchorY),fr=Ai(Ht,E).point,xr={},Or=le(Ue,zt,!1,L,f,E,w,l.glyphOffsetArray,ue,se,fr,Ht,xr,Ee);Fe=Or.useVertical,(Or.notEnoughRoom||Fe||Or.needsFlipping&&le(Ue,zt,!0,L,f,E,w,l.glyphOffsetArray,ue,se,fr,Ht,xr,Ee).notEnoughRoom)&&Fa(Ue.numGlyphs,se)}else Fa(Ue.numGlyphs,se)}}d?l.text.dynamicLayoutVertexBuffer.updateData(se):l.icon.dynamicLayoutVertexBuffer.updateData(se)}function _t(l,f,c,d,E,w,P,L,U,H,ae){var se=L.glyphStartIndex+L.numGlyphs,ue=L.lineStartIndex,Ie=L.lineStartIndex+L.lineLength,Ee=f.getoffsetX(L.glyphStartIndex),Fe=f.getoffsetX(se-1),Ae=Ki(l*Ee,c,d,E,w,P,L.segment,ue,Ie,U,H,ae);if(!Ae)return null;var Ue=Ki(l*Fe,c,d,E,w,P,L.segment,ue,Ie,U,H,ae);return Ue?{first:Ae,last:Ue}:null}function ea(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function le(l,f,c,d,E,w,P,L,U,H,ae,se,ue,Ie){var Ee,Fe=f/24,Ae=l.lineOffsetX*Fe,Ue=l.lineOffsetY*Fe;if(l.numGlyphs>1){var Ye=l.glyphStartIndex+l.numGlyphs,vt=l.lineStartIndex,Vt=l.lineStartIndex+l.lineLength,zt=_t(Fe,L,Ae,Ue,c,ae,se,l,U,w,ue);if(!zt)return{notEnoughRoom:!0};var Ht=Ai(zt.first.point,P).point,fr=Ai(zt.last.point,P).point;if(d&&!c){var xr=ea(l.writingMode,Ht,fr,Ie);if(xr)return xr}Ee=[zt.first];for(var Or=l.glyphStartIndex+1;Or<Ye-1;Or++)Ee.push(Ki(Fe*L.getoffsetX(Or),Ae,Ue,c,ae,se,l.segment,vt,Vt,U,w,ue));Ee.push(zt.last)}else{if(d&&!c){var an=Ai(se,E).point,Un=l.lineStartIndex+l.segment+1,On=new m.Point(U.getx(Un),U.gety(Un)),Bn=Ai(On,E),Ti=Bn.signedDistanceFromCamera>0?Bn.point:Ko(se,On,an,1,E),tn=ea(l.writingMode,an,Ti,Ie);if(tn)return tn}var ri=Ki(Fe*L.getoffsetX(l.glyphStartIndex),Ae,Ue,c,ae,se,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,ue);if(!ri)return{notEnoughRoom:!0};Ee=[ri]}for(var ni=0,Yn=Ee;ni<Yn.length;ni+=1){var Vn=Yn[ni];m.addDynamicAttributes(H,Vn.point,Vn.angle)}return{}}function Ko(l,f,c,d,E){var w=Ai(l.add(l.sub(f)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function Ki(l,f,c,d,E,w,P,L,U,H,ae,se){var ue=d?l-f:l+f,Ie=ue>0?1:-1,Ee=0;d&&(Ie*=-1,Ee=Math.PI),Ie<0&&(Ee+=Math.PI);for(var Fe=Ie>0?L+P:L+P+1,Ae=E,Ue=E,Ye=0,vt=0,Vt=Math.abs(ue),zt=[];Ye+vt<=Vt;){if((Fe+=Ie)<L||Fe>=U)return null;if(Ue=Ae,zt.push(Ae),(Ae=se[Fe])===void 0){var Ht=new m.Point(H.getx(Fe),H.gety(Fe)),fr=Ai(Ht,ae);if(fr.signedDistanceFromCamera>0)Ae=se[Fe]=fr.point;else{var xr=Fe-Ie;Ae=Ko(Ye===0?w:new m.Point(H.getx(xr),H.gety(xr)),Ht,Ue,Vt-Ye+1,ae)}}Ye+=vt,vt=Ue.dist(Ae)}var Or=(Vt-Ye)/vt,an=Ae.sub(Ue),Un=an.mult(Or)._add(Ue);Un._add(an._unit()._perp()._mult(c*Ie));var On=Ee+Math.atan2(Ae.y-Ue.y,Ae.x-Ue.x);return zt.push(Un),{point:Un,angle:On,path:zt}}Mt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Mt.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Mt.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Mt.prototype._insertBoxCell=function(l,f,c,d,E,w){this.boxCells[E].push(w)},Mt.prototype._insertCircleCell=function(l,f,c,d,E,w){this.circleCells[E].push(w)},Mt.prototype._query=function(l,f,c,d,E,w){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var P=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var H=this.circles[3*U],ae=this.circles[3*U+1],se=this.circles[3*U+2];P.push({key:this.circleKeys[U],x1:H-se,y1:ae-se,x2:H+se,y2:ae+se})}return w?P.filter(w):P}return this._forEachCell(l,f,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},Mt.prototype._queryCircle=function(l,f,c,d,E){var w=l-c,P=l+c,L=f-c,U=f+c;if(P<0||w>this.width||U<0||L>this.height)return!d&&[];var H=[];return this._forEachCell(w,L,P,U,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?H.length>0:H},Mt.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},Mt.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},Mt.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Mt.prototype._queryCell=function(l,f,c,d,E,w,P,L){var U=P.seenUids,H=this.boxCells[E];if(H!==null)for(var ae=this.bboxes,se=0,ue=H;se<ue.length;se+=1){var Ie=ue[se];if(!U.box[Ie]){U.box[Ie]=!0;var Ee=4*Ie;if(l<=ae[Ee+2]&&f<=ae[Ee+3]&&c>=ae[Ee+0]&&d>=ae[Ee+1]&&(!L||L(this.boxKeys[Ie]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Ie],x1:ae[Ee],y1:ae[Ee+1],x2:ae[Ee+2],y2:ae[Ee+3]})}}}var Fe=this.circleCells[E];if(Fe!==null)for(var Ae=this.circles,Ue=0,Ye=Fe;Ue<Ye.length;Ue+=1){var vt=Ye[Ue];if(!U.circle[vt]){U.circle[vt]=!0;var Vt=3*vt;if(this._circleAndRectCollide(Ae[Vt],Ae[Vt+1],Ae[Vt+2],l,f,c,d)&&(!L||L(this.circleKeys[vt]))){if(P.hitTest)return w.push(!0),!0;var zt=Ae[Vt],Ht=Ae[Vt+1],fr=Ae[Vt+2];w.push({key:this.circleKeys[vt],x1:zt-fr,y1:Ht-fr,x2:zt+fr,y2:Ht+fr})}}}},Mt.prototype._queryCellCircle=function(l,f,c,d,E,w,P,L){var U=P.circle,H=P.seenUids,ae=this.boxCells[E];if(ae!==null)for(var se=this.bboxes,ue=0,Ie=ae;ue<Ie.length;ue+=1){var Ee=Ie[ue];if(!H.box[Ee]){H.box[Ee]=!0;var Fe=4*Ee;if(this._circleAndRectCollide(U.x,U.y,U.radius,se[Fe+0],se[Fe+1],se[Fe+2],se[Fe+3])&&(!L||L(this.boxKeys[Ee])))return w.push(!0),!0}}var Ae=this.circleCells[E];if(Ae!==null)for(var Ue=this.circles,Ye=0,vt=Ae;Ye<vt.length;Ye+=1){var Vt=vt[Ye];if(!H.circle[Vt]){H.circle[Vt]=!0;var zt=3*Vt;if(this._circlesCollide(Ue[zt],Ue[zt+1],Ue[zt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Vt])))return w.push(!0),!0}}},Mt.prototype._forEachCell=function(l,f,c,d,E,w,P,L){for(var U=this._convertToXCellCoord(l),H=this._convertToYCellCoord(f),ae=this._convertToXCellCoord(c),se=this._convertToYCellCoord(d),ue=U;ue<=ae;ue++)for(var Ie=H;Ie<=se;Ie++)if(E.call(this,l,f,c,d,this.xCellCount*Ie+ue,w,P,L))return},Mt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Mt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Mt.prototype._circlesCollide=function(l,f,c,d,E,w){var P=d-l,L=E-f,U=c+w;return U*U>P*P+L*L},Mt.prototype._circleAndRectCollide=function(l,f,c,d,E,w,P){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var H=(P-E)/2,ae=Math.abs(f-(E+H));if(ae>H+c)return!1;if(U<=L||ae<=H)return!0;var se=U-L,ue=ae-H;return se*se+ue*ue<=c*c};var fu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fa(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(fu,3*d)}}function Ta(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var Ha=function(l,f,c){f===void 0&&(f=new Mt(l.width+200,l.height+200,25)),c===void 0&&(c=new Mt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ta(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ha.prototype.placeCollisionBox=function(l,f,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,U=l.y1*P+w.point.y,H=l.x2*P+w.point.x,ae=l.y2*P+w.point.y;return!this.isInsideGrid(L,U,H,ae)||!f&&this.grid.hitTest(L,U,H,ae,E)?{box:[],offscreen:!1}:{box:[L,U,H,ae],offscreen:this.isOffscreen(L,U,H,ae)}},Ha.prototype.placeCollisionCircles=function(l,f,c,d,E,w,P,L,U,H,ae,se,ue){var Ie=[],Ee=new m.Point(f.anchorX,f.anchorY),Fe=Ai(Ee,w),Ae=Di(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Ue=(H?E/Ae:E*Ae)/m.ONE_EM,Ye=Ai(Ee,P).point,vt=_t(Ue,d,f.lineOffsetX*Ue,f.lineOffsetY*Ue,!1,Ye,Ee,f,c,P,{}),Vt=!1,zt=!1,Ht=!0;if(vt){for(var fr=.5*se*Ae+ue,xr=new m.Point(-100,-100),Or=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),an=new ft,Un=vt.first,On=vt.last,Bn=[],Ti=Un.path.length-1;Ti>=1;Ti--)Bn.push(Un.path[Ti]);for(var tn=1;tn<On.path.length;tn++)Bn.push(On.path[tn]);var ri=2.5*fr;if(L){var ni=Bn.map(function(go){return Ai(go,L)});Bn=ni.some(function(go){return go.signedDistanceFromCamera<=0})?[]:ni.map(function(go){return go.point})}var Yn=[];if(Bn.length>0){for(var Vn=Bn[0].clone(),ci=Bn[0].clone(),Wn=1;Wn<Bn.length;Wn++)Vn.x=Math.min(Vn.x,Bn[Wn].x),Vn.y=Math.min(Vn.y,Bn[Wn].y),ci.x=Math.max(ci.x,Bn[Wn].x),ci.y=Math.max(ci.y,Bn[Wn].y);Yn=Vn.x>=xr.x&&ci.x<=Or.x&&Vn.y>=xr.y&&ci.y<=Or.y?[Bn]:ci.x<xr.x||Vn.x>Or.x||ci.y<xr.y||Vn.y>Or.y?[]:m.clipLine([Bn],xr.x,xr.y,Or.x,Or.y)}for(var Gn=0,bo=Yn;Gn<bo.length;Gn+=1){var Va;an.reset(bo[Gn],.25*fr),Va=an.length<=.5*fr?1:Math.ceil(an.paddedLength/ri)+1;for(var ka=0;ka<Va;ka++){var Mo=ka/Math.max(Va-1,1),Ya=an.lerp(Mo),fo=Ya.x+100,Ps=Ya.y+100;Ie.push(fo,Ps,fr,0);var as=fo-fr,Lu=Ps-fr,os=fo+fr,Ls=Ps+fr;if(Ht=Ht&&this.isOffscreen(as,Lu,os,Ls),zt=zt||this.isInsideGrid(as,Lu,os,Ls),!l&&this.grid.hitTestCircle(fo,Ps,fr,ae)&&(Vt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!U&&Vt||!zt?[]:Ie,offscreen:Ht,collisionDetected:Vt}},Ha.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var U=L[P],H=new m.Point(U.x+100,U.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),E=Math.max(E,H.x),w=Math.max(w,H.y),f.push(H)}for(var ae={},se={},ue=0,Ie=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));ue<Ie.length;ue+=1){var Ee=Ie[ue],Fe=Ee.key;if(ae[Fe.bucketInstanceId]===void 0&&(ae[Fe.bucketInstanceId]={}),!ae[Fe.bucketInstanceId][Fe.featureIndex]){var Ae=[new m.Point(Ee.x1,Ee.y1),new m.Point(Ee.x2,Ee.y1),new m.Point(Ee.x2,Ee.y2),new m.Point(Ee.x1,Ee.y2)];m.polygonIntersectsPolygon(f,Ae)&&(ae[Fe.bucketInstanceId][Fe.featureIndex]=!0,se[Fe.bucketInstanceId]===void 0&&(se[Fe.bucketInstanceId]=[]),se[Fe.bucketInstanceId].push(Fe.featureIndex))}}return se},Ha.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},Ha.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var w=f?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},Ha.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return Ta(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ha.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Ha.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Ha.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var wo=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};wo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ho=function(l,f,c,d,E){this.text=new wo(l?l.text:null,f,c,E),this.icon=new wo(l?l.icon:null,f,d,E)};Ho.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Eu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},ho=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Do=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},ra=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Wa(l,f,c,d,E){var w=m.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*f,L=-(w.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(P+U[0]*E,L+U[1]*E)}function Fo(l,f,c,d,E,w){var P=l.x1,L=l.x2,U=l.y1,H=l.y2,ae=l.anchorPointX,se=l.anchorPointY,ue=new m.Point(f,c);return d&&ue._rotate(E?w:-w),{x1:P+ue.x,y1:U+ue.y,x2:L+ue.x,y2:H+ue.y,anchorPointX:ae,anchorPointY:se}}ra.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Xa=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new Ha(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ra(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Cs(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}Xa.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),w=c.latestFeatureIndex;if(E&&w&&f.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/m.EXTENT,ae=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),se=L.get("text-pitch-alignment")==="map",ue=L.get("text-rotation-alignment")==="map",Ie=ta(c,1,this.transform.zoom),Ee=wa(ae,se,ue,this.transform,Ie),Fe=null;if(se){var Ae=Ei(ae,se,ue,this.transform,Ie);Fe=m.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[E.bucketInstanceId]=new Do(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Ue={bucket:E,layout:L,posMatrix:ae,textLabelPlaneMatrix:Ee,labelToScreenMatrix:Fe,scale:U,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var Ye=0,vt=E.sortKeyRanges;Ye<vt.length;Ye+=1){var Vt=vt[Ye];l.push({sortKey:Vt.sortKey,symbolInstanceStart:Vt.symbolInstanceStart,symbolInstanceEnd:Vt.symbolInstanceEnd,parameters:Ue})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ue})}},Xa.prototype.attemptAnchorPlacement=function(l,f,c,d,E,w,P,L,U,H,ae,se,ue,Ie,Ee){var Fe,Ae=[se.textOffset0,se.textOffset1],Ue=Wa(l,c,d,Ae,E),Ye=this.collisionIndex.placeCollisionBox(Fo(f,Ue.x,Ue.y,w,P,this.transform.angle),ae,L,U,H.predicate);if(!Ee||this.collisionIndex.placeCollisionBox(Fo(Ee,Ue.x,Ue.y,w,P,this.transform.angle),ae,L,U,H.predicate).box.length!==0)return Ye.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Fe},this.markUsedJustification(ue,l,se,Ie),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,Ie,se),this.placedOrientations[se.crossTileID]=Ie),{shift:Ue,placedGlyphBoxes:Ye}):void 0},Xa.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,H=E.labelToScreenMatrix,ae=E.textPixelRatio,se=E.holdingForFade,ue=E.collisionBoxArray,Ie=E.partiallyEvaluatedTextSize,Ee=E.collisionGroup,Fe=P.get("text-optional"),Ae=P.get("icon-optional"),Ue=P.get("text-allow-overlap"),Ye=P.get("icon-allow-overlap"),vt=P.get("text-rotation-alignment")==="map",Vt=P.get("text-pitch-alignment")==="map",zt=P.get("icon-text-fit")!=="none",Ht=P.get("symbol-z-order")==="viewport-y",fr=Ue&&(Ye||!w.hasIconData()||Ae),xr=Ye&&(Ue||!w.hasTextData()||Fe);!w.collisionArrays&&ue&&w.deserializeCollisionBoxes(ue);var Or=function(tn,ri){if(!f[tn.crossTileID])if(se)d.placements[tn.crossTileID]=new Eu(!1,!1,!1);else{var ni,Yn=!1,Vn=!1,ci=!0,Wn=null,Gn={box:null,offscreen:null},bo={box:null,offscreen:null},Va=null,ka=null,Mo=0,Ya=0,fo=0;ri.textFeatureIndex?Mo=ri.textFeatureIndex:tn.useRuntimeCollisionCircles&&(Mo=tn.featureIndex),ri.verticalTextFeatureIndex&&(Ya=ri.verticalTextFeatureIndex);var Ps=ri.textBox;if(Ps){var as=function(na){var Is=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!na&&d.prevPlacement){var No=d.prevPlacement.placedOrientations[tn.crossTileID];No&&(d.placedOrientations[tn.crossTileID]=No,d.markUsedOrientation(w,Is=No,tn))}return Is},Lu=function(na,Is){if(w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&ri.verticalTextBox)for(var No=0,tl=w.writingModes;No<tl.length&&(tl[No]===m.WritingMode.vertical?(Gn=Is(),bo=Gn):Gn=na(),!(Gn&&Gn.box&&Gn.box.length));No+=1);else Gn=na()};if(P.get("text-variable-anchor")){var os=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[tn.crossTileID]){var Ls=d.prevPlacement.variableOffsets[tn.crossTileID];os.indexOf(Ls.anchor)>0&&(os=os.filter(function(na){return na!==Ls.anchor})).unshift(Ls.anchor)}var go=function(na,Is,No){for(var tl=na.x2-na.x1,Nc=na.y2-na.y1,zc=tn.textBoxScale,bf=zt&&!Ye?Is:null,qs={box:[],offscreen:!1},Vl=Ue?2*os.length:os.length,uu=0;uu<Vl;++uu){var rl=d.attemptAnchorPlacement(os[uu%os.length],na,tl,Nc,zc,vt,Vt,ae,L,Ee,uu>=os.length,tn,w,No,bf);if(rl&&(qs=rl.placedGlyphBoxes)&&qs.box&&qs.box.length){Yn=!0,Wn=rl.shift;break}}return qs};Lu(function(){return go(Ps,ri.iconBox,m.WritingMode.horizontal)},function(){var na=ri.verticalTextBox;return w.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&tn.numVerticalGlyphVertices>0&&na?go(na,ri.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Gn&&(Yn=Gn.box,ci=Gn.offscreen);var fc=as(Gn&&Gn.box);if(!Yn&&d.prevPlacement){var Ul=d.prevPlacement.variableOffsets[tn.crossTileID];Ul&&(d.variableOffsets[tn.crossTileID]=Ul,d.markUsedJustification(w,Ul.anchor,tn,fc))}}else{var vu=function(na,Is){var No=d.collisionIndex.placeCollisionBox(na,Ue,ae,L,Ee.predicate);return No&&No.box&&No.box.length&&(d.markUsedOrientation(w,Is,tn),d.placedOrientations[tn.crossTileID]=Is),No};Lu(function(){return vu(Ps,m.WritingMode.horizontal)},function(){var na=ri.verticalTextBox;return w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&na?vu(na,m.WritingMode.vertical):{box:null,offscreen:null}}),as(Gn&&Gn.box&&Gn.box.length)}}if(Yn=(ni=Gn)&&ni.box&&ni.box.length>0,ci=ni&&ni.offscreen,tn.useRuntimeCollisionCircles){var yl=w.text.placedSymbolArray.get(tn.centerJustifiedTextSymbolIndex),Zl=m.evaluateSizeForFeature(w.textSizeData,Ie,yl),Ys=P.get("text-padding");Va=d.collisionIndex.placeCollisionCircles(Ue,yl,w.lineVertexArray,w.glyphOffsetArray,Zl,L,U,H,c,Vt,Ee.predicate,tn.collisionCircleDiameter,Ys),Yn=Ue||Va.circles.length>0&&!Va.collisionDetected,ci=ci&&Va.offscreen}if(ri.iconFeatureIndex&&(fo=ri.iconFeatureIndex),ri.iconBox){var jl=function(na){var Is=zt&&Wn?Fo(na,Wn.x,Wn.y,vt,Vt,d.transform.angle):na;return d.collisionIndex.placeCollisionBox(Is,Ye,ae,L,Ee.predicate)};Vn=bo&&bo.box&&bo.box.length&&ri.verticalIconBox?(ka=jl(ri.verticalIconBox)).box.length>0:(ka=jl(ri.iconBox)).box.length>0,ci=ci&&ka.offscreen}var mu=Fe||tn.numHorizontalGlyphVertices===0&&tn.numVerticalGlyphVertices===0,Eo=Ae||tn.numIconVertices===0;if(mu||Eo?Eo?mu||(Vn=Vn&&Yn):Yn=Vn&&Yn:Vn=Yn=Vn&&Yn,Yn&&ni&&ni.box&&d.collisionIndex.insertCollisionBox(ni.box,P.get("text-ignore-placement"),w.bucketInstanceId,bo&&bo.box&&Ya?Ya:Mo,Ee.ID),Vn&&ka&&d.collisionIndex.insertCollisionBox(ka.box,P.get("icon-ignore-placement"),w.bucketInstanceId,fo,Ee.ID),Va&&(Yn&&d.collisionIndex.insertCollisionCircles(Va.circles,P.get("text-ignore-placement"),w.bucketInstanceId,Mo,Ee.ID),c)){var gu=w.bucketInstanceId,Ju=d.collisionCircleArrays[gu];Ju===void 0&&(Ju=d.collisionCircleArrays[gu]=new ho);for(var el=0;el<Va.circles.length;el+=4)Ju.circles.push(Va.circles[el+0]),Ju.circles.push(Va.circles[el+1]),Ju.circles.push(Va.circles[el+2]),Ju.circles.push(Va.collisionDetected?1:0)}d.placements[tn.crossTileID]=new Eu(Yn||fr,Vn||xr,ci||w.justReloaded),f[tn.crossTileID]=!0}};if(Ht)for(var an=w.getSortedSymbolIndexes(this.transform.angle),Un=an.length-1;Un>=0;--Un){var On=an[Un];Or(w.symbolInstances.get(On),w.collisionArrays[On])}else for(var Bn=l.symbolInstanceStart;Bn<l.symbolInstanceEnd;Bn++)Or(w.symbolInstances.get(Bn),w.collisionArrays[Bn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Ti=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Ti.invProjMatrix,L),Ti.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Xa.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Xa.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Xa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},w=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],H=E[L];H?(this.opacities[L]=new Ho(H,d,U.text,U.icon),c=c||U.text!==H.text.placed||U.icon!==H.icon.placed):(this.opacities[L]=new Ho(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var ae in E){var se=E[ae];if(!this.opacities[ae]){var ue=new Ho(se,d,!1,!1);ue.isHidden()||(this.opacities[ae]=ue,c=c||se.text.placed||se.icon.placed)}}for(var Ie in w)this.variableOffsets[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.variableOffsets[Ie]=w[Ie]);for(var Ee in P)this.placedOrientations[Ee]||!this.opacities[Ee]||this.opacities[Ee].isHidden()||(this.placedOrientations[Ee]=P[Ee]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Xa.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Xa.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new Ho(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",ae=E.get("text-pitch-alignment")==="map",se=E.get("icon-text-fit")!=="none",ue=new Ho(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Ie=function(Ue,Ye,vt){for(var Vt=0;Vt<Ye/4;Vt++)Ue.opacityVertexArray.emplaceBack(vt)},Ee=function(Ue){var Ye=l.symbolInstances.get(Ue),vt=Ye.numHorizontalGlyphVertices,Vt=Ye.numVerticalGlyphVertices,zt=Ye.crossTileID,Ht=d.opacities[zt];f[zt]?Ht=w:Ht||(d.opacities[zt]=Ht=ue),f[zt]=!0;var fr=Ye.numIconVertices>0,xr=d.placedOrientations[Ye.crossTileID],Or=xr===m.WritingMode.vertical,an=xr===m.WritingMode.horizontal||xr===m.WritingMode.horizontalOnly;if(vt>0||Vt>0){var Un=Mn(Ht.text);Ie(l.text,vt,Or?wi:Un),Ie(l.text,Vt,an?wi:Un);var On=Ht.text.isHidden();[Ye.rightJustifiedTextSymbolIndex,Ye.centerJustifiedTextSymbolIndex,Ye.leftJustifiedTextSymbolIndex].forEach(function(Gn){Gn>=0&&(l.text.placedSymbolArray.get(Gn).hidden=On||Or?1:0)}),Ye.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Ye.verticalPlacedTextSymbolIndex).hidden=On||an?1:0);var Bn=d.variableOffsets[Ye.crossTileID];Bn&&d.markUsedJustification(l,Bn.anchor,Ye,xr);var Ti=d.placedOrientations[Ye.crossTileID];Ti&&(d.markUsedJustification(l,"left",Ye,Ti),d.markUsedOrientation(l,Ti,Ye))}if(fr){var tn=Mn(Ht.icon),ri=!(se&&Ye.verticalPlacedIconSymbolIndex&&Or);Ye.placedIconSymbolIndex>=0&&(Ie(l.icon,Ye.numIconVertices,ri?tn:wi),l.icon.placedSymbolArray.get(Ye.placedIconSymbolIndex).hidden=Ht.icon.isHidden()),Ye.verticalPlacedIconSymbolIndex>=0&&(Ie(l.icon,Ye.numVerticalIconVertices,ri?wi:tn),l.icon.placedSymbolArray.get(Ye.verticalPlacedIconSymbolIndex).hidden=Ht.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ni=l.collisionArrays[Ue];if(ni){var Yn=new m.Point(0,0);if(ni.textBox||ni.verticalTextBox){var Vn=!0;if(U){var ci=d.variableOffsets[zt];ci?(Yn=Wa(ci.anchor,ci.width,ci.height,ci.textOffset,ci.textBoxScale),H&&Yn._rotate(ae?d.transform.angle:-d.transform.angle)):Vn=!1}ni.textBox&&Cs(l.textCollisionBox.collisionVertexArray,Ht.text.placed,!Vn||Or,Yn.x,Yn.y),ni.verticalTextBox&&Cs(l.textCollisionBox.collisionVertexArray,Ht.text.placed,!Vn||an,Yn.x,Yn.y)}var Wn=Boolean(!an&&ni.verticalIconBox);ni.iconBox&&Cs(l.iconCollisionBox.collisionVertexArray,Ht.icon.placed,Wn,se?Yn.x:0,se?Yn.y:0),ni.verticalIconBox&&Cs(l.iconCollisionBox.collisionVertexArray,Ht.icon.placed,!Wn,se?Yn.x:0,se?Yn.y:0)}}},Fe=0;Fe<l.symbolInstances.length;Fe++)Ee(Fe);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Xa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Xa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Xa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Xa.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Xa.prototype.setStale=function(){this.stale=!0};var Tl=Math.pow(2,25),ps=Math.pow(2,24),J=Math.pow(2,17),ge=Math.pow(2,16),We=Math.pow(2,9),Tt=Math.pow(2,8),Mr=Math.pow(2,1);function Mn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Tl+f*ps+c*J+f*ge+c*We+f*Tt+c*Mr+f}var wi=0,ro=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ro.prototype.continuePlacement=function(l,f,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Oa=function(l,f,c,d,E,w,P){this.placement=new Xa(l,E,w,P),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Oa.prototype.isDone=function(){return this._done},Oa.prototype.continuePlacement=function(l,f,c){for(var d=this,E=m.browser.now(),w=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var P=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ro(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Oa.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ba=512/m.EXTENT/2,Wo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Wo.prototype.getScaledCoordinates=function(l,f){var c=Ba/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},Wo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,f),U=0,H=P;U<H.length;U+=1){var ae=H[U];if(Math.abs(ae.coord.x-L.x)<=d&&Math.abs(ae.coord.y-L.y)<=d&&!c[ae.crossTileID]){c[ae.crossTileID]=!0,w.crossTileID=ae.crossTileID;break}}}}};var hs=function(){this.maxCrossTileID=0};hs.prototype.generate=function(){return++this.maxCrossTileID};var uo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};uo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},uo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var U=P[L];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,E)}else{var H=P[l.scaledTo(Number(w)).key];H&&H.findMatches(f.symbolInstances,l,E)}}for(var ae=0;ae<f.symbolInstances.length;ae++){var se=f.symbolInstances.get(ae);se.crossTileID||(se.crossTileID=c.generate(),E[se.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Wo(l,f.symbolInstances,f.bucketInstanceId),!0},uo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},uo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var To=function(){this.layerIndexes={},this.crossTileIDs=new hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};To.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new uo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=f;P<L.length;P+=1){var U=L[P],H=U.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,H,this.crossTileIDs)&&(E=!0),w[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},To.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ds=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},As=m.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Rs=m.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),eu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),vs=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Xt(Ct(),this),this.imageManager=new kt,this.imageManager.setEventedParent(this),this.glyphManager=new Wt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new To,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,U){if(m.triggerPluginCompletionEvent(L),U&&U.every(function(ae){return ae}))for(var H in w.sourceCaches)w.sourceCaches[H].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var H in E._layers){var ae=E._layers[H];ae.source===U.id&&E._validateLayer(ae)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(P,function(L,U){E._request=null,L?E.fire(new m.ErrorEvent(L)):U&&E._load(U,w)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(eu,!1)},f.prototype._load=function(c,d){if(!d||!ds(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Dr(this.stylesheet.layers);this._order=w.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var U=L[P];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new St(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,U,H,ae=m.browser.devicePixelRatio>1?"@2x":"",se=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,ae,".json"),m.ResourceType.SpriteJSON),function(Ee,Fe){se=null,H||(H=Ee,L=Fe,Ie())}),ue=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,ae,".png"),m.ResourceType.SpriteImage),function(Ee,Fe){ue=null,H||(H=Ee,U=Fe,Ie())});function Ie(){if(H)P(H);else if(L&&U){var Ee=m.browser.getImageData(U),Fe={};for(var Ae in L){var Ue=L[Ae],Ye=Ue.width,vt=Ue.height,Vt=Ue.x,zt=Ue.y,Ht=Ue.sdf,fr=Ue.pixelRatio,xr=Ue.stretchX,Or=Ue.stretchY,an=Ue.content,Un=new m.RGBAImage({width:Ye,height:vt});m.RGBAImage.copy(Ee,Un,{x:Vt,y:zt},{x:0,y:0},{width:Ye,height:vt}),Fe[Ae]={data:Un,pixelRatio:fr,sdf:Ht,stretchX:xr,stretchY:Or,content:an}}P(null,Fe)}}return{cancel:function(){se&&(se.cancel(),se=null),ue&&(ue.cancel(),ue=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var ae in this.sourceCaches){var se=this.sourceCaches[ae];H[ae]=se.used,se.used=!1}for(var ue=0,Ie=this._order;ue<Ie.length;ue+=1){var Ee=this._layers[Ie[ue]];Ee.recalculate(c,this._availableImages),!Ee.isHidden(c.zoom)&&Ee.source&&(this.sourceCaches[Ee.source].used=!0)}for(var Fe in H){var Ae=this.sourceCaches[Fe];H[Fe]!==Ae.used&&Ae.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Fe}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ds(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Dr(c.layers);var E=function(P,L){if(!P)return[{command:Hr.setStyle,args:[L]}];var U=[];try{if(!m.deepEqual(P.version,L.version))return[{command:Hr.setStyle,args:[L]}];m.deepEqual(P.center,L.center)||U.push({command:Hr.setCenter,args:[L.center]}),m.deepEqual(P.zoom,L.zoom)||U.push({command:Hr.setZoom,args:[L.zoom]}),m.deepEqual(P.bearing,L.bearing)||U.push({command:Hr.setBearing,args:[L.bearing]}),m.deepEqual(P.pitch,L.pitch)||U.push({command:Hr.setPitch,args:[L.pitch]}),m.deepEqual(P.sprite,L.sprite)||U.push({command:Hr.setSprite,args:[L.sprite]}),m.deepEqual(P.glyphs,L.glyphs)||U.push({command:Hr.setGlyphs,args:[L.glyphs]}),m.deepEqual(P.transition,L.transition)||U.push({command:Hr.setTransition,args:[L.transition]}),m.deepEqual(P.light,L.light)||U.push({command:Hr.setLight,args:[L.light]});var H={},ae=[];(function(ue,Ie,Ee,Fe){var Ae;for(Ae in Ie=Ie||{},ue=ue||{})ue.hasOwnProperty(Ae)&&(Ie.hasOwnProperty(Ae)||$r(Ae,Ee,Fe));for(Ae in Ie)Ie.hasOwnProperty(Ae)&&(ue.hasOwnProperty(Ae)?m.deepEqual(ue[Ae],Ie[Ae])||(ue[Ae].type==="geojson"&&Ie[Ae].type==="geojson"&&Zi(ue,Ie,Ae)?Ee.push({command:Hr.setGeoJSONSourceData,args:[Ae,Ie[Ae].data]}):yn(Ae,Ie,Ee,Fe)):pi(Ae,Ie,Ee))})(P.sources,L.sources,ae,H);var se=[];P.layers&&P.layers.forEach(function(ue){H[ue.source]?U.push({command:Hr.removeLayer,args:[ue.id]}):se.push(ue)}),U=U.concat(ae),function(ue,Ie,Ee){Ie=Ie||[];var Fe,Ae,Ue,Ye,vt,Vt,zt,Ht=(ue=ue||[]).map(Ci),fr=Ie.map(Ci),xr=ue.reduce(gi,{}),Or=Ie.reduce(gi,{}),an=Ht.slice(),Un=Object.create(null);for(Fe=0,Ae=0;Fe<Ht.length;Fe++)Or.hasOwnProperty(Ue=Ht[Fe])?Ae++:(Ee.push({command:Hr.removeLayer,args:[Ue]}),an.splice(an.indexOf(Ue,Ae),1));for(Fe=0,Ae=0;Fe<fr.length;Fe++)an[an.length-1-Fe]!==(Ue=fr[fr.length-1-Fe])&&(xr.hasOwnProperty(Ue)?(Ee.push({command:Hr.removeLayer,args:[Ue]}),an.splice(an.lastIndexOf(Ue,an.length-Ae),1)):Ae++,Ee.push({command:Hr.addLayer,args:[Or[Ue],Vt=an[an.length-Fe]]}),an.splice(an.length-Fe,0,Ue),Un[Ue]=!0);for(Fe=0;Fe<fr.length;Fe++)if(Ye=xr[Ue=fr[Fe]],vt=Or[Ue],!Un[Ue]&&!m.deepEqual(Ye,vt))if(m.deepEqual(Ye.source,vt.source)&&m.deepEqual(Ye["source-layer"],vt["source-layer"])&&m.deepEqual(Ye.type,vt.type)){for(zt in li(Ye.layout,vt.layout,Ee,Ue,null,Hr.setLayoutProperty),li(Ye.paint,vt.paint,Ee,Ue,null,Hr.setPaintProperty),m.deepEqual(Ye.filter,vt.filter)||Ee.push({command:Hr.setFilter,args:[Ue,vt.filter]}),m.deepEqual(Ye.minzoom,vt.minzoom)&&m.deepEqual(Ye.maxzoom,vt.maxzoom)||Ee.push({command:Hr.setLayerZoomRange,args:[Ue,vt.minzoom,vt.maxzoom]}),Ye)Ye.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?li(Ye[zt],vt[zt],Ee,Ue,zt.slice(6),Hr.setPaintProperty):m.deepEqual(Ye[zt],vt[zt])||Ee.push({command:Hr.setLayerProperty,args:[Ue,zt,vt[zt]]}));for(zt in vt)vt.hasOwnProperty(zt)&&!Ye.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?li(Ye[zt],vt[zt],Ee,Ue,zt.slice(6),Hr.setPaintProperty):m.deepEqual(Ye[zt],vt[zt])||Ee.push({command:Hr.setLayerProperty,args:[Ue,zt,vt[zt]]}))}else Ee.push({command:Hr.removeLayer,args:[Ue]}),Vt=an[an.lastIndexOf(Ue)+1],Ee.push({command:Hr.addLayer,args:[vt,Vt]})}(se,L.layers,U)}catch(ue){console.warn("Unable to compute style diff:",ue),U=[{command:Hr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(P){return!(P.command in Rs)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in As)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new Re(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(ds(this,m.validateCustomStyleLayer(c)))return;P=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=m.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(xr){return d._layers[xr].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var H=0,ae=c;H<ae.length;H+=1){var se=ae[H][U];if(se)for(var ue=0,Ie=se;ue<Ie.length;ue+=1)P.push(Ie[ue])}}}P.sort(function(xr,Or){return Or.intersectionZ-xr.intersectionZ});for(var Ee=[],Fe=this._order.length-1;Fe>=0;Fe--){var Ae=this._order[Fe];if(E(Ae))for(var Ue=P.length-1;Ue>=0;Ue--){var Ye=P[Ue].feature;if(w[Ye.layer.id]<Fe)break;Ee.push(Ye),P.pop()}else for(var vt=0,Vt=c;vt<Vt.length;vt+=1){var zt=Vt[vt][Ae];if(zt)for(var Ht=0,fr=zt;Ht<fr.length;Ht+=1)Ee.push(fr[Ht].feature)}}return Ee},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var U=L[P],H=this._layers[U];if(!H)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[H.source]=!0}}var ae=[];for(var se in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[se]||ae.push(gn(this.sourceCaches[se],this._layers,this._serializedLayers,c,d,E));return this.placement&&ae.push(function(ue,Ie,Ee,Fe,Ae,Ue,Ye){for(var vt={},Vt=Ue.queryRenderedSymbols(Fe),zt=[],Ht=0,fr=Object.keys(Vt).map(Number);Ht<fr.length;Ht+=1)zt.push(Ye[fr[Ht]]);zt.sort(di);for(var xr=function(){var Bn=an[Or],Ti=Bn.featureIndex.lookupSymbolFeatures(Vt[Bn.bucketInstanceId],Ie,Bn.bucketIndex,Bn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,ue);for(var tn in Ti){var ri=vt[tn]=vt[tn]||[],ni=Ti[tn];ni.sort(function(ci,Wn){var Gn=Bn.featureSortOrder;if(Gn){var bo=Gn.indexOf(ci.featureIndex);return Gn.indexOf(Wn.featureIndex)-bo}return Wn.featureIndex-ci.featureIndex});for(var Yn=0,Vn=ni;Yn<Vn.length;Yn+=1)ri.push(Vn[Yn])}},Or=0,an=zt;Or<an.length;Or+=1)xr();var Un=function(Bn){vt[Bn].forEach(function(Ti){var tn=Ti.feature,ri=Ee[ue[Bn].source].getFeatureState(tn.layer["source-layer"],tn.id);tn.source=tn.layer.source,tn.layer["source-layer"]&&(tn.sourceLayer=tn.layer["source-layer"]),tn.state=ri})};for(var On in vt)Un(On);return vt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ae)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(Ie){return w.getTileByID(Ie)}),U=[],H={},ae=0;ae<L.length;ae++){var se=L[ae],ue=se.tileID.canonical.key;H[ue]||(H[ue]=!0,se.querySourceFeatures(U,P))}return U}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!m.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&ds(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,U=!1,H={},ae=0,se=this._order;ae<se.length;ae+=1){var ue=this._layers[se[ae]];if(ue.type==="symbol"){if(!H[ue.source]){var Ie=this.sourceCaches[ue.source];H[ue.source]=Ie.getRenderableIds(!0).map(function(Ye){return Ie.getTileByID(Ye)}).sort(function(Ye,vt){return vt.tileID.overscaledZ-Ye.tileID.overscaledZ||(Ye.tileID.isLessThan(vt.tileID)?-1:1)})}var Ee=this.crossTileSymbolIndex.addLayer(ue,H[ue.source],c.center.lng);L=L||Ee}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Oa(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Fe=0,Ae=this._order;Fe<Ae.length;Fe+=1){var Ue=this._layers[Ae[Fe]];Ue.type==="symbol"&&this.placement.updateLayerOpacities(Ue,H[Ue.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);vs.getSourceType=function(l){return Er[l]},vs.setSourceType=function(l,f){Er[l]=f},vs.registerForPluginStateChange=m.registerForPluginStateChange;var ha=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),ya=zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),rs=zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),nf=zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ml=zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Zs=zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ec=zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Hu=zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),js=zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ul=zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),X=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),me=zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ge=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ot=zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),st=zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),tr=zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ar=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Tn=zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ti=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Rn=zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ji=zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ua=zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ea=zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function zi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,H,ae,se,ue){return L[ue]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+ue+`
varying `+ae+" "+se+" "+ue+`;
#else
uniform `+ae+" "+se+" u_"+ue+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ue+`
    `+ae+" "+se+" "+ue+" = u_"+ue+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,H,ae,se,ue){var Ie=se==="float"?"vec2":"vec4",Ee=ue.match(/color/)?"color":Ie;return L[ue]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+ue+`
uniform lowp float u_`+ue+`_t;
attribute `+ae+" "+Ie+" a_"+ue+`;
varying `+ae+" "+se+" "+ue+`;
#else
uniform `+ae+" "+se+" u_"+ue+`;
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+ue+" = a_"+ue+`;
#else
    `+ae+" "+se+" "+ue+" = u_"+ue+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+ue+" = unpack_mix_"+Ee+"(a_"+ue+", u_"+ue+`_t);
#else
    `+ae+" "+se+" "+ue+" = u_"+ue+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+ue+`
uniform lowp float u_`+ue+`_t;
attribute `+ae+" "+Ie+" a_"+ue+`;
#else
uniform `+ae+" "+se+" u_"+ue+`;
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+ae+" "+se+" "+ue+" = a_"+ue+`;
#else
    `+ae+" "+se+" "+ue+" = u_"+ue+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+ae+" "+se+" "+ue+" = unpack_mix_"+Ee+"(a_"+ue+", u_"+ue+`_t);
#else
    `+ae+" "+se+" "+ue+" = u_"+ue+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var ms=Object.freeze({__proto__:null,prelude:ya,background:rs,backgroundPattern:nf,circle:Ml,clippingMask:Zs,heatmap:ec,heatmapTexture:Hu,collisionBox:js,collisionCircle:ul,debug:_,fill:M,fillOutline:B,fillOutlinePattern:R,fillPattern:X,fillExtrusion:me,fillExtrusionPattern:Ge,hillshadePrepare:ot,hillshade:st,line:tr,lineGradient:ar,linePattern:Tn,lineSDF:ti,raster:Rn,symbolIcon:ji,symbolSDF:ua,symbolTextAndIcon:Ea}),tu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Wu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}tu.prototype.bind=function(l,f,c,d,E,w,P,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,H=0;!U&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(f,c,d,E,w,P,L)},tu.prototype.freshBind=function(l,f,c,d,E,w,P){var L,U=l.numAttributes,H=this.context,ae=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=H.currentNumAttributes||0;for(var se=U;se<L;se++)ae.disableVertexAttribArray(se)}f.enableAttributes(ae,l);for(var ue=0,Ie=c;ue<Ie.length;ue+=1)Ie[ue].enableAttributes(ae,l);w&&w.enableAttributes(ae,l),P&&P.enableAttributes(ae,l),f.bind(),f.setVertexAttribPointers(ae,l,E);for(var Ee=0,Fe=c;Ee<Fe.length;Ee+=1){var Ae=Fe[Ee];Ae.bind(),Ae.setVertexAttribPointers(ae,l,E)}w&&(w.bind(),w.setVertexAttribPointers(ae,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(ae,l,E)),H.currentNumAttributes=U},tu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var af=function(l,f,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=Wu(c.staticAttributes),U=d?d.getBinderAttributes():[],H=L.concat(U),ae=c.staticUniforms?Wu(c.staticUniforms):[],se=d?d.getBinderUniforms():[],ue=[],Ie=0,Ee=ae.concat(se);Ie<Ee.length;Ie+=1){var Fe=Ee[Ie];ue.indexOf(Fe)<0&&ue.push(Fe)}var Ae=d?d.defines():[];w&&Ae.push("#define OVERDRAW_INSPECTOR;");var Ue=Ae.concat(ya.fragmentSource,c.fragmentSource).join(`
`),Ye=Ae.concat(ya.vertexSource,c.vertexSource).join(`
`),vt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(vt,Ue),P.compileShader(vt),P.attachShader(this.program,vt);var Vt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Vt,Ye),P.compileShader(Vt),P.attachShader(this.program,Vt),this.attributes={};var zt={};this.numAttributes=H.length;for(var Ht=0;Ht<this.numAttributes;Ht++)H[Ht]&&(P.bindAttribLocation(this.program,Ht,H[Ht]),this.attributes[H[Ht]]=Ht);P.linkProgram(this.program),P.deleteShader(Vt),P.deleteShader(vt);for(var fr=0;fr<ue.length;fr++){var xr=ue[fr];if(xr&&!zt[xr]){var Or=P.getUniformLocation(this.program,xr);Or&&(zt[xr]=Or)}}this.fixedUniforms=E(l,zt),this.binderUniforms=d?d.getUniforms(l,zt):[]}}};function ll(l,f,c){var d=1/ta(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}af.prototype.draw=function(l,f,c,d,E,w,P,L,U,H,ae,se,ue,Ie,Ee,Fe){var Ae,Ue=l.gl;if(!this.failedToCreate){for(var Ye in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Ye].set(P[Ye]);Ie&&Ie.setUniforms(l,this.binderUniforms,se,{zoom:ue});for(var vt=(Ae={},Ae[Ue.LINES]=2,Ae[Ue.TRIANGLES]=3,Ae[Ue.LINE_STRIP]=1,Ae)[f],Vt=0,zt=ae.get();Vt<zt.length;Vt+=1){var Ht=zt[Vt],fr=Ht.vaos||(Ht.vaos={});(fr[L]||(fr[L]=new tu)).bind(l,this,U,Ie?Ie.getPaintVertexBuffers():[],H,Ht.vertexOffset,Ee,Fe),Ue.drawElements(f,Ht.primitiveLength*vt,Ue.UNSIGNED_SHORT,Ht.primitiveOffset*vt*2)}}};var Mc=function(l,f,c,d){var E=f.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-f.transform.angle),m.transformMat3(P,P,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Su=function(l,f,c,d,E,w,P){return m.extend(Mc(l,f,c,d),ll(w,f,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},Cu=function(l){return{u_matrix:l}},Au=function(l,f,c,d){return m.extend(Cu(l),ll(c,f,d))},lo=function(l,f){return{u_matrix:l,u_world:f}},Zf=function(l,f,c,d,E){return m.extend(Au(l,f,c,d),{u_world:E})},jf=function(l,f,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=ta(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},$o=function(l,f,c){var d=ta(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Pc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},wu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},ru=function(l){return{u_matrix:l}},of=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ta(f,1,c),u_intensity:d}},Pl=function(l,f,c){var d=l.transform;return{u_matrix:Ic(l,f,c),u_ratio:1/ta(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Oi=function(l,f,c,d){return m.extend(Pl(l,f,c),{u_image:0,u_image_height:d})},Il=function(l,f,c,d){var E=l.transform,w=cl(f,E);return{u_matrix:Ic(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ta(f,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Mp=function(l,f,c,d,E){var w=l.lineAtlas,P=cl(f,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),H=w.getDash(d.to,L),ae=U.width*E.fromScale,se=H.width*E.toScale;return m.extend(Pl(l,f,c),{u_patternscale_a:[P/ae,-U.height/2],u_patternscale_b:[P/se,-H.height/2],u_sdfgamma:w.width/(256*Math.min(ae,se)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:H.y,u_mix:E.t})};function cl(l,f){return 1/ta(l,1,f.tileZoom)}function Ic(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Vf=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Pp(E.paint.get("raster-hue-rotate"))};var w,P};function Pp(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Gf,Oc=function(l,f,c,d,E,w,P,L,U,H){var ae=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_pitch:ae.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ae.width/ae.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},tc=function(l,f,c,d,E,w,P,L,U,H,ae){var se=E.transform;return m.extend(Oc(l,f,c,d,E,w,P,L,U,H),{u_gamma_scale:d?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ae})},rc=function(l,f,c,d,E,w,P,L,U,H){return m.extend(tc(l,f,c,d,E,w,P,L,!0,U,!0),{u_texsize_icon:H,u_texture_icon:1})},Ol=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},fl=function(l,f,c,d,E,w){return m.extend(function(P,L,U,H){var ae=U.imageManager.getPattern(P.from.toString()),se=U.imageManager.getPattern(P.to.toString()),ue=U.imageManager.getPixelSize(),Ie=ue.width,Ee=ue.height,Fe=Math.pow(2,H.tileID.overscaledZ),Ae=H.tileSize*Math.pow(2,U.transform.tileZoom)/Fe,Ue=Ae*(H.tileID.canonical.x+H.tileID.wrap*Fe),Ye=Ae*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ae.tl,u_pattern_br_a:ae.br,u_pattern_tl_b:se.tl,u_pattern_br_b:se.br,u_texsize:[Ie,Ee],u_mix:L.t,u_pattern_size_a:ae.displaySize,u_pattern_size_b:se.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/ta(H,1,U.transform.tileZoom),u_pixel_coord_upper:[Ue>>16,Ye>>16],u_pixel_coord_lower:[65535&Ue,65535&Ye]}}(d,w,c,E),{u_matrix:l,u_opacity:f})},Rl={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Xu(l,f,c,d,E,w,P){for(var L=l.context,U=L.gl,H=l.useProgram("collisionBox"),ae=[],se=0,ue=0,Ie=0;Ie<d.length;Ie++){var Ee=d[Ie],Fe=f.getTile(Ee),Ae=Fe.getBucket(c);if(Ae){var Ue=Ee.posMatrix;E[0]===0&&E[1]===0||(Ue=l.translatePosMatrix(Ee.posMatrix,Fe,E,w));var Ye=P?Ae.textCollisionBox:Ae.iconCollisionBox,vt=Ae.collisionCircleArray;if(vt.length>0){var Vt=m.create(),zt=Ue;m.mul(Vt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Vt,Vt,Ae.placementViewportMatrix),ae.push({circleArray:vt,circleOffset:ue,transform:zt,invTransform:Vt}),ue=se+=vt.length/4}Ye&&H.draw(L,U.LINES,de.disabled,Me.disabled,l.colorModeForRenderPass(),$e.disabled,$o(Ue,l.transform,Fe),c.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,null,l.transform.zoom,null,null,Ye.collisionVertexBuffer)}}if(P&&ae.length){var Ht=l.useProgram("collisionCircle"),fr=new m.StructArrayLayout2f1f2i16;fr.resize(4*se),fr._trim();for(var xr=0,Or=0,an=ae;Or<an.length;Or+=1)for(var Un=an[Or],On=0;On<Un.circleArray.length/4;On++){var Bn=4*On,Ti=Un.circleArray[Bn+0],tn=Un.circleArray[Bn+1],ri=Un.circleArray[Bn+2],ni=Un.circleArray[Bn+3];fr.emplace(xr++,Ti,tn,ri,ni,0),fr.emplace(xr++,Ti,tn,ri,ni,1),fr.emplace(xr++,Ti,tn,ri,ni,2),fr.emplace(xr++,Ti,tn,ri,ni,3)}(!Gf||Gf.length<2*se)&&(Gf=function(Va){var ka=2*Va,Mo=new m.StructArrayLayout3ui6;Mo.resize(ka),Mo._trim();for(var Ya=0;Ya<ka;Ya++){var fo=6*Ya;Mo.uint16[fo+0]=4*Ya+0,Mo.uint16[fo+1]=4*Ya+1,Mo.uint16[fo+2]=4*Ya+2,Mo.uint16[fo+3]=4*Ya+2,Mo.uint16[fo+4]=4*Ya+3,Mo.uint16[fo+5]=4*Ya+0}return Mo}(se));for(var Yn=L.createIndexBuffer(Gf,!0),Vn=L.createVertexBuffer(fr,m.collisionCircleLayout.members,!0),ci=0,Wn=ae;ci<Wn.length;ci+=1){var Gn=Wn[ci],bo=Pc(Gn.transform,Gn.invTransform,l.transform);Ht.draw(L,U.TRIANGLES,de.disabled,Me.disabled,l.colorModeForRenderPass(),$e.disabled,bo,c.id,Vn,Yn,m.SegmentVector.simpleSegment(0,2*Gn.circleOffset,Gn.circleArray.length,Gn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Vn.destroy(),Yn.destroy()}}var Vs=m.identity(new Float32Array(16));function sf(l,f,c,d,E,w){var P=m.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*f,U=-(P.verticalAlign-.5)*c,H=m.evaluateVariableOffset(l,d);return new m.Point((L/E+H[0])*w,(U/E+H[1])*w)}function uf(l,f,c,d,E,w,P,L,U,H,ae){var se=l.text.placedSymbolArray,ue=l.text.dynamicLayoutVertexArray,Ie=l.icon.dynamicLayoutVertexArray,Ee={};ue.clear();for(var Fe=0;Fe<se.length;Fe++){var Ae=se.get(Fe),Ue=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(Ue){var Ye=new m.Point(Ae.anchorX,Ae.anchorY),vt=Ai(Ye,c?L:P),Vt=Di(w.cameraToCenterDistance,vt.signedDistanceFromCamera),zt=E.evaluateSizeForFeature(l.textSizeData,H,Ae)*Vt/m.ONE_EM;c&&(zt*=l.tilePixelRatio/U);for(var Ht=sf(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale,zt),fr=c?Ai(Ye.add(Ht),P).point:vt.point.add(f?Ht.rotate(-w.angle):Ht),xr=l.allowVerticalPlacement&&Ae.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Or=0;Or<Ae.numGlyphs;Or++)m.addDynamicAttributes(ue,fr,xr);ae&&Ae.associatedIconIndex>=0&&(Ee[Ae.associatedIconIndex]={shiftedAnchor:fr,angle:xr})}else Fa(Ae.numGlyphs,ue)}if(ae){Ie.clear();for(var an=l.icon.placedSymbolArray,Un=0;Un<an.length;Un++){var On=an.get(Un);if(On.hidden)Fa(On.numGlyphs,Ie);else{var Bn=Ee[Un];if(Bn)for(var Ti=0;Ti<On.numGlyphs;Ti++)m.addDynamicAttributes(Ie,Bn.shiftedAnchor,Bn.angle);else Fa(On.numGlyphs,Ie)}}l.icon.dynamicLayoutVertexBuffer.updateData(Ie)}l.text.dynamicLayoutVertexBuffer.updateData(ue)}function Hf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function nu(l,f,c,d,E,w,P,L,U,H,ae,se){for(var ue=l.context,Ie=ue.gl,Ee=l.transform,Fe=L==="map",Ae=U==="map",Ue=Fe&&c.layout.get("symbol-placement")!=="point",Ye=Fe&&!Ae&&!Ue,vt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Vt=!1,zt=l.depthModeForSublayer(0,de.ReadOnly),Ht=c.layout.get("text-variable-anchor"),fr=[],xr=0,Or=d;xr<Or.length;xr+=1){var an=Or[xr],Un=f.getTile(an),On=Un.getBucket(c);if(On){var Bn=E?On.text:On.icon;if(Bn&&Bn.segments.get().length){var Ti=Bn.programConfigurations.get(c.id),tn=E||On.sdfIcons,ri=E?On.textSizeData:On.iconSizeData,ni=Ae||Ee.pitch!==0,Yn=l.useProgram(Hf(tn,E,On),Ti),Vn=m.evaluateSizeForZoom(ri,Ee.zoom),ci=void 0,Wn=[0,0],Gn=void 0,bo=void 0,Va=null,ka=void 0;if(E)Gn=Un.glyphAtlasTexture,bo=Ie.LINEAR,ci=Un.glyphAtlasTexture.size,On.iconsInText&&(Wn=Un.imageAtlasTexture.size,Va=Un.imageAtlasTexture,ka=ni||l.options.rotating||l.options.zooming||ri.kind==="composite"||ri.kind==="camera"?Ie.LINEAR:Ie.NEAREST);else{var Mo=c.layout.get("icon-size").constantOr(0)!==1||On.iconsNeedLinear;Gn=Un.imageAtlasTexture,bo=tn||l.options.rotating||l.options.zooming||Mo||ni?Ie.LINEAR:Ie.NEAREST,ci=Un.imageAtlasTexture.size}var Ya=ta(Un,1,l.transform.zoom),fo=wa(an.posMatrix,Ae,Fe,l.transform,Ya),Ps=Ei(an.posMatrix,Ae,Fe,l.transform,Ya),as=Ht&&On.hasTextData(),Lu=c.layout.get("icon-text-fit")!=="none"&&as&&On.hasIconData();Ue&&cn(On,an.posMatrix,l,E,fo,Ps,Ae,H);var os=l.translatePosMatrix(an.posMatrix,Un,w,P),Ls=Ue||E&&Ht||Lu?Vs:fo,go=l.translatePosMatrix(Ps,Un,w,P,!0),fc=tn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ul={program:Yn,buffers:Bn,uniformValues:tn?On.iconsInText?rc(ri.kind,Vn,Ye,Ae,l,os,Ls,go,ci,Wn):tc(ri.kind,Vn,Ye,Ae,l,os,Ls,go,E,ci,!0):Oc(ri.kind,Vn,Ye,Ae,l,os,Ls,go,E,ci),atlasTexture:Gn,atlasTextureIcon:Va,atlasInterpolation:bo,atlasInterpolationIcon:ka,isSDF:tn,hasHalo:fc};if(vt&&On.canOverlap){Vt=!0;for(var vu=0,yl=Bn.segments.get();vu<yl.length;vu+=1){var Zl=yl[vu];fr.push({segments:new m.SegmentVector([Zl]),sortKey:Zl.sortKey,state:Ul})}}else fr.push({segments:Bn.segments,sortKey:0,state:Ul})}}}Vt&&fr.sort(function(Ju,el){return Ju.sortKey-el.sortKey});for(var Ys=0,jl=fr;Ys<jl.length;Ys+=1){var mu=jl[Ys],Eo=mu.state;if(ue.activeTexture.set(Ie.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,Ie.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(ue.activeTexture.set(Ie.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE)),Eo.isSDF){var gu=Eo.uniformValues;Eo.hasHalo&&(gu.u_is_halo=1,nc(Eo.buffers,mu.segments,c,l,Eo.program,zt,ae,se,gu)),gu.u_is_halo=0}nc(Eo.buffers,mu.segments,c,l,Eo.program,zt,ae,se,Eo.uniformValues)}}function nc(l,f,c,d,E,w,P,L,U){var H=d.context;E.draw(H,H.gl.TRIANGLES,w,P,L,$e.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Rc(l,f,c,d,E,w,P){var L,U,H,ae,se,ue=l.context.gl,Ie=c.paint.get("fill-pattern"),Ee=Ie&&Ie.constantOr(1),Fe=c.getCrossfadeParameters();P?(U=Ee&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=ue.LINES):(U=Ee?"fillPattern":"fill",L=ue.TRIANGLES);for(var Ae=0,Ue=d;Ae<Ue.length;Ae+=1){var Ye=Ue[Ae],vt=f.getTile(Ye);if(!Ee||vt.patternsLoaded()){var Vt=vt.getBucket(c);if(Vt){var zt=Vt.programConfigurations.get(c.id),Ht=l.useProgram(U,zt);Ee&&(l.context.activeTexture.set(ue.TEXTURE0),vt.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),zt.updatePaintBuffers(Fe));var fr=Ie.constantOr(null);if(fr&&vt.imageAtlas){var xr=vt.imageAtlas,Or=xr.patternPositions[fr.to.toString()],an=xr.patternPositions[fr.from.toString()];Or&&an&&zt.setConstantPatternPositions(Or,an)}var Un=l.translatePosMatrix(Ye.posMatrix,vt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){ae=Vt.indexBuffer2,se=Vt.segments2;var On=[ue.drawingBufferWidth,ue.drawingBufferHeight];H=U==="fillOutlinePattern"&&Ee?Zf(Un,l,Fe,vt,On):lo(Un,On)}else ae=Vt.indexBuffer,se=Vt.segments,H=Ee?Au(Un,l,Fe,vt):Cu(Un);Ht.draw(l.context,L,E,l.stencilModeForClipping(Ye),w,$e.disabled,H,c.id,Vt.layoutVertexBuffer,ae,se,c.paint,l.transform.zoom,zt)}}}}function lf(l,f,c,d,E,w,P){for(var L=l.context,U=L.gl,H=c.paint.get("fill-extrusion-pattern"),ae=H.constantOr(1),se=c.getCrossfadeParameters(),ue=c.paint.get("fill-extrusion-opacity"),Ie=0,Ee=d;Ie<Ee.length;Ie+=1){var Fe=Ee[Ie],Ae=f.getTile(Fe),Ue=Ae.getBucket(c);if(Ue){var Ye=Ue.programConfigurations.get(c.id),vt=l.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",Ye);ae&&(l.context.activeTexture.set(U.TEXTURE0),Ae.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ye.updatePaintBuffers(se));var Vt=H.constantOr(null);if(Vt&&Ae.imageAtlas){var zt=Ae.imageAtlas,Ht=zt.patternPositions[Vt.to.toString()],fr=zt.patternPositions[Vt.from.toString()];Ht&&fr&&Ye.setConstantPatternPositions(Ht,fr)}var xr=l.translatePosMatrix(Fe.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Or=c.paint.get("fill-extrusion-vertical-gradient"),an=ae?Su(xr,l,Or,ue,Fe,se,Ae):Mc(xr,l,Or,ue);vt.draw(L,L.gl.TRIANGLES,E,w,P,$e.backCCW,an,c.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,c.paint,l.transform.zoom,Ye)}}}function kl(l,f,c,d,E,w){var P=l.context,L=P.gl,U=f.fbo;if(U){var H=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var ae=function(se,ue,Ie){var Ee=Ie.paint.get("hillshade-shadow-color"),Fe=Ie.paint.get("hillshade-highlight-color"),Ae=Ie.paint.get("hillshade-accent-color"),Ue=Ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ue-=se.transform.angle);var Ye,vt,Vt,zt=!se.options.moving;return{u_matrix:se.transform.calculatePosMatrix(ue.tileID.toUnwrapped(),zt),u_image:0,u_latrange:(Ye=ue.tileID,vt=Math.pow(2,Ye.canonical.z),Vt=Ye.canonical.y,[new m.MercatorCoordinate(0,Vt/vt).toLngLat().lat,new m.MercatorCoordinate(0,(Vt+1)/vt).toLngLat().lat]),u_light:[Ie.paint.get("hillshade-exaggeration"),Ue],u_shadow:Ee,u_highlight:Fe,u_accent:Ae}}(l,f,c);H.draw(P,L.TRIANGLES,d,E,w,$e.disabled,ae,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function oh(l,f,c,d,E,w){var P=l.context,L=P.gl,U=f.dem;if(U&&U.data){var H=U.dim,ae=U.stride,se=U.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ae),f.demTexture){var ue=f.demTexture;ue.update(se,{premultiply:!1}),ue.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(P,se,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var Ie=f.fbo;if(!Ie){var Ee=new m.Texture(P,{width:H,height:H,data:null},L.RGBA);Ee.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Ie=f.fbo=P.createFramebuffer(H,H,!0)).colorAttachment.set(Ee.texture)}P.bindFramebuffer.set(Ie.framebuffer),P.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,$e.disabled,function(Fe,Ae){var Ue=Ae.stride,Ye=m.create();return m.ortho(Ye,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Ye,Ye,[0,-m.EXTENT,0]),{u_matrix:Ye,u_image:1,u_dimension:[Ue,Ue],u_zoom:Fe.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function cf(l,f,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=m.browser.now(),L=(P-l.timeAdded)/w,U=f?(P-f.timeAdded)/w:-1,H=c.getSource(),ae=E.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),se=!f||Math.abs(f.tileID.overscaledZ-ae)>Math.abs(l.tileID.overscaledZ-ae),ue=se&&l.refreshedUponExpiration?1:m.clamp(se?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-ue}:{opacity:ue,mix:0}}return{opacity:1,mix:0}}var Ll=new m.Color(1,0,0,1),ff=new m.Color(0,1,0,1),pf=new m.Color(0,0,1,1),Dl=new m.Color(1,0,1,1),kc=new m.Color(0,1,1,1);function Ip(l,f,c,d){ic(l,0,f+c/2,l.transform.width,c,d)}function Op(l,f,c,d){ic(l,f-c/2,0,c,l.transform.height,d)}function ic(l,f,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Rp(l,f,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=de.disabled,U=Me.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,U,H,$e.disabled,wu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ae=f.getTileByID(c.key).latestRawTileData,se=Math.floor((ae&&ae.byteLength||0)/1024),ue=f.getTile(c).tileSize,Ie=512/Math.min(ue,512)*(c.overscaledZ/l.transform.zoom)*.5,Ee=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ee+=" => "+c.overscaledZ),function(Fe,Ae){Fe.initDebugOverlayCanvas();var Ue=Fe.debugOverlayCanvas,Ye=Fe.context.gl,vt=Fe.debugOverlayCanvas.getContext("2d");vt.clearRect(0,0,Ue.width,Ue.height),vt.shadowColor="white",vt.shadowBlur=2,vt.lineWidth=1.5,vt.strokeStyle="white",vt.textBaseline="top",vt.font="bold 36px Open Sans, sans-serif",vt.fillText(Ae,5,5),vt.strokeText(Ae,5,5),Fe.debugOverlayTexture.update(Ue),Fe.debugOverlayTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE)}(l,Ee+" "+se+"kb"),P.draw(d,E.TRIANGLES,L,U,Ve.alphaBlended,$e.disabled,wu(w,m.Color.transparent,Ie),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Fl={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var w=Me.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,H,ae,se,ue,Ie){for(var Ee=U.transform,Fe=se==="map",Ae=ue==="map",Ue=0,Ye=L;Ue<Ye.length;Ue+=1){var vt=Ye[Ue],Vt=ae.getTile(vt),zt=Vt.getBucket(H);if(zt&&zt.text&&zt.text.segments.get().length){var Ht=m.evaluateSizeForZoom(zt.textSizeData,Ee.zoom),fr=ta(Vt,1,U.transform.zoom),xr=wa(vt.posMatrix,Ae,Fe,U.transform,fr),Or=H.layout.get("icon-text-fit")!=="none"&&zt.hasIconData();if(Ht){var an=Math.pow(2,Ee.zoom-Vt.tileID.overscaledZ);uf(zt,Fe,Ae,Ie,m.symbolSize,Ee,xr,vt.posMatrix,an,Ht,Or)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&nu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&nu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),f.map.showCollisionBoxes&&(Xu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Xu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var U=l.context,H=U.gl,ae=l.depthModeForSublayer(0,de.ReadOnly),se=Me.disabled,ue=l.colorModeForRenderPass(),Ie=[],Ee=0;Ee<d.length;Ee++){var Fe=d[Ee],Ae=f.getTile(Fe),Ue=Ae.getBucket(c);if(Ue){var Ye=Ue.programConfigurations.get(c.id),vt={programConfiguration:Ye,program:l.useProgram("circle",Ye),layoutVertexBuffer:Ue.layoutVertexBuffer,indexBuffer:Ue.indexBuffer,uniformValues:jf(l,Fe,Ae,c)};if(L)for(var Vt=0,zt=Ue.segments.get();Vt<zt.length;Vt+=1){var Ht=zt[Vt];Ie.push({segments:new m.SegmentVector([Ht]),sortKey:Ht.sortKey,state:vt})}else Ie.push({segments:Ue.segments,sortKey:0,state:vt})}}L&&Ie.sort(function(Un,On){return Un.sortKey-On.sortKey});for(var fr=0,xr=Ie;fr<xr.length;fr+=1){var Or=xr[fr],an=Or.state;an.program.draw(U,H.TRIANGLES,ae,se,ue,$e.disabled,an.uniformValues,c.id,an.layoutVertexBuffer,an.indexBuffer,Or.segments,c.paint,l.transform.zoom,an.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Me.disabled,L=new Ve([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Ie,Ee,Fe){var Ae=Ie.gl;Ie.activeTexture.set(Ae.TEXTURE1),Ie.viewport.set([0,0,Ee.width/4,Ee.height/4]);var Ue=Fe.heatmapFbo;if(Ue)Ae.bindTexture(Ae.TEXTURE_2D,Ue.colorAttachment.get()),Ie.bindFramebuffer.set(Ue.framebuffer);else{var Ye=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,Ye),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Ue=Fe.heatmapFbo=Ie.createFramebuffer(Ee.width/4,Ee.height/4,!1),function(vt,Vt,zt,Ht){var fr=vt.gl;fr.texImage2D(fr.TEXTURE_2D,0,fr.RGBA,Vt.width/4,Vt.height/4,0,fr.RGBA,vt.extRenderToTextureHalfFloat?vt.extTextureHalfFloat.HALF_FLOAT_OES:fr.UNSIGNED_BYTE,null),Ht.colorAttachment.set(zt)}(Ie,Ee,Ye,Ue)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var H=d[U];if(!f.hasRenderableParent(H)){var ae=f.getTile(H),se=ae.getBucket(c);if(se){var ue=se.programConfigurations.get(c.id);l.useProgram("heatmap",ue).draw(E,w.TRIANGLES,de.disabled,P,L,$e.disabled,of(H.posMatrix,ae,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,l.transform.zoom,ue)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Ie,Ee){var Fe=Ie.context,Ae=Fe.gl,Ue=Ee.heatmapFbo;if(Ue){Fe.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,Ue.colorAttachment.get()),Fe.activeTexture.set(Ae.TEXTURE1);var Ye=Ee.colorRampTexture;Ye||(Ye=Ee.colorRampTexture=new m.Texture(Fe,Ee.colorRamp,Ae.RGBA)),Ye.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Ie.useProgram("heatmapTexture").draw(Fe,Ae.TRIANGLES,de.disabled,Me.disabled,Ie.colorModeForRenderPass(),$e.disabled,function(vt,Vt,zt,Ht){var fr=m.create();m.ortho(fr,0,vt.width,vt.height,0,0,1);var xr=vt.context.gl;return{u_matrix:fr,u_world:[xr.drawingBufferWidth,xr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Vt.paint.get("heatmap-opacity")}}(Ie,Ee),Ee.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments,Ee.paint,Ie.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,de.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),ae=H.constantOr(1),se=c.paint.get("line-gradient"),ue=c.getCrossfadeParameters(),Ie=ae?"linePattern":U?"lineSDF":se?"lineGradient":"line",Ee=l.context,Fe=Ee.gl,Ae=!0,Ue=0,Ye=d;Ue<Ye.length;Ue+=1){var vt=Ye[Ue],Vt=f.getTile(vt);if(!ae||Vt.patternsLoaded()){var zt=Vt.getBucket(c);if(zt){var Ht=zt.programConfigurations.get(c.id),fr=l.context.program.get(),xr=l.useProgram(Ie,Ht),Or=Ae||xr.program!==fr,an=H.constantOr(null);if(an&&Vt.imageAtlas){var Un=Vt.imageAtlas,On=Un.patternPositions[an.to.toString()],Bn=Un.patternPositions[an.from.toString()];On&&Bn&&Ht.setConstantPatternPositions(On,Bn)}var Ti=ae?Il(l,Vt,c,ue):U?Mp(l,Vt,c,U,ue):se?Oi(l,Vt,c,zt.lineClipsArray.length):Pl(l,Vt,c);if(ae)Ee.activeTexture.set(Fe.TEXTURE0),Vt.imageAtlasTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Ht.updatePaintBuffers(ue);else if(U&&(Or||l.lineAtlas.dirty))Ee.activeTexture.set(Fe.TEXTURE0),l.lineAtlas.bind(Ee);else if(se){var tn=zt.gradients[c.id],ri=tn.texture;if(c.gradientVersion!==tn.version){var ni=256;if(c.stepInterpolant){var Yn=f.getSource().maxzoom,Vn=vt.canonical.z===Yn?Math.ceil(1<<l.transform.maxZoom-vt.canonical.z):1;ni=m.clamp(m.nextPowerOfTwo(zt.maxLineLength/m.EXTENT*1024*Vn),256,Ee.maxTextureSize)}tn.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ni,image:tn.gradient||void 0,clips:zt.lineClipsArray}),tn.texture?tn.texture.update(tn.gradient):tn.texture=new m.Texture(Ee,tn.gradient,Fe.RGBA),tn.version=c.gradientVersion,ri=tn.texture}Ee.activeTexture.set(Fe.TEXTURE0),ri.bind(c.stepInterpolant?Fe.NEAREST:Fe.LINEAR,Fe.CLAMP_TO_EDGE)}xr.draw(Ee,Fe.TRIANGLES,P,l.stencilModeForClipping(vt),L,$e.disabled,Ti,c.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,c.paint,l.transform.zoom,Ht,zt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?de.ReadWrite:de.ReadOnly);Rc(l,f,c,d,H,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ae=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,de.ReadOnly);Rc(l,f,c,d,ae,P,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new de(l.context.gl.LEQUAL,de.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))lf(l,f,c,d,w,Me.disabled,Ve.disabled),lf(l,f,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();lf(l,f,c,d,w,Me.disabled,P)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,de.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],H=0,ae=L[1];H<ae.length;H+=1){var se=ae[H],ue=f.getTile(se);ue.needsHillshadePrepare&&l.renderPass==="offscreen"?oh(l,ue,c,w,Me.disabled,P):l.renderPass==="translucent"&&kl(l,ue,c,w,U[se.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=f.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),H=P instanceof ht?[{},d]:l.stencilConfigForOverlap(d),ae=H[0],se=H[1],ue=se[se.length-1].overscaledZ,Ie=!l.options.moving,Ee=0,Fe=se;Ee<Fe.length;Ee+=1){var Ae=Fe[Ee],Ue=l.depthModeForSublayer(Ae.overscaledZ-ue,c.paint.get("raster-opacity")===1?de.ReadWrite:de.ReadOnly,w.LESS),Ye=f.getTile(Ae),vt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Ie);Ye.registerFadeDuration(c.paint.get("raster-fade-duration"));var Vt=f.findLoadedParent(Ae,0),zt=cf(Ye,Vt,f,c,l.transform),Ht=void 0,fr=void 0,xr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),Ye.texture.bind(xr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Vt?(Vt.texture.bind(xr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Ht=Math.pow(2,Vt.tileID.overscaledZ-Ye.tileID.overscaledZ),fr=[Ye.tileID.canonical.x*Ht%1,Ye.tileID.canonical.y*Ht%1]):Ye.texture.bind(xr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Or=Vf(vt,fr||[0,0],Ht||1,zt,c);P instanceof ht?L.draw(E,w.TRIANGLES,Ue,Me.disabled,U,$e.disabled,Or,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,Ue,ae[Ae.overscaledZ],U,$e.disabled,Or,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,U=L.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var ae=!H&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ae){var se=Me.disabled,ue=l.depthModeForSublayer(0,ae==="opaque"?de.ReadWrite:de.ReadOnly),Ie=l.colorModeForRenderPass(),Ee=l.useProgram(H?"backgroundPattern":"background"),Fe=L.coveringTiles({tileSize:U});H&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),Ue=0,Ye=Fe;Ue<Ye.length;Ue+=1){var vt=Ye[Ue],Vt=l.transform.calculatePosMatrix(vt.toUnwrapped()),zt=H?fl(Vt,E,l,H,{tileID:vt,tileSize:U},Ae):Ol(Vt,E,d);Ee.draw(w,P.TRIANGLES,ue,se,Ie,$e.disabled,zt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Rp(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Me.disabled);var P=E.renderingMode==="3d"?new de(l.context.gl.LEQUAL,de.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,de.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Yi=function(l,f){this.context=new oe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Re.maxUnderzooming+Re.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new To,this.gpuTimers={}};Yi.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Yi.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ha.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ha.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,xt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ha.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new m.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Me({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Yi.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,de.disabled,this.stencilClearMode,Ve.disabled,$e.disabled,ru(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Yi.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ve.disabled),c.setDepthMode(de.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=f;w<P.length;w+=1){var L=P[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,de.disabled,new Me({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ve.disabled,$e.disabled,ru(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Yi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Me({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Yi.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Me({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Yi.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,H){return H.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Me({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(f={},f[E]=Me.disabled,f),d]},Yi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ve([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ve.unblended:Ve.alphaBlended},Yi.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return de.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new de(c||this.context.gl.LEQUAL,f,[d,d])},Yi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Yi.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,U,H={},ae={},se={};for(var ue in E){var Ie=E[ue];H[ue]=Ie.getVisibleCoordinates(),ae[ue]=H[ue].slice().reverse(),se[ue]=Ie.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ee=0;Ee<d.length;Ee++)if(this.style._layers[d[Ee]].is3D()){this.opaquePassCutoff=Ee;break}this.renderPass="offscreen";for(var Fe=0,Ae=d;Fe<Ae.length;Fe+=1){var Ue=this.style._layers[Ae[Fe]];if(Ue.hasOffscreenPass()&&!Ue.isHidden(this.transform.zoom)){var Ye=ae[Ue.source];(Ue.type==="custom"||Ye.length)&&this.renderLayer(this,E[Ue.source],Ue,Ye)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var vt=this.style._layers[d[this.currentLayer]],Vt=E[vt.source],zt=H[vt.source];this._renderTileClippingMasks(vt,zt),this.renderLayer(this,Vt,vt,zt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Ht=this.style._layers[d[this.currentLayer]],fr=E[Ht.source],xr=(Ht.type==="symbol"?se:ae)[Ht.source];this._renderTileClippingMasks(Ht,H[Ht.source]),this.renderLayer(this,fr,Ht,xr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Or){Or.source&&!Or.isHidden(c.transform.zoom)&&(Or.source!==(U&&U.id)&&(U=c.style.sourceCaches[Or.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&Fl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Or){var an=Or.transform.padding;Ip(Or,Or.transform.height-(an.top||0),3,Ll),Ip(Or,an.bottom||0,3,ff),Op(Or,an.left||0,3,pf),Op(Or,Or.transform.width-(an.right||0),3,Dl);var Un=Or.transform.centerPoint;(function(On,Bn,Ti,tn){ic(On,Bn-1,Ti-10,2,20,tn),ic(On,Bn-10,Ti-1,20,2,tn)})(Or,Un.x,Or.transform.height-Un.y,kc)}(this),this.context.setDefault()},Yi.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Fl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Yi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Yi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Yi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Yi.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=w}return f},Yi.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var U=[E?c[0]:ta(f,c[0],this.transform.zoom),E?c[1]:ta(f,c[1],this.transform.zoom),0],H=new Float32Array(16);return m.translate(H,l,U),H},Yi.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Yi.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Yi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Yi.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new af(this.context,l,ms[l],f,Rl[l],this._showOverdrawInspector)),this.cache[c]},Yi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Yi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Yi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Yi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ac=function(l,f){this.points=l,this.planes=f};ac.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return m.transformMat4([],P,l)}).map(function(P){return m.scale$1([],P,1/P[3]/f*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=m.sub([],E[P[0]],E[P[1]]),U=m.sub([],E[P[2]],E[P[1]]),H=m.normalize([],m.cross([],L,U)),ae=-m.dot(H,E[P[1]]);return H.concat(ae)});return new ac(E,w)};var oa=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};oa.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new oa(c,d)},oa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},oa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},oa.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<f.length;P++)w+=m.dot$1(E,f[P])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,H=-Number.MAX_VALUE,ae=0;ae<l.points.length;ae++){var se=l.points[ae][L]-this.min[L];U=Math.min(U,se),H=Math.max(H,se)}if(H<0||U>this.max[L]-this.min[L])return 0}return 1};var Tu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Tu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Tu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},Tu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Tu.prototype.clone=function(){return new Tu(this.top,this.bottom,this.left,this.right)},Tu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Vi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Tu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Vi.prototype.clone=function(){var l=new Vi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new m.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Vi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Vi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Vi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Vi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=P-1;U<=L+1;U++)U!==0&&f.push(new m.UnwrappedTileID(U,l));return f},Vi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),w=[E*d.x,E*d.y,0],P=ac.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var U=function(Or){return{aabb:new oa([Or*E,0,0],[(Or+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Or,fullyVisible:!1}},H=[],ae=[],se=f,ue=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Ie=1;Ie<=3;Ie++)H.push(U(-Ie)),H.push(U(Ie));for(H.push(U(0));H.length>0;){var Ee=H.pop(),Fe=Ee.x,Ae=Ee.y,Ue=Ee.fullyVisible;if(!Ue){var Ye=Ee.aabb.intersects(P);if(Ye===0)continue;Ue=Ye===2}var vt=Ee.aabb.distanceX(w),Vt=Ee.aabb.distanceY(w),zt=Math.max(Math.abs(vt),Math.abs(Vt));if(Ee.zoom===se||zt>3+(1<<se-Ee.zoom)-2&&Ee.zoom>=L)ae.push({tileID:new m.OverscaledTileID(Ee.zoom===se?ue:Ee.zoom,Ee.wrap,Ee.zoom,Fe,Ae),distanceSq:m.sqrLen([w[0]-.5-Fe,w[1]-.5-Ae])});else for(var Ht=0;Ht<4;Ht++){var fr=(Fe<<1)+Ht%2,xr=(Ae<<1)+(Ht>>1);H.push({aabb:Ee.aabb.quadrant(Ht),zoom:Ee.zoom+1,x:fr,y:xr,wrap:Ee.wrap,fullyVisible:Ue})}}return ae.sort(function(Or,an){return Or.distanceSq-an.distanceSq}).map(function(Or){return Or.tileID})},Vi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Vi.prototype.zoomScale=function(l){return Math.pow(2,l)},Vi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Vi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Vi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Vi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Vi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Vi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Vi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Vi.prototype.coordinateLocation=function(l){return l.toLngLat()},Vi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],w=f[1]/d,P=c[1]/E,L=f[2]/d,U=c[2]/E,H=L===U?0:(0-L)/(U-L);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,H)/this.worldSize,m.number(w,P,H)/this.worldSize)},Vi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Vi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Vi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Vi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Vi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[P*w,E.y*w,0]),m.scale(L,L,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Vi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Vi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,w=90,P=-180,L=180,U=this.size,H=this._unmodified;if(this.latRange){var ae=this.latRange;E=m.mercatorYfromLat(ae[1])*this.worldSize,l=(w=m.mercatorYfromLat(ae[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var se=this.lngRange;P=m.mercatorXfromLng(se[0])*this.worldSize,f=(L=m.mercatorXfromLng(se[1])*this.worldSize)-P<U.x?U.x/(L-P):0}var ue=this.point,Ie=Math.max(f||0,l||0);if(Ie)return this.center=this.unproject(new m.Point(f?(L+P)/2:ue.x,l?(w+E)/2:ue.y)),this.zoom+=this.scaleZoom(Ie),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var Ee=ue.y,Fe=U.y/2;Ee-Fe<E&&(d=E+Fe),Ee+Fe>w&&(d=w-Fe)}if(this.lngRange){var Ae=ue.x,Ue=U.x/2;Ae-Ue<P&&(c=P+Ue),Ae+Ue>L&&(c=L-Ue)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:ue.x,d!==void 0?d:ue.y))),this._unmodified=H,this._constraining=!1}},Vi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,H=new Float64Array(16);m.perspective(H,this._fov,this.width/this.height,U,L),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,m.scale(H,H,[1,-1,1]),m.translate(H,H,[0,0,-this.cameraToCenterDistance]),m.rotateX(H,H,this._pitch),m.rotateZ(H,H,this.angle),m.translate(H,H,[-w,-P,0]),this.mercatorMatrix=m.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),m.scale(H,H,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=m.invert([],this.projMatrix);var ae=this.width%2/2,se=this.height%2/2,ue=Math.cos(this.angle),Ie=Math.sin(this.angle),Ee=w-Math.round(w)+ue*ae+Ie*se,Fe=P-Math.round(P)+ue*se+Ie*ae,Ae=new Float64Array(H);if(m.translate(Ae,Ae,[Ee>.5?Ee-1:Ee,Fe>.5?Fe-1:Fe,0]),this.alignedProjMatrix=Ae,H=m.create(),m.scale(H,H,[this.width/2,-this.height/2,1]),m.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=m.create(),m.scale(H,H,[1,-1,1]),m.translate(H,H,[-1,-1,0]),m.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Vi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Vi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Vi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,w=f.y,P=0,L=l;P<L.length;P+=1){var U=L[P];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(Vi.prototype,Ma);var gs=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};gs.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},gs.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},gs.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(f.lng*E)/E,P=Math.round(f.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),H="";if(H+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||U)&&(H+="/"+Math.round(10*L)/10),U&&(H+="/"+Math.round(U)),this._hashName){var ae=this._hashName,se=!1,ue=m.window.location.hash.slice(1).split("&").map(function(Ie){var Ee=Ie.split("=")[0];return Ee===ae?(se=!0,Ee+"="+H):Ie}).filter(function(Ie){return Ie});return se||ue.push(ae+"="+H),"#"+ue.join("&")}return"#"+H},gs.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},gs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},gs.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Lc={linearity:.3,easing:m.bezier(0,0,.3,1)},Yu=m.extend({deceleration:2500,maxSpeed:1400},Lc),Na=m.extend({deceleration:20,maxSpeed:1400},Lc),oc=m.extend({deceleration:1e3,maxSpeed:360},Lc),Bl=m.extend({deceleration:1e3,maxSpeed:90},Lc),qu=function(l){this._map=l,this.clear()};function Dc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Mu(l,f,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=m.clamp(l*E/(f/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}qu.prototype.clear=function(){this._inertiaBuffer=[]},qu.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},qu.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},qu.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(f.pan.mag()){var L=Mu(f.pan.mag(),w,m.extend({},Yu,l||{}));P.offset=f.pan.mult(L.amount/f.pan.mag()),P.center=this._map.transform.center,Dc(P,L)}if(f.zoom){var U=Mu(f.zoom,w,Na);P.zoom=this._map.transform.zoom+U.amount,Dc(P,U)}if(f.bearing){var H=Mu(f.bearing,w,oc);P.bearing=this._map.transform.bearing+m.clamp(H.amount,-179,179),Dc(P,H)}if(f.pitch){var ae=Mu(f.pitch,w,Bl);P.pitch=this._map.transform.pitch+ae.amount,Dc(P,ae)}if(P.zoom||P.bearing){var se=f.pinchAround===void 0?f.around:f.pinchAround;P.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),m.extend(P,{noMoveStart:!0})}};var vo=function(l){function f(d,E,w,P){P===void 0&&(P={});var L=W.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:U,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Nl=function(l){function f(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=W.touchPos(E.getCanvasContainer(),P),U=L.map(function(se){return E.unproject(se)}),H=L.reduce(function(se,ue,Ie,Ee){return se.add(ue.div(Ee.length))},new m.Point(0,0)),ae=E.unproject(H);l.call(this,d,{points:L,point:H,lngLats:U,lngLat:ae,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),sc=function(l){function f(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),mo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};mo.prototype.reset=function(){delete this._mousedownPos},mo.prototype.wheel=function(l){return this._firePreventable(new sc(l.type,this._map,l))},mo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new vo(l.type,this._map,l))},mo.prototype.mouseup=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new vo(l.type,this._map,l))},mo.prototype.dblclick=function(l){return this._firePreventable(new vo(l.type,this._map,l))},mo.prototype.mouseover=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.mouseout=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.touchstart=function(l){return this._firePreventable(new Nl(l.type,this._map,l))},mo.prototype.touchmove=function(l){this._map.fire(new Nl(l.type,this._map,l))},mo.prototype.touchend=function(l){this._map.fire(new Nl(l.type,this._map,l))},mo.prototype.touchcancel=function(l){this._map.fire(new Nl(l.type,this._map,l))},mo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},mo.prototype.isEnabled=function(){return!0},mo.prototype.isActive=function(){return!1},mo.prototype.enable=function(){},mo.prototype.disable=function(){};var pn=function(l){this._map=l};pn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},pn.prototype.mousemove=function(l){this._map.fire(new vo(l.type,this._map,l))},pn.prototype.mousedown=function(){this._delayContextMenu=!0},pn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},pn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new vo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},pn.prototype.isEnabled=function(){return!0},pn.prototype.isActive=function(){return!1},pn.prototype.enable=function(){},pn.prototype.disable=function(){};var co=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Ku(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}co.prototype.isEnabled=function(){return!!this._enabled},co.prototype.isActive=function(){return!!this._active},co.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},co.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},co.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(W.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},co.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);W.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},co.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),W.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},co.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},co.prototype.blur=function(){this.reset()},co.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},co.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var Ra=function(l){this.reset(),this.numTouches=l.numTouches};Ra.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ra.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(f),this.touches=Ku(c,f)))},Ra.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=Ku(c,f);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Ra.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Gs=function(l){this.singleTap=new Ra(l),this.numTaps=l.numTaps,this.reset()};Gs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Gs.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Gs.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Gs.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var ws=function(){this._zoomIn=new Gs({numTouches:1,numTaps:2}),this._zoomOut=new Gs({numTouches:2,numTaps:1}),this.reset()};ws.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ws.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},ws.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},ws.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},ws.prototype.touchcancel=function(){this.reset()},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active};var hf={0:1,2:2},Ur=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Ur.prototype.blur=function(){this.reset()},Ur.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ur.prototype._correctButton=function(l,f){return!1},Ur.prototype._move=function(l,f){return{}},Ur.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=W.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Ur.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=hf[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Ur.prototype.mouseupWindow=function(l){this._lastPoint&&W.mouseButton(l)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},Ur.prototype.enable=function(){this._enabled=!0},Ur.prototype.disable=function(){this._enabled=!1,this.reset()},Ur.prototype.isEnabled=function(){return this._enabled},Ur.prototype.isActive=function(){return this._active};var uc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Ur),df=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Ur),pl=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Ur),Sa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Sa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Sa.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Sa.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Sa.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Sa.prototype.touchcancel=function(){this.reset()},Sa.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=Ku(c,f),E=new m.Point(0,0),w=new m.Point(0,0),P=0;for(var L in d){var U=d[L],H=this._touches[L];H&&(E._add(U),w._add(U.sub(H)),P++,d[L]=U)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var ae=w.div(P);if(this._sum._add(ae),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:ae}}},Sa.prototype.enable=function(){this._enabled=!0},Sa.prototype.disable=function(){this._enabled=!1,this.reset()},Sa.prototype.isEnabled=function(){return this._enabled},Sa.prototype.isActive=function(){return this._active};var ys=function(){this.reset()};function vf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Pu(l,f){return Math.log(l/f)/Math.LN2}ys.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ys.prototype._start=function(l){},ys.prototype._move=function(l,f,c){return{}},ys.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},ys.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=vf(c,f,d[0]),P=vf(c,f,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},ys.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=vf(c,f,d[0]),P=vf(c,f,E);w&&P||(this._active&&W.suppressClick(),this.reset())}},ys.prototype.touchcancel=function(){this.reset()},ys.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ys.prototype.disable=function(){this._enabled=!1,this.reset()},ys.prototype.isEnabled=function(){return this._enabled},ys.prototype.isActive=function(){return this._active};var ks=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Pu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pu(this._distance,E),pinchAround:d}},f}(ys);function Iu(l,f){return 180*l.angleWith(f)/Math.PI}var Wf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Iu(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Iu(c,this._startVector);return Math.abs(E)<d},f}(ys);function hl(l){return Math.abs(l.y)>Math.abs(l.x)}var Xf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,hl(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return hl(c)&&hl(d)&&L}},f}(ys),mf={panStep:100,bearingStep:15,pitchStep:10},iu=function(){var l=mf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ts(l){return l*(2-l)}iu.prototype.blur=function(){this.reset()},iu.prototype.reset=function(){this._active=!1},iu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ts,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+E*f._pitchStep,offset:[-w*f._panStep,-P*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},iu.prototype.enable=function(){this._enabled=!0},iu.prototype.disable=function(){this._enabled=!1,this.reset()},iu.prototype.isEnabled=function(){return this._enabled},iu.prototype.isActive=function(){return this._active},iu.prototype.disableRotation=function(){this._rotationDisabled=!0},iu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Si=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Si.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Si.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Si.prototype.isEnabled=function(){return!!this._enabled},Si.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Si.prototype.isZooming=function(){return!!this._zooming},Si.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Si.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Si.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Si.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=W.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Si.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,U=this._easing,H=!1;if(this._type==="wheel"&&L&&U){var ae=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),se=U(ae);w=m.number(L,P,se),ae<1?this._frameId||(this._frameId=!0):H=!0}else w=P,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Si.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);f=m.bezier(w,P,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Si.prototype.blur=function(){this.reset()},Si.prototype.reset=function(){this._active=!1};var Ou=function(l,f){this._clickZoom=l,this._tapZoom=f};Ou.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ou.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ou.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ou.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var au=function(){this.reset()};au.prototype.reset=function(){this._active=!1},au.prototype.blur=function(){this.reset()},au.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},au.prototype.enable=function(){this._enabled=!0},au.prototype.disable=function(){this._enabled=!1,this.reset()},au.prototype.isEnabled=function(){return this._enabled},au.prototype.isActive=function(){return this._active};var Xo=function(){this._tap=new Gs({numTouches:1,numTaps:1}),this.reset()};Xo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Xo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Xo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},Xo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Xo.prototype.touchcancel=function(){this.reset()},Xo.prototype.enable=function(){this._enabled=!0},Xo.prototype.disable=function(){this._enabled=!1,this.reset()},Xo.prototype.isEnabled=function(){return this._enabled},Xo.prototype.isActive=function(){return this._active};var dl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};dl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},dl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},dl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},dl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ns=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};ns.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ns.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ns.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ns.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Hs=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Hs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Hs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Hs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Hs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Hs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Hs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var _s=function(l){return l.zoom||l.drag||l.pitch||l.rotate},pu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function In(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Cn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qu(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];W.addEventListener(P,w[1],P===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Cn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];W.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Cn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new mo(f,l));var d=f.boxZoom=new co(f,l);this._add("boxZoom",d);var E=new ws,w=new au;f.doubleClickZoom=new Ou(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new Xo;this._add("tapDragZoom",P);var L=f.touchPitch=new Xf;this._add("touchPitch",L);var U=new df(l),H=new pl(l);f.dragRotate=new ns(l,U,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var ae=new uc(l),se=new Sa(l);f.dragPan=new dl(c,ae,se),this._add("mousePan",ae),this._add("touchPan",se,["touchZoom","touchRotate"]);var ue=new Wf,Ie=new ks;f.touchZoomRotate=new Hs(c,Ie,ue,P),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]);var Ee=f.scrollZoom=new Si(f,this);this._add("scrollZoom",Ee,["mousePan"]);var Fe=f.keyboard=new iu;this._add("keyboard",Fe),this._add("blockableMapEvent",new pn(f));for(var Ae=0,Ue=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<Ue.length;Ae+=1){var Ye=Ue[Ae];l.interactive&&l[Ye]&&f[Ye].enable(l[Ye])}},Cn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Cn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Cn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(_s(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Cn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},Cn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?W.touchPos(this._el,P):W.mousePos(this._el,l),U=0,H=this._handlers;U<H.length;U+=1){var ae=H[U],se=ae.handlerName,ue=ae.handler,Ie=ae.allowed;if(ue.isEnabled()){var Ee=void 0;this._blockedByActive(w,Ie,se)?ue.reset():ue[f||l.type]&&(Ee=ue[f||l.type](l,L,P),this.mergeHandlerResult(d,E,Ee,se,c),Ee&&Ee.needsRenderFrame&&this._triggerRenderFrame()),(Ee||ue.isActive())&&(w[se]=ue)}}var Fe={};for(var Ae in this._previousActiveHandlers)w[Ae]||(Fe[Ae]=c);this._previousActiveHandlers=w,(Object.keys(Fe).length||In(d))&&(this._changes.push([d,E,Fe]),this._triggerRenderFrame()),(Object.keys(w).length||In(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ue=d.cameraAnimation;Ue&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ue(this._map))},Cn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},Cn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],U=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),m.extend(f,L),m.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},Cn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!In(l))return this._fireEvents(f,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,H=l.around,ae=l.pinchAround;ae!==void 0&&(H=ae),d._stop(!0),H=H||d.transform.centerPoint;var se=E.pointLocation(w?H.sub(w):H);L&&(E.bearing+=L),U&&(E.pitch+=U),P&&(E.zoom+=P),E.setLocationAtPoint(se,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Cn.prototype._fireEvents=function(l,f,c){var d=this,E=_s(this._eventsInProgress),w=_s(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(U,P[U]);for(var H in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var ae,se={};for(var ue in this._eventsInProgress){var Ie=this._eventsInProgress[ue],Ee=Ie.handlerName,Fe=Ie.originalEvent;this._handlersById[Ee].isActive()||(delete this._eventsInProgress[ue],se[ue+"end"]=ae=f[Ee]||Fe)}for(var Ae in se)this._fireEvent(Ae,se[Ae]);var Ue=_s(this._eventsInProgress);if(c&&(E||w)&&!Ue){this._updatingCamera=!0;var Ye=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),vt=function(Vt){return Vt!==0&&-d._bearingSnap<Vt&&Vt<d._bearingSnap};Ye?(vt(Ye.bearing||this._map.getBearing())&&(Ye.bearing=0),this._map.easeTo(Ye,{originalEvent:ae})):(this._map.fire(new m.Event("moveend",{originalEvent:ae})),vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},Cn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new pu("renderFrame",{timeStamp:f})),l._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Fc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=m.extend(P,w.padding);var U=this.transform,H=U.padding,ae=U.project(m.LngLat.convert(c)),se=U.project(m.LngLat.convert(d)),ue=ae.rotate(-E*Math.PI/180),Ie=se.rotate(-E*Math.PI/180),Ee=new m.Point(Math.max(ue.x,Ie.x),Math.max(ue.y,Ie.y)),Fe=new m.Point(Math.min(ue.x,Ie.x),Math.min(ue.y,Ie.y)),Ae=Ee.sub(Fe),Ue=(U.width-(H.left+H.right+w.padding.left+w.padding.right))/Ae.x,Ye=(U.height-(H.top+H.bottom+w.padding.top+w.padding.bottom))/Ae.y;if(!(Ye<0||Ue<0)){var vt=Math.min(U.scaleZoom(U.scale*Math.min(Ue,Ye)),w.maxZoom),Vt=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),zt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Ht=Vt.add(zt).mult(U.scale/U.zoomScale(vt));return{center:U.unproject(ae.add(se).div(2).sub(Ht)),zoom:vt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,P)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),P&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),U=this.getPitch(),H=this.getPadding(),ae="zoom"in c?+c.zoom:P,se="bearing"in c?this._normalizeBearing(c.bearing,L):L,ue="pitch"in c?+c.pitch:U,Ie="padding"in c?c.padding:w.padding,Ee=m.Point.convert(c.offset),Fe=w.centerPoint.add(Ee),Ae=w.pointLocation(Fe),Ue=m.LngLat.convert(c.center||Ae);this._normalizeCenter(Ue);var Ye,vt,Vt=w.project(Ae),zt=w.project(Ue).sub(Vt),Ht=w.zoomScale(ae-P);c.around&&(Ye=m.LngLat.convert(c.around),vt=w.locationPoint(Ye));var fr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==P,this._rotating=this._rotating||L!==se,this._pitching=this._pitching||ue!==U,this._padding=!w.isPaddingEqual(Ie),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,fr),this._ease(function(xr){if(E._zooming&&(w.zoom=m.number(P,ae,xr)),E._rotating&&(w.bearing=m.number(L,se,xr)),E._pitching&&(w.pitch=m.number(U,ue,xr)),E._padding&&(w.interpolatePadding(H,Ie,xr),Fe=w.centerPoint.add(Ee)),Ye)w.setLocationAtPoint(Ye,vt);else{var Or=w.zoomScale(w.zoom-P),an=ae>P?Math.min(2,Ht):Math.max(.5,Ht),Un=Math.pow(an,1-xr),On=w.unproject(Vt.add(zt.mult(xr*Un)).mult(Or));w.setLocationAtPoint(w.renderWorldCopies?On.wrap():On,Fe)}E._fireMoveEvents(d)},function(xr){E._afterEase(d,xr)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),P&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var P=this.transform,L=this.getZoom(),U=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),se="zoom"in c?m.clamp(+c.zoom,P.minZoom,P.maxZoom):L,ue="bearing"in c?this._normalizeBearing(c.bearing,U):U,Ie="pitch"in c?+c.pitch:H,Ee="padding"in c?c.padding:P.padding,Fe=P.zoomScale(se-L),Ae=m.Point.convert(c.offset),Ue=P.centerPoint.add(Ae),Ye=P.pointLocation(Ue),vt=m.LngLat.convert(c.center||Ye);this._normalizeCenter(vt);var Vt=P.project(Ye),zt=P.project(vt).sub(Vt),Ht=c.curve,fr=Math.max(P.width,P.height),xr=fr/Fe,Or=zt.mag();if("minZoom"in c){var an=m.clamp(Math.min(c.minZoom,L,se),P.minZoom,P.maxZoom),Un=fr/P.zoomScale(an-L);Ht=Math.sqrt(Un/Or*2)}var On=Ht*Ht;function Bn(Wn){var Gn=(xr*xr-fr*fr+(Wn?-1:1)*On*On*Or*Or)/(2*(Wn?xr:fr)*On*Or);return Math.log(Math.sqrt(Gn*Gn+1)-Gn)}function Ti(Wn){return(Math.exp(Wn)-Math.exp(-Wn))/2}function tn(Wn){return(Math.exp(Wn)+Math.exp(-Wn))/2}var ri=Bn(0),ni=function(Wn){return tn(ri)/tn(ri+Ht*Wn)},Yn=function(Wn){return fr*((tn(ri)*(Ti(Gn=ri+Ht*Wn)/tn(Gn))-Ti(ri))/On)/Or;var Gn},Vn=(Bn(1)-ri)/Ht;if(Math.abs(Or)<1e-6||!isFinite(Vn)){if(Math.abs(fr-xr)<1e-6)return this.easeTo(c,d);var ci=xr<fr?-1:1;Vn=Math.abs(Math.log(xr/fr))/Ht,Yn=function(){return 0},ni=function(Wn){return Math.exp(ci*Ht*Wn)}}return c.duration="duration"in c?+c.duration:1e3*Vn/("screenSpeed"in c?+c.screenSpeed/Ht:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==ue,this._pitching=Ie!==H,this._padding=!P.isPaddingEqual(Ee),this._prepareEase(d,!1),this._ease(function(Wn){var Gn=Wn*Vn,bo=1/ni(Gn);P.zoom=Wn===1?se:L+P.scaleZoom(bo),E._rotating&&(P.bearing=m.number(U,ue,Wn)),E._pitching&&(P.pitch=m.number(H,Ie,Wn)),E._padding&&(P.interpolatePadding(ae,Ee,Wn),Ue=P.centerPoint.add(Ae));var Va=Wn===1?vt:P.unproject(Vt.add(zt.mult(Yn(Gn))).mult(bo));P.setLocationAtPoint(P.renderWorldCopies?Va.wrap():Va,Ue),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),is=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};is.prototype.getDefaultPosition=function(){return"bottom-right"},is.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},is.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},is.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},is.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},is.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},is.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},is.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var P=(l=l.filter(function(L,U){for(var H=U+1;H<l.length;H++)if(l[H].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},is.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ou=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};ou.prototype.onAdd=function(l){this._map=l,this._container=W.create("div","mapboxgl-ctrl");var f=W.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ou.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ou.prototype.getDefaultPosition=function(){return"bottom-left"},ou.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ou.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},ou.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Bo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Bo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Bo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Bo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Bo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},gf=m.window.HTMLImageElement,yf=m.window.HTMLElement,la=m.window.ImageBitmap,da={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},kp=function(l){function f(d){var E=this;if((d=m.extend({},da,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Vi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Bo,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Ru,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof yf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,d),this._hash=d.hash&&new gs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new is({customAttribution:d.customAttribution})),this.addControl(new ou,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new m.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new m.Event(P.dataType+"dataloading",P))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(ae){var se=L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[];se.length?U||(U=!0,w.call(L,new vo(d,L,ae.originalEvent,{features:se}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:E,listener:w,delegates:{mousemove:function(ae){(L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[]).length?H=!0:H&&(H=!1,w.call(L,new vo(d,L,ae.originalEvent)))},mouseout:function(ae){H&&(H=!1,w.call(L,new vo(d,L,ae.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(ae){var se=L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[];se.length&&(ae.features=se,w.call(L,ae),delete ae.features)},P)}},f.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},f.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},f.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],H=0;H<U.length;H++){var ae=U[H];if(ae.layer===E&&ae.listener===w){for(var se in ae.delegates)P.off(se,ae.delegates[se]);return U.splice(H,1),P}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var P=m.Point.convert(d[0]),L=m.Point.convert(d[1]);w=[P,new m.Point(L.x,P.y),L,new m.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new vs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,m.ResourceType.Style);m.getJSON(L,function(U,H){U?w.fire(new m.ErrorEvent(U)):H&&w._updateDiff(H,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,H=w.stretchY,ae=w.content;if(this._lazyInitEmptyStyle(),E instanceof gf||la&&E instanceof la){var se=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:se.width,height:se.height},se.data),pixelRatio:P,stretchX:U,stretchY:H,content:ae,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ue=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:U,stretchY:H,content:ae,sdf:L,version:0,userImage:ue}),ue.onAdd&&ue.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof gf||la&&E instanceof la?m.browser.getImageData(E):E,L=P.width,U=P.height,H=P.data;return L===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(H,!(E instanceof gf||la&&E instanceof la)),void this.style.updateImage(d,w))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},f.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=W.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=W.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=W.create("div","mapboxgl-ctrl-"+U,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},Oe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Yi(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,ae=m.browser.now();this.style.zoomHistory.update(H,ae);var se=new m.EvaluationParameters(H,{now:ae,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ue=se.crossFadingFactor();ue===1&&ue===this._crossFadingFactor||(U=!0,this._crossFadingFactor=ue),this.style.update(se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ie=m.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ae=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Ie,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Ee=this.painter.collectGpuTimers();setTimeout(function(){var Ae=w.painter.queryGpuTimers(Ee);w.fire(new m.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var Fe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Fe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||Fe||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),$u(this._canvasContainer),$u(this._controlContainer),$u(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(Fc);function $u(l){l.parentNode&&l.parentNode.removeChild(l)}var hu={showCompass:!0,showZoom:!0,visualizePitch:!1},Gi=function(l){var f=this;this.options=m.extend({},hu,l),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Gi.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Gi.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Gi.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new no(this._map,this._compass,this.options.visualizePitch)),this._container},Gi.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Gi.prototype._createButton=function(l,f){var c=W.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Gi.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var no=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new df({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new pl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(f,"mousedown",this.mousedown),W.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(f,"touchmove",this.touchmove),W.addEventListener(f,"touchend",this.touchend),W.addEventListener(f,"touchcancel",this.reset)};function Ws(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<w?l=d:c.locationPoint(E).distSqr(f)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}no.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),W.disableDrag()},no.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},no.prototype.off=function(){var l=this.element;W.removeEventListener(l,"mousedown",this.mousedown),W.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(l,"touchmove",this.touchmove),W.removeEventListener(l,"touchend",this.touchend),W.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},no.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(m.window,"mousemove",this.mousemove),W.removeEventListener(m.window,"mouseup",this.mouseup)},no.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),W.mousePos(this.element,l)),W.addEventListener(m.window,"mousemove",this.mousemove),W.addEventListener(m.window,"mouseup",this.mouseup)},no.prototype.mousemove=function(l){this.move(l,W.mousePos(this.element,l))},no.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},no.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},no.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},no.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},no.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Xs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vl(l,f,c){var d=l.classList;for(var E in Xs)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var ku,zl=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var E=W.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=W.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=W.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=W.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<H.length;U+=1){var ae=H[U],se=W.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ae.rx),se.setAttributeNS(null,"ry",ae.ry),L.appendChild(se)}var ue=W.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"fill",this._color);var Ie=W.createNS("http://www.w3.org/2000/svg","path");Ie.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ue.appendChild(Ie);var Ee=W.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"fill","#000000");var Fe=W.createNS("http://www.w3.org/2000/svg","path");Fe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ee.appendChild(Fe);var Ae=W.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var Ue=W.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ye=W.createNS("http://www.w3.org/2000/svg","circle");Ye.setAttributeNS(null,"fill","#000000"),Ye.setAttributeNS(null,"opacity","0.25"),Ye.setAttributeNS(null,"cx","5.5"),Ye.setAttributeNS(null,"cy","5.5"),Ye.setAttributeNS(null,"r","5.4999962");var vt=W.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#FFFFFF"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962"),Ue.appendChild(Ye),Ue.appendChild(vt),P.appendChild(L),P.appendChild(ue),P.appendChild(Ee),P.appendChild(Ae),P.appendChild(Ue),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Vt){Vt.preventDefault()}),this._element.addEventListener("mousedown",function(Vt){Vt.preventDefault()}),vl(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ws(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,Xs[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),ja={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},su=0,du=!1,Yf=function(l){function f(c){l.call(this),this.options=m.extend({},ja,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,ku!==void 0?d(ku):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(ku=E.state!=="denied")}):d(ku=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,su=0,du=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&du)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new zl(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":su--,du=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++su>1?(c={maximumAge:6e5,timeout:0},du=!0):(c=this.options.positionOptions,du=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),ml={maxWidth:100,unit:"metric"},Qu=function(l){this.options=m.extend({},ml,l),m.bindAll(["_onMove","setUnit"],this)};function _f(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?gl(f,d,U/5280,l._getUIString("ScaleControl.Miles")):gl(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?gl(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?gl(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):gl(f,d,L,l._getUIString("ScaleControl.Meters"))}function gl(l,f,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(U){var H=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*H)/H}(P)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Qu.prototype.getDefaultPosition=function(){return"bottom-left"},Qu.prototype._onMove=function(){_f(this._map,this._container,this.options)},Qu.prototype.onAdd=function(l){return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Qu.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Qu.prototype.setUnit=function(l){this.options.unit=l,_f(this._map,this._container,this.options)};var Ms=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ms.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ms.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ms.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Ms.prototype._setupUI=function(){var l=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ms.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ms.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ms.prototype._isFullscreen=function(){return this._fullscreen},Ms.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ms.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var lc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),xf=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(lc),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(se){return d._container.classList.add(se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ws(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function se(ue){if(ue){if(typeof ue=="number"){var Ie=Math.round(Math.sqrt(.5*Math.pow(ue,2)));return{center:new m.Point(0,0),top:new m.Point(0,ue),"top-left":new m.Point(Ie,Ie),"top-right":new m.Point(-Ie,Ie),bottom:new m.Point(0,-ue),"bottom-left":new m.Point(Ie,-Ie),"bottom-right":new m.Point(-Ie,-Ie),left:new m.Point(ue,0),right:new m.Point(-ue,0)}}if(ue instanceof m.Point||Array.isArray(ue)){var Ee=m.Point.convert(ue);return{center:Ee,top:Ee,"top-left":Ee,"top-right":Ee,bottom:Ee,"bottom-left":Ee,"bottom-right":Ee,left:Ee,right:Ee}}return{center:m.Point.convert(ue.center||[0,0]),top:m.Point.convert(ue.top||[0,0]),"top-left":m.Point.convert(ue["top-left"]||[0,0]),"top-right":m.Point.convert(ue["top-right"]||[0,0]),bottom:m.Point.convert(ue.bottom||[0,0]),"bottom-left":m.Point.convert(ue["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(ue["bottom-right"]||[0,0]),left:m.Point.convert(ue.left||[0,0]),right:m.Point.convert(ue.right||[0,0])}}return se(new m.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,H=this._container.offsetHeight;L=E.y+P.bottom.y<H?["top"]:E.y>this._map.transform.height-H?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var ae=E.add(P[w]).round();W.setTransform(this._container,Xs[w]+" translate("+ae.x+"px,"+ae.y+"px)"),vl(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Bc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),cc={version:m.version,supported:Oe,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:kp,NavigationControl:Gi,GeolocateControl:Yf,AttributionControl:is,ScaleControl:Qu,FullscreenControl:Ms,Popup:xf,Marker:zl,Style:vs,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Ct().acquire(Lt)},clearPrewarmedResources:function(){var l=_n;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Lt),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return pr.workerCount},set workerCount(l){pr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return cc}),Pe})},28660:function(Ar,ne,Q){var Pe=Q(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(m){(function(Oe){var W=typeof Q.g=="object"?Q.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),pe=ce(m);typeof W.Reflect=="undefined"?W.Reflect=m:pe=ce(W.Reflect,pe),Oe(pe);function ce(Be,_e){return function(tt,pt){typeof Be[tt]!="function"&&Object.defineProperty(Be,tt,{configurable:!0,writable:!0,value:pt}),_e&&_e(tt,pt)}}})(function(Oe){var W=Object.prototype.hasOwnProperty,pe=typeof Symbol=="function",ce=pe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=pe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",_e=typeof Object.create=="function",tt={__proto__:[]}instanceof Array,pt=!_e&&!tt,Et={create:_e?function(){return Js(Object.create(null))}:tt?function(){return Js({__proto__:null})}:function(){return Js({})},has:pt?function(Nt,$t){return W.call(Nt,$t)}:function(Nt,$t){return $t in Nt},get:pt?function(Nt,$t){return W.call(Nt,$t)?Nt[$t]:void 0}:function(Nt,$t){return Nt[$t]}},Jt=Object.getPrototypeOf(Function),ur=typeof Pe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",kt=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:he(),er=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:oi(),jt=!ur&&typeof WeakMap=="function"?WeakMap:xo(),ct=new jt;function dt(Nt,$t,Ir,nn){if(gn(Ir)){if(!Li(Nt))throw new TypeError;if(!pa($t))throw new TypeError;return Gr(Nt,$t)}else{if(!Li(Nt))throw new TypeError;if(!ai($t))throw new TypeError;if(!ai(nn)&&!gn(nn)&&!di(nn))throw new TypeError;return di(nn)&&(nn=void 0),Ir=Wi(Ir),Qr(Nt,$t,Ir,nn)}}Oe("decorate",dt);function ir(Nt,$t){function Ir(nn,wn){if(!ai(nn))throw new TypeError;if(!gn(wn)&&!Lo(wn))throw new TypeError;Ft(Nt,$t,nn,wn)}return Ir}Oe("metadata",ir);function Y(Nt,$t,Ir,nn){if(!ai(Ir))throw new TypeError;return gn(nn)||(nn=Wi(nn)),Ft(Nt,$t,Ir,nn)}Oe("defineMetadata",Y);function Wt(Nt,$t,Ir){if(!ai($t))throw new TypeError;return gn(Ir)||(Ir=Wi(Ir)),Ce(Nt,$t,Ir)}Oe("hasMetadata",Wt);function ut(Nt,$t,Ir){if(!ai($t))throw new TypeError;return gn(Ir)||(Ir=Wi(Ir)),ke(Nt,$t,Ir)}Oe("hasOwnMetadata",ut);function qe(Nt,$t,Ir){if(!ai($t))throw new TypeError;return gn(Ir)||(Ir=Wi(Ir)),xt(Nt,$t,Ir)}Oe("getMetadata",qe);function St(Nt,$t,Ir){if(!ai($t))throw new TypeError;return gn(Ir)||(Ir=Wi(Ir)),ht(Nt,$t,Ir)}Oe("getOwnMetadata",St);function Qe(Nt,$t){if(!ai(Nt))throw new TypeError;return gn($t)||($t=Wi($t)),Gt(Nt,$t)}Oe("getMetadataKeys",Qe);function Xt(Nt,$t){if(!ai(Nt))throw new TypeError;return gn($t)||($t=Wi($t)),Er(Nt,$t)}Oe("getOwnMetadataKeys",Xt);function wr(Nt,$t,Ir){if(!ai($t))throw new TypeError;gn(Ir)||(Ir=Wi(Ir));var nn=A($t,Ir,!1);if(gn(nn)||!nn.delete(Nt))return!1;if(nn.size>0)return!0;var wn=ct.get($t);return wn.delete(Ir),wn.size>0||ct.delete($t),!0}Oe("deleteMetadata",wr);function Gr(Nt,$t){for(var Ir=Nt.length-1;Ir>=0;--Ir){var nn=Nt[Ir],wn=nn($t);if(!gn(wn)&&!di(wn)){if(!pa(wn))throw new TypeError;$t=wn}}return $t}function Qr(Nt,$t,Ir,nn){for(var wn=Nt.length-1;wn>=0;--wn){var zn=Nt[wn],xi=zn($t,Ir,nn);if(!gn(xi)&&!di(xi)){if(!ai(xi))throw new TypeError;nn=xi}}return nn}function A(Nt,$t,Ir){var nn=ct.get(Nt);if(gn(nn)){if(!Ir)return;nn=new kt,ct.set(Nt,nn)}var wn=nn.get($t);if(gn(wn)){if(!Ir)return;wn=new kt,nn.set($t,wn)}return wn}function Ce(Nt,$t,Ir){var nn=ke(Nt,$t,Ir);if(nn)return!0;var wn=Ss($t);return di(wn)?!1:Ce(Nt,wn,Ir)}function ke(Nt,$t,Ir){var nn=A($t,Ir,!1);return gn(nn)?!1:mi(nn.has(Nt))}function xt(Nt,$t,Ir){var nn=ke(Nt,$t,Ir);if(nn)return ht(Nt,$t,Ir);var wn=Ss($t);if(!di(wn))return xt(Nt,wn,Ir)}function ht(Nt,$t,Ir){var nn=A($t,Ir,!1);if(!gn(nn))return nn.get(Nt)}function Ft(Nt,$t,Ir,nn){var wn=A(Ir,nn,!0);wn.set(Nt,$t)}function Gt(Nt,$t){var Ir=Er(Nt,$t),nn=Ss(Nt);if(nn===null)return Ir;var wn=Gt(nn,$t);if(wn.length<=0)return Ir;if(Ir.length<=0)return wn;for(var zn=new er,xi=[],fi=0,En=Ir;fi<En.length;fi++){var Ii=En[fi],Pi=zn.has(Ii);Pi||(zn.add(Ii),xi.push(Ii))}for(var to=0,fs=wn;to<fs.length;to++){var Ii=fs[to],Pi=zn.has(Ii);Pi||(zn.add(Ii),xi.push(Ii))}return xi}function Er(Nt,$t){var Ir=[],nn=A(Nt,$t,!1);if(gn(nn))return Ir;for(var wn=nn.keys(),zn=_a(wn),xi=0;;){var fi=aa(zn);if(!fi)return Ir.length=xi,Ir;var En=Ni(fi);try{Ir[xi]=En}catch(Ii){try{Ji(zn)}finally{throw Ii}}xi++}}function Qn(Nt){if(Nt===null)return 1;switch(typeof Nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Nt===null?1:6;default:return 6}}function gn(Nt){return Nt===void 0}function di(Nt){return Nt===null}function Hn(Nt){return typeof Nt=="symbol"}function ai(Nt){return typeof Nt=="object"?Nt!==null:typeof Nt=="function"}function vi(Nt,$t){switch(Qn(Nt)){case 0:return Nt;case 1:return Nt;case 2:return Nt;case 3:return Nt;case 4:return Nt;case 5:return Nt}var Ir=$t===3?"string":$t===5?"number":"default",nn=Ia(Nt,ce);if(nn!==void 0){var wn=nn.call(Nt,Ir);if(ai(wn))throw new TypeError;return wn}return Xn(Nt,Ir==="default"?"number":Ir)}function Xn(Nt,$t){if($t==="string"){var Ir=Nt.toString;if(Qi(Ir)){var nn=Ir.call(Nt);if(!ai(nn))return nn}var wn=Nt.valueOf;if(Qi(wn)){var nn=wn.call(Nt);if(!ai(nn))return nn}}else{var wn=Nt.valueOf;if(Qi(wn)){var nn=wn.call(Nt);if(!ai(nn))return nn}var zn=Nt.toString;if(Qi(zn)){var nn=zn.call(Nt);if(!ai(nn))return nn}}throw new TypeError}function mi(Nt){return!!Nt}function fa(Nt){return""+Nt}function Wi(Nt){var $t=vi(Nt,3);return Hn($t)?$t:fa($t)}function Li(Nt){return Array.isArray?Array.isArray(Nt):Nt instanceof Object?Nt instanceof Array:Object.prototype.toString.call(Nt)==="[object Array]"}function Qi(Nt){return typeof Nt=="function"}function pa(Nt){return typeof Nt=="function"}function Lo(Nt){switch(Qn(Nt)){case 3:return!0;case 4:return!0;default:return!1}}function Ia(Nt,$t){var Ir=Nt[$t];if(Ir!=null){if(!Qi(Ir))throw new TypeError;return Ir}}function _a(Nt){var $t=Ia(Nt,Be);if(!Qi($t))throw new TypeError;var Ir=$t.call(Nt);if(!ai(Ir))throw new TypeError;return Ir}function Ni(Nt){return Nt.value}function aa(Nt){var $t=Nt.next();return $t.done?!1:$t}function Ji(Nt){var $t=Nt.return;$t&&$t.call(Nt)}function Ss(Nt){var $t=Object.getPrototypeOf(Nt);if(typeof Nt!="function"||Nt===Jt||$t!==Jt)return $t;var Ir=Nt.prototype,nn=Ir&&Object.getPrototypeOf(Ir);if(nn==null||nn===Object.prototype)return $t;var wn=nn.constructor;return typeof wn!="function"||wn===Nt?$t:wn}function he(){var Nt={},$t=[],Ir=function(){function xi(fi,En,Ii){this._index=0,this._keys=fi,this._values=En,this._selector=Ii}return xi.prototype["@@iterator"]=function(){return this},xi.prototype[Be]=function(){return this},xi.prototype.next=function(){var fi=this._index;if(fi>=0&&fi<this._keys.length){var En=this._selector(this._keys[fi],this._values[fi]);return fi+1>=this._keys.length?(this._index=-1,this._keys=$t,this._values=$t):this._index++,{value:En,done:!1}}return{value:void 0,done:!0}},xi.prototype.throw=function(fi){throw this._index>=0&&(this._index=-1,this._keys=$t,this._values=$t),fi},xi.prototype.return=function(fi){return this._index>=0&&(this._index=-1,this._keys=$t,this._values=$t),{value:fi,done:!0}},xi}();return function(){function xi(){this._keys=[],this._values=[],this._cacheKey=Nt,this._cacheIndex=-2}return Object.defineProperty(xi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),xi.prototype.has=function(fi){return this._find(fi,!1)>=0},xi.prototype.get=function(fi){var En=this._find(fi,!1);return En>=0?this._values[En]:void 0},xi.prototype.set=function(fi,En){var Ii=this._find(fi,!0);return this._values[Ii]=En,this},xi.prototype.delete=function(fi){var En=this._find(fi,!1);if(En>=0){for(var Ii=this._keys.length,Pi=En+1;Pi<Ii;Pi++)this._keys[Pi-1]=this._keys[Pi],this._values[Pi-1]=this._values[Pi];return this._keys.length--,this._values.length--,fi===this._cacheKey&&(this._cacheKey=Nt,this._cacheIndex=-2),!0}return!1},xi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Nt,this._cacheIndex=-2},xi.prototype.keys=function(){return new Ir(this._keys,this._values,nn)},xi.prototype.values=function(){return new Ir(this._keys,this._values,wn)},xi.prototype.entries=function(){return new Ir(this._keys,this._values,zn)},xi.prototype["@@iterator"]=function(){return this.entries()},xi.prototype[Be]=function(){return this.entries()},xi.prototype._find=function(fi,En){return this._cacheKey!==fi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=fi)),this._cacheIndex<0&&En&&(this._cacheIndex=this._keys.length,this._keys.push(fi),this._values.push(void 0)),this._cacheIndex},xi}();function nn(xi,fi){return xi}function wn(xi,fi){return fi}function zn(xi,fi){return[xi,fi]}}function oi(){return function(){function Nt(){this._map=new kt}return Object.defineProperty(Nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Nt.prototype.has=function($t){return this._map.has($t)},Nt.prototype.add=function($t){return this._map.set($t,$t),this},Nt.prototype.delete=function($t){return this._map.delete($t)},Nt.prototype.clear=function(){this._map.clear()},Nt.prototype.keys=function(){return this._map.keys()},Nt.prototype.values=function(){return this._map.values()},Nt.prototype.entries=function(){return this._map.entries()},Nt.prototype["@@iterator"]=function(){return this.keys()},Nt.prototype[Be]=function(){return this.keys()},Nt}()}function xo(){var Nt=16,$t=Et.create(),Ir=nn();return function(){function En(){this._key=nn()}return En.prototype.has=function(Ii){var Pi=wn(Ii,!1);return Pi!==void 0?Et.has(Pi,this._key):!1},En.prototype.get=function(Ii){var Pi=wn(Ii,!1);return Pi!==void 0?Et.get(Pi,this._key):void 0},En.prototype.set=function(Ii,Pi){var to=wn(Ii,!0);return to[this._key]=Pi,this},En.prototype.delete=function(Ii){var Pi=wn(Ii,!1);return Pi!==void 0?delete Pi[this._key]:!1},En.prototype.clear=function(){this._key=nn()},En}();function nn(){var En;do En="@@WeakMap@@"+fi();while(Et.has($t,En));return $t[En]=!0,En}function wn(En,Ii){if(!W.call(En,Ir)){if(!Ii)return;Object.defineProperty(En,Ir,{value:Et.create()})}return En[Ir]}function zn(En,Ii){for(var Pi=0;Pi<Ii;++Pi)En[Pi]=Math.random()*255|0;return En}function xi(En){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(En)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(En)):zn(new Uint8Array(En),En):zn(new Array(En),En)}function fi(){var En=xi(Nt);En[6]=En[6]&79|64,En[8]=En[8]&191|128;for(var Ii="",Pi=0;Pi<Nt;++Pi){var to=En[Pi];(Pi===4||Pi===6||Pi===8)&&(Ii+="-"),to<16&&(Ii+="0"),Ii+=to.toString(16).toLowerCase()}return Ii}}function Js(Nt){return Nt.__=void 0,delete Nt.__,Nt}})})(ye||(ye={}))},69848:function(Ar){(function(ne,Q){Ar.exports=Q()})(this,function(){"use strict";function ne(ut,qe,St,Qe,Xt,wr){if(!(Xt-Qe<=St)){var Gr=Qe+Xt>>1;Q(ut,qe,Gr,Qe,Xt,wr%2),ne(ut,qe,St,Qe,Gr-1,wr+1),ne(ut,qe,St,Gr+1,Xt,wr+1)}}function Q(ut,qe,St,Qe,Xt,wr){for(;Xt>Qe;){if(Xt-Qe>600){var Gr=Xt-Qe+1,Qr=St-Qe+1,A=Math.log(Gr),Ce=.5*Math.exp(2*A/3),ke=.5*Math.sqrt(A*Ce*(Gr-Ce)/Gr)*(Qr-Gr/2<0?-1:1),xt=Math.max(Qe,Math.floor(St-Qr*Ce/Gr+ke)),ht=Math.min(Xt,Math.floor(St+(Gr-Qr)*Ce/Gr+ke));Q(ut,qe,St,xt,ht,wr)}var Ft=qe[2*St+wr],Gt=Qe,Er=Xt;for(Pe(ut,qe,Qe,St),qe[2*Xt+wr]>Ft&&Pe(ut,qe,Qe,Xt);Gt<Er;){for(Pe(ut,qe,Gt,Er),Gt++,Er--;qe[2*Gt+wr]<Ft;)Gt++;for(;qe[2*Er+wr]>Ft;)Er--}qe[2*Qe+wr]===Ft?Pe(ut,qe,Qe,Er):(Er++,Pe(ut,qe,Er,Xt)),Er<=St&&(Qe=Er+1),St<=Er&&(Xt=Er-1)}}function Pe(ut,qe,St,Qe){ye(ut,St,Qe),ye(qe,2*St,2*Qe),ye(qe,2*St+1,2*Qe+1)}function ye(ut,qe,St){var Qe=ut[qe];ut[qe]=ut[St],ut[St]=Qe}function m(ut,qe,St,Qe,Xt,wr,Gr){for(var Qr=[0,ut.length-1,0],A=[],Ce,ke;Qr.length;){var xt=Qr.pop(),ht=Qr.pop(),Ft=Qr.pop();if(ht-Ft<=Gr){for(var Gt=Ft;Gt<=ht;Gt++)Ce=qe[2*Gt],ke=qe[2*Gt+1],Ce>=St&&Ce<=Xt&&ke>=Qe&&ke<=wr&&A.push(ut[Gt]);continue}var Er=Math.floor((Ft+ht)/2);Ce=qe[2*Er],ke=qe[2*Er+1],Ce>=St&&Ce<=Xt&&ke>=Qe&&ke<=wr&&A.push(ut[Er]);var Qn=(xt+1)%2;(xt===0?St<=Ce:Qe<=ke)&&(Qr.push(Ft),Qr.push(Er-1),Qr.push(Qn)),(xt===0?Xt>=Ce:wr>=ke)&&(Qr.push(Er+1),Qr.push(ht),Qr.push(Qn))}return A}function Oe(ut,qe,St,Qe,Xt,wr){for(var Gr=[0,ut.length-1,0],Qr=[],A=Xt*Xt;Gr.length;){var Ce=Gr.pop(),ke=Gr.pop(),xt=Gr.pop();if(ke-xt<=wr){for(var ht=xt;ht<=ke;ht++)W(qe[2*ht],qe[2*ht+1],St,Qe)<=A&&Qr.push(ut[ht]);continue}var Ft=Math.floor((xt+ke)/2),Gt=qe[2*Ft],Er=qe[2*Ft+1];W(Gt,Er,St,Qe)<=A&&Qr.push(ut[Ft]);var Qn=(Ce+1)%2;(Ce===0?St-Xt<=Gt:Qe-Xt<=Er)&&(Gr.push(xt),Gr.push(Ft-1),Gr.push(Qn)),(Ce===0?St+Xt>=Gt:Qe+Xt>=Er)&&(Gr.push(Ft+1),Gr.push(ke),Gr.push(Qn))}return Qr}function W(ut,qe,St,Qe){var Xt=ut-St,wr=qe-Qe;return Xt*Xt+wr*wr}var pe=function(ut){return ut[0]},ce=function(ut){return ut[1]},Be=function(qe,St,Qe,Xt,wr){St===void 0&&(St=pe),Qe===void 0&&(Qe=ce),Xt===void 0&&(Xt=64),wr===void 0&&(wr=Float64Array),this.nodeSize=Xt,this.points=qe;for(var Gr=qe.length<65536?Uint16Array:Uint32Array,Qr=this.ids=new Gr(qe.length),A=this.coords=new wr(qe.length*2),Ce=0;Ce<qe.length;Ce++)Qr[Ce]=Ce,A[2*Ce]=St(qe[Ce]),A[2*Ce+1]=Qe(qe[Ce]);ne(Qr,A,Xt,0,Qr.length-1,0)};Be.prototype.range=function(qe,St,Qe,Xt){return m(this.ids,this.coords,qe,St,Qe,Xt,this.nodeSize)},Be.prototype.within=function(qe,St,Qe){return Oe(this.ids,this.coords,qe,St,Qe,this.nodeSize)};var _e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ut){return ut}},tt=Math.fround||function(ut){return function(qe){return ut[0]=+qe,ut[0]}}(new Float32Array(1)),pt=function(qe){this.options=ir(Object.create(_e),qe),this.trees=new Array(this.options.maxZoom+1)};pt.prototype.load=function(qe){var St=this.options,Qe=St.log,Xt=St.minZoom,wr=St.maxZoom,Gr=St.nodeSize;Qe&&console.time("total time");var Qr="prepare "+qe.length+" points";Qe&&console.time(Qr),this.points=qe;for(var A=[],Ce=0;Ce<qe.length;Ce++)!qe[Ce].geometry||A.push(Jt(qe[Ce],Ce));this.trees[wr+1]=new Be(A,Y,Wt,Gr,Float32Array),Qe&&console.timeEnd(Qr);for(var ke=wr;ke>=Xt;ke--){var xt=+Date.now();A=this._cluster(A,ke),this.trees[ke]=new Be(A,Y,Wt,Gr,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",ke,A.length,+Date.now()-xt)}return Qe&&console.timeEnd("total time"),this},pt.prototype.getClusters=function(qe,St){var Qe=((qe[0]+180)%360+360)%360-180,Xt=Math.max(-90,Math.min(90,qe[1])),wr=qe[2]===180?180:((qe[2]+180)%360+360)%360-180,Gr=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)Qe=-180,wr=180;else if(Qe>wr){var Qr=this.getClusters([Qe,Xt,180,Gr],St),A=this.getClusters([-180,Xt,wr,Gr],St);return Qr.concat(A)}for(var Ce=this.trees[this._limitZoom(St)],ke=Ce.range(er(Qe),jt(Gr),er(wr),jt(Xt)),xt=[],ht=0,Ft=ke;ht<Ft.length;ht+=1){var Gt=Ft[ht],Er=Ce.points[Gt];xt.push(Er.numPoints?ur(Er):this.points[Er.index])}return xt},pt.prototype.getChildren=function(qe){var St=this._getOriginId(qe),Qe=this._getOriginZoom(qe),Xt="No cluster with the specified id.",wr=this.trees[Qe];if(!wr)throw new Error(Xt);var Gr=wr.points[St];if(!Gr)throw new Error(Xt);for(var Qr=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),A=wr.within(Gr.x,Gr.y,Qr),Ce=[],ke=0,xt=A;ke<xt.length;ke+=1){var ht=xt[ke],Ft=wr.points[ht];Ft.parentId===qe&&Ce.push(Ft.numPoints?ur(Ft):this.points[Ft.index])}if(Ce.length===0)throw new Error(Xt);return Ce},pt.prototype.getLeaves=function(qe,St,Qe){St=St||10,Qe=Qe||0;var Xt=[];return this._appendLeaves(Xt,qe,St,Qe,0),Xt},pt.prototype.getTile=function(qe,St,Qe){var Xt=this.trees[this._limitZoom(qe)],wr=Math.pow(2,qe),Gr=this.options,Qr=Gr.extent,A=Gr.radius,Ce=A/Qr,ke=(Qe-Ce)/wr,xt=(Qe+1+Ce)/wr,ht={features:[]};return this._addTileFeatures(Xt.range((St-Ce)/wr,ke,(St+1+Ce)/wr,xt),Xt.points,St,Qe,wr,ht),St===0&&this._addTileFeatures(Xt.range(1-Ce/wr,ke,1,xt),Xt.points,wr,Qe,wr,ht),St===wr-1&&this._addTileFeatures(Xt.range(0,ke,Ce/wr,xt),Xt.points,-1,Qe,wr,ht),ht.features.length?ht:null},pt.prototype.getClusterExpansionZoom=function(qe){for(var St=this._getOriginZoom(qe)-1;St<=this.options.maxZoom;){var Qe=this.getChildren(qe);if(St++,Qe.length!==1)break;qe=Qe[0].properties.cluster_id}return St},pt.prototype._appendLeaves=function(qe,St,Qe,Xt,wr){for(var Gr=this.getChildren(St),Qr=0,A=Gr;Qr<A.length;Qr+=1){var Ce=A[Qr],ke=Ce.properties;if(ke&&ke.cluster?wr+ke.point_count<=Xt?wr+=ke.point_count:wr=this._appendLeaves(qe,ke.cluster_id,Qe,Xt,wr):wr<Xt?wr++:qe.push(Ce),qe.length===Qe)break}return wr},pt.prototype._addTileFeatures=function(qe,St,Qe,Xt,wr,Gr){for(var Qr=0,A=qe;Qr<A.length;Qr+=1){var Ce=A[Qr],ke=St[Ce],xt=ke.numPoints,ht=void 0,Ft=void 0,Gt=void 0;if(xt)ht=kt(ke),Ft=ke.x,Gt=ke.y;else{var Er=this.points[ke.index];ht=Er.properties,Ft=er(Er.geometry.coordinates[0]),Gt=jt(Er.geometry.coordinates[1])}var Qn={type:1,geometry:[[Math.round(this.options.extent*(Ft*wr-Qe)),Math.round(this.options.extent*(Gt*wr-Xt))]],tags:ht},gn=void 0;xt?gn=ke.id:this.options.generateId?gn=ke.index:this.points[ke.index].id&&(gn=this.points[ke.index].id),gn!==void 0&&(Qn.id=gn),Gr.features.push(Qn)}},pt.prototype._limitZoom=function(qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+qe),this.options.maxZoom+1))},pt.prototype._cluster=function(qe,St){for(var Qe=[],Xt=this.options,wr=Xt.radius,Gr=Xt.extent,Qr=Xt.reduce,A=Xt.minPoints,Ce=wr/(Gr*Math.pow(2,St)),ke=0;ke<qe.length;ke++){var xt=qe[ke];if(!(xt.zoom<=St)){xt.zoom=St;for(var ht=this.trees[St+1],Ft=ht.within(xt.x,xt.y,Ce),Gt=xt.numPoints||1,Er=Gt,Qn=0,gn=Ft;Qn<gn.length;Qn+=1){var di=gn[Qn],Hn=ht.points[di];Hn.zoom>St&&(Er+=Hn.numPoints||1)}if(Er>Gt&&Er>=A){for(var ai=xt.x*Gt,vi=xt.y*Gt,Xn=Qr&&Gt>1?this._map(xt,!0):null,mi=(ke<<5)+(St+1)+this.points.length,fa=0,Wi=Ft;fa<Wi.length;fa+=1){var Li=Wi[fa],Qi=ht.points[Li];if(!(Qi.zoom<=St)){Qi.zoom=St;var pa=Qi.numPoints||1;ai+=Qi.x*pa,vi+=Qi.y*pa,Qi.parentId=mi,Qr&&(Xn||(Xn=this._map(xt,!0)),Qr(Xn,this._map(Qi)))}}xt.parentId=mi,Qe.push(Et(ai/Er,vi/Er,mi,Er,Xn))}else if(Qe.push(xt),Er>1)for(var Lo=0,Ia=Ft;Lo<Ia.length;Lo+=1){var _a=Ia[Lo],Ni=ht.points[_a];Ni.zoom<=St||(Ni.zoom=St,Qe.push(Ni))}}}return Qe},pt.prototype._getOriginId=function(qe){return qe-this.points.length>>5},pt.prototype._getOriginZoom=function(qe){return(qe-this.points.length)%32},pt.prototype._map=function(qe,St){if(qe.numPoints)return St?ir({},qe.properties):qe.properties;var Qe=this.points[qe.index].properties,Xt=this.options.map(Qe);return St&&Xt===Qe?ir({},Xt):Xt};function Et(ut,qe,St,Qe,Xt){return{x:tt(ut),y:tt(qe),zoom:Infinity,id:St,parentId:-1,numPoints:Qe,properties:Xt}}function Jt(ut,qe){var St=ut.geometry.coordinates,Qe=St[0],Xt=St[1];return{x:tt(er(Qe)),y:tt(jt(Xt)),zoom:Infinity,index:qe,parentId:-1}}function ur(ut){return{type:"Feature",id:ut.id,properties:kt(ut),geometry:{type:"Point",coordinates:[ct(ut.x),dt(ut.y)]}}}function kt(ut){var qe=ut.numPoints,St=qe>=1e4?Math.round(qe/1e3)+"k":qe>=1e3?Math.round(qe/100)/10+"k":qe;return ir(ir({},ut.properties),{cluster:!0,cluster_id:ut.id,point_count:qe,point_count_abbreviated:St})}function er(ut){return ut/360+.5}function jt(ut){var qe=Math.sin(ut*Math.PI/180),St=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return St<0?0:St>1?1:St}function ct(ut){return(ut-.5)*360}function dt(ut){var qe=(180-ut*360)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function ir(ut,qe){for(var St in qe)ut[St]=qe[St];return ut}function Y(ut){return ut.x}function Wt(ut){return ut.y}return pt})},75752:function(Ar){Ar.exports.RADIUS=6378137,Ar.exports.FLATTENING=1/298.257223563,Ar.exports.POLAR_RADIUS=63567523142e-4}}]);
